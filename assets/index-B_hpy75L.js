(function(){const on=document.createElement("link").relList;if(on&&on.supports&&on.supports("modulepreload"))return;for(const kt of document.querySelectorAll('link[rel="modulepreload"]'))nt(kt);new MutationObserver(kt=>{for(const jt of kt)if(jt.type==="childList")for(const hn of jt.addedNodes)hn.tagName==="LINK"&&hn.rel==="modulepreload"&&nt(hn)}).observe(document,{childList:!0,subtree:!0});function Fe(kt){const jt={};return kt.integrity&&(jt.integrity=kt.integrity),kt.referrerPolicy&&(jt.referrerPolicy=kt.referrerPolicy),kt.crossOrigin==="use-credentials"?jt.credentials="include":kt.crossOrigin==="anonymous"?jt.credentials="omit":jt.credentials="same-origin",jt}function nt(kt){if(kt.ep)return;kt.ep=!0;const jt=Fe(kt);fetch(kt.href,jt)}})();var kO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fx(wt){return wt&&wt.__esModule&&Object.prototype.hasOwnProperty.call(wt,"default")?wt.default:wt}var MO={exports:{}},Mg={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ix;function aH(){if(ix)return Mg;ix=1;var wt=Symbol.for("react.transitional.element"),on=Symbol.for("react.fragment");function Fe(nt,kt,jt){var hn=null;if(jt!==void 0&&(hn=""+jt),kt.key!==void 0&&(hn=""+kt.key),"key"in kt){jt={};for(var Ci in kt)Ci!=="key"&&(jt[Ci]=kt[Ci])}else jt=kt;return kt=jt.ref,{$$typeof:wt,type:nt,key:hn,ref:kt!==void 0?kt:null,props:jt}}return Mg.Fragment=on,Mg.jsx=Fe,Mg.jsxs=Fe,Mg}var rx;function sH(){return rx||(rx=1,MO.exports=aH()),MO.exports}var ha=sH(),UO={exports:{}},we={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ax;function oH(){if(ax)return we;ax=1;var wt=Symbol.for("react.transitional.element"),on=Symbol.for("react.portal"),Fe=Symbol.for("react.fragment"),nt=Symbol.for("react.strict_mode"),kt=Symbol.for("react.profiler"),jt=Symbol.for("react.consumer"),hn=Symbol.for("react.context"),Ci=Symbol.for("react.forward_ref"),Ht=Symbol.for("react.suspense"),St=Symbol.for("react.memo"),zt=Symbol.for("react.lazy"),Yt=Symbol.iterator;function he(H){return H===null||typeof H!="object"?null:(H=Yt&&H[Yt]||H["@@iterator"],typeof H=="function"?H:null)}var Qn={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},le=Object.assign,Mn={};function Sn(H,Tt,Nt){this.props=H,this.context=Tt,this.refs=Mn,this.updater=Nt||Qn}Sn.prototype.isReactComponent={},Sn.prototype.setState=function(H,Tt){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,Tt,"setState")},Sn.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function Ai(){}Ai.prototype=Sn.prototype;function Pi(H,Tt,Nt){this.props=H,this.context=Tt,this.refs=Mn,this.updater=Nt||Qn}var Hn=Pi.prototype=new Ai;Hn.constructor=Pi,le(Hn,Sn.prototype),Hn.isPureReactComponent=!0;var Hr=Array.isArray,Ye={H:null,A:null,T:null,S:null,V:null},Ir=Object.prototype.hasOwnProperty;function Wn(H,Tt,Nt,Ot,Gt,qe){return Nt=qe.ref,{$$typeof:wt,type:H,key:Tt,ref:Nt!==void 0?Nt:null,props:qe}}function Or(H,Tt){return Wn(H.type,Tt,void 0,void 0,void 0,H.props)}function Va(H){return typeof H=="object"&&H!==null&&H.$$typeof===wt}function Ba(H){var Tt={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(Nt){return Tt[Nt]})}var pa=/\/+/g;function ke(H,Tt){return typeof H=="object"&&H!==null&&H.key!=null?Ba(""+H.key):Tt.toString(36)}function Fa(){}function Kn(H){switch(H.status){case"fulfilled":return H.value;case"rejected":throw H.reason;default:switch(typeof H.status=="string"?H.then(Fa,Fa):(H.status="pending",H.then(function(Tt){H.status==="pending"&&(H.status="fulfilled",H.value=Tt)},function(Tt){H.status==="pending"&&(H.status="rejected",H.reason=Tt)})),H.status){case"fulfilled":return H.value;case"rejected":throw H.reason}}throw H}function Hi(H,Tt,Nt,Ot,Gt){var qe=typeof H;(qe==="undefined"||qe==="boolean")&&(H=null);var pe=!1;if(H===null)pe=!0;else switch(qe){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(H.$$typeof){case wt:case on:pe=!0;break;case zt:return pe=H._init,Hi(pe(H._payload),Tt,Nt,Ot,Gt)}}if(pe)return Gt=Gt(H),pe=Ot===""?"."+ke(H,0):Ot,Hr(Gt)?(Nt="",pe!=null&&(Nt=pe.replace(pa,"$&/")+"/"),Hi(Gt,Tt,Nt,"",function(fa){return fa})):Gt!=null&&(Va(Gt)&&(Gt=Or(Gt,Nt+(Gt.key==null||H&&H.key===Gt.key?"":(""+Gt.key).replace(pa,"$&/")+"/")+pe)),Tt.push(Gt)),1;pe=0;var tr=Ot===""?".":Ot+":";if(Hr(H))for(var Un=0;Un<H.length;Un++)Ot=H[Un],qe=tr+ke(Ot,Un),pe+=Hi(Ot,Tt,Nt,qe,Gt);else if(Un=he(H),typeof Un=="function")for(H=Un.call(H),Un=0;!(Ot=H.next()).done;)Ot=Ot.value,qe=tr+ke(Ot,Un++),pe+=Hi(Ot,Tt,Nt,qe,Gt);else if(qe==="object"){if(typeof H.then=="function")return Hi(Kn(H),Tt,Nt,Ot,Gt);throw Tt=String(H),Error("Objects are not valid as a React child (found: "+(Tt==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":Tt)+"). If you meant to render a collection of children, use an array instead.")}return pe}function ot(H,Tt,Nt){if(H==null)return H;var Ot=[],Gt=0;return Hi(H,Ot,"","",function(qe){return Tt.call(Nt,qe,Gt++)}),Ot}function Rt(H){if(H._status===-1){var Tt=H._result;Tt=Tt(),Tt.then(function(Nt){(H._status===0||H._status===-1)&&(H._status=1,H._result=Nt)},function(Nt){(H._status===0||H._status===-1)&&(H._status=2,H._result=Nt)}),H._status===-1&&(H._status=0,H._result=Tt)}if(H._status===1)return H._result.default;throw H._result}var Qt=typeof reportError=="function"?reportError:function(H){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Tt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof H=="object"&&H!==null&&typeof H.message=="string"?String(H.message):String(H),error:H});if(!window.dispatchEvent(Tt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",H);return}console.error(H)};function pn(){}return we.Children={map:ot,forEach:function(H,Tt,Nt){ot(H,function(){Tt.apply(this,arguments)},Nt)},count:function(H){var Tt=0;return ot(H,function(){Tt++}),Tt},toArray:function(H){return ot(H,function(Tt){return Tt})||[]},only:function(H){if(!Va(H))throw Error("React.Children.only expected to receive a single React element child.");return H}},we.Component=Sn,we.Fragment=Fe,we.Profiler=kt,we.PureComponent=Pi,we.StrictMode=nt,we.Suspense=Ht,we.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ye,we.__COMPILER_RUNTIME={__proto__:null,c:function(H){return Ye.H.useMemoCache(H)}},we.cache=function(H){return function(){return H.apply(null,arguments)}},we.cloneElement=function(H,Tt,Nt){if(H==null)throw Error("The argument must be a React element, but you passed "+H+".");var Ot=le({},H.props),Gt=H.key,qe=void 0;if(Tt!=null)for(pe in Tt.ref!==void 0&&(qe=void 0),Tt.key!==void 0&&(Gt=""+Tt.key),Tt)!Ir.call(Tt,pe)||pe==="key"||pe==="__self"||pe==="__source"||pe==="ref"&&Tt.ref===void 0||(Ot[pe]=Tt[pe]);var pe=arguments.length-2;if(pe===1)Ot.children=Nt;else if(1<pe){for(var tr=Array(pe),Un=0;Un<pe;Un++)tr[Un]=arguments[Un+2];Ot.children=tr}return Wn(H.type,Gt,void 0,void 0,qe,Ot)},we.createContext=function(H){return H={$$typeof:hn,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null},H.Provider=H,H.Consumer={$$typeof:jt,_context:H},H},we.createElement=function(H,Tt,Nt){var Ot,Gt={},qe=null;if(Tt!=null)for(Ot in Tt.key!==void 0&&(qe=""+Tt.key),Tt)Ir.call(Tt,Ot)&&Ot!=="key"&&Ot!=="__self"&&Ot!=="__source"&&(Gt[Ot]=Tt[Ot]);var pe=arguments.length-2;if(pe===1)Gt.children=Nt;else if(1<pe){for(var tr=Array(pe),Un=0;Un<pe;Un++)tr[Un]=arguments[Un+2];Gt.children=tr}if(H&&H.defaultProps)for(Ot in pe=H.defaultProps,pe)Gt[Ot]===void 0&&(Gt[Ot]=pe[Ot]);return Wn(H,qe,void 0,void 0,null,Gt)},we.createRef=function(){return{current:null}},we.forwardRef=function(H){return{$$typeof:Ci,render:H}},we.isValidElement=Va,we.lazy=function(H){return{$$typeof:zt,_payload:{_status:-1,_result:H},_init:Rt}},we.memo=function(H,Tt){return{$$typeof:St,type:H,compare:Tt===void 0?null:Tt}},we.startTransition=function(H){var Tt=Ye.T,Nt={};Ye.T=Nt;try{var Ot=H(),Gt=Ye.S;Gt!==null&&Gt(Nt,Ot),typeof Ot=="object"&&Ot!==null&&typeof Ot.then=="function"&&Ot.then(pn,Qt)}catch(qe){Qt(qe)}finally{Ye.T=Tt}},we.unstable_useCacheRefresh=function(){return Ye.H.useCacheRefresh()},we.use=function(H){return Ye.H.use(H)},we.useActionState=function(H,Tt,Nt){return Ye.H.useActionState(H,Tt,Nt)},we.useCallback=function(H,Tt){return Ye.H.useCallback(H,Tt)},we.useContext=function(H){return Ye.H.useContext(H)},we.useDebugValue=function(){},we.useDeferredValue=function(H,Tt){return Ye.H.useDeferredValue(H,Tt)},we.useEffect=function(H,Tt,Nt){var Ot=Ye.H;if(typeof Nt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Ot.useEffect(H,Tt)},we.useId=function(){return Ye.H.useId()},we.useImperativeHandle=function(H,Tt,Nt){return Ye.H.useImperativeHandle(H,Tt,Nt)},we.useInsertionEffect=function(H,Tt){return Ye.H.useInsertionEffect(H,Tt)},we.useLayoutEffect=function(H,Tt){return Ye.H.useLayoutEffect(H,Tt)},we.useMemo=function(H,Tt){return Ye.H.useMemo(H,Tt)},we.useOptimistic=function(H,Tt){return Ye.H.useOptimistic(H,Tt)},we.useReducer=function(H,Tt,Nt){return Ye.H.useReducer(H,Tt,Nt)},we.useRef=function(H){return Ye.H.useRef(H)},we.useState=function(H){return Ye.H.useState(H)},we.useSyncExternalStore=function(H,Tt,Nt){return Ye.H.useSyncExternalStore(H,Tt,Nt)},we.useTransition=function(){return Ye.H.useTransition()},we.version="19.1.0",we}var sx;function jO(){return sx||(sx=1,UO.exports=oH()),UO.exports}var nl=jO(),xO={exports:{}},Ug={},VO={exports:{}},BO={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ox;function cH(){return ox||(ox=1,function(wt){function on(ot,Rt){var Qt=ot.length;ot.push(Rt);t:for(;0<Qt;){var pn=Qt-1>>>1,H=ot[pn];if(0<kt(H,Rt))ot[pn]=Rt,ot[Qt]=H,Qt=pn;else break t}}function Fe(ot){return ot.length===0?null:ot[0]}function nt(ot){if(ot.length===0)return null;var Rt=ot[0],Qt=ot.pop();if(Qt!==Rt){ot[0]=Qt;t:for(var pn=0,H=ot.length,Tt=H>>>1;pn<Tt;){var Nt=2*(pn+1)-1,Ot=ot[Nt],Gt=Nt+1,qe=ot[Gt];if(0>kt(Ot,Qt))Gt<H&&0>kt(qe,Ot)?(ot[pn]=qe,ot[Gt]=Qt,pn=Gt):(ot[pn]=Ot,ot[Nt]=Qt,pn=Nt);else if(Gt<H&&0>kt(qe,Qt))ot[pn]=qe,ot[Gt]=Qt,pn=Gt;else break t}}return Rt}function kt(ot,Rt){var Qt=ot.sortIndex-Rt.sortIndex;return Qt!==0?Qt:ot.id-Rt.id}if(wt.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var jt=performance;wt.unstable_now=function(){return jt.now()}}else{var hn=Date,Ci=hn.now();wt.unstable_now=function(){return hn.now()-Ci}}var Ht=[],St=[],zt=1,Yt=null,he=3,Qn=!1,le=!1,Mn=!1,Sn=!1,Ai=typeof setTimeout=="function"?setTimeout:null,Pi=typeof clearTimeout=="function"?clearTimeout:null,Hn=typeof setImmediate<"u"?setImmediate:null;function Hr(ot){for(var Rt=Fe(St);Rt!==null;){if(Rt.callback===null)nt(St);else if(Rt.startTime<=ot)nt(St),Rt.sortIndex=Rt.expirationTime,on(Ht,Rt);else break;Rt=Fe(St)}}function Ye(ot){if(Mn=!1,Hr(ot),!le)if(Fe(Ht)!==null)le=!0,Ir||(Ir=!0,ke());else{var Rt=Fe(St);Rt!==null&&Hi(Ye,Rt.startTime-ot)}}var Ir=!1,Wn=-1,Or=5,Va=-1;function Ba(){return Sn?!0:!(wt.unstable_now()-Va<Or)}function pa(){if(Sn=!1,Ir){var ot=wt.unstable_now();Va=ot;var Rt=!0;try{t:{le=!1,Mn&&(Mn=!1,Pi(Wn),Wn=-1),Qn=!0;var Qt=he;try{e:{for(Hr(ot),Yt=Fe(Ht);Yt!==null&&!(Yt.expirationTime>ot&&Ba());){var pn=Yt.callback;if(typeof pn=="function"){Yt.callback=null,he=Yt.priorityLevel;var H=pn(Yt.expirationTime<=ot);if(ot=wt.unstable_now(),typeof H=="function"){Yt.callback=H,Hr(ot),Rt=!0;break e}Yt===Fe(Ht)&&nt(Ht),Hr(ot)}else nt(Ht);Yt=Fe(Ht)}if(Yt!==null)Rt=!0;else{var Tt=Fe(St);Tt!==null&&Hi(Ye,Tt.startTime-ot),Rt=!1}}break t}finally{Yt=null,he=Qt,Qn=!1}Rt=void 0}}finally{Rt?ke():Ir=!1}}}var ke;if(typeof Hn=="function")ke=function(){Hn(pa)};else if(typeof MessageChannel<"u"){var Fa=new MessageChannel,Kn=Fa.port2;Fa.port1.onmessage=pa,ke=function(){Kn.postMessage(null)}}else ke=function(){Ai(pa,0)};function Hi(ot,Rt){Wn=Ai(function(){ot(wt.unstable_now())},Rt)}wt.unstable_IdlePriority=5,wt.unstable_ImmediatePriority=1,wt.unstable_LowPriority=4,wt.unstable_NormalPriority=3,wt.unstable_Profiling=null,wt.unstable_UserBlockingPriority=2,wt.unstable_cancelCallback=function(ot){ot.callback=null},wt.unstable_forceFrameRate=function(ot){0>ot||125<ot?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Or=0<ot?Math.floor(1e3/ot):5},wt.unstable_getCurrentPriorityLevel=function(){return he},wt.unstable_next=function(ot){switch(he){case 1:case 2:case 3:var Rt=3;break;default:Rt=he}var Qt=he;he=Rt;try{return ot()}finally{he=Qt}},wt.unstable_requestPaint=function(){Sn=!0},wt.unstable_runWithPriority=function(ot,Rt){switch(ot){case 1:case 2:case 3:case 4:case 5:break;default:ot=3}var Qt=he;he=ot;try{return Rt()}finally{he=Qt}},wt.unstable_scheduleCallback=function(ot,Rt,Qt){var pn=wt.unstable_now();switch(typeof Qt=="object"&&Qt!==null?(Qt=Qt.delay,Qt=typeof Qt=="number"&&0<Qt?pn+Qt:pn):Qt=pn,ot){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=Qt+H,ot={id:zt++,callback:Rt,priorityLevel:ot,startTime:Qt,expirationTime:H,sortIndex:-1},Qt>pn?(ot.sortIndex=Qt,on(St,ot),Fe(Ht)===null&&ot===Fe(St)&&(Mn?(Pi(Wn),Wn=-1):Mn=!0,Hi(Ye,Qt-pn))):(ot.sortIndex=H,on(Ht,ot),le||Qn||(le=!0,Ir||(Ir=!0,ke()))),ot},wt.unstable_shouldYield=Ba,wt.unstable_wrapCallback=function(ot){var Rt=he;return function(){var Qt=he;he=Rt;try{return ot.apply(this,arguments)}finally{he=Qt}}}}(BO)),BO}var cx;function lH(){return cx||(cx=1,VO.exports=cH()),VO.exports}var FO={exports:{}},br={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lx;function dH(){if(lx)return br;lx=1;var wt=jO();function on(Ht){var St="https://react.dev/errors/"+Ht;if(1<arguments.length){St+="?args[]="+encodeURIComponent(arguments[1]);for(var zt=2;zt<arguments.length;zt++)St+="&args[]="+encodeURIComponent(arguments[zt])}return"Minified React error #"+Ht+"; visit "+St+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Fe(){}var nt={d:{f:Fe,r:function(){throw Error(on(522))},D:Fe,C:Fe,L:Fe,m:Fe,X:Fe,S:Fe,M:Fe},p:0,findDOMNode:null},kt=Symbol.for("react.portal");function jt(Ht,St,zt){var Yt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:kt,key:Yt==null?null:""+Yt,children:Ht,containerInfo:St,implementation:zt}}var hn=wt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Ci(Ht,St){if(Ht==="font")return"";if(typeof St=="string")return St==="use-credentials"?St:""}return br.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=nt,br.createPortal=function(Ht,St){var zt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!St||St.nodeType!==1&&St.nodeType!==9&&St.nodeType!==11)throw Error(on(299));return jt(Ht,St,null,zt)},br.flushSync=function(Ht){var St=hn.T,zt=nt.p;try{if(hn.T=null,nt.p=2,Ht)return Ht()}finally{hn.T=St,nt.p=zt,nt.d.f()}},br.preconnect=function(Ht,St){typeof Ht=="string"&&(St?(St=St.crossOrigin,St=typeof St=="string"?St==="use-credentials"?St:"":void 0):St=null,nt.d.C(Ht,St))},br.prefetchDNS=function(Ht){typeof Ht=="string"&&nt.d.D(Ht)},br.preinit=function(Ht,St){if(typeof Ht=="string"&&St&&typeof St.as=="string"){var zt=St.as,Yt=Ci(zt,St.crossOrigin),he=typeof St.integrity=="string"?St.integrity:void 0,Qn=typeof St.fetchPriority=="string"?St.fetchPriority:void 0;zt==="style"?nt.d.S(Ht,typeof St.precedence=="string"?St.precedence:void 0,{crossOrigin:Yt,integrity:he,fetchPriority:Qn}):zt==="script"&&nt.d.X(Ht,{crossOrigin:Yt,integrity:he,fetchPriority:Qn,nonce:typeof St.nonce=="string"?St.nonce:void 0})}},br.preinitModule=function(Ht,St){if(typeof Ht=="string")if(typeof St=="object"&&St!==null){if(St.as==null||St.as==="script"){var zt=Ci(St.as,St.crossOrigin);nt.d.M(Ht,{crossOrigin:zt,integrity:typeof St.integrity=="string"?St.integrity:void 0,nonce:typeof St.nonce=="string"?St.nonce:void 0})}}else St==null&&nt.d.M(Ht)},br.preload=function(Ht,St){if(typeof Ht=="string"&&typeof St=="object"&&St!==null&&typeof St.as=="string"){var zt=St.as,Yt=Ci(zt,St.crossOrigin);nt.d.L(Ht,zt,{crossOrigin:Yt,integrity:typeof St.integrity=="string"?St.integrity:void 0,nonce:typeof St.nonce=="string"?St.nonce:void 0,type:typeof St.type=="string"?St.type:void 0,fetchPriority:typeof St.fetchPriority=="string"?St.fetchPriority:void 0,referrerPolicy:typeof St.referrerPolicy=="string"?St.referrerPolicy:void 0,imageSrcSet:typeof St.imageSrcSet=="string"?St.imageSrcSet:void 0,imageSizes:typeof St.imageSizes=="string"?St.imageSizes:void 0,media:typeof St.media=="string"?St.media:void 0})}},br.preloadModule=function(Ht,St){if(typeof Ht=="string")if(St){var zt=Ci(St.as,St.crossOrigin);nt.d.m(Ht,{as:typeof St.as=="string"&&St.as!=="script"?St.as:void 0,crossOrigin:zt,integrity:typeof St.integrity=="string"?St.integrity:void 0})}else nt.d.m(Ht)},br.requestFormReset=function(Ht){nt.d.r(Ht)},br.unstable_batchedUpdates=function(Ht,St){return Ht(St)},br.useFormState=function(Ht,St,zt){return hn.H.useFormState(Ht,St,zt)},br.useFormStatus=function(){return hn.H.useHostTransitionStatus()},br.version="19.1.0",br}var dx;function uH(){if(dx)return FO.exports;dx=1;function wt(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(wt)}catch(on){console.error(on)}}return wt(),FO.exports=dH(),FO.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ux;function hH(){if(ux)return Ug;ux=1;var wt=lH(),on=jO(),Fe=uH();function nt(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function kt(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function jt(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function hn(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function Ci(a){if(jt(a)!==a)throw Error(nt(188))}function Ht(a){var o=a.alternate;if(!o){if(o=jt(a),o===null)throw Error(nt(188));return o!==a?null:a}for(var u=a,f=o;;){var E=u.return;if(E===null)break;var T=E.alternate;if(T===null){if(f=E.return,f!==null){u=f;continue}break}if(E.child===T.child){for(T=E.child;T;){if(T===u)return Ci(E),a;if(T===f)return Ci(E),o;T=T.sibling}throw Error(nt(188))}if(u.return!==f.return)u=E,f=T;else{for(var w=!1,P=E.child;P;){if(P===u){w=!0,u=E,f=T;break}if(P===f){w=!0,f=E,u=T;break}P=P.sibling}if(!w){for(P=T.child;P;){if(P===u){w=!0,u=T,f=E;break}if(P===f){w=!0,f=T,u=E;break}P=P.sibling}if(!w)throw Error(nt(189))}}if(u.alternate!==f)throw Error(nt(190))}if(u.tag!==3)throw Error(nt(188));return u.stateNode.current===u?a:o}function St(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=St(a),o!==null)return o;a=a.sibling}return null}var zt=Object.assign,Yt=Symbol.for("react.element"),he=Symbol.for("react.transitional.element"),Qn=Symbol.for("react.portal"),le=Symbol.for("react.fragment"),Mn=Symbol.for("react.strict_mode"),Sn=Symbol.for("react.profiler"),Ai=Symbol.for("react.provider"),Pi=Symbol.for("react.consumer"),Hn=Symbol.for("react.context"),Hr=Symbol.for("react.forward_ref"),Ye=Symbol.for("react.suspense"),Ir=Symbol.for("react.suspense_list"),Wn=Symbol.for("react.memo"),Or=Symbol.for("react.lazy"),Va=Symbol.for("react.activity"),Ba=Symbol.for("react.memo_cache_sentinel"),pa=Symbol.iterator;function ke(a){return a===null||typeof a!="object"?null:(a=pa&&a[pa]||a["@@iterator"],typeof a=="function"?a:null)}var Fa=Symbol.for("react.client.reference");function Kn(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Fa?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case le:return"Fragment";case Sn:return"Profiler";case Mn:return"StrictMode";case Ye:return"Suspense";case Ir:return"SuspenseList";case Va:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case Qn:return"Portal";case Hn:return(a.displayName||"Context")+".Provider";case Pi:return(a._context.displayName||"Context")+".Consumer";case Hr:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Wn:return o=a.displayName||null,o!==null?o:Kn(a.type)||"Memo";case Or:o=a._payload,a=a._init;try{return Kn(a(o))}catch{}}return null}var Hi=Array.isArray,ot=on.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Rt=Fe.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Qt={pending:!1,data:null,method:null,action:null},pn=[],H=-1;function Tt(a){return{current:a}}function Nt(a){0>H||(a.current=pn[H],pn[H]=null,H--)}function Ot(a,o){H++,pn[H]=a.current,a.current=o}var Gt=Tt(null),qe=Tt(null),pe=Tt(null),tr=Tt(null);function Un(a,o){switch(Ot(pe,o),Ot(qe,a),Ot(Gt,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?WT(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=WT(o),a=KT(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Nt(Gt),Ot(Gt,a)}function fa(){Nt(Gt),Nt(qe),Nt(pe)}function il(a){a.memoizedState!==null&&Ot(tr,a);var o=Gt.current,u=KT(o,a.type);o!==u&&(Ot(qe,a),Ot(Gt,u))}function Ch(a){qe.current===a&&(Nt(Gt),Nt(qe)),tr.current===a&&(Nt(tr),Mu._currentValue=Qt)}var a_=Object.prototype.hasOwnProperty,vs=wt.unstable_scheduleCallback,s_=wt.unstable_cancelCallback,ky=wt.unstable_shouldYield,no=wt.unstable_requestPaint,ja=wt.unstable_now,ki=wt.unstable_getCurrentPriorityLevel,hr=wt.unstable_ImmediatePriority,Ah=wt.unstable_UserBlockingPriority,rl=wt.unstable_NormalPriority,My=wt.unstable_LowPriority,o_=wt.unstable_IdlePriority,Mi=wt.log,Vg=wt.unstable_setDisableYieldValue,al=null,Zn=null;function Rs(a){if(typeof Mi=="function"&&Vg(a),Zn&&typeof Zn.setStrictMode=="function")try{Zn.setStrictMode(al,a)}catch{}}var er=Math.clz32?Math.clz32:jg,Bg=Math.log,Fg=Math.LN2;function jg(a){return a>>>=0,a===0?32:31-(Bg(a)/Fg|0)|0}var Nd=256,Ga=4194304;function io(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function bh(a,o,u){var f=a.pendingLanes;if(f===0)return 0;var E=0,T=a.suspendedLanes,w=a.pingedLanes;a=a.warmLanes;var P=f&134217727;return P!==0?(f=P&~T,f!==0?E=io(f):(w&=P,w!==0?E=io(w):u||(u=P&~a,u!==0&&(E=io(u))))):(P=f&~T,P!==0?E=io(P):w!==0?E=io(w):u||(u=f&~a,u!==0&&(E=io(u)))),E===0?0:o!==0&&o!==E&&(o&T)===0&&(T=E&-E,u=o&-o,T>=u||T===32&&(u&4194048)!==0)?o:E}function Dd(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function sl(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function c_(){var a=Nd;return Nd<<=1,(Nd&4194048)===0&&(Nd=256),a}function Gg(){var a=Ga;return Ga<<=1,(Ga&62914560)===0&&(Ga=4194304),a}function l_(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function Ld(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Uy(a,o,u,f,E,T){var w=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var P=a.entanglements,F=a.expirationTimes,J=a.hiddenUpdates;for(u=w&~u;0<u;){var ct=31-er(u),mt=1<<ct;P[ct]=0,F[ct]=-1;var tt=J[ct];if(tt!==null)for(J[ct]=null,ct=0;ct<tt.length;ct++){var et=tt[ct];et!==null&&(et.lane&=-536870913)}u&=~mt}f!==0&&ol(a,f,0),T!==0&&E===0&&a.tag!==0&&(a.suspendedLanes|=T&~(w&~o))}function ol(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var f=31-er(o);a.entangledLanes|=o,a.entanglements[f]=a.entanglements[f]|1073741824|u&4194090}function Hg(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var f=31-er(u),E=1<<f;E&o|a[f]&o&&(a[f]|=o),u&=~E}}function ro(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function d_(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Wg(){var a=Rt.p;return a!==0?a:(a=window.event,a===void 0?32:lv(a.type))}function xy(a,o){var u=Rt.p;try{return Rt.p=a,o()}finally{Rt.p=u}}var $n=Math.random().toString(36).slice(2),Wi="__reactFiber$"+$n,pr="__reactProps$"+$n,ys="__reactContainer$"+$n,Ih="__reactEvents$"+$n,Kg="__reactListeners$"+$n,zg="__reactHandles$"+$n,Yg="__reactResources$"+$n,cl="__reactMarker$"+$n;function Oh(a){delete a[Wi],delete a[pr],delete a[Ih],delete a[Kg],delete a[zg]}function ll(a){var o=a[Wi];if(o)return o;for(var u=a.parentNode;u;){if(o=u[ys]||u[Wi]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=XT(a);a!==null;){if(u=a[Wi])return u;a=XT(a)}return o}a=u,u=a.parentNode}return null}function dl(a){if(a=a[Wi]||a[ys]){var o=a.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return a}return null}function Pd(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(nt(33))}function nc(a){var o=a[Yg];return o||(o=a[Yg]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function fi(a){a[cl]=!0}var wh=new Set,u_={};function Wr(a,o){ul(a,o),ul(a+"Capture",o)}function ul(a,o){for(u_[a]=o,a=0;a<o.length;a++)wh.add(o[a])}var Vy=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),_a={},qg={};function By(a){return a_.call(qg,a)?!0:a_.call(_a,a)?!1:Vy.test(a)?qg[a]=!0:(_a[a]=!0,!1)}function Vn(a,o,u){if(By(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function Nh(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function Cs(a,o,u,f){if(f===null)a.removeAttribute(u);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+f)}}var h_,Xg;function ao(a){if(h_===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);h_=o&&o[1]||"",Xg=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+h_+a+Xg}var p_=!1;function Dh(a,o){if(!a||p_)return"";p_=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var mt=function(){throw Error()};if(Object.defineProperty(mt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(mt,[])}catch(et){var tt=et}Reflect.construct(a,[],mt)}else{try{mt.call()}catch(et){tt=et}a.call(mt.prototype)}}else{try{throw Error()}catch(et){tt=et}(mt=a())&&typeof mt.catch=="function"&&mt.catch(function(){})}}catch(et){if(et&&tt&&typeof et.stack=="string")return[et.stack,tt.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=f.DetermineComponentFrameRoot(),w=T[0],P=T[1];if(w&&P){var F=w.split(`
`),J=P.split(`
`);for(E=f=0;f<F.length&&!F[f].includes("DetermineComponentFrameRoot");)f++;for(;E<J.length&&!J[E].includes("DetermineComponentFrameRoot");)E++;if(f===F.length||E===J.length)for(f=F.length-1,E=J.length-1;1<=f&&0<=E&&F[f]!==J[E];)E--;for(;1<=f&&0<=E;f--,E--)if(F[f]!==J[E]){if(f!==1||E!==1)do if(f--,E--,0>E||F[f]!==J[E]){var ct=`
`+F[f].replace(" at new "," at ");return a.displayName&&ct.includes("<anonymous>")&&(ct=ct.replace("<anonymous>",a.displayName)),ct}while(1<=f&&0<=E);break}}}finally{p_=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?ao(u):""}function Fy(a){switch(a.tag){case 26:case 27:case 5:return ao(a.type);case 16:return ao("Lazy");case 13:return ao("Suspense");case 19:return ao("SuspenseList");case 0:case 15:return Dh(a.type,!1);case 11:return Dh(a.type.render,!1);case 1:return Dh(a.type,!0);case 31:return ao("Activity");default:return""}}function Jg(a){try{var o="";do o+=Fy(a),a=a.return;while(a);return o}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function Kr(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function ic(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function f_(a){var o=ic(a)?"checked":"value",u=Object.getOwnPropertyDescriptor(a.constructor.prototype,o),f=""+a[o];if(!a.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var E=u.get,T=u.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return E.call(this)},set:function(w){f=""+w,T.call(this,w)}}),Object.defineProperty(a,o,{enumerable:u.enumerable}),{getValue:function(){return f},setValue:function(w){f=""+w},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function Lh(a){a._valueTracker||(a._valueTracker=f_(a))}function fn(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),f="";return a&&(f=ic(a)?a.checked?"true":"false":a.value),a=f,a!==u?(o.setValue(a),!0):!1}function Ph(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Qg=/[\n"\\]/g;function wr(a){return a.replace(Qg,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function __(a,o,u,f,E,T,w,P){a.name="",w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"?a.type=w:a.removeAttribute("type"),o!=null?w==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+Kr(o)):a.value!==""+Kr(o)&&(a.value=""+Kr(o)):w!=="submit"&&w!=="reset"||a.removeAttribute("value"),o!=null?m_(a,w,Kr(o)):u!=null?m_(a,w,Kr(u)):f!=null&&a.removeAttribute("value"),E==null&&T!=null&&(a.defaultChecked=!!T),E!=null&&(a.checked=E&&typeof E!="function"&&typeof E!="symbol"),P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?a.name=""+Kr(P):a.removeAttribute("name")}function Zg(a,o,u,f,E,T,w,P){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(a.type=T),o!=null||u!=null){if(!(T!=="submit"&&T!=="reset"||o!=null))return;u=u!=null?""+Kr(u):"",o=o!=null?""+Kr(o):u,P||o===a.value||(a.value=o),a.defaultValue=o}f=f??E,f=typeof f!="function"&&typeof f!="symbol"&&!!f,a.checked=P?a.checked:!!f,a.defaultChecked=!!f,w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(a.name=w)}function m_(a,o,u){o==="number"&&Ph(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function hl(a,o,u,f){if(a=a.options,o){o={};for(var E=0;E<u.length;E++)o["$"+u[E]]=!0;for(u=0;u<a.length;u++)E=o.hasOwnProperty("$"+a[u].value),a[u].selected!==E&&(a[u].selected=E),E&&f&&(a[u].defaultSelected=!0)}else{for(u=""+Kr(u),o=null,E=0;E<a.length;E++){if(a[E].value===u){a[E].selected=!0,f&&(a[E].defaultSelected=!0);return}o!==null||a[E].disabled||(o=a[E])}o!==null&&(o.selected=!0)}}function $g(a,o,u){if(o!=null&&(o=""+Kr(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+Kr(u):""}function tS(a,o,u,f){if(o==null){if(f!=null){if(u!=null)throw Error(nt(92));if(Hi(f)){if(1<f.length)throw Error(nt(93));f=f[0]}u=f}u==null&&(u=""),o=u}u=Kr(o),a.defaultValue=u,f=a.textContent,f===u&&f!==""&&f!==null&&(a.value=f)}function so(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var eS=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kh(a,o,u){var f=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?f?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":f?a.setProperty(o,u):typeof u!="number"||u===0||eS.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function nS(a,o,u){if(o!=null&&typeof o!="object")throw Error(nt(62));if(a=a.style,u!=null){for(var f in u)!u.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?a.setProperty(f,""):f==="float"?a.cssFloat="":a[f]="");for(var E in o)f=o[E],o.hasOwnProperty(E)&&u[E]!==f&&kh(a,E,f)}else for(var T in o)o.hasOwnProperty(T)&&kh(a,T,o[T])}function kd(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jy=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),iS=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Mh(a){return iS.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var E_=null;function g_(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var pl=null,fl=null;function rS(a){var o=dl(a);if(o&&(a=o.stateNode)){var u=a[pr]||null;t:switch(a=o.stateNode,o.type){case"input":if(__(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+wr(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var f=u[o];if(f!==a&&f.form===a.form){var E=f[pr]||null;if(!E)throw Error(nt(90));__(f,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(o=0;o<u.length;o++)f=u[o],f.form===a.form&&fn(f)}break t;case"textarea":$g(a,u.value,u.defaultValue);break t;case"select":o=u.value,o!=null&&hl(a,!!u.multiple,o,!1)}}}var S_=!1;function aS(a,o,u){if(S_)return a(o,u);S_=!0;try{var f=a(o);return f}finally{if(S_=!1,(pl!==null||fl!==null)&&(Dc(),pl&&(o=pl,a=fl,fl=pl=null,rS(o),a)))for(o=0;o<a.length;o++)rS(a[o])}}function _l(a,o){var u=a.stateNode;if(u===null)return null;var f=u[pr]||null;if(f===null)return null;u=f[o];t:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(a=a.type,f=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!f;break t;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(nt(231,o,typeof u));return u}var As=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),T_=!1;if(As)try{var Md={};Object.defineProperty(Md,"passive",{get:function(){T_=!0}}),window.addEventListener("test",Md,Md),window.removeEventListener("test",Md,Md)}catch{T_=!1}var zr=null,v_=null,Uh=null;function sS(){if(Uh)return Uh;var a,o=v_,u=o.length,f,E="value"in zr?zr.value:zr.textContent,T=E.length;for(a=0;a<u&&o[a]===E[a];a++);var w=u-a;for(f=1;f<=w&&o[u-f]===E[T-f];f++);return Uh=E.slice(a,1<f?1-f:void 0)}function xh(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function Ud(){return!0}function oS(){return!1}function fr(a){function o(u,f,E,T,w){this._reactName=u,this._targetInst=E,this.type=f,this.nativeEvent=T,this.target=w,this.currentTarget=null;for(var P in a)a.hasOwnProperty(P)&&(u=a[P],this[P]=u?u(T):T[P]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Ud:oS,this.isPropagationStopped=oS,this}return zt(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Ud)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Ud)},persist:function(){},isPersistent:Ud}),o}var rc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ma=fr(rc),Ki=zt({},rc,{view:0,detail:0}),cS=fr(Ki),R_,y_,xd,bi=zt({},Ki,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:I_,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==xd&&(xd&&a.type==="mousemove"?(R_=a.screenX-xd.screenX,y_=a.screenY-xd.screenY):y_=R_=0,xd=a),R_)},movementY:function(a){return"movementY"in a?a.movementY:y_}}),lS=fr(bi),Gy=zt({},bi,{dataTransfer:0}),Hy=fr(Gy),Vh=zt({},Ki,{relatedTarget:0}),Bh=fr(Vh),Wy=zt({},rc,{animationName:0,elapsedTime:0,pseudoElement:0}),C_=fr(Wy),Ky=zt({},rc,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),A_=fr(Ky),b_=zt({},rc,{data:0}),Fh=fr(b_),zy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Yy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ac={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vd(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=ac[a])?!!o[a]:!1}function I_(){return Vd}var qy=zt({},Ki,{key:function(a){if(a.key){var o=zy[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=xh(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Yy[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:I_,charCode:function(a){return a.type==="keypress"?xh(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?xh(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Xy=fr(qy),Jy=zt({},bi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dS=fr(Jy),ml=zt({},Ki,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:I_}),Qy=fr(ml),El=zt({},rc,{propertyName:0,elapsedTime:0,pseudoElement:0}),uS=fr(El),Zy=zt({},bi,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),fe=fr(Zy),$y=zt({},rc,{newState:0,oldState:0}),tC=fr($y),eC=[9,13,27,32],O_=As&&"CompositionEvent"in window,sc=null;As&&"documentMode"in document&&(sc=document.documentMode);var nC=As&&"TextEvent"in window&&!sc,hS=As&&(!O_||sc&&8<sc&&11>=sc),pS=" ",jh=!1;function fS(a,o){switch(a){case"keyup":return eC.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _S(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var oc=!1;function iC(a,o){switch(a){case"compositionend":return _S(o);case"keypress":return o.which!==32?null:(jh=!0,pS);case"textInput":return a=o.data,a===pS&&jh?null:a;default:return null}}function oo(a,o){if(oc)return a==="compositionend"||!O_&&fS(a,o)?(a=sS(),Uh=v_=zr=null,oc=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return hS&&o.locale!=="ko"?null:o.data;default:return null}}var rC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mS(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!rC[a.type]:o==="textarea"}function ES(a,o,u,f){pl?fl?fl.push(f):fl=[f]:pl=f,o=Ou(o,"onChange"),0<o.length&&(u=new ma("onChange","change",null,u,f),a.push({event:u,listeners:o}))}var gl=null,cc=null;function aC(a){Vp(a,0)}function Gh(a){var o=Pd(a);if(fn(o))return a}function gS(a,o){if(a==="change")return o}var Nr=!1;if(As){var w_;if(As){var N_="oninput"in document;if(!N_){var SS=document.createElement("div");SS.setAttribute("oninput","return;"),N_=typeof SS.oninput=="function"}w_=N_}else w_=!1;Nr=w_&&(!document.documentMode||9<document.documentMode)}function TS(){gl&&(gl.detachEvent("onpropertychange",D_),cc=gl=null)}function D_(a){if(a.propertyName==="value"&&Gh(cc)){var o=[];ES(o,cc,a,g_(a)),aS(aC,o)}}function sC(a,o,u){a==="focusin"?(TS(),gl=o,cc=u,gl.attachEvent("onpropertychange",D_)):a==="focusout"&&TS()}function oC(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Gh(cc)}function vS(a,o){if(a==="click")return Gh(o)}function L_(a,o){if(a==="input"||a==="change")return Gh(o)}function cC(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var Dr=typeof Object.is=="function"?Object.is:cC;function co(a,o){if(Dr(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),f=Object.keys(o);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var E=u[f];if(!a_.call(o,E)||!Dr(a[E],o[E]))return!1}return!0}function RS(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function yS(a,o){var u=RS(a);a=0;for(var f;u;){if(u.nodeType===3){if(f=a+u.textContent.length,a<=o&&f>=o)return{node:u,offset:o-a};a=f}t:{for(;u;){if(u.nextSibling){u=u.nextSibling;break t}u=u.parentNode}u=void 0}u=RS(u)}}function CS(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?CS(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function bs(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Ph(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=Ph(a.document)}return o}function P_(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var lC=As&&"documentMode"in document&&11>=document.documentMode,_i=null,k_=null,Bd=null,M_=!1;function AS(a,o,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;M_||_i==null||_i!==Ph(f)||(f=_i,"selectionStart"in f&&P_(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Bd&&co(Bd,f)||(Bd=f,f=Ou(k_,"onSelect"),0<f.length&&(o=new ma("onSelect","select",null,o,u),a.push({event:o,listeners:f}),o.target=_i)))}function lo(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var Sl={animationend:lo("Animation","AnimationEnd"),animationiteration:lo("Animation","AnimationIteration"),animationstart:lo("Animation","AnimationStart"),transitionrun:lo("Transition","TransitionRun"),transitionstart:lo("Transition","TransitionStart"),transitioncancel:lo("Transition","TransitionCancel"),transitionend:lo("Transition","TransitionEnd")},U_={},bS={};As&&(bS=document.createElement("div").style,"AnimationEvent"in window||(delete Sl.animationend.animation,delete Sl.animationiteration.animation,delete Sl.animationstart.animation),"TransitionEvent"in window||delete Sl.transitionend.transition);function uo(a){if(U_[a])return U_[a];if(!Sl[a])return a;var o=Sl[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in bS)return U_[a]=o[u];return a}var IS=uo("animationend"),OS=uo("animationiteration"),Hh=uo("animationstart"),x_=uo("transitionrun"),dC=uo("transitionstart"),rt=uo("transitioncancel"),wS=uo("transitionend"),NS=new Map,V_="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");V_.push("scrollEnd");function Ea(a,o){NS.set(a,o),Wr(o,[a])}var B_=new WeakMap;function Lr(a,o){if(typeof a=="object"&&a!==null){var u=B_.get(a);return u!==void 0?u:(o={value:a,source:o,stack:Jg(o)},B_.set(a,o),o)}return{value:a,source:o,stack:Jg(o)}}var Yr=[],Tl=0,F_=0;function lc(){for(var a=Tl,o=F_=Tl=0;o<a;){var u=Yr[o];Yr[o++]=null;var f=Yr[o];Yr[o++]=null;var E=Yr[o];Yr[o++]=null;var T=Yr[o];if(Yr[o++]=null,f!==null&&E!==null){var w=f.pending;w===null?E.next=E:(E.next=w.next,w.next=E),f.pending=E}T!==0&&Fd(u,E,T)}}function ho(a,o,u,f){Yr[Tl++]=a,Yr[Tl++]=o,Yr[Tl++]=u,Yr[Tl++]=f,F_|=f,a.lanes|=f,a=a.alternate,a!==null&&(a.lanes|=f)}function j_(a,o,u,f){return ho(a,o,u,f),Rl(a)}function vl(a,o){return ho(a,null,null,o),Rl(a)}function Fd(a,o,u){a.lanes|=u;var f=a.alternate;f!==null&&(f.lanes|=u);for(var E=!1,T=a.return;T!==null;)T.childLanes|=u,f=T.alternate,f!==null&&(f.childLanes|=u),T.tag===22&&(a=T.stateNode,a===null||a._visibility&1||(E=!0)),a=T,T=T.return;return a.tag===3?(T=a.stateNode,E&&o!==null&&(E=31-er(u),a=T.hiddenUpdates,f=a[E],f===null?a[E]=[o]:f.push(o),o.lane=u|536870912),T):null}function Rl(a){if(50<Au)throw Au=0,Vm=null,Error(nt(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var Is={};function uC(a,o,u,f){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pr(a,o,u,f){return new uC(a,o,u,f)}function G_(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Os(a,o){var u=a.alternate;return u===null?(u=Pr(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function Wh(a,o){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function Kh(a,o,u,f,E,T){var w=0;if(f=a,typeof a=="function")G_(a)&&(w=1);else if(typeof a=="string")w=fE(a,u,Gt.current)?26:a==="html"||a==="head"||a==="body"?27:5;else t:switch(a){case Va:return a=Pr(31,u,o,E),a.elementType=Va,a.lanes=T,a;case le:return po(u.children,E,T,o);case Mn:w=8,E|=24;break;case Sn:return a=Pr(12,u,o,E|2),a.elementType=Sn,a.lanes=T,a;case Ye:return a=Pr(13,u,o,E),a.elementType=Ye,a.lanes=T,a;case Ir:return a=Pr(19,u,o,E),a.elementType=Ir,a.lanes=T,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Ai:case Hn:w=10;break t;case Pi:w=9;break t;case Hr:w=11;break t;case Wn:w=14;break t;case Or:w=16,f=null;break t}w=29,u=Error(nt(130,a===null?"null":typeof a,"")),f=null}return o=Pr(w,u,o,E),o.elementType=a,o.type=f,o.lanes=T,o}function po(a,o,u,f){return a=Pr(7,a,f,o),a.lanes=u,a}function _r(a,o,u){return a=Pr(6,a,null,o),a.lanes=u,a}function H_(a,o,u){return o=Pr(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var Ha=[],yl=0,zh=null,Yh=0,kr=[],qr=0,dc=null,ws=1,ga="";function uc(a,o){Ha[yl++]=Yh,Ha[yl++]=zh,zh=a,Yh=o}function W_(a,o,u){kr[qr++]=ws,kr[qr++]=ga,kr[qr++]=dc,dc=a;var f=ws;a=ga;var E=32-er(f)-1;f&=~(1<<E),u+=1;var T=32-er(o)+E;if(30<T){var w=E-E%5;T=(f&(1<<w)-1).toString(32),f>>=w,E-=w,ws=1<<32-er(o)+E|u<<E|f,ga=T+a}else ws=1<<T|u<<E|f,ga=a}function qh(a){a.return!==null&&(uc(a,1),W_(a,1,0))}function K_(a){for(;a===zh;)zh=Ha[--yl],Ha[yl]=null,Yh=Ha[--yl],Ha[yl]=null;for(;a===dc;)dc=kr[--qr],kr[qr]=null,ga=kr[--qr],kr[qr]=null,ws=kr[--qr],kr[qr]=null}var zi=null,Nn=null,Ze=!1,hc=null,Wa=!1,z_=Error(nt(519));function pc(a){var o=Error(nt(418,""));throw Gd(Lr(o,a)),z_}function Y_(a){var o=a.stateNode,u=a.type,f=a.memoizedProps;switch(o[Wi]=a,o[pr]=f,u){case"dialog":be("cancel",o),be("close",o);break;case"iframe":case"object":case"embed":be("load",o);break;case"video":case"audio":for(u=0;u<Ql.length;u++)be(Ql[u],o);break;case"source":be("error",o);break;case"img":case"image":case"link":be("error",o),be("load",o);break;case"details":be("toggle",o);break;case"input":be("invalid",o),Zg(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),Lh(o);break;case"select":be("invalid",o);break;case"textarea":be("invalid",o),tS(o,f.value,f.defaultValue,f.children),Lh(o)}u=f.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||f.suppressHydrationWarning===!0||Gp(o.textContent,u)?(f.popover!=null&&(be("beforetoggle",o),be("toggle",o)),f.onScroll!=null&&be("scroll",o),f.onScrollEnd!=null&&be("scrollend",o),f.onClick!=null&&(o.onclick=wu),o=!0):o=!1,o||pc(a)}function Xh(a){for(zi=a.return;zi;)switch(zi.tag){case 5:case 13:Wa=!1;return;case 27:case 3:Wa=!0;return;default:zi=zi.return}}function jd(a){if(a!==zi)return!1;if(!Ze)return Xh(a),Ze=!0,!1;var o=a.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||oE(a.type,a.memoizedProps)),u=!u),u&&Nn&&pc(a),Xh(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(nt(317));t:{for(a=a.nextSibling,o=0;a;){if(a.nodeType===8)if(u=a.data,u==="/$"){if(o===0){Nn=Ia(a.nextSibling);break t}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++;a=a.nextSibling}Nn=null}}else o===27?(o=Nn,Do(a.type)?(a=dE,dE=null,Nn=a):Nn=o):Nn=zi?Ia(a.stateNode.nextSibling):null;return!0}function fc(){Nn=zi=null,Ze=!1}function DS(){var a=hc;return a!==null&&(Si===null?Si=a:Si.push.apply(Si,a),hc=null),a}function Gd(a){hc===null?hc=[a]:hc.push(a)}var q_=Tt(null),_c=null,Ns=null;function fo(a,o,u){Ot(q_,o._currentValue),o._currentValue=u}function Ds(a){a._currentValue=q_.current,Nt(q_)}function X_(a,o,u){for(;a!==null;){var f=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),a===u)break;a=a.return}}function J_(a,o,u,f){var E=a.child;for(E!==null&&(E.return=a);E!==null;){var T=E.dependencies;if(T!==null){var w=E.child;T=T.firstContext;t:for(;T!==null;){var P=T;T=E;for(var F=0;F<o.length;F++)if(P.context===o[F]){T.lanes|=u,P=T.alternate,P!==null&&(P.lanes|=u),X_(T.return,u,a),f||(w=null);break t}T=P.next}}else if(E.tag===18){if(w=E.return,w===null)throw Error(nt(341));w.lanes|=u,T=w.alternate,T!==null&&(T.lanes|=u),X_(w,u,a),w=null}else w=E.child;if(w!==null)w.return=E;else for(w=E;w!==null;){if(w===a){w=null;break}if(E=w.sibling,E!==null){E.return=w.return,w=E;break}w=w.return}E=w}}function Hd(a,o,u,f){a=null;for(var E=o,T=!1;E!==null;){if(!T){if((E.flags&524288)!==0)T=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var w=E.alternate;if(w===null)throw Error(nt(387));if(w=w.memoizedProps,w!==null){var P=E.type;Dr(E.pendingProps.value,w.value)||(a!==null?a.push(P):a=[P])}}else if(E===tr.current){if(w=E.alternate,w===null)throw Error(nt(387));w.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(a!==null?a.push(Mu):a=[Mu])}E=E.return}a!==null&&J_(o,a,u,f),o.flags|=262144}function Jh(a){for(a=a.firstContext;a!==null;){if(!Dr(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Ka(a){_c=a,Ns=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function mi(a){return LS(_c,a)}function Cl(a,o){return _c===null&&Ka(a),LS(a,o)}function LS(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},Ns===null){if(a===null)throw Error(nt(308));Ns=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else Ns=Ns.next=o;return u}var hC=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,f){a.push(f)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},pC=wt.unstable_scheduleCallback,PS=wt.unstable_NormalPriority,si={$$typeof:Hn,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Wd(){return{controller:new hC,data:new Map,refCount:0}}function Kd(a){a.refCount--,a.refCount===0&&pC(PS,function(){a.controller.abort()})}var zd=null,mc=0,Al=0,bl=null;function fC(a,o){if(zd===null){var u=zd=[];mc=0,Al=Jl(),bl={status:"pending",value:void 0,then:function(f){u.push(f)}}}return mc++,o.then(kS,kS),o}function kS(){if(--mc===0&&zd!==null){bl!==null&&(bl.status="fulfilled");var a=zd;zd=null,Al=0,bl=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function _C(a,o){var u=[],f={status:"pending",value:null,reason:null,then:function(E){u.push(E)}};return a.then(function(){f.status="fulfilled",f.value=o;for(var E=0;E<u.length;E++)(0,u[E])(o)},function(E){for(f.status="rejected",f.reason=E,E=0;E<u.length;E++)(0,u[E])(void 0)}),f}var MS=ot.S;ot.S=function(a,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&fC(a,o),MS!==null&&MS(a,o)};var _o=Tt(null);function Q_(){var a=_o.current;return a!==null?a:bn.pooledCache}function Qh(a,o){o===null?Ot(_o,_o.current):Ot(_o,o.pool)}function US(){var a=Q_();return a===null?null:{parent:si._currentValue,pool:a}}var Ec=Error(nt(460)),xS=Error(nt(474)),Zh=Error(nt(542)),Il={then:function(){}};function VS(a){return a=a.status,a==="fulfilled"||a==="rejected"}function $h(){}function BS(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then($h,$h),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,jS(a),a;default:if(typeof o.status=="string")o.then($h,$h);else{if(a=bn,a!==null&&100<a.shellSuspendCounter)throw Error(nt(482));a=o,a.status="pending",a.then(function(f){if(o.status==="pending"){var E=o;E.status="fulfilled",E.value=f}},function(f){if(o.status==="pending"){var E=o;E.status="rejected",E.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,jS(a),a}throw Yd=o,Ec}}var Yd=null;function FS(){if(Yd===null)throw Error(nt(459));var a=Yd;return Yd=null,a}function jS(a){if(a===Ec||a===Zh)throw Error(nt(483))}var Sa=!1;function tp(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Z_(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function mo(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Ls(a,o,u){var f=a.updateQueue;if(f===null)return null;if(f=f.shared,($e&2)!==0){var E=f.pending;return E===null?o.next=o:(o.next=E.next,E.next=o),f.pending=o,o=Rl(a),Fd(a,null,u),o}return ho(a,f,o,u),Rl(a)}function qd(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,Hg(a,u)}}function $_(a,o){var u=a.updateQueue,f=a.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var E=null,T=null;if(u=u.firstBaseUpdate,u!==null){do{var w={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};T===null?E=T=w:T=T.next=w,u=u.next}while(u!==null);T===null?E=T=o:T=T.next=o}else E=T=o;u={baseState:f.baseState,firstBaseUpdate:E,lastBaseUpdate:T,shared:f.shared,callbacks:f.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var tm=!1;function gc(){if(tm){var a=bl;if(a!==null)throw a}}function Sc(a,o,u,f){tm=!1;var E=a.updateQueue;Sa=!1;var T=E.firstBaseUpdate,w=E.lastBaseUpdate,P=E.shared.pending;if(P!==null){E.shared.pending=null;var F=P,J=F.next;F.next=null,w===null?T=J:w.next=J,w=F;var ct=a.alternate;ct!==null&&(ct=ct.updateQueue,P=ct.lastBaseUpdate,P!==w&&(P===null?ct.firstBaseUpdate=J:P.next=J,ct.lastBaseUpdate=F))}if(T!==null){var mt=E.baseState;w=0,ct=J=F=null,P=T;do{var tt=P.lane&-536870913,et=tt!==P.lane;if(et?(Ge&tt)===tt:(f&tt)===tt){tt!==0&&tt===Al&&(tm=!0),ct!==null&&(ct=ct.next={lane:0,tag:P.tag,payload:P.payload,callback:null,next:null});t:{var ce=a,Zt=P;tt=o;var mn=u;switch(Zt.tag){case 1:if(ce=Zt.payload,typeof ce=="function"){mt=ce.call(mn,mt,tt);break t}mt=ce;break t;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=Zt.payload,tt=typeof ce=="function"?ce.call(mn,mt,tt):ce,tt==null)break t;mt=zt({},mt,tt);break t;case 2:Sa=!0}}tt=P.callback,tt!==null&&(a.flags|=64,et&&(a.flags|=8192),et=E.callbacks,et===null?E.callbacks=[tt]:et.push(tt))}else et={lane:tt,tag:P.tag,payload:P.payload,callback:P.callback,next:null},ct===null?(J=ct=et,F=mt):ct=ct.next=et,w|=tt;if(P=P.next,P===null){if(P=E.shared.pending,P===null)break;et=P,P=et.next,et.next=null,E.lastBaseUpdate=et,E.shared.pending=null}}while(!0);ct===null&&(F=mt),E.baseState=F,E.firstBaseUpdate=J,E.lastBaseUpdate=ct,T===null&&(E.shared.lanes=0),Ca|=w,a.lanes=w,a.memoizedState=mt}}function em(a,o){if(typeof a!="function")throw Error(nt(191,a));a.call(o)}function ep(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)em(u[a],o)}var Tc=Tt(null),Xd=Tt(0);function Jd(a,o){a=Za,Ot(Xd,a),Ot(Tc,o),Za=a|o.baseLanes}function vc(){Ot(Xd,Za),Ot(Tc,Tc.current)}function nm(){Za=Xd.current,Nt(Tc),Nt(Xd)}var Eo=0,ve=null,_n=null,oi=null,Qd=!1,Ol=!1,Rc=!1,np=0,Zd=0,wl=null,mC=0;function zn(){throw Error(nt(321))}function go(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!Dr(a[u],o[u]))return!1;return!0}function im(a,o,u,f,E,T){return Eo=T,ve=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,ot.H=a===null||a.memoizedState===null?yc:To,Rc=!1,T=u(f,E),Rc=!1,Ol&&(T=HS(o,u,f,E)),GS(a),T}function GS(a){ot.H=Mr;var o=_n!==null&&_n.next!==null;if(Eo=0,oi=_n=ve=null,Qd=!1,Zd=0,wl=null,o)throw Error(nt(300));a===null||Ii||(a=a.dependencies,a!==null&&Jh(a)&&(Ii=!0))}function HS(a,o,u,f){ve=a;var E=0;do{if(Ol&&(wl=null),Zd=0,Ol=!1,25<=E)throw Error(nt(301));if(E+=1,oi=_n=null,a.updateQueue!=null){var T=a.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}ot.H=cT,T=o(u,f)}while(Ol);return T}function WS(){var a=ot.H,o=a.useState()[0];return o=typeof o.then=="function"?$d(o):o,a=a.useState()[0],(_n!==null?_n.memoizedState:null)!==a&&(ve.flags|=1024),o}function rm(){var a=np!==0;return np=0,a}function ip(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function am(a){if(Qd){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}Qd=!1}Eo=0,oi=_n=ve=null,Ol=!1,Zd=np=0,wl=null}function mr(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oi===null?ve.memoizedState=oi=a:oi=oi.next=a,oi}function ci(){if(_n===null){var a=ve.alternate;a=a!==null?a.memoizedState:null}else a=_n.next;var o=oi===null?ve.memoizedState:oi.next;if(o!==null)oi=o,_n=a;else{if(a===null)throw ve.alternate===null?Error(nt(467)):Error(nt(310));_n=a,a={memoizedState:_n.memoizedState,baseState:_n.baseState,baseQueue:_n.baseQueue,queue:_n.queue,next:null},oi===null?ve.memoizedState=oi=a:oi=oi.next=a}return oi}function Nl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function $d(a){var o=Zd;return Zd+=1,wl===null&&(wl=[]),a=BS(wl,a,o),o=ve,(oi===null?o.memoizedState:oi.next)===null&&(o=o.alternate,ot.H=o===null||o.memoizedState===null?yc:To),a}function rp(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return $d(a);if(a.$$typeof===Hn)return mi(a)}throw Error(nt(438,String(a)))}function sm(a){var o=null,u=ve.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var f=ve.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(E){return E.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=Nl(),ve.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),f=0;f<a;f++)u[f]=Ba;return o.index++,u}function Ps(a,o){return typeof o=="function"?o(a):o}function ap(a){var o=ci();return om(o,_n,a)}function om(a,o,u){var f=a.queue;if(f===null)throw Error(nt(311));f.lastRenderedReducer=u;var E=a.baseQueue,T=f.pending;if(T!==null){if(E!==null){var w=E.next;E.next=T.next,T.next=w}o.baseQueue=E=T,f.pending=null}if(T=a.baseState,E===null)a.memoizedState=T;else{o=E.next;var P=w=null,F=null,J=o,ct=!1;do{var mt=J.lane&-536870913;if(mt!==J.lane?(Ge&mt)===mt:(Eo&mt)===mt){var tt=J.revertLane;if(tt===0)F!==null&&(F=F.next={lane:0,revertLane:0,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null}),mt===Al&&(ct=!0);else if((Eo&tt)===tt){J=J.next,tt===Al&&(ct=!0);continue}else mt={lane:0,revertLane:J.revertLane,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null},F===null?(P=F=mt,w=T):F=F.next=mt,ve.lanes|=tt,Ca|=tt;mt=J.action,Rc&&u(T,mt),T=J.hasEagerState?J.eagerState:u(T,mt)}else tt={lane:mt,revertLane:J.revertLane,action:J.action,hasEagerState:J.hasEagerState,eagerState:J.eagerState,next:null},F===null?(P=F=tt,w=T):F=F.next=tt,ve.lanes|=mt,Ca|=mt;J=J.next}while(J!==null&&J!==o);if(F===null?w=T:F.next=P,!Dr(T,a.memoizedState)&&(Ii=!0,ct&&(u=bl,u!==null)))throw u;a.memoizedState=T,a.baseState=w,a.baseQueue=F,f.lastRenderedState=T}return E===null&&(f.lanes=0),[a.memoizedState,f.dispatch]}function tu(a){var o=ci(),u=o.queue;if(u===null)throw Error(nt(311));u.lastRenderedReducer=a;var f=u.dispatch,E=u.pending,T=o.memoizedState;if(E!==null){u.pending=null;var w=E=E.next;do T=a(T,w.action),w=w.next;while(w!==E);Dr(T,o.memoizedState)||(Ii=!0),o.memoizedState=T,o.baseQueue===null&&(o.baseState=T),u.lastRenderedState=T}return[T,f]}function KS(a,o,u){var f=ve,E=ci(),T=Ze;if(T){if(u===void 0)throw Error(nt(407));u=u()}else u=o();var w=!Dr((_n||E).memoizedState,u);w&&(E.memoizedState=u,Ii=!0),E=E.queue;var P=lm.bind(null,f,E,a);if(Pl(2048,8,P,[a]),E.getSnapshot!==o||w||oi!==null&&oi.memoizedState.tag&1){if(f.flags|=2048,Ll(9,sp(),zS.bind(null,f,E,u,o),null),bn===null)throw Error(nt(349));T||(Eo&124)!==0||cm(f,o,u)}return u}function cm(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=ve.updateQueue,o===null?(o=Nl(),ve.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function zS(a,o,u,f){o.value=u,o.getSnapshot=f,YS(o)&&qS(a)}function lm(a,o,u){return u(function(){YS(o)&&qS(a)})}function YS(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!Dr(a,u)}catch{return!0}}function qS(a){var o=vl(a,2);o!==null&&Sr(o,a,2)}function dm(a){var o=mr();if(typeof a=="function"){var u=a;if(a=u(),Rc){Rs(!0);try{u()}finally{Rs(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ps,lastRenderedState:a},o}function XS(a,o,u,f){return a.baseState=u,om(a,_n,typeof f=="function"?f:Ps)}function EC(a,o,u,f,E){if(ou(a))throw Error(nt(485));if(a=o.action,a!==null){var T={payload:E,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(w){T.listeners.push(w)}};ot.T!==null?u(!0):T.isTransition=!1,f(T),u=o.pending,u===null?(T.next=o.pending=T,JS(o,T)):(T.next=u.next,o.pending=u.next=T)}}function JS(a,o){var u=o.action,f=o.payload,E=a.state;if(o.isTransition){var T=ot.T,w={};ot.T=w;try{var P=u(E,f),F=ot.S;F!==null&&F(w,P),um(a,o,P)}catch(J){hm(a,o,J)}finally{ot.T=T}}else try{T=u(E,f),um(a,o,T)}catch(J){hm(a,o,J)}}function um(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(f){QS(a,o,f)},function(f){return hm(a,o,f)}):QS(a,o,u)}function QS(a,o,u){o.status="fulfilled",o.value=u,pm(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,JS(a,u)))}function hm(a,o,u){var f=a.pending;if(a.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=u,pm(o),o=o.next;while(o!==f)}a.action=null}function pm(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function ZS(a,o){return o}function eu(a,o){if(Ze){var u=bn.formState;if(u!==null){t:{var f=ve;if(Ze){if(Nn){e:{for(var E=Nn,T=Wa;E.nodeType!==8;){if(!T){E=null;break e}if(E=Ia(E.nextSibling),E===null){E=null;break e}}T=E.data,E=T==="F!"||T==="F"?E:null}if(E){Nn=Ia(E.nextSibling),f=E.data==="F!";break t}}pc(f)}f=!1}f&&(o=u[0])}}return u=mr(),u.memoizedState=u.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ZS,lastRenderedState:o},u.queue=f,u=up.bind(null,ve,f),f.dispatch=u,f=dm(!1),T=Tm.bind(null,ve,!1,f.queue),f=mr(),E={state:o,dispatch:null,action:a,pending:null},f.queue=E,u=EC.bind(null,ve,E,T,u),E.dispatch=u,f.memoizedState=a,[o,u,!1]}function fm(a){var o=ci();return Dl(o,_n,a)}function Dl(a,o,u){if(o=om(a,o,ZS)[0],a=ap(Ps)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var f=$d(o)}catch(w){throw w===Ec?Zh:w}else f=o;o=ci();var E=o.queue,T=E.dispatch;return u!==o.memoizedState&&(ve.flags|=2048,Ll(9,sp(),gC.bind(null,E,u),null)),[f,T,a]}function gC(a,o){a.action=o}function $S(a){var o=ci(),u=_n;if(u!==null)return Dl(o,u,a);ci(),o=o.memoizedState,u=ci();var f=u.queue.dispatch;return u.memoizedState=a,[o,f,!1]}function Ll(a,o,u,f){return a={tag:a,create:u,deps:f,inst:o,next:null},o=ve.updateQueue,o===null&&(o=Nl(),ve.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(f=u.next,u.next=a,a.next=f,o.lastEffect=a),a}function sp(){return{destroy:void 0,resource:void 0}}function nu(){return ci().memoizedState}function op(a,o,u,f){var E=mr();f=f===void 0?null:f,ve.flags|=a,E.memoizedState=Ll(1|o,sp(),u,f)}function Pl(a,o,u,f){var E=ci();f=f===void 0?null:f;var T=E.memoizedState.inst;_n!==null&&f!==null&&go(f,_n.memoizedState.deps)?E.memoizedState=Ll(o,T,u,f):(ve.flags|=a,E.memoizedState=Ll(1|o,T,u,f))}function cp(a,o){op(8390656,8,a,o)}function lp(a,o){Pl(2048,8,a,o)}function tT(a,o){return Pl(4,2,a,o)}function eT(a,o){return Pl(4,4,a,o)}function nT(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function iT(a,o,u){u=u!=null?u.concat([a]):null,Pl(4,4,nT.bind(null,o,a),u)}function _m(){}function iu(a,o){var u=ci();o=o===void 0?null:o;var f=u.memoizedState;return o!==null&&go(o,f[1])?f[0]:(u.memoizedState=[a,o],a)}function rT(a,o){var u=ci();o=o===void 0?null:o;var f=u.memoizedState;if(o!==null&&go(o,f[1]))return f[0];if(f=a(),Rc){Rs(!0);try{a()}finally{Rs(!1)}}return u.memoizedState=[f,o],f}function So(a,o,u){return u===void 0||(Eo&1073741824)!==0?a.memoizedState=o:(a.memoizedState=u,a=wp(),ve.lanes|=a,Ca|=a,u)}function dp(a,o,u,f){return Dr(u,o)?u:Tc.current!==null?(a=So(a,u,f),Dr(a,o)||(Ii=!0),a):(Eo&42)===0?(Ii=!0,a.memoizedState=u):(a=wp(),ve.lanes|=a,Ca|=a,o)}function ru(a,o,u,f,E){var T=Rt.p;Rt.p=T!==0&&8>T?T:8;var w=ot.T,P={};ot.T=P,Tm(a,!1,o,u);try{var F=E(),J=ot.S;if(J!==null&&J(P,F),F!==null&&typeof F=="object"&&typeof F.then=="function"){var ct=_C(F,f);su(a,o,ct,xr(a))}else su(a,o,f,xr(a))}catch(mt){su(a,o,{then:function(){},status:"rejected",reason:mt},xr())}finally{Rt.p=T,ot.T=w}}function au(){}function kl(a,o,u,f){if(a.tag!==5)throw Error(nt(476));var E=aT(a).queue;ru(a,E,o,Qt,u===null?au:function(){return mm(a),u(f)})}function aT(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:Qt,baseState:Qt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ps,lastRenderedState:Qt},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ps,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function mm(a){var o=aT(a).next.queue;su(a,o,{},xr())}function Em(){return mi(Mu)}function gm(){return ci().memoizedState}function sT(){return ci().memoizedState}function SC(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=xr();a=mo(u);var f=Ls(o,a,u);f!==null&&(Sr(f,o,u),qd(f,o,u)),o={cache:Wd()},a.payload=o;return}o=o.return}}function Sm(a,o,u){var f=xr();u={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},ou(a)?hp(o,u):(u=j_(a,o,u,f),u!==null&&(Sr(u,a,f),oT(u,o,f)))}function up(a,o,u){var f=xr();su(a,o,u,f)}function su(a,o,u,f){var E={lane:f,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(ou(a))hp(o,E);else{var T=a.alternate;if(a.lanes===0&&(T===null||T.lanes===0)&&(T=o.lastRenderedReducer,T!==null))try{var w=o.lastRenderedState,P=T(w,u);if(E.hasEagerState=!0,E.eagerState=P,Dr(P,w))return ho(a,o,E,0),bn===null&&lc(),!1}catch{}finally{}if(u=j_(a,o,E,f),u!==null)return Sr(u,a,f),oT(u,o,f),!0}return!1}function Tm(a,o,u,f){if(f={lane:2,revertLane:Jl(),action:f,hasEagerState:!1,eagerState:null,next:null},ou(a)){if(o)throw Error(nt(479))}else o=j_(a,u,f,2),o!==null&&Sr(o,a,2)}function ou(a){var o=a.alternate;return a===ve||o!==null&&o===ve}function hp(a,o){Ol=Qd=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function oT(a,o,u){if((u&4194048)!==0){var f=o.lanes;f&=a.pendingLanes,u|=f,o.lanes=u,Hg(a,u)}}var Mr={readContext:mi,use:rp,useCallback:zn,useContext:zn,useEffect:zn,useImperativeHandle:zn,useLayoutEffect:zn,useInsertionEffect:zn,useMemo:zn,useReducer:zn,useRef:zn,useState:zn,useDebugValue:zn,useDeferredValue:zn,useTransition:zn,useSyncExternalStore:zn,useId:zn,useHostTransitionStatus:zn,useFormState:zn,useActionState:zn,useOptimistic:zn,useMemoCache:zn,useCacheRefresh:zn},yc={readContext:mi,use:rp,useCallback:function(a,o){return mr().memoizedState=[a,o===void 0?null:o],a},useContext:mi,useEffect:cp,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,op(4194308,4,nT.bind(null,o,a),u)},useLayoutEffect:function(a,o){return op(4194308,4,a,o)},useInsertionEffect:function(a,o){op(4,2,a,o)},useMemo:function(a,o){var u=mr();o=o===void 0?null:o;var f=a();if(Rc){Rs(!0);try{a()}finally{Rs(!1)}}return u.memoizedState=[f,o],f},useReducer:function(a,o,u){var f=mr();if(u!==void 0){var E=u(o);if(Rc){Rs(!0);try{u(o)}finally{Rs(!1)}}}else E=o;return f.memoizedState=f.baseState=E,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:E},f.queue=a,a=a.dispatch=Sm.bind(null,ve,a),[f.memoizedState,a]},useRef:function(a){var o=mr();return a={current:a},o.memoizedState=a},useState:function(a){a=dm(a);var o=a.queue,u=up.bind(null,ve,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:_m,useDeferredValue:function(a,o){var u=mr();return So(u,a,o)},useTransition:function(){var a=dm(!1);return a=ru.bind(null,ve,a.queue,!0,!1),mr().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var f=ve,E=mr();if(Ze){if(u===void 0)throw Error(nt(407));u=u()}else{if(u=o(),bn===null)throw Error(nt(349));(Ge&124)!==0||cm(f,o,u)}E.memoizedState=u;var T={value:u,getSnapshot:o};return E.queue=T,cp(lm.bind(null,f,T,a),[a]),f.flags|=2048,Ll(9,sp(),zS.bind(null,f,T,u,o),null),u},useId:function(){var a=mr(),o=bn.identifierPrefix;if(Ze){var u=ga,f=ws;u=(f&~(1<<32-er(f)-1)).toString(32)+u,o=""+o+"R"+u,u=np++,0<u&&(o+="H"+u.toString(32)),o+=""}else u=mC++,o=""+o+"r"+u.toString(32)+"";return a.memoizedState=o},useHostTransitionStatus:Em,useFormState:eu,useActionState:eu,useOptimistic:function(a){var o=mr();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=Tm.bind(null,ve,!0,u),u.dispatch=o,[a,o]},useMemoCache:sm,useCacheRefresh:function(){return mr().memoizedState=SC.bind(null,ve)}},To={readContext:mi,use:rp,useCallback:iu,useContext:mi,useEffect:lp,useImperativeHandle:iT,useInsertionEffect:tT,useLayoutEffect:eT,useMemo:rT,useReducer:ap,useRef:nu,useState:function(){return ap(Ps)},useDebugValue:_m,useDeferredValue:function(a,o){var u=ci();return dp(u,_n.memoizedState,a,o)},useTransition:function(){var a=ap(Ps)[0],o=ci().memoizedState;return[typeof a=="boolean"?a:$d(a),o]},useSyncExternalStore:KS,useId:gm,useHostTransitionStatus:Em,useFormState:fm,useActionState:fm,useOptimistic:function(a,o){var u=ci();return XS(u,_n,a,o)},useMemoCache:sm,useCacheRefresh:sT},cT={readContext:mi,use:rp,useCallback:iu,useContext:mi,useEffect:lp,useImperativeHandle:iT,useInsertionEffect:tT,useLayoutEffect:eT,useMemo:rT,useReducer:tu,useRef:nu,useState:function(){return tu(Ps)},useDebugValue:_m,useDeferredValue:function(a,o){var u=ci();return _n===null?So(u,a,o):dp(u,_n.memoizedState,a,o)},useTransition:function(){var a=tu(Ps)[0],o=ci().memoizedState;return[typeof a=="boolean"?a:$d(a),o]},useSyncExternalStore:KS,useId:gm,useHostTransitionStatus:Em,useFormState:$S,useActionState:$S,useOptimistic:function(a,o){var u=ci();return _n!==null?XS(u,_n,a,o):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:sm,useCacheRefresh:sT},Cc=null,Ta=0;function Ml(a){var o=Ta;return Ta+=1,Cc===null&&(Cc=[]),BS(Cc,a,o)}function cu(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function lu(a,o){throw o.$$typeof===Yt?Error(nt(525)):(a=Object.prototype.toString.call(o),Error(nt(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function lT(a){var o=a._init;return o(a._payload)}function vm(a){function o(q,W){if(a){var Q=q.deletions;Q===null?(q.deletions=[W],q.flags|=16):Q.push(W)}}function u(q,W){if(!a)return null;for(;W!==null;)o(q,W),W=W.sibling;return null}function f(q){for(var W=new Map;q!==null;)q.key!==null?W.set(q.key,q):W.set(q.index,q),q=q.sibling;return W}function E(q,W){return q=Os(q,W),q.index=0,q.sibling=null,q}function T(q,W,Q){return q.index=Q,a?(Q=q.alternate,Q!==null?(Q=Q.index,Q<W?(q.flags|=67108866,W):Q):(q.flags|=67108866,W)):(q.flags|=1048576,W)}function w(q){return a&&q.alternate===null&&(q.flags|=67108866),q}function P(q,W,Q,pt){return W===null||W.tag!==6?(W=_r(Q,q.mode,pt),W.return=q,W):(W=E(W,Q),W.return=q,W)}function F(q,W,Q,pt){var Mt=Q.type;return Mt===le?ct(q,W,Q.props.children,pt,Q.key):W!==null&&(W.elementType===Mt||typeof Mt=="object"&&Mt!==null&&Mt.$$typeof===Or&&lT(Mt)===W.type)?(W=E(W,Q.props),cu(W,Q),W.return=q,W):(W=Kh(Q.type,Q.key,Q.props,null,q.mode,pt),cu(W,Q),W.return=q,W)}function J(q,W,Q,pt){return W===null||W.tag!==4||W.stateNode.containerInfo!==Q.containerInfo||W.stateNode.implementation!==Q.implementation?(W=H_(Q,q.mode,pt),W.return=q,W):(W=E(W,Q.children||[]),W.return=q,W)}function ct(q,W,Q,pt,Mt){return W===null||W.tag!==7?(W=po(Q,q.mode,pt,Mt),W.return=q,W):(W=E(W,Q),W.return=q,W)}function mt(q,W,Q){if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return W=_r(""+W,q.mode,Q),W.return=q,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case he:return Q=Kh(W.type,W.key,W.props,null,q.mode,Q),cu(Q,W),Q.return=q,Q;case Qn:return W=H_(W,q.mode,Q),W.return=q,W;case Or:var pt=W._init;return W=pt(W._payload),mt(q,W,Q)}if(Hi(W)||ke(W))return W=po(W,q.mode,Q,null),W.return=q,W;if(typeof W.then=="function")return mt(q,Ml(W),Q);if(W.$$typeof===Hn)return mt(q,Cl(q,W),Q);lu(q,W)}return null}function tt(q,W,Q,pt){var Mt=W!==null?W.key:null;if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Mt!==null?null:P(q,W,""+Q,pt);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case he:return Q.key===Mt?F(q,W,Q,pt):null;case Qn:return Q.key===Mt?J(q,W,Q,pt):null;case Or:return Mt=Q._init,Q=Mt(Q._payload),tt(q,W,Q,pt)}if(Hi(Q)||ke(Q))return Mt!==null?null:ct(q,W,Q,pt,null);if(typeof Q.then=="function")return tt(q,W,Ml(Q),pt);if(Q.$$typeof===Hn)return tt(q,W,Cl(q,Q),pt);lu(q,Q)}return null}function et(q,W,Q,pt,Mt){if(typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint")return q=q.get(Q)||null,P(W,q,""+pt,Mt);if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case he:return q=q.get(pt.key===null?Q:pt.key)||null,F(W,q,pt,Mt);case Qn:return q=q.get(pt.key===null?Q:pt.key)||null,J(W,q,pt,Mt);case Or:var De=pt._init;return pt=De(pt._payload),et(q,W,Q,pt,Mt)}if(Hi(pt)||ke(pt))return q=q.get(Q)||null,ct(W,q,pt,Mt,null);if(typeof pt.then=="function")return et(q,W,Q,Ml(pt),Mt);if(pt.$$typeof===Hn)return et(q,W,Q,Cl(W,pt),Mt);lu(W,pt)}return null}function ce(q,W,Q,pt){for(var Mt=null,De=null,Wt=W,ie=W=0,Ni=null;Wt!==null&&ie<Q.length;ie++){Wt.index>ie?(Ni=Wt,Wt=null):Ni=Wt.sibling;var He=tt(q,Wt,Q[ie],pt);if(He===null){Wt===null&&(Wt=Ni);break}a&&Wt&&He.alternate===null&&o(q,Wt),W=T(He,W,ie),De===null?Mt=He:De.sibling=He,De=He,Wt=Ni}if(ie===Q.length)return u(q,Wt),Ze&&uc(q,ie),Mt;if(Wt===null){for(;ie<Q.length;ie++)Wt=mt(q,Q[ie],pt),Wt!==null&&(W=T(Wt,W,ie),De===null?Mt=Wt:De.sibling=Wt,De=Wt);return Ze&&uc(q,ie),Mt}for(Wt=f(Wt);ie<Q.length;ie++)Ni=et(Wt,q,ie,Q[ie],pt),Ni!==null&&(a&&Ni.alternate!==null&&Wt.delete(Ni.key===null?ie:Ni.key),W=T(Ni,W,ie),De===null?Mt=Ni:De.sibling=Ni,De=Ni);return a&&Wt.forEach(function(xs){return o(q,xs)}),Ze&&uc(q,ie),Mt}function Zt(q,W,Q,pt){if(Q==null)throw Error(nt(151));for(var Mt=null,De=null,Wt=W,ie=W=0,Ni=null,He=Q.next();Wt!==null&&!He.done;ie++,He=Q.next()){Wt.index>ie?(Ni=Wt,Wt=null):Ni=Wt.sibling;var xs=tt(q,Wt,He.value,pt);if(xs===null){Wt===null&&(Wt=Ni);break}a&&Wt&&xs.alternate===null&&o(q,Wt),W=T(xs,W,ie),De===null?Mt=xs:De.sibling=xs,De=xs,Wt=Ni}if(He.done)return u(q,Wt),Ze&&uc(q,ie),Mt;if(Wt===null){for(;!He.done;ie++,He=Q.next())He=mt(q,He.value,pt),He!==null&&(W=T(He,W,ie),De===null?Mt=He:De.sibling=He,De=He);return Ze&&uc(q,ie),Mt}for(Wt=f(Wt);!He.done;ie++,He=Q.next())He=et(Wt,q,ie,He.value,pt),He!==null&&(a&&He.alternate!==null&&Wt.delete(He.key===null?ie:He.key),W=T(He,W,ie),De===null?Mt=He:De.sibling=He,De=He);return a&&Wt.forEach(function(nA){return o(q,nA)}),Ze&&uc(q,ie),Mt}function mn(q,W,Q,pt){if(typeof Q=="object"&&Q!==null&&Q.type===le&&Q.key===null&&(Q=Q.props.children),typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case he:t:{for(var Mt=Q.key;W!==null;){if(W.key===Mt){if(Mt=Q.type,Mt===le){if(W.tag===7){u(q,W.sibling),pt=E(W,Q.props.children),pt.return=q,q=pt;break t}}else if(W.elementType===Mt||typeof Mt=="object"&&Mt!==null&&Mt.$$typeof===Or&&lT(Mt)===W.type){u(q,W.sibling),pt=E(W,Q.props),cu(pt,Q),pt.return=q,q=pt;break t}u(q,W);break}else o(q,W);W=W.sibling}Q.type===le?(pt=po(Q.props.children,q.mode,pt,Q.key),pt.return=q,q=pt):(pt=Kh(Q.type,Q.key,Q.props,null,q.mode,pt),cu(pt,Q),pt.return=q,q=pt)}return w(q);case Qn:t:{for(Mt=Q.key;W!==null;){if(W.key===Mt)if(W.tag===4&&W.stateNode.containerInfo===Q.containerInfo&&W.stateNode.implementation===Q.implementation){u(q,W.sibling),pt=E(W,Q.children||[]),pt.return=q,q=pt;break t}else{u(q,W);break}else o(q,W);W=W.sibling}pt=H_(Q,q.mode,pt),pt.return=q,q=pt}return w(q);case Or:return Mt=Q._init,Q=Mt(Q._payload),mn(q,W,Q,pt)}if(Hi(Q))return ce(q,W,Q,pt);if(ke(Q)){if(Mt=ke(Q),typeof Mt!="function")throw Error(nt(150));return Q=Mt.call(Q),Zt(q,W,Q,pt)}if(typeof Q.then=="function")return mn(q,W,Ml(Q),pt);if(Q.$$typeof===Hn)return mn(q,W,Cl(q,Q),pt);lu(q,Q)}return typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint"?(Q=""+Q,W!==null&&W.tag===6?(u(q,W.sibling),pt=E(W,Q),pt.return=q,q=pt):(u(q,W),pt=_r(Q,q.mode,pt),pt.return=q,q=pt),w(q)):u(q,W)}return function(q,W,Q,pt){try{Ta=0;var Mt=mn(q,W,Q,pt);return Cc=null,Mt}catch(Wt){if(Wt===Ec||Wt===Zh)throw Wt;var De=Pr(29,Wt,null,q.mode);return De.lanes=pt,De.return=q,De}finally{}}}var Ac=vm(!0),dT=vm(!1),Ei=Tt(null),za=null;function vo(a){var o=a.alternate;Ot(gi,gi.current&1),Ot(Ei,a),za===null&&(o===null||Tc.current!==null||o.memoizedState!==null)&&(za=a)}function uT(a){if(a.tag===22){if(Ot(gi,gi.current),Ot(Ei,a),za===null){var o=a.alternate;o!==null&&o.memoizedState!==null&&(za=a)}}else Ro()}function Ro(){Ot(gi,gi.current),Ot(Ei,Ei.current)}function Ya(a){Nt(Ei),za===a&&(za=null),Nt(gi)}var gi=Tt(0);function Ul(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||Wp(u)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function pp(a,o,u,f){o=a.memoizedState,u=u(f,o),u=u==null?o:zt({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var Rm={enqueueSetState:function(a,o,u){a=a._reactInternals;var f=xr(),E=mo(f);E.payload=o,u!=null&&(E.callback=u),o=Ls(a,E,f),o!==null&&(Sr(o,a,f),qd(o,a,f))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var f=xr(),E=mo(f);E.tag=1,E.payload=o,u!=null&&(E.callback=u),o=Ls(a,E,f),o!==null&&(Sr(o,a,f),qd(o,a,f))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=xr(),f=mo(u);f.tag=2,o!=null&&(f.callback=o),o=Ls(a,f,u),o!==null&&(Sr(o,a,u),qd(o,a,u))}};function ym(a,o,u,f,E,T,w){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(f,T,w):o.prototype&&o.prototype.isPureReactComponent?!co(u,f)||!co(E,T):!0}function hT(a,o,u,f){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,f),o.state!==a&&Rm.enqueueReplaceState(o,o.state,null)}function bc(a,o){var u=o;if("ref"in o){u={};for(var f in o)f!=="ref"&&(u[f]=o[f])}if(a=a.defaultProps){u===o&&(u=zt({},u));for(var E in a)u[E]===void 0&&(u[E]=a[E])}return u}var fp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function pT(a){fp(a)}function fT(a){console.error(a)}function _T(a){fp(a)}function _p(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function Cm(a,o,u){try{var f=a.onCaughtError;f(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function va(a,o,u){return u=mo(u),u.tag=3,u.payload={element:null},u.callback=function(){_p(a,o)},u}function mT(a){return a=mo(a),a.tag=3,a}function ET(a,o,u,f){var E=u.type.getDerivedStateFromError;if(typeof E=="function"){var T=f.value;a.payload=function(){return E(T)},a.callback=function(){Cm(o,u,f)}}var w=u.stateNode;w!==null&&typeof w.componentDidCatch=="function"&&(a.callback=function(){Cm(o,u,f),typeof E!="function"&&(Ms===null?Ms=new Set([this]):Ms.add(this));var P=f.stack;this.componentDidCatch(f.value,{componentStack:P!==null?P:""})})}function TC(a,o,u,f,E){if(u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=u.alternate,o!==null&&Hd(o,u,E,!0),u=Ei.current,u!==null){switch(u.tag){case 13:return za===null?kc():u.alternate===null&&Bn===0&&(Bn=3),u.flags&=-257,u.flags|=65536,u.lanes=E,f===Il?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([f]):o.add(f),ql(a,f,E)),!1;case 22:return u.flags|=65536,f===Il?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([f]):u.add(f)),ql(a,f,E)),!1}throw Error(nt(435,u.tag))}return ql(a,f,E),kc(),!1}if(Ze)return o=Ei.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=E,f!==z_&&(a=Error(nt(422),{cause:f}),Gd(Lr(a,u)))):(f!==z_&&(o=Error(nt(423),{cause:f}),Gd(Lr(o,u))),a=a.current.alternate,a.flags|=65536,E&=-E,a.lanes|=E,f=Lr(f,u),E=va(a.stateNode,f,E),$_(a,E),Bn!==4&&(Bn=2)),!1;var T=Error(nt(520),{cause:f});if(T=Lr(T,u),Hl===null?Hl=[T]:Hl.push(T),Bn!==4&&(Bn=2),o===null)return!0;f=Lr(f,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=E&-E,u.lanes|=a,a=va(u.stateNode,f,a),$_(u,a),!1;case 1:if(o=u.type,T=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Ms===null||!Ms.has(T))))return u.flags|=65536,E&=-E,u.lanes|=E,E=mT(E),ET(E,a,u,f),$_(u,E),!1}u=u.return}while(u!==null);return!1}var gT=Error(nt(461)),Ii=!1;function Ui(a,o,u,f){o.child=a===null?dT(o,null,u,f):Ac(o,a.child,u,f)}function mp(a,o,u,f,E){u=u.render;var T=o.ref;if("ref"in f){var w={};for(var P in f)P!=="ref"&&(w[P]=f[P])}else w=f;return Ka(o),f=im(a,o,u,w,T,E),P=rm(),a!==null&&!Ii?(ip(a,o,E),qa(a,o,E)):(Ze&&P&&qh(o),o.flags|=1,Ui(a,o,f,E),o.child)}function ST(a,o,u,f,E){if(a===null){var T=u.type;return typeof T=="function"&&!G_(T)&&T.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=T,TT(a,o,T,f,E)):(a=Kh(u.type,null,f,o,o.mode,E),a.ref=o.ref,a.return=o,o.child=a)}if(T=a.child,!gp(a,E)){var w=T.memoizedProps;if(u=u.compare,u=u!==null?u:co,u(w,f)&&a.ref===o.ref)return qa(a,o,E)}return o.flags|=1,a=Os(T,f),a.ref=o.ref,a.return=o,o.child=a}function TT(a,o,u,f,E){if(a!==null){var T=a.memoizedProps;if(co(T,f)&&a.ref===o.ref)if(Ii=!1,o.pendingProps=f=T,gp(a,E))(a.flags&131072)!==0&&(Ii=!0);else return o.lanes=a.lanes,qa(a,o,E)}return Am(a,o,u,f,E)}function vT(a,o,u){var f=o.pendingProps,E=f.children,T=a!==null?a.memoizedState:null;if(f.mode==="hidden"){if((o.flags&128)!==0){if(f=T!==null?T.baseLanes|u:u,a!==null){for(E=o.child=a.child,T=0;E!==null;)T=T|E.lanes|E.childLanes,E=E.sibling;o.childLanes=T&~f}else o.childLanes=0,o.child=null;return RT(a,o,f,u)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&Qh(o,T!==null?T.cachePool:null),T!==null?Jd(o,T):vc(),uT(o);else return o.lanes=o.childLanes=536870912,RT(a,o,T!==null?T.baseLanes|u:u,u)}else T!==null?(Qh(o,T.cachePool),Jd(o,T),Ro(),o.memoizedState=null):(a!==null&&Qh(o,null),vc(),Ro());return Ui(a,o,E,u),o.child}function RT(a,o,u,f){var E=Q_();return E=E===null?null:{parent:si._currentValue,pool:E},o.memoizedState={baseLanes:u,cachePool:E},a!==null&&Qh(o,null),vc(),uT(o),a!==null&&Hd(a,o,f,!0),null}function Ep(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(nt(284));(a===null||a.ref!==u)&&(o.flags|=4194816)}}function Am(a,o,u,f,E){return Ka(o),u=im(a,o,u,f,void 0,E),f=rm(),a!==null&&!Ii?(ip(a,o,E),qa(a,o,E)):(Ze&&f&&qh(o),o.flags|=1,Ui(a,o,u,E),o.child)}function bm(a,o,u,f,E,T){return Ka(o),o.updateQueue=null,u=HS(o,f,u,E),GS(a),f=rm(),a!==null&&!Ii?(ip(a,o,T),qa(a,o,T)):(Ze&&f&&qh(o),o.flags|=1,Ui(a,o,u,T),o.child)}function Im(a,o,u,f,E){if(Ka(o),o.stateNode===null){var T=Is,w=u.contextType;typeof w=="object"&&w!==null&&(T=mi(w)),T=new u(f,T),o.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=Rm,o.stateNode=T,T._reactInternals=o,T=o.stateNode,T.props=f,T.state=o.memoizedState,T.refs={},tp(o),w=u.contextType,T.context=typeof w=="object"&&w!==null?mi(w):Is,T.state=o.memoizedState,w=u.getDerivedStateFromProps,typeof w=="function"&&(pp(o,u,w,f),T.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(w=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),w!==T.state&&Rm.enqueueReplaceState(T,T.state,null),Sc(o,f,T,E),gc(),T.state=o.memoizedState),typeof T.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(a===null){T=o.stateNode;var P=o.memoizedProps,F=bc(u,P);T.props=F;var J=T.context,ct=u.contextType;w=Is,typeof ct=="object"&&ct!==null&&(w=mi(ct));var mt=u.getDerivedStateFromProps;ct=typeof mt=="function"||typeof T.getSnapshotBeforeUpdate=="function",P=o.pendingProps!==P,ct||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(P||J!==w)&&hT(o,T,f,w),Sa=!1;var tt=o.memoizedState;T.state=tt,Sc(o,f,T,E),gc(),J=o.memoizedState,P||tt!==J||Sa?(typeof mt=="function"&&(pp(o,u,mt,f),J=o.memoizedState),(F=Sa||ym(o,u,F,f,tt,J,w))?(ct||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(o.flags|=4194308)):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=J),T.props=f,T.state=J,T.context=w,f=F):(typeof T.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{T=o.stateNode,Z_(a,o),w=o.memoizedProps,ct=bc(u,w),T.props=ct,mt=o.pendingProps,tt=T.context,J=u.contextType,F=Is,typeof J=="object"&&J!==null&&(F=mi(J)),P=u.getDerivedStateFromProps,(J=typeof P=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(w!==mt||tt!==F)&&hT(o,T,f,F),Sa=!1,tt=o.memoizedState,T.state=tt,Sc(o,f,T,E),gc();var et=o.memoizedState;w!==mt||tt!==et||Sa||a!==null&&a.dependencies!==null&&Jh(a.dependencies)?(typeof P=="function"&&(pp(o,u,P,f),et=o.memoizedState),(ct=Sa||ym(o,u,ct,f,tt,et,F)||a!==null&&a.dependencies!==null&&Jh(a.dependencies))?(J||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(f,et,F),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(f,et,F)),typeof T.componentDidUpdate=="function"&&(o.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof T.componentDidUpdate!="function"||w===a.memoizedProps&&tt===a.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||w===a.memoizedProps&&tt===a.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=et),T.props=f,T.state=et,T.context=F,f=ct):(typeof T.componentDidUpdate!="function"||w===a.memoizedProps&&tt===a.memoizedState||(o.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||w===a.memoizedProps&&tt===a.memoizedState||(o.flags|=1024),f=!1)}return T=f,Ep(a,o),f=(o.flags&128)!==0,T||f?(T=o.stateNode,u=f&&typeof u.getDerivedStateFromError!="function"?null:T.render(),o.flags|=1,a!==null&&f?(o.child=Ac(o,a.child,null,E),o.child=Ac(o,null,u,E)):Ui(a,o,u,E),o.memoizedState=T.state,a=o.child):a=qa(a,o,E),a}function yT(a,o,u,f){return fc(),o.flags|=256,Ui(a,o,u,f),o.child}var Om={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function xl(a){return{baseLanes:a,cachePool:US()}}function du(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=Jr),a}function wm(a,o,u){var f=o.pendingProps,E=!1,T=(o.flags&128)!==0,w;if((w=T)||(w=a!==null&&a.memoizedState===null?!1:(gi.current&2)!==0),w&&(E=!0,o.flags&=-129),w=(o.flags&32)!==0,o.flags&=-33,a===null){if(Ze){if(E?vo(o):Ro(),Ze){var P=Nn,F;if(F=P){t:{for(F=P,P=Wa;F.nodeType!==8;){if(!P){P=null;break t}if(F=Ia(F.nextSibling),F===null){P=null;break t}}P=F}P!==null?(o.memoizedState={dehydrated:P,treeContext:dc!==null?{id:ws,overflow:ga}:null,retryLane:536870912,hydrationErrors:null},F=Pr(18,null,null,0),F.stateNode=P,F.return=o,o.child=F,zi=o,Nn=null,F=!0):F=!1}F||pc(o)}if(P=o.memoizedState,P!==null&&(P=P.dehydrated,P!==null))return Wp(P)?o.lanes=32:o.lanes=536870912,null;Ya(o)}return P=f.children,f=f.fallback,E?(Ro(),E=o.mode,P=uu({mode:"hidden",children:P},E),f=po(f,E,u,null),P.return=o,f.return=o,P.sibling=f,o.child=P,E=o.child,E.memoizedState=xl(u),E.childLanes=du(a,w,u),o.memoizedState=Om,f):(vo(o),Vl(o,P))}if(F=a.memoizedState,F!==null&&(P=F.dehydrated,P!==null)){if(T)o.flags&256?(vo(o),o.flags&=-257,o=Nm(a,o,u)):o.memoizedState!==null?(Ro(),o.child=a.child,o.flags|=128,o=null):(Ro(),E=f.fallback,P=o.mode,f=uu({mode:"visible",children:f.children},P),E=po(E,P,u,null),E.flags|=2,f.return=o,E.return=o,f.sibling=E,o.child=f,Ac(o,a.child,null,u),f=o.child,f.memoizedState=xl(u),f.childLanes=du(a,w,u),o.memoizedState=Om,o=E);else if(vo(o),Wp(P)){if(w=P.nextSibling&&P.nextSibling.dataset,w)var J=w.dgst;w=J,f=Error(nt(419)),f.stack="",f.digest=w,Gd({value:f,source:null,stack:null}),o=Nm(a,o,u)}else if(Ii||Hd(a,o,u,!1),w=(u&a.childLanes)!==0,Ii||w){if(w=bn,w!==null&&(f=u&-u,f=(f&42)!==0?1:ro(f),f=(f&(w.suspendedLanes|u))!==0?0:f,f!==0&&f!==F.retryLane))throw F.retryLane=f,vl(a,f),Sr(w,a,f),gT;P.data==="$?"||kc(),o=Nm(a,o,u)}else P.data==="$?"?(o.flags|=192,o.child=a.child,o=null):(a=F.treeContext,Nn=Ia(P.nextSibling),zi=o,Ze=!0,hc=null,Wa=!1,a!==null&&(kr[qr++]=ws,kr[qr++]=ga,kr[qr++]=dc,ws=a.id,ga=a.overflow,dc=o),o=Vl(o,f.children),o.flags|=4096);return o}return E?(Ro(),E=f.fallback,P=o.mode,F=a.child,J=F.sibling,f=Os(F,{mode:"hidden",children:f.children}),f.subtreeFlags=F.subtreeFlags&65011712,J!==null?E=Os(J,E):(E=po(E,P,u,null),E.flags|=2),E.return=o,f.return=o,f.sibling=E,o.child=f,f=E,E=o.child,P=a.child.memoizedState,P===null?P=xl(u):(F=P.cachePool,F!==null?(J=si._currentValue,F=F.parent!==J?{parent:J,pool:J}:F):F=US(),P={baseLanes:P.baseLanes|u,cachePool:F}),E.memoizedState=P,E.childLanes=du(a,w,u),o.memoizedState=Om,f):(vo(o),u=a.child,a=u.sibling,u=Os(u,{mode:"visible",children:f.children}),u.return=o,u.sibling=null,a!==null&&(w=o.deletions,w===null?(o.deletions=[a],o.flags|=16):w.push(a)),o.child=u,o.memoizedState=null,u)}function Vl(a,o){return o=uu({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function uu(a,o){return a=Pr(22,a,null,o),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function Nm(a,o,u){return Ac(o,a.child,null,u),a=Vl(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function Dm(a,o,u){a.lanes|=o;var f=a.alternate;f!==null&&(f.lanes|=o),X_(a.return,o,u)}function Bl(a,o,u,f,E){var T=a.memoizedState;T===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:E}:(T.isBackwards=o,T.rendering=null,T.renderingStartTime=0,T.last=f,T.tail=u,T.tailMode=E)}function CT(a,o,u){var f=o.pendingProps,E=f.revealOrder,T=f.tail;if(Ui(a,o,f.children,u),f=gi.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(a!==null&&(a.flags&128)!==0)t:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Dm(a,u,o);else if(a.tag===19)Dm(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break t;for(;a.sibling===null;){if(a.return===null||a.return===o)break t;a=a.return}a.sibling.return=a.return,a=a.sibling}f&=1}switch(Ot(gi,f),E){case"forwards":for(u=o.child,E=null;u!==null;)a=u.alternate,a!==null&&Ul(a)===null&&(E=u),u=u.sibling;u=E,u===null?(E=o.child,o.child=null):(E=u.sibling,u.sibling=null),Bl(o,!1,E,u,T);break;case"backwards":for(u=null,E=o.child,o.child=null;E!==null;){if(a=E.alternate,a!==null&&Ul(a)===null){o.child=E;break}a=E.sibling,E.sibling=u,u=E,E=a}Bl(o,!0,u,null,T);break;case"together":Bl(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function qa(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),Ca|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(Hd(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(nt(153));if(o.child!==null){for(a=o.child,u=Os(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=Os(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function gp(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&Jh(a)))}function vC(a,o,u){switch(o.tag){case 3:Un(o,o.stateNode.containerInfo),fo(o,si,a.memoizedState.cache),fc();break;case 27:case 5:il(o);break;case 4:Un(o,o.stateNode.containerInfo);break;case 10:fo(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(vo(o),o.flags|=128,null):(u&o.child.childLanes)!==0?wm(a,o,u):(vo(o),a=qa(a,o,u),a!==null?a.sibling:null);vo(o);break;case 19:var E=(a.flags&128)!==0;if(f=(u&o.childLanes)!==0,f||(Hd(a,o,u,!1),f=(u&o.childLanes)!==0),E){if(f)return CT(a,o,u);o.flags|=128}if(E=o.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),Ot(gi,gi.current),f)break;return null;case 22:case 23:return o.lanes=0,vT(a,o,u);case 24:fo(o,si,a.memoizedState.cache)}return qa(a,o,u)}function hu(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)Ii=!0;else{if(!gp(a,u)&&(o.flags&128)===0)return Ii=!1,vC(a,o,u);Ii=(a.flags&131072)!==0}else Ii=!1,Ze&&(o.flags&1048576)!==0&&W_(o,Yh,o.index);switch(o.lanes=0,o.tag){case 16:t:{a=o.pendingProps;var f=o.elementType,E=f._init;if(f=E(f._payload),o.type=f,typeof f=="function")G_(f)?(a=bc(f,a),o.tag=1,o=Im(null,o,f,a,u)):(o.tag=0,o=Am(null,o,f,a,u));else{if(f!=null){if(E=f.$$typeof,E===Hr){o.tag=11,o=mp(null,o,f,a,u);break t}else if(E===Wn){o.tag=14,o=ST(null,o,f,a,u);break t}}throw o=Kn(f)||f,Error(nt(306,o,""))}}return o;case 0:return Am(a,o,o.type,o.pendingProps,u);case 1:return f=o.type,E=bc(f,o.pendingProps),Im(a,o,f,E,u);case 3:t:{if(Un(o,o.stateNode.containerInfo),a===null)throw Error(nt(387));f=o.pendingProps;var T=o.memoizedState;E=T.element,Z_(a,o),Sc(o,f,null,u);var w=o.memoizedState;if(f=w.cache,fo(o,si,f),f!==T.cache&&J_(o,[si],u,!0),gc(),f=w.element,T.isDehydrated)if(T={element:f,isDehydrated:!1,cache:w.cache},o.updateQueue.baseState=T,o.memoizedState=T,o.flags&256){o=yT(a,o,f,u);break t}else if(f!==E){E=Lr(Error(nt(424)),o),Gd(E),o=yT(a,o,f,u);break t}else{switch(a=o.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Nn=Ia(a.firstChild),zi=o,Ze=!0,hc=null,Wa=!0,u=dT(o,null,f,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(fc(),f===E){o=qa(a,o,u);break t}Ui(a,o,f,u)}o=o.child}return o;case 26:return Ep(a,o),a===null?(u=tv(o.type,null,o.pendingProps,null))?o.memoizedState=u:Ze||(u=o.type,a=o.pendingProps,f=Hp(pe.current).createElement(u),f[Wi]=o,f[pr]=a,wi(f,u,a),fi(f),o.stateNode=f):o.memoizedState=tv(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return il(o),a===null&&Ze&&(f=o.stateNode=JT(o.type,o.pendingProps,pe.current),zi=o,Wa=!0,E=Nn,Do(o.type)?(dE=E,Nn=Ia(f.firstChild)):Nn=E),Ui(a,o,o.pendingProps.children,u),Ep(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&Ze&&((E=f=Nn)&&(f=BC(f,o.type,o.pendingProps,Wa),f!==null?(o.stateNode=f,zi=o,Nn=Ia(f.firstChild),Wa=!1,E=!0):E=!1),E||pc(o)),il(o),E=o.type,T=o.pendingProps,w=a!==null?a.memoizedProps:null,f=T.children,oE(E,T)?f=null:w!==null&&oE(E,w)&&(o.flags|=32),o.memoizedState!==null&&(E=im(a,o,WS,null,null,u),Mu._currentValue=E),Ep(a,o),Ui(a,o,f,u),o.child;case 6:return a===null&&Ze&&((a=u=Nn)&&(u=FC(u,o.pendingProps,Wa),u!==null?(o.stateNode=u,zi=o,Nn=null,a=!0):a=!1),a||pc(o)),null;case 13:return wm(a,o,u);case 4:return Un(o,o.stateNode.containerInfo),f=o.pendingProps,a===null?o.child=Ac(o,null,f,u):Ui(a,o,f,u),o.child;case 11:return mp(a,o,o.type,o.pendingProps,u);case 7:return Ui(a,o,o.pendingProps,u),o.child;case 8:return Ui(a,o,o.pendingProps.children,u),o.child;case 12:return Ui(a,o,o.pendingProps.children,u),o.child;case 10:return f=o.pendingProps,fo(o,o.type,f.value),Ui(a,o,f.children,u),o.child;case 9:return E=o.type._context,f=o.pendingProps.children,Ka(o),E=mi(E),f=f(E),o.flags|=1,Ui(a,o,f,u),o.child;case 14:return ST(a,o,o.type,o.pendingProps,u);case 15:return TT(a,o,o.type,o.pendingProps,u);case 19:return CT(a,o,u);case 31:return f=o.pendingProps,u=o.mode,f={mode:f.mode,children:f.children},a===null?(u=uu(f,u),u.ref=o.ref,o.child=u,u.return=o,o=u):(u=Os(a.child,f),u.ref=o.ref,o.child=u,u.return=o,o=u),o;case 22:return vT(a,o,u);case 24:return Ka(o),f=mi(si),a===null?(E=Q_(),E===null&&(E=bn,T=Wd(),E.pooledCache=T,T.refCount++,T!==null&&(E.pooledCacheLanes|=u),E=T),o.memoizedState={parent:f,cache:E},tp(o),fo(o,si,E)):((a.lanes&u)!==0&&(Z_(a,o),Sc(o,null,null,u),gc()),E=a.memoizedState,T=o.memoizedState,E.parent!==f?(E={parent:f,cache:f},o.memoizedState=E,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=E),fo(o,si,f)):(f=T.cache,fo(o,si,f),f!==E.cache&&J_(o,[si],u,!0))),Ui(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(nt(156,o.tag))}function Xa(a){a.flags|=4}function AT(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!iv(o)){if(o=Ei.current,o!==null&&((Ge&4194048)===Ge?za!==null:(Ge&62914560)!==Ge&&(Ge&536870912)===0||o!==za))throw Yd=Il,xS;a.flags|=8192}}function Sp(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?Gg():536870912,a.lanes|=o,Nc|=o)}function pu(a,o){if(!Ze)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:f.sibling=null}}function An(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,f=0;if(o)for(var E=a.child;E!==null;)u|=E.lanes|E.childLanes,f|=E.subtreeFlags&65011712,f|=E.flags&65011712,E.return=a,E=E.sibling;else for(E=a.child;E!==null;)u|=E.lanes|E.childLanes,f|=E.subtreeFlags,f|=E.flags,E.return=a,E=E.sibling;return a.subtreeFlags|=f,a.childLanes=u,o}function RC(a,o,u){var f=o.pendingProps;switch(K_(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return An(o),null;case 1:return An(o),null;case 3:return u=o.stateNode,f=null,a!==null&&(f=a.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),Ds(si),fa(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(jd(o)?Xa(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,DS())),An(o),null;case 26:return u=o.memoizedState,a===null?(Xa(o),u!==null?(An(o),AT(o,u)):(An(o),o.flags&=-16777217)):u?u!==a.memoizedState?(Xa(o),An(o),AT(o,u)):(An(o),o.flags&=-16777217):(a.memoizedProps!==f&&Xa(o),An(o),o.flags&=-16777217),null;case 27:Ch(o),u=pe.current;var E=o.type;if(a!==null&&o.stateNode!=null)a.memoizedProps!==f&&Xa(o);else{if(!f){if(o.stateNode===null)throw Error(nt(166));return An(o),null}a=Gt.current,jd(o)?Y_(o):(a=JT(E,f,u),o.stateNode=a,Xa(o))}return An(o),null;case 5:if(Ch(o),u=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==f&&Xa(o);else{if(!f){if(o.stateNode===null)throw Error(nt(166));return An(o),null}if(a=Gt.current,jd(o))Y_(o);else{switch(E=Hp(pe.current),a){case 1:a=E.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:a=E.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":a=E.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":a=E.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":a=E.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof f.is=="string"?E.createElement("select",{is:f.is}):E.createElement("select"),f.multiple?a.multiple=!0:f.size&&(a.size=f.size);break;default:a=typeof f.is=="string"?E.createElement(u,{is:f.is}):E.createElement(u)}}a[Wi]=o,a[pr]=f;t:for(E=o.child;E!==null;){if(E.tag===5||E.tag===6)a.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===o)break t;for(;E.sibling===null;){if(E.return===null||E.return===o)break t;E=E.return}E.sibling.return=E.return,E=E.sibling}o.stateNode=a;t:switch(wi(a,u,f),u){case"button":case"input":case"select":case"textarea":a=!!f.autoFocus;break t;case"img":a=!0;break t;default:a=!1}a&&Xa(o)}}return An(o),o.flags&=-16777217,null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==f&&Xa(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(nt(166));if(a=pe.current,jd(o)){if(a=o.stateNode,u=o.memoizedProps,f=null,E=zi,E!==null)switch(E.tag){case 27:case 5:f=E.memoizedProps}a[Wi]=o,a=!!(a.nodeValue===u||f!==null&&f.suppressHydrationWarning===!0||Gp(a.nodeValue,u)),a||pc(o)}else a=Hp(a).createTextNode(f),a[Wi]=o,o.stateNode=a}return An(o),null;case 13:if(f=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(E=jd(o),f!==null&&f.dehydrated!==null){if(a===null){if(!E)throw Error(nt(318));if(E=o.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(nt(317));E[Wi]=o}else fc(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;An(o),E=!1}else E=DS(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=E),E=!0;if(!E)return o.flags&256?(Ya(o),o):(Ya(o),null)}if(Ya(o),(o.flags&128)!==0)return o.lanes=u,o;if(u=f!==null,a=a!==null&&a.memoizedState!==null,u){f=o.child,E=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(E=f.alternate.memoizedState.cachePool.pool);var T=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(T=f.memoizedState.cachePool.pool),T!==E&&(f.flags|=2048)}return u!==a&&u&&(o.child.flags|=8192),Sp(o,o.updateQueue),An(o),null;case 4:return fa(),a===null&&Fp(o.stateNode.containerInfo),An(o),null;case 10:return Ds(o.type),An(o),null;case 19:if(Nt(gi),E=o.memoizedState,E===null)return An(o),null;if(f=(o.flags&128)!==0,T=E.rendering,T===null)if(f)pu(E,!1);else{if(Bn!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(T=Ul(a),T!==null){for(o.flags|=128,pu(E,!1),a=T.updateQueue,o.updateQueue=a,Sp(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)Wh(u,a),u=u.sibling;return Ot(gi,gi.current&1|2),o.child}a=a.sibling}E.tail!==null&&ja()>Wl&&(o.flags|=128,f=!0,pu(E,!1),o.lanes=4194304)}else{if(!f)if(a=Ul(T),a!==null){if(o.flags|=128,f=!0,a=a.updateQueue,o.updateQueue=a,Sp(o,a),pu(E,!0),E.tail===null&&E.tailMode==="hidden"&&!T.alternate&&!Ze)return An(o),null}else 2*ja()-E.renderingStartTime>Wl&&u!==536870912&&(o.flags|=128,f=!0,pu(E,!1),o.lanes=4194304);E.isBackwards?(T.sibling=o.child,o.child=T):(a=E.last,a!==null?a.sibling=T:o.child=T,E.last=T)}return E.tail!==null?(o=E.tail,E.rendering=o,E.tail=o.sibling,E.renderingStartTime=ja(),o.sibling=null,a=gi.current,Ot(gi,f?a&1|2:a&1),o):(An(o),null);case 22:case 23:return Ya(o),nm(),f=o.memoizedState!==null,a!==null?a.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(u&536870912)!==0&&(o.flags&128)===0&&(An(o),o.subtreeFlags&6&&(o.flags|=8192)):An(o),u=o.updateQueue,u!==null&&Sp(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==u&&(o.flags|=2048),a!==null&&Nt(_o),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),Ds(si),An(o),null;case 25:return null;case 30:return null}throw Error(nt(156,o.tag))}function yC(a,o){switch(K_(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return Ds(si),fa(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return Ch(o),null;case 13:if(Ya(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(nt(340));fc()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return Nt(gi),null;case 4:return fa(),null;case 10:return Ds(o.type),null;case 22:case 23:return Ya(o),nm(),a!==null&&Nt(_o),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return Ds(si),null;case 25:return null;default:return null}}function bT(a,o){switch(K_(o),o.tag){case 3:Ds(si),fa();break;case 26:case 27:case 5:Ch(o);break;case 4:fa();break;case 13:Ya(o);break;case 19:Nt(gi);break;case 10:Ds(o.type);break;case 22:case 23:Ya(o),nm(),a!==null&&Nt(_o);break;case 24:Ds(si)}}function Fl(a,o){try{var u=o.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var E=f.next;u=E;do{if((u.tag&a)===a){f=void 0;var T=u.create,w=u.inst;f=T(),w.destroy=f}u=u.next}while(u!==E)}}catch(P){Tn(o,o.return,P)}}function yo(a,o,u){try{var f=o.updateQueue,E=f!==null?f.lastEffect:null;if(E!==null){var T=E.next;f=T;do{if((f.tag&a)===a){var w=f.inst,P=w.destroy;if(P!==void 0){w.destroy=void 0,E=o;var F=u,J=P;try{J()}catch(ct){Tn(E,F,ct)}}}f=f.next}while(f!==T)}}catch(ct){Tn(o,o.return,ct)}}function IT(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{ep(o,u)}catch(f){Tn(a,a.return,f)}}}function Tp(a,o,u){u.props=bc(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(f){Tn(a,o,f)}}function fu(a,o){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var f=a.stateNode;break;case 30:f=a.stateNode;break;default:f=a.stateNode}typeof u=="function"?a.refCleanup=u(f):u.current=f}}catch(E){Tn(a,o,E)}}function Xr(a,o){var u=a.ref,f=a.refCleanup;if(u!==null)if(typeof f=="function")try{f()}catch(E){Tn(a,o,E)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(E){Tn(a,o,E)}else u.current=null}function OT(a){var o=a.type,u=a.memoizedProps,f=a.stateNode;try{t:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&f.focus();break t;case"img":u.src?f.src=u.src:u.srcSet&&(f.srcset=u.srcSet)}}catch(E){Tn(a,a.return,E)}}function vp(a,o,u){try{var f=a.stateNode;kC(f,a.type,u,o),f[pr]=o}catch(E){Tn(a,a.return,E)}}function wT(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Do(a.type)||a.tag===4}function Lm(a){t:for(;;){for(;a.sibling===null;){if(a.return===null||wT(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Do(a.type)||a.flags&2||a.child===null||a.tag===4)continue t;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Rp(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(a),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=wu));else if(f!==4&&(f===27&&Do(a.type)&&(u=a.stateNode,o=null),a=a.child,a!==null))for(Rp(a,o,u),a=a.sibling;a!==null;)Rp(a,o,u),a=a.sibling}function yp(a,o,u){var f=a.tag;if(f===5||f===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(f!==4&&(f===27&&Do(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(yp(a,o,u),a=a.sibling;a!==null;)yp(a,o,u),a=a.sibling}function NT(a){var o=a.stateNode,u=a.memoizedProps;try{for(var f=a.type,E=o.attributes;E.length;)o.removeAttributeNode(E[0]);wi(o,f,u),o[Wi]=a,o[pr]=u}catch(T){Tn(a,a.return,T)}}var Ja=!1,Yn=!1,_u=!1,DT=typeof WeakSet=="function"?WeakSet:Set,Oi=null;function mu(a,o){if(a=a.containerInfo,sE=Qp,a=bs(a),P_(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else t:{u=(u=a.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var E=f.anchorOffset,T=f.focusNode;f=f.focusOffset;try{u.nodeType,T.nodeType}catch{u=null;break t}var w=0,P=-1,F=-1,J=0,ct=0,mt=a,tt=null;e:for(;;){for(var et;mt!==u||E!==0&&mt.nodeType!==3||(P=w+E),mt!==T||f!==0&&mt.nodeType!==3||(F=w+f),mt.nodeType===3&&(w+=mt.nodeValue.length),(et=mt.firstChild)!==null;)tt=mt,mt=et;for(;;){if(mt===a)break e;if(tt===u&&++J===E&&(P=w),tt===T&&++ct===f&&(F=w),(et=mt.nextSibling)!==null)break;mt=tt,tt=mt.parentNode}mt=et}u=P===-1||F===-1?null:{start:P,end:F}}else u=null}u=u||{start:0,end:0}}else u=null;for(ed={focusedElem:a,selectionRange:u},Qp=!1,Oi=o;Oi!==null;)if(o=Oi,a=o.child,(o.subtreeFlags&1024)!==0&&a!==null)a.return=o,Oi=a;else for(;Oi!==null;){switch(o=Oi,T=o.alternate,a=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&T!==null){a=void 0,u=o,E=T.memoizedProps,T=T.memoizedState,f=u.stateNode;try{var ce=bc(u.type,E,u.elementType===u.type);a=f.getSnapshotBeforeUpdate(ce,T),f.__reactInternalSnapshotBeforeUpdate=a}catch(Zt){Tn(u,u.return,Zt)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)lE(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":lE(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(nt(163))}if(a=o.sibling,a!==null){a.return=o.return,Oi=a;break}Oi=o.return}}function Pm(a,o,u){var f=u.flags;switch(u.tag){case 0:case 11:case 15:ir(a,u),f&4&&Fl(5,u);break;case 1:if(ir(a,u),f&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(w){Tn(u,u.return,w)}else{var E=bc(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(E,o,a.__reactInternalSnapshotBeforeUpdate)}catch(w){Tn(u,u.return,w)}}f&64&&IT(u),f&512&&fu(u,u.return);break;case 3:if(ir(a,u),f&64&&(a=u.updateQueue,a!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{ep(a,o)}catch(w){Tn(u,u.return,w)}}break;case 27:o===null&&f&4&&NT(u);case 26:case 5:ir(a,u),o===null&&f&4&&OT(u),f&512&&fu(u,u.return);break;case 12:ir(a,u);break;case 13:ir(a,u),f&4&&LT(a,u),f&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=wC.bind(null,u),jC(a,u))));break;case 22:if(f=u.memoizedState!==null||Ja,!f){o=o!==null&&o.memoizedState!==null||Yn,E=Ja;var T=Yn;Ja=f,(Yn=o)&&!T?gr(a,u,(u.subtreeFlags&8772)!==0):ir(a,u),Ja=E,Yn=T}break;case 30:break;default:ir(a,u)}}function jl(a){var o=a.alternate;o!==null&&(a.alternate=null,jl(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&Oh(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var cn=null,nr=!1;function Ra(a,o,u){for(u=u.child;u!==null;)Eu(a,o,u),u=u.sibling}function Eu(a,o,u){if(Zn&&typeof Zn.onCommitFiberUnmount=="function")try{Zn.onCommitFiberUnmount(al,u)}catch{}switch(u.tag){case 26:Yn||Xr(u,o),Ra(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:Yn||Xr(u,o);var f=cn,E=nr;Do(u.type)&&(cn=u.stateNode,nr=!1),Ra(a,o,u),Nu(u.stateNode),cn=f,nr=E;break;case 5:Yn||Xr(u,o);case 6:if(f=cn,E=nr,cn=null,Ra(a,o,u),cn=f,nr=E,cn!==null)if(nr)try{(cn.nodeType===9?cn.body:cn.nodeName==="HTML"?cn.ownerDocument.body:cn).removeChild(u.stateNode)}catch(T){Tn(u,o,T)}else try{cn.removeChild(u.stateNode)}catch(T){Tn(u,o,T)}break;case 18:cn!==null&&(nr?(a=cn,qT(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),Fu(a)):qT(cn,u.stateNode));break;case 4:f=cn,E=nr,cn=u.stateNode.containerInfo,nr=!0,Ra(a,o,u),cn=f,nr=E;break;case 0:case 11:case 14:case 15:Yn||yo(2,u,o),Yn||yo(4,u,o),Ra(a,o,u);break;case 1:Yn||(Xr(u,o),f=u.stateNode,typeof f.componentWillUnmount=="function"&&Tp(u,o,f)),Ra(a,o,u);break;case 21:Ra(a,o,u);break;case 22:Yn=(f=Yn)||u.memoizedState!==null,Ra(a,o,u),Yn=f;break;default:Ra(a,o,u)}}function LT(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Fu(a)}catch(u){Tn(o,o.return,u)}}function CC(a){switch(a.tag){case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new DT),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new DT),o;default:throw Error(nt(435,a.tag))}}function km(a,o){var u=CC(a);o.forEach(function(f){var E=NC.bind(null,a,f);u.has(f)||(u.add(f),f.then(E,E))})}function Er(a,o){var u=o.deletions;if(u!==null)for(var f=0;f<u.length;f++){var E=u[f],T=a,w=o,P=w;t:for(;P!==null;){switch(P.tag){case 27:if(Do(P.type)){cn=P.stateNode,nr=!1;break t}break;case 5:cn=P.stateNode,nr=!1;break t;case 3:case 4:cn=P.stateNode.containerInfo,nr=!0;break t}P=P.return}if(cn===null)throw Error(nt(160));Eu(T,w,E),cn=null,nr=!1,T=E.alternate,T!==null&&(T.return=null),E.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)PT(o,a),o=o.sibling}var ya=null;function PT(a,o){var u=a.alternate,f=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Er(o,a),Ur(a),f&4&&(yo(3,a,a.return),Fl(3,a),yo(5,a,a.return));break;case 1:Er(o,a),Ur(a),f&512&&(Yn||u===null||Xr(u,u.return)),f&64&&Ja&&(a=a.updateQueue,a!==null&&(f=a.callbacks,f!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?f:u.concat(f))));break;case 26:var E=ya;if(Er(o,a),Ur(a),f&512&&(Yn||u===null||Xr(u,u.return)),f&4){var T=u!==null?u.memoizedState:null;if(f=a.memoizedState,u===null)if(f===null)if(a.stateNode===null){t:{f=a.type,u=a.memoizedProps,E=E.ownerDocument||E;e:switch(f){case"title":T=E.getElementsByTagName("title")[0],(!T||T[cl]||T[Wi]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=E.createElement(f),E.head.insertBefore(T,E.querySelector("head > title"))),wi(T,f,u),T[Wi]=a,fi(T),f=T;break t;case"link":var w=pE("link","href",E).get(f+(u.href||""));if(w){for(var P=0;P<w.length;P++)if(T=w[P],T.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&T.getAttribute("rel")===(u.rel==null?null:u.rel)&&T.getAttribute("title")===(u.title==null?null:u.title)&&T.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){w.splice(P,1);break e}}T=E.createElement(f),wi(T,f,u),E.head.appendChild(T);break;case"meta":if(w=pE("meta","content",E).get(f+(u.content||""))){for(P=0;P<w.length;P++)if(T=w[P],T.getAttribute("content")===(u.content==null?null:""+u.content)&&T.getAttribute("name")===(u.name==null?null:u.name)&&T.getAttribute("property")===(u.property==null?null:u.property)&&T.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&T.getAttribute("charset")===(u.charSet==null?null:u.charSet)){w.splice(P,1);break e}}T=E.createElement(f),wi(T,f,u),E.head.appendChild(T);break;default:throw Error(nt(468,f))}T[Wi]=a,fi(T),f=T}a.stateNode=f}else nv(E,a.type,a.stateNode);else a.stateNode=Yp(E,f,a.memoizedProps);else T!==f?(T===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):T.count--,f===null?nv(E,a.type,a.stateNode):Yp(E,f,a.memoizedProps)):f===null&&a.stateNode!==null&&vp(a,a.memoizedProps,u.memoizedProps)}break;case 27:Er(o,a),Ur(a),f&512&&(Yn||u===null||Xr(u,u.return)),u!==null&&f&4&&vp(a,a.memoizedProps,u.memoizedProps);break;case 5:if(Er(o,a),Ur(a),f&512&&(Yn||u===null||Xr(u,u.return)),a.flags&32){E=a.stateNode;try{so(E,"")}catch(et){Tn(a,a.return,et)}}f&4&&a.stateNode!=null&&(E=a.memoizedProps,vp(a,E,u!==null?u.memoizedProps:E)),f&1024&&(_u=!0);break;case 6:if(Er(o,a),Ur(a),f&4){if(a.stateNode===null)throw Error(nt(162));f=a.memoizedProps,u=a.stateNode;try{u.nodeValue=f}catch(et){Tn(a,a.return,et)}}break;case 3:if(Xp=null,E=ya,ya=Kp(o.containerInfo),Er(o,a),ya=E,Ur(a),f&4&&u!==null&&u.memoizedState.isDehydrated)try{Fu(o.containerInfo)}catch(et){Tn(a,a.return,et)}_u&&(_u=!1,Cp(a));break;case 4:f=ya,ya=Kp(a.stateNode.containerInfo),Er(o,a),Ur(a),ya=f;break;case 12:Er(o,a),Ur(a);break;case 13:Er(o,a),Ur(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Ru=ja()),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,km(a,f)));break;case 22:E=a.memoizedState!==null;var F=u!==null&&u.memoizedState!==null,J=Ja,ct=Yn;if(Ja=J||E,Yn=ct||F,Er(o,a),Yn=ct,Ja=J,Ur(a),f&8192)t:for(o=a.stateNode,o._visibility=E?o._visibility&-2:o._visibility|1,E&&(u===null||F||Ja||Yn||Ic(a)),u=null,o=a;;){if(o.tag===5||o.tag===26){if(u===null){F=u=o;try{if(T=F.stateNode,E)w=T.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none";else{P=F.stateNode;var mt=F.memoizedProps.style,tt=mt!=null&&mt.hasOwnProperty("display")?mt.display:null;P.style.display=tt==null||typeof tt=="boolean"?"":(""+tt).trim()}}catch(et){Tn(F,F.return,et)}}}else if(o.tag===6){if(u===null){F=o;try{F.stateNode.nodeValue=E?"":F.memoizedProps}catch(et){Tn(F,F.return,et)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break t;for(;o.sibling===null;){if(o.return===null||o.return===a)break t;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=a.updateQueue,f!==null&&(u=f.retryQueue,u!==null&&(f.retryQueue=null,km(a,u))));break;case 19:Er(o,a),Ur(a),f&4&&(f=a.updateQueue,f!==null&&(a.updateQueue=null,km(a,f)));break;case 30:break;case 21:break;default:Er(o,a),Ur(a)}}function Ur(a){var o=a.flags;if(o&2){try{for(var u,f=a.return;f!==null;){if(wT(f)){u=f;break}f=f.return}if(u==null)throw Error(nt(160));switch(u.tag){case 27:var E=u.stateNode,T=Lm(a);yp(a,T,E);break;case 5:var w=u.stateNode;u.flags&32&&(so(w,""),u.flags&=-33);var P=Lm(a);yp(a,P,w);break;case 3:case 4:var F=u.stateNode.containerInfo,J=Lm(a);Rp(a,J,F);break;default:throw Error(nt(161))}}catch(ct){Tn(a,a.return,ct)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function Cp(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;Cp(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function ir(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)Pm(a,o.alternate,o),o=o.sibling}function Ic(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:yo(4,o,o.return),Ic(o);break;case 1:Xr(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&Tp(o,o.return,u),Ic(o);break;case 27:Nu(o.stateNode);case 26:case 5:Xr(o,o.return),Ic(o);break;case 22:o.memoizedState===null&&Ic(o);break;case 30:Ic(o);break;default:Ic(o)}a=a.sibling}}function gr(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,E=a,T=o,w=T.flags;switch(T.tag){case 0:case 11:case 15:gr(E,T,u),Fl(4,T);break;case 1:if(gr(E,T,u),f=T,E=f.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch(J){Tn(f,f.return,J)}if(f=T,E=f.updateQueue,E!==null){var P=f.stateNode;try{var F=E.shared.hiddenCallbacks;if(F!==null)for(E.shared.hiddenCallbacks=null,E=0;E<F.length;E++)em(F[E],P)}catch(J){Tn(f,f.return,J)}}u&&w&64&&IT(T),fu(T,T.return);break;case 27:NT(T);case 26:case 5:gr(E,T,u),u&&f===null&&w&4&&OT(T),fu(T,T.return);break;case 12:gr(E,T,u);break;case 13:gr(E,T,u),u&&w&4&&LT(E,T);break;case 22:T.memoizedState===null&&gr(E,T,u),fu(T,T.return);break;case 30:break;default:gr(E,T,u)}o=o.sibling}}function Ap(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&Kd(u))}function rr(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Kd(a))}function Qa(a,o,u,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)kT(a,o,u,f),o=o.sibling}function kT(a,o,u,f){var E=o.flags;switch(o.tag){case 0:case 11:case 15:Qa(a,o,u,f),E&2048&&Fl(9,o);break;case 1:Qa(a,o,u,f);break;case 3:Qa(a,o,u,f),E&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Kd(a)));break;case 12:if(E&2048){Qa(a,o,u,f),a=o.stateNode;try{var T=o.memoizedProps,w=T.id,P=T.onPostCommit;typeof P=="function"&&P(w,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(F){Tn(o,o.return,F)}}else Qa(a,o,u,f);break;case 13:Qa(a,o,u,f);break;case 23:break;case 22:T=o.stateNode,w=o.alternate,o.memoizedState!==null?T._visibility&2?Qa(a,o,u,f):gu(a,o):T._visibility&2?Qa(a,o,u,f):(T._visibility|=2,Oc(a,o,u,f,(o.subtreeFlags&10256)!==0)),E&2048&&Ap(w,o);break;case 24:Qa(a,o,u,f),E&2048&&rr(o.alternate,o);break;default:Qa(a,o,u,f)}}function Oc(a,o,u,f,E){for(E=E&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var T=a,w=o,P=u,F=f,J=w.flags;switch(w.tag){case 0:case 11:case 15:Oc(T,w,P,F,E),Fl(8,w);break;case 23:break;case 22:var ct=w.stateNode;w.memoizedState!==null?ct._visibility&2?Oc(T,w,P,F,E):gu(T,w):(ct._visibility|=2,Oc(T,w,P,F,E)),E&&J&2048&&Ap(w.alternate,w);break;case 24:Oc(T,w,P,F,E),E&&J&2048&&rr(w.alternate,w);break;default:Oc(T,w,P,F,E)}o=o.sibling}}function gu(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,f=o,E=f.flags;switch(f.tag){case 22:gu(u,f),E&2048&&Ap(f.alternate,f);break;case 24:gu(u,f),E&2048&&rr(f.alternate,f);break;default:gu(u,f)}o=o.sibling}}var Gl=8192;function wc(a){if(a.subtreeFlags&Gl)for(a=a.child;a!==null;)MT(a),a=a.sibling}function MT(a){switch(a.tag){case 26:wc(a),a.flags&Gl&&a.memoizedState!==null&&QC(ya,a.memoizedState,a.memoizedProps);break;case 5:wc(a);break;case 3:case 4:var o=ya;ya=Kp(a.stateNode.containerInfo),wc(a),ya=o;break;case 22:a.memoizedState===null&&(o=a.alternate,o!==null&&o.memoizedState!==null?(o=Gl,Gl=16777216,wc(a),Gl=o):wc(a));break;default:wc(a)}}function Mm(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function Su(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];Oi=f,Ip(f,a)}Mm(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)UT(a),a=a.sibling}function UT(a){switch(a.tag){case 0:case 11:case 15:Su(a),a.flags&2048&&yo(9,a,a.return);break;case 3:Su(a);break;case 12:Su(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,bp(a)):Su(a);break;default:Su(a)}}function bp(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var f=o[u];Oi=f,Ip(f,a)}Mm(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:yo(8,o,o.return),bp(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,bp(o));break;default:bp(o)}a=a.sibling}}function Ip(a,o){for(;Oi!==null;){var u=Oi;switch(u.tag){case 0:case 11:case 15:yo(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var f=u.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Kd(u.memoizedState.cache)}if(f=u.child,f!==null)f.return=u,Oi=f;else t:for(u=a;Oi!==null;){f=Oi;var E=f.sibling,T=f.return;if(jl(f),f===u){Oi=null;break t}if(E!==null){E.return=T,Oi=E;break t}Oi=T}}}var Um={getCacheForType:function(a){var o=mi(si),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u}},AC=typeof WeakMap=="function"?WeakMap:Map,$e=0,bn=null,Ne=null,Ge=0,tn=0,xi=null,ks=!1,Co=!1,Tu=!1,Za=0,Bn=0,Ca=0,Ao=0,xm=0,Jr=0,Nc=0,Hl=null,Si=null,vu=!1,Ru=0,Wl=1/0,yu=null,Ms=null,Vi=0,bo=null,Aa=null,Kl=0,Op=0,Cu=null,xT=null,Au=0,Vm=null;function xr(){if(($e&2)!==0&&Ge!==0)return Ge&-Ge;if(ot.T!==null){var a=Al;return a!==0?a:Jl()}return Wg()}function wp(){Jr===0&&(Jr=(Ge&536870912)===0||Ze?c_():536870912);var a=Ei.current;return a!==null&&(a.flags|=32),Jr}function Sr(a,o,u){(a===bn&&(tn===2||tn===9)||a.cancelPendingCommit!==null)&&(Lc(a,0),$a(a,Ge,Jr,!1)),Ld(a,u),(($e&2)===0||a!==bn)&&(a===bn&&(($e&2)===0&&(Ao|=u),Bn===4&&$a(a,Ge,Jr,!1)),Qr(a))}function Bm(a,o,u){if(($e&6)!==0)throw Error(nt(327));var f=!u&&(o&124)===0&&(o&a.expiredLanes)===0||Dd(a,o),E=f?IC(a,o):jm(a,o,!0),T=f;do{if(E===0){Co&&!f&&$a(a,o,0,!1);break}else{if(u=a.current.alternate,T&&!Np(u)){E=jm(a,o,!1),T=!1;continue}if(E===2){if(T=o,a.errorRecoveryDisabledLanes&T)var w=0;else w=a.pendingLanes&-536870913,w=w!==0?w:w&536870912?536870912:0;if(w!==0){o=w;t:{var P=a;E=Hl;var F=P.current.memoizedState.isDehydrated;if(F&&(Lc(P,w).flags|=256),w=jm(P,w,!1),w!==2){if(Tu&&!F){P.errorRecoveryDisabledLanes|=T,Ao|=T,E=4;break t}T=Si,Si=E,T!==null&&(Si===null?Si=T:Si.push.apply(Si,T))}E=w}if(T=!1,E!==2)continue}}if(E===1){Lc(a,0),$a(a,o,0,!0);break}t:{switch(f=a,T=E,T){case 0:case 1:throw Error(nt(345));case 4:if((o&4194048)!==o)break;case 6:$a(f,o,Jr,!ks);break t;case 2:Si=null;break;case 3:case 5:break;default:throw Error(nt(329))}if((o&62914560)===o&&(E=Ru+300-ja(),10<E)){if($a(f,o,Jr,!ks),bh(f,0,!0)!==0)break t;f.timeoutHandle=zT(Fm.bind(null,f,u,Si,yu,vu,o,Jr,Ao,Nc,ks,T,2,-0,0),E);break t}Fm(f,u,Si,yu,vu,o,Jr,Ao,Nc,ks,T,0,-0,0)}}break}while(!0);Qr(a)}function Fm(a,o,u,f,E,T,w,P,F,J,ct,mt,tt,et){if(a.timeoutHandle=-1,mt=o.subtreeFlags,(mt&8192||(mt&16785408)===16785408)&&(Lu={stylesheets:null,count:0,unsuspend:JC},MT(o),mt=rv(),mt!==null)){a.cancelPendingCommit=mt(BT.bind(null,a,o,T,u,f,E,w,P,F,ct,1,tt,et)),$a(a,T,w,!J);return}BT(a,o,T,u,f,E,w,P,F)}function Np(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var f=0;f<u.length;f++){var E=u[f],T=E.getSnapshot;E=E.value;try{if(!Dr(T(),E))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function $a(a,o,u,f){o&=~xm,o&=~Ao,a.suspendedLanes|=o,a.pingedLanes&=~o,f&&(a.warmLanes|=o),f=a.expirationTimes;for(var E=o;0<E;){var T=31-er(E),w=1<<T;f[T]=-1,E&=~w}u!==0&&ol(a,u,o)}function Dc(){return($e&6)===0?(bu(0),!1):!0}function zl(){if(Ne!==null){if(tn===0)var a=Ne.return;else a=Ne,Ns=_c=null,am(a),Cc=null,Ta=0,a=Ne;for(;a!==null;)bT(a.alternate,a),a=a.return;Ne=null}}function Lc(a,o){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,UC(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),zl(),bn=a,Ne=u=Os(a.current,null),Ge=o,tn=0,xi=null,ks=!1,Co=Dd(a,o),Tu=!1,Nc=Jr=xm=Ao=Ca=Bn=0,Si=Hl=null,vu=!1,(o&8)!==0&&(o|=o&32);var f=a.entangledLanes;if(f!==0)for(a=a.entanglements,f&=o;0<f;){var E=31-er(f),T=1<<E;o|=a[E],f&=~T}return Za=o,lc(),u}function Pc(a,o){ve=null,ot.H=Mr,o===Ec||o===Zh?(o=FS(),tn=3):o===xS?(o=FS(),tn=4):tn=o===gT?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,xi=o,Ne===null&&(Bn=1,_p(a,Lr(o,a.current)))}function Io(){var a=ot.H;return ot.H=Mr,a===null?Mr:a}function VT(){var a=ot.A;return ot.A=Um,a}function kc(){Bn=4,ks||(Ge&4194048)!==Ge&&Ei.current!==null||(Co=!0),(Ca&134217727)===0&&(Ao&134217727)===0||bn===null||$a(bn,Ge,Jr,!1)}function jm(a,o,u){var f=$e;$e|=2;var E=Io(),T=VT();(bn!==a||Ge!==o)&&(yu=null,Lc(a,o)),o=!1;var w=Bn;t:do try{if(tn!==0&&Ne!==null){var P=Ne,F=xi;switch(tn){case 8:zl(),w=6;break t;case 3:case 2:case 9:case 6:Ei.current===null&&(o=!0);var J=tn;if(tn=0,xi=null,Mc(a,P,F,J),u&&Co){w=0;break t}break;default:J=tn,tn=0,xi=null,Mc(a,P,F,J)}}bC(),w=Bn;break}catch(ct){Pc(a,ct)}while(!0);return o&&a.shellSuspendCounter++,Ns=_c=null,$e=f,ot.H=E,ot.A=T,Ne===null&&(bn=null,Ge=0,lc()),w}function bC(){for(;Ne!==null;)Gm(Ne)}function IC(a,o){var u=$e;$e|=2;var f=Io(),E=VT();bn!==a||Ge!==o?(yu=null,Wl=ja()+500,Lc(a,o)):Co=Dd(a,o);t:do try{if(tn!==0&&Ne!==null){o=Ne;var T=xi;e:switch(tn){case 1:tn=0,xi=null,Mc(a,o,T,1);break;case 2:case 9:if(VS(T)){tn=0,xi=null,Dp(o);break}o=function(){tn!==2&&tn!==9||bn!==a||(tn=7),Qr(a)},T.then(o,o);break t;case 3:tn=7;break t;case 4:tn=5;break t;case 7:VS(T)?(tn=0,xi=null,Dp(o)):(tn=0,xi=null,Mc(a,o,T,7));break;case 5:var w=null;switch(Ne.tag){case 26:w=Ne.memoizedState;case 5:case 27:var P=Ne;if(!w||iv(w)){tn=0,xi=null;var F=P.sibling;if(F!==null)Ne=F;else{var J=P.return;J!==null?(Ne=J,Lp(J)):Ne=null}break e}}tn=0,xi=null,Mc(a,o,T,5);break;case 6:tn=0,xi=null,Mc(a,o,T,6);break;case 8:zl(),Bn=6;break t;default:throw Error(nt(462))}}OC();break}catch(ct){Pc(a,ct)}while(!0);return Ns=_c=null,ot.H=f,ot.A=E,$e=u,Ne!==null?0:(bn=null,Ge=0,lc(),Bn)}function OC(){for(;Ne!==null&&!ky();)Gm(Ne)}function Gm(a){var o=hu(a.alternate,a,Za);a.memoizedProps=a.pendingProps,o===null?Lp(a):Ne=o}function Dp(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=bm(u,o,o.pendingProps,o.type,void 0,Ge);break;case 11:o=bm(u,o,o.pendingProps,o.type.render,o.ref,Ge);break;case 5:am(o);default:bT(u,o),o=Ne=Wh(o,Za),o=hu(u,o,Za)}a.memoizedProps=a.pendingProps,o===null?Lp(a):Ne=o}function Mc(a,o,u,f){Ns=_c=null,am(o),Cc=null,Ta=0;var E=o.return;try{if(TC(a,E,o,u,Ge)){Bn=1,_p(a,Lr(u,a.current)),Ne=null;return}}catch(T){if(E!==null)throw Ne=E,T;Bn=1,_p(a,Lr(u,a.current)),Ne=null;return}o.flags&32768?(Ze||f===1?a=!0:Co||(Ge&536870912)!==0?a=!1:(ks=a=!0,(f===2||f===9||f===3||f===6)&&(f=Ei.current,f!==null&&f.tag===13&&(f.flags|=16384))),Hm(o,a)):Lp(o)}function Lp(a){var o=a;do{if((o.flags&32768)!==0){Hm(o,ks);return}a=o.return;var u=RC(o.alternate,o,Za);if(u!==null){Ne=u;return}if(o=o.sibling,o!==null){Ne=o;return}Ne=o=a}while(o!==null);Bn===0&&(Bn=5)}function Hm(a,o){do{var u=yC(a.alternate,a);if(u!==null){u.flags&=32767,Ne=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){Ne=a;return}Ne=a=u}while(a!==null);Bn=6,Ne=null}function BT(a,o,u,f,E,T,w,P,F){a.cancelPendingCommit=null;do Pp();while(Vi!==0);if(($e&6)!==0)throw Error(nt(327));if(o!==null){if(o===a.current)throw Error(nt(177));if(T=o.lanes|o.childLanes,T|=F_,Uy(a,u,T,w,P,F),a===bn&&(Ne=bn=null,Ge=0),Aa=o,bo=a,Kl=u,Op=T,Cu=E,xT=f,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,DC(rl,function(){return kp(),null})):(a.callbackNode=null,a.callbackPriority=0),f=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||f){f=ot.T,ot.T=null,E=Rt.p,Rt.p=2,w=$e,$e|=4;try{mu(a,o,u)}finally{$e=w,Rt.p=E,ot.T=f}}Vi=1,Yl(),ba(),Wm()}}function Yl(){if(Vi===1){Vi=0;var a=bo,o=Aa,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=ot.T,ot.T=null;var f=Rt.p;Rt.p=2;var E=$e;$e|=4;try{PT(o,a);var T=ed,w=bs(a.containerInfo),P=T.focusedElem,F=T.selectionRange;if(w!==P&&P&&P.ownerDocument&&CS(P.ownerDocument.documentElement,P)){if(F!==null&&P_(P)){var J=F.start,ct=F.end;if(ct===void 0&&(ct=J),"selectionStart"in P)P.selectionStart=J,P.selectionEnd=Math.min(ct,P.value.length);else{var mt=P.ownerDocument||document,tt=mt&&mt.defaultView||window;if(tt.getSelection){var et=tt.getSelection(),ce=P.textContent.length,Zt=Math.min(F.start,ce),mn=F.end===void 0?Zt:Math.min(F.end,ce);!et.extend&&Zt>mn&&(w=mn,mn=Zt,Zt=w);var q=yS(P,Zt),W=yS(P,mn);if(q&&W&&(et.rangeCount!==1||et.anchorNode!==q.node||et.anchorOffset!==q.offset||et.focusNode!==W.node||et.focusOffset!==W.offset)){var Q=mt.createRange();Q.setStart(q.node,q.offset),et.removeAllRanges(),Zt>mn?(et.addRange(Q),et.extend(W.node,W.offset)):(Q.setEnd(W.node,W.offset),et.addRange(Q))}}}}for(mt=[],et=P;et=et.parentNode;)et.nodeType===1&&mt.push({element:et,left:et.scrollLeft,top:et.scrollTop});for(typeof P.focus=="function"&&P.focus(),P=0;P<mt.length;P++){var pt=mt[P];pt.element.scrollLeft=pt.left,pt.element.scrollTop=pt.top}}Qp=!!sE,ed=sE=null}finally{$e=E,Rt.p=f,ot.T=u}}a.current=o,Vi=2}}function ba(){if(Vi===2){Vi=0;var a=bo,o=Aa,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=ot.T,ot.T=null;var f=Rt.p;Rt.p=2;var E=$e;$e|=4;try{Pm(a,o.alternate,o)}finally{$e=E,Rt.p=f,ot.T=u}}Vi=3}}function Wm(){if(Vi===4||Vi===3){Vi=0,no();var a=bo,o=Aa,u=Kl,f=xT;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Vi=5:(Vi=0,Aa=bo=null,FT(a,a.pendingLanes));var E=a.pendingLanes;if(E===0&&(Ms=null),d_(u),o=o.stateNode,Zn&&typeof Zn.onCommitFiberRoot=="function")try{Zn.onCommitFiberRoot(al,o,void 0,(o.current.flags&128)===128)}catch{}if(f!==null){o=ot.T,E=Rt.p,Rt.p=2,ot.T=null;try{for(var T=a.onRecoverableError,w=0;w<f.length;w++){var P=f[w];T(P.value,{componentStack:P.stack})}}finally{ot.T=o,Rt.p=E}}(Kl&3)!==0&&Pp(),Qr(a),E=a.pendingLanes,(u&4194090)!==0&&(E&42)!==0?a===Vm?Au++:(Au=0,Vm=a):Au=0,bu(0)}}function FT(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,Kd(o)))}function Pp(a){return Yl(),ba(),Wm(),kp()}function kp(){if(Vi!==5)return!1;var a=bo,o=Op;Op=0;var u=d_(Kl),f=ot.T,E=Rt.p;try{Rt.p=32>u?32:u,ot.T=null,u=Cu,Cu=null;var T=bo,w=Kl;if(Vi=0,Aa=bo=null,Kl=0,($e&6)!==0)throw Error(nt(331));var P=$e;if($e|=4,UT(T.current),kT(T,T.current,w,u),$e=P,bu(0,!1),Zn&&typeof Zn.onPostCommitFiberRoot=="function")try{Zn.onPostCommitFiberRoot(al,T)}catch{}return!0}finally{Rt.p=E,ot.T=f,FT(a,o)}}function Km(a,o,u){o=Lr(u,o),o=va(a.stateNode,o,2),a=Ls(a,o,2),a!==null&&(Ld(a,2),Qr(a))}function Tn(a,o,u){if(a.tag===3)Km(a,a,u);else for(;o!==null;){if(o.tag===3){Km(o,a,u);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ms===null||!Ms.has(f))){a=Lr(u,a),u=mT(2),f=Ls(o,u,2),f!==null&&(ET(u,f,o,a),Ld(f,2),Qr(f));break}}o=o.return}}function ql(a,o,u){var f=a.pingCache;if(f===null){f=a.pingCache=new AC;var E=new Set;f.set(o,E)}else E=f.get(o),E===void 0&&(E=new Set,f.set(o,E));E.has(u)||(Tu=!0,E.add(u),a=Oo.bind(null,a,o,u),o.then(a,a))}function Oo(a,o,u){var f=a.pingCache;f!==null&&f.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,bn===a&&(Ge&u)===u&&(Bn===4||Bn===3&&(Ge&62914560)===Ge&&300>ja()-Ru?($e&2)===0&&Lc(a,0):xm|=u,Nc===Ge&&(Nc=0)),Qr(a)}function Xl(a,o){o===0&&(o=Gg()),a=vl(a,o),a!==null&&(Ld(a,o),Qr(a))}function wC(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),Xl(a,u)}function NC(a,o){var u=0;switch(a.tag){case 13:var f=a.stateNode,E=a.memoizedState;E!==null&&(u=E.retryLane);break;case 19:f=a.stateNode;break;case 22:f=a.stateNode._retryCache;break;default:throw Error(nt(314))}f!==null&&f.delete(o),Xl(a,u)}function DC(a,o){return vs(a,o)}var Mp=null,wo=null,zm=!1,Up=!1,Ym=!1,No=0;function Qr(a){a!==wo&&a.next===null&&(wo===null?Mp=wo=a:wo=wo.next=a),Up=!0,zm||(zm=!0,GT())}function bu(a,o){if(!Ym&&Up){Ym=!0;do for(var u=!1,f=Mp;f!==null;){if(a!==0){var E=f.pendingLanes;if(E===0)var T=0;else{var w=f.suspendedLanes,P=f.pingedLanes;T=(1<<31-er(42|a)+1)-1,T&=E&~(w&~P),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(u=!0,Xm(f,T))}else T=Ge,T=bh(f,f===bn?T:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(T&3)===0||Dd(f,T)||(u=!0,Xm(f,T));f=f.next}while(u);Ym=!1}}function LC(){jT()}function jT(){Up=zm=!1;var a=0;No!==0&&(MC()&&(a=No),No=0);for(var o=ja(),u=null,f=Mp;f!==null;){var E=f.next,T=qm(f,o);T===0?(f.next=null,u===null?Mp=E:u.next=E,E===null&&(wo=u)):(u=f,(a!==0||(T&3)!==0)&&(Up=!0)),f=E}bu(a)}function qm(a,o){for(var u=a.suspendedLanes,f=a.pingedLanes,E=a.expirationTimes,T=a.pendingLanes&-62914561;0<T;){var w=31-er(T),P=1<<w,F=E[w];F===-1?((P&u)===0||(P&f)!==0)&&(E[w]=sl(P,o)):F<=o&&(a.expiredLanes|=P),T&=~P}if(o=bn,u=Ge,u=bh(a,a===o?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f=a.callbackNode,u===0||a===o&&(tn===2||tn===9)||a.cancelPendingCommit!==null)return f!==null&&f!==null&&s_(f),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||Dd(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(f!==null&&s_(f),d_(u)){case 2:case 8:u=Ah;break;case 32:u=rl;break;case 268435456:u=o_;break;default:u=rl}return f=xp.bind(null,a),u=vs(u,f),a.callbackPriority=o,a.callbackNode=u,o}return f!==null&&f!==null&&s_(f),a.callbackPriority=2,a.callbackNode=null,2}function xp(a,o){if(Vi!==0&&Vi!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(Pp()&&a.callbackNode!==u)return null;var f=Ge;return f=bh(a,a===bn?f:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),f===0?null:(Bm(a,f,o),qm(a,ja()),a.callbackNode!=null&&a.callbackNode===u?xp.bind(null,a):null)}function Xm(a,o){if(Pp())return null;Bm(a,o,!0)}function GT(){xC(function(){($e&6)!==0?vs(hr,LC):jT()})}function Jl(){return No===0&&(No=c_()),No}function Jm(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Mh(""+a)}function HT(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function Qm(a,o,u,f,E){if(o==="submit"&&u&&u.stateNode===E){var T=Jm((E[pr]||null).action),w=f.submitter;w&&(o=(o=w[pr]||null)?Jm(o.formAction):w.getAttribute("formAction"),o!==null&&(T=o,w=null));var P=new ma("action","action",null,f,E);a.push({event:P,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(No!==0){var F=w?HT(E,w):new FormData(E);kl(u,{pending:!0,data:F,method:E.method,action:T},null,F)}}else typeof T=="function"&&(P.preventDefault(),F=w?HT(E,w):new FormData(E),kl(u,{pending:!0,data:F,method:E.method,action:T},T,F))},currentTarget:E}]})}}for(var Zm=0;Zm<V_.length;Zm++){var $m=V_[Zm],Iu=$m.toLowerCase(),tE=$m[0].toUpperCase()+$m.slice(1);Ea(Iu,"on"+tE)}Ea(IS,"onAnimationEnd"),Ea(OS,"onAnimationIteration"),Ea(Hh,"onAnimationStart"),Ea("dblclick","onDoubleClick"),Ea("focusin","onFocus"),Ea("focusout","onBlur"),Ea(x_,"onTransitionRun"),Ea(dC,"onTransitionStart"),Ea(rt,"onTransitionCancel"),Ea(wS,"onTransitionEnd"),ul("onMouseEnter",["mouseout","mouseover"]),ul("onMouseLeave",["mouseout","mouseover"]),ul("onPointerEnter",["pointerout","pointerover"]),ul("onPointerLeave",["pointerout","pointerover"]),Wr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Wr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Wr("onBeforeInput",["compositionend","keypress","textInput","paste"]),Wr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Wr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Wr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ql="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),eE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ql));function Vp(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var f=a[u],E=f.event;f=f.listeners;t:{var T=void 0;if(o)for(var w=f.length-1;0<=w;w--){var P=f[w],F=P.instance,J=P.currentTarget;if(P=P.listener,F!==T&&E.isPropagationStopped())break t;T=P,E.currentTarget=J;try{T(E)}catch(ct){fp(ct)}E.currentTarget=null,T=F}else for(w=0;w<f.length;w++){if(P=f[w],F=P.instance,J=P.currentTarget,P=P.listener,F!==T&&E.isPropagationStopped())break t;T=P,E.currentTarget=J;try{T(E)}catch(ct){fp(ct)}E.currentTarget=null,T=F}}}}function be(a,o){var u=o[Ih];u===void 0&&(u=o[Ih]=new Set);var f=a+"__bubble";u.has(f)||(iE(o,a,2,!1),u.add(f))}function nE(a,o,u){var f=0;o&&(f|=4),iE(u,a,f,o)}var Bp="_reactListening"+Math.random().toString(36).slice(2);function Fp(a){if(!a[Bp]){a[Bp]=!0,wh.forEach(function(u){u!=="selectionchange"&&(eE.has(u)||nE(u,!1,a),nE(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Bp]||(o[Bp]=!0,nE("selectionchange",!1,o))}}function iE(a,o,u,f){switch(lv(o)){case 2:var E=$C;break;case 8:E=tA;break;default:E=Zp}u=E.bind(null,o,u,a),E=void 0,!T_||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(E=!0),f?E!==void 0?a.addEventListener(o,u,{capture:!0,passive:E}):a.addEventListener(o,u,!0):E!==void 0?a.addEventListener(o,u,{passive:E}):a.addEventListener(o,u,!1)}function jp(a,o,u,f,E){var T=f;if((o&1)===0&&(o&2)===0&&f!==null)t:for(;;){if(f===null)return;var w=f.tag;if(w===3||w===4){var P=f.stateNode.containerInfo;if(P===E)break;if(w===4)for(w=f.return;w!==null;){var F=w.tag;if((F===3||F===4)&&w.stateNode.containerInfo===E)return;w=w.return}for(;P!==null;){if(w=ll(P),w===null)return;if(F=w.tag,F===5||F===6||F===26||F===27){f=T=w;continue t}P=P.parentNode}}f=f.return}aS(function(){var J=T,ct=g_(u),mt=[];t:{var tt=NS.get(a);if(tt!==void 0){var et=ma,ce=a;switch(a){case"keypress":if(xh(u)===0)break t;case"keydown":case"keyup":et=Xy;break;case"focusin":ce="focus",et=Bh;break;case"focusout":ce="blur",et=Bh;break;case"beforeblur":case"afterblur":et=Bh;break;case"click":if(u.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":et=lS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":et=Hy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":et=Qy;break;case IS:case OS:case Hh:et=C_;break;case wS:et=uS;break;case"scroll":case"scrollend":et=cS;break;case"wheel":et=fe;break;case"copy":case"cut":case"paste":et=A_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":et=dS;break;case"toggle":case"beforetoggle":et=tC}var Zt=(o&4)!==0,mn=!Zt&&(a==="scroll"||a==="scrollend"),q=Zt?tt!==null?tt+"Capture":null:tt;Zt=[];for(var W=J,Q;W!==null;){var pt=W;if(Q=pt.stateNode,pt=pt.tag,pt!==5&&pt!==26&&pt!==27||Q===null||q===null||(pt=_l(W,q),pt!=null&&Zt.push(Zl(W,pt,Q))),mn)break;W=W.return}0<Zt.length&&(tt=new et(tt,ce,null,u,ct),mt.push({event:tt,listeners:Zt}))}}if((o&7)===0){t:{if(tt=a==="mouseover"||a==="pointerover",et=a==="mouseout"||a==="pointerout",tt&&u!==E_&&(ce=u.relatedTarget||u.fromElement)&&(ll(ce)||ce[ys]))break t;if((et||tt)&&(tt=ct.window===ct?ct:(tt=ct.ownerDocument)?tt.defaultView||tt.parentWindow:window,et?(ce=u.relatedTarget||u.toElement,et=J,ce=ce?ll(ce):null,ce!==null&&(mn=jt(ce),Zt=ce.tag,ce!==mn||Zt!==5&&Zt!==27&&Zt!==6)&&(ce=null)):(et=null,ce=J),et!==ce)){if(Zt=lS,pt="onMouseLeave",q="onMouseEnter",W="mouse",(a==="pointerout"||a==="pointerover")&&(Zt=dS,pt="onPointerLeave",q="onPointerEnter",W="pointer"),mn=et==null?tt:Pd(et),Q=ce==null?tt:Pd(ce),tt=new Zt(pt,W+"leave",et,u,ct),tt.target=mn,tt.relatedTarget=Q,pt=null,ll(ct)===J&&(Zt=new Zt(q,W+"enter",ce,u,ct),Zt.target=Q,Zt.relatedTarget=mn,pt=Zt),mn=pt,et&&ce)e:{for(Zt=et,q=ce,W=0,Q=Zt;Q;Q=$l(Q))W++;for(Q=0,pt=q;pt;pt=$l(pt))Q++;for(;0<W-Q;)Zt=$l(Zt),W--;for(;0<Q-W;)q=$l(q),Q--;for(;W--;){if(Zt===q||q!==null&&Zt===q.alternate)break e;Zt=$l(Zt),q=$l(q)}Zt=null}else Zt=null;et!==null&&rE(mt,tt,et,Zt,!1),ce!==null&&mn!==null&&rE(mt,mn,ce,Zt,!0)}}t:{if(tt=J?Pd(J):window,et=tt.nodeName&&tt.nodeName.toLowerCase(),et==="select"||et==="input"&&tt.type==="file")var Mt=gS;else if(mS(tt))if(Nr)Mt=L_;else{Mt=oC;var De=sC}else et=tt.nodeName,!et||et.toLowerCase()!=="input"||tt.type!=="checkbox"&&tt.type!=="radio"?J&&kd(J.elementType)&&(Mt=gS):Mt=vS;if(Mt&&(Mt=Mt(a,J))){ES(mt,Mt,u,ct);break t}De&&De(a,tt,J),a==="focusout"&&J&&tt.type==="number"&&J.memoizedProps.value!=null&&m_(tt,"number",tt.value)}switch(De=J?Pd(J):window,a){case"focusin":(mS(De)||De.contentEditable==="true")&&(_i=De,k_=J,Bd=null);break;case"focusout":Bd=k_=_i=null;break;case"mousedown":M_=!0;break;case"contextmenu":case"mouseup":case"dragend":M_=!1,AS(mt,u,ct);break;case"selectionchange":if(lC)break;case"keydown":case"keyup":AS(mt,u,ct)}var Wt;if(O_)t:{switch(a){case"compositionstart":var ie="onCompositionStart";break t;case"compositionend":ie="onCompositionEnd";break t;case"compositionupdate":ie="onCompositionUpdate";break t}ie=void 0}else oc?fS(a,u)&&(ie="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(ie="onCompositionStart");ie&&(hS&&u.locale!=="ko"&&(oc||ie!=="onCompositionStart"?ie==="onCompositionEnd"&&oc&&(Wt=sS()):(zr=ct,v_="value"in zr?zr.value:zr.textContent,oc=!0)),De=Ou(J,ie),0<De.length&&(ie=new Fh(ie,a,null,u,ct),mt.push({event:ie,listeners:De}),Wt?ie.data=Wt:(Wt=_S(u),Wt!==null&&(ie.data=Wt)))),(Wt=nC?iC(a,u):oo(a,u))&&(ie=Ou(J,"onBeforeInput"),0<ie.length&&(De=new Fh("onBeforeInput","beforeinput",null,u,ct),mt.push({event:De,listeners:ie}),De.data=Wt)),Qm(mt,a,J,u,ct)}Vp(mt,o)})}function Zl(a,o,u){return{instance:a,listener:o,currentTarget:u}}function Ou(a,o){for(var u=o+"Capture",f=[];a!==null;){var E=a,T=E.stateNode;if(E=E.tag,E!==5&&E!==26&&E!==27||T===null||(E=_l(a,u),E!=null&&f.unshift(Zl(a,E,T)),E=_l(a,o),E!=null&&f.push(Zl(a,E,T))),a.tag===3)return f;a=a.return}return[]}function $l(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function rE(a,o,u,f,E){for(var T=o._reactName,w=[];u!==null&&u!==f;){var P=u,F=P.alternate,J=P.stateNode;if(P=P.tag,F!==null&&F===f)break;P!==5&&P!==26&&P!==27||J===null||(F=J,E?(J=_l(u,T),J!=null&&w.unshift(Zl(u,J,F))):E||(J=_l(u,T),J!=null&&w.push(Zl(u,J,F)))),u=u.return}w.length!==0&&a.push({event:o,listeners:w})}var PC=/\r\n?/g,td=/\u0000|\uFFFD/g;function Uc(a){return(typeof a=="string"?a:""+a).replace(PC,`
`).replace(td,"")}function Gp(a,o){return o=Uc(o),Uc(a)===o}function wu(){}function ln(a,o,u,f,E,T){switch(u){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||so(a,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&so(a,""+f);break;case"className":Nh(a,"class",f);break;case"tabIndex":Nh(a,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Nh(a,u,f);break;case"style":nS(a,f,T);break;case"data":if(o!=="object"){Nh(a,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=Mh(""+f),a.setAttribute(u,f);break;case"action":case"formAction":if(typeof f=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(u==="formAction"?(o!=="input"&&ln(a,o,"name",E.name,E,null),ln(a,o,"formEncType",E.formEncType,E,null),ln(a,o,"formMethod",E.formMethod,E,null),ln(a,o,"formTarget",E.formTarget,E,null)):(ln(a,o,"encType",E.encType,E,null),ln(a,o,"method",E.method,E,null),ln(a,o,"target",E.target,E,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){a.removeAttribute(u);break}f=Mh(""+f),a.setAttribute(u,f);break;case"onClick":f!=null&&(a.onclick=wu);break;case"onScroll":f!=null&&be("scroll",a);break;case"onScrollEnd":f!=null&&be("scrollend",a);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(nt(61));if(u=f.__html,u!=null){if(E.children!=null)throw Error(nt(60));a.innerHTML=u}}break;case"multiple":a.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":a.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){a.removeAttribute("xlink:href");break}u=Mh(""+f),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""+f):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":f===!0?a.setAttribute(u,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?a.setAttribute(u,f):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?a.setAttribute(u,f):a.removeAttribute(u);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?a.removeAttribute(u):a.setAttribute(u,f);break;case"popover":be("beforetoggle",a),be("toggle",a),Vn(a,"popover",f);break;case"xlinkActuate":Cs(a,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Cs(a,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Cs(a,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Cs(a,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Cs(a,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Cs(a,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Vn(a,"is",f);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=jy.get(u)||u,Vn(a,u,f))}}function aE(a,o,u,f,E,T){switch(u){case"style":nS(a,f,T);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(nt(61));if(u=f.__html,u!=null){if(E.children!=null)throw Error(nt(60));a.innerHTML=u}}break;case"children":typeof f=="string"?so(a,f):(typeof f=="number"||typeof f=="bigint")&&so(a,""+f);break;case"onScroll":f!=null&&be("scroll",a);break;case"onScrollEnd":f!=null&&be("scrollend",a);break;case"onClick":f!=null&&(a.onclick=wu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!u_.hasOwnProperty(u))t:{if(u[0]==="o"&&u[1]==="n"&&(E=u.endsWith("Capture"),o=u.slice(2,E?u.length-7:void 0),T=a[pr]||null,T=T!=null?T[u]:null,typeof T=="function"&&a.removeEventListener(o,T,E),typeof f=="function")){typeof T!="function"&&T!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,f,E);break t}u in a?a[u]=f:f===!0?a.setAttribute(u,""):Vn(a,u,f)}}}function wi(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":be("error",a),be("load",a);var f=!1,E=!1,T;for(T in u)if(u.hasOwnProperty(T)){var w=u[T];if(w!=null)switch(T){case"src":f=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(nt(137,o));default:ln(a,o,T,w,u,null)}}E&&ln(a,o,"srcSet",u.srcSet,u,null),f&&ln(a,o,"src",u.src,u,null);return;case"input":be("invalid",a);var P=T=w=E=null,F=null,J=null;for(f in u)if(u.hasOwnProperty(f)){var ct=u[f];if(ct!=null)switch(f){case"name":E=ct;break;case"type":w=ct;break;case"checked":F=ct;break;case"defaultChecked":J=ct;break;case"value":T=ct;break;case"defaultValue":P=ct;break;case"children":case"dangerouslySetInnerHTML":if(ct!=null)throw Error(nt(137,o));break;default:ln(a,o,f,ct,u,null)}}Zg(a,T,P,F,J,w,E,!1),Lh(a);return;case"select":be("invalid",a),f=w=T=null;for(E in u)if(u.hasOwnProperty(E)&&(P=u[E],P!=null))switch(E){case"value":T=P;break;case"defaultValue":w=P;break;case"multiple":f=P;default:ln(a,o,E,P,u,null)}o=T,u=w,a.multiple=!!f,o!=null?hl(a,!!f,o,!1):u!=null&&hl(a,!!f,u,!0);return;case"textarea":be("invalid",a),T=E=f=null;for(w in u)if(u.hasOwnProperty(w)&&(P=u[w],P!=null))switch(w){case"value":f=P;break;case"defaultValue":E=P;break;case"children":T=P;break;case"dangerouslySetInnerHTML":if(P!=null)throw Error(nt(91));break;default:ln(a,o,w,P,u,null)}tS(a,f,E,T),Lh(a);return;case"option":for(F in u)if(u.hasOwnProperty(F)&&(f=u[F],f!=null))switch(F){case"selected":a.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:ln(a,o,F,f,u,null)}return;case"dialog":be("beforetoggle",a),be("toggle",a),be("cancel",a),be("close",a);break;case"iframe":case"object":be("load",a);break;case"video":case"audio":for(f=0;f<Ql.length;f++)be(Ql[f],a);break;case"image":be("error",a),be("load",a);break;case"details":be("toggle",a);break;case"embed":case"source":case"link":be("error",a),be("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(J in u)if(u.hasOwnProperty(J)&&(f=u[J],f!=null))switch(J){case"children":case"dangerouslySetInnerHTML":throw Error(nt(137,o));default:ln(a,o,J,f,u,null)}return;default:if(kd(o)){for(ct in u)u.hasOwnProperty(ct)&&(f=u[ct],f!==void 0&&aE(a,o,ct,f,u,void 0));return}}for(P in u)u.hasOwnProperty(P)&&(f=u[P],f!=null&&ln(a,o,P,f,u,null))}function kC(a,o,u,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,T=null,w=null,P=null,F=null,J=null,ct=null;for(et in u){var mt=u[et];if(u.hasOwnProperty(et)&&mt!=null)switch(et){case"checked":break;case"value":break;case"defaultValue":F=mt;default:f.hasOwnProperty(et)||ln(a,o,et,null,f,mt)}}for(var tt in f){var et=f[tt];if(mt=u[tt],f.hasOwnProperty(tt)&&(et!=null||mt!=null))switch(tt){case"type":T=et;break;case"name":E=et;break;case"checked":J=et;break;case"defaultChecked":ct=et;break;case"value":w=et;break;case"defaultValue":P=et;break;case"children":case"dangerouslySetInnerHTML":if(et!=null)throw Error(nt(137,o));break;default:et!==mt&&ln(a,o,tt,et,f,mt)}}__(a,w,P,F,J,ct,T,E);return;case"select":et=w=P=tt=null;for(T in u)if(F=u[T],u.hasOwnProperty(T)&&F!=null)switch(T){case"value":break;case"multiple":et=F;default:f.hasOwnProperty(T)||ln(a,o,T,null,f,F)}for(E in f)if(T=f[E],F=u[E],f.hasOwnProperty(E)&&(T!=null||F!=null))switch(E){case"value":tt=T;break;case"defaultValue":P=T;break;case"multiple":w=T;default:T!==F&&ln(a,o,E,T,f,F)}o=P,u=w,f=et,tt!=null?hl(a,!!u,tt,!1):!!f!=!!u&&(o!=null?hl(a,!!u,o,!0):hl(a,!!u,u?[]:"",!1));return;case"textarea":et=tt=null;for(P in u)if(E=u[P],u.hasOwnProperty(P)&&E!=null&&!f.hasOwnProperty(P))switch(P){case"value":break;case"children":break;default:ln(a,o,P,null,f,E)}for(w in f)if(E=f[w],T=u[w],f.hasOwnProperty(w)&&(E!=null||T!=null))switch(w){case"value":tt=E;break;case"defaultValue":et=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(nt(91));break;default:E!==T&&ln(a,o,w,E,f,T)}$g(a,tt,et);return;case"option":for(var ce in u)if(tt=u[ce],u.hasOwnProperty(ce)&&tt!=null&&!f.hasOwnProperty(ce))switch(ce){case"selected":a.selected=!1;break;default:ln(a,o,ce,null,f,tt)}for(F in f)if(tt=f[F],et=u[F],f.hasOwnProperty(F)&&tt!==et&&(tt!=null||et!=null))switch(F){case"selected":a.selected=tt&&typeof tt!="function"&&typeof tt!="symbol";break;default:ln(a,o,F,tt,f,et)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Zt in u)tt=u[Zt],u.hasOwnProperty(Zt)&&tt!=null&&!f.hasOwnProperty(Zt)&&ln(a,o,Zt,null,f,tt);for(J in f)if(tt=f[J],et=u[J],f.hasOwnProperty(J)&&tt!==et&&(tt!=null||et!=null))switch(J){case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(nt(137,o));break;default:ln(a,o,J,tt,f,et)}return;default:if(kd(o)){for(var mn in u)tt=u[mn],u.hasOwnProperty(mn)&&tt!==void 0&&!f.hasOwnProperty(mn)&&aE(a,o,mn,void 0,f,tt);for(ct in f)tt=f[ct],et=u[ct],!f.hasOwnProperty(ct)||tt===et||tt===void 0&&et===void 0||aE(a,o,ct,tt,f,et);return}}for(var q in u)tt=u[q],u.hasOwnProperty(q)&&tt!=null&&!f.hasOwnProperty(q)&&ln(a,o,q,null,f,tt);for(mt in f)tt=f[mt],et=u[mt],!f.hasOwnProperty(mt)||tt===et||tt==null&&et==null||ln(a,o,mt,tt,f,et)}var sE=null,ed=null;function Hp(a){return a.nodeType===9?a:a.ownerDocument}function WT(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function KT(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function oE(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var cE=null;function MC(){var a=window.event;return a&&a.type==="popstate"?a===cE?!1:(cE=a,!0):(cE=null,!1)}var zT=typeof setTimeout=="function"?setTimeout:void 0,UC=typeof clearTimeout=="function"?clearTimeout:void 0,YT=typeof Promise=="function"?Promise:void 0,xC=typeof queueMicrotask=="function"?queueMicrotask:typeof YT<"u"?function(a){return YT.resolve(null).then(a).catch(VC)}:zT;function VC(a){setTimeout(function(){throw a})}function Do(a){return a==="head"}function qT(a,o){var u=o,f=0,E=0;do{var T=u.nextSibling;if(a.removeChild(u),T&&T.nodeType===8)if(u=T.data,u==="/$"){if(0<f&&8>f){u=f;var w=a.ownerDocument;if(u&1&&Nu(w.documentElement),u&2&&Nu(w.body),u&4)for(u=w.head,Nu(u),w=u.firstChild;w;){var P=w.nextSibling,F=w.nodeName;w[cl]||F==="SCRIPT"||F==="STYLE"||F==="LINK"&&w.rel.toLowerCase()==="stylesheet"||u.removeChild(w),w=P}}if(E===0){a.removeChild(T),Fu(o);return}E--}else u==="$"||u==="$?"||u==="$!"?E++:f=u.charCodeAt(0)-48;else f=0;u=T}while(u);Fu(o)}function lE(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":lE(u),Oh(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function BC(a,o,u,f){for(;a.nodeType===1;){var E=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(f){if(!a[cl])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(T=a.getAttribute("rel"),T==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(T!==E.rel||a.getAttribute("href")!==(E.href==null||E.href===""?null:E.href)||a.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||a.getAttribute("title")!==(E.title==null?null:E.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(T=a.getAttribute("src"),(T!==(E.src==null?null:E.src)||a.getAttribute("type")!==(E.type==null?null:E.type)||a.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&T&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var T=E.name==null?null:""+E.name;if(E.type==="hidden"&&a.getAttribute("name")===T)return a}else return a;if(a=Ia(a.nextSibling),a===null)break}return null}function FC(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=Ia(a.nextSibling),a===null))return null;return a}function Wp(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function jC(a,o){var u=a.ownerDocument;if(a.data!=="$?"||u.readyState==="complete")o();else{var f=function(){o(),u.removeEventListener("DOMContentLoaded",f)};u.addEventListener("DOMContentLoaded",f),a._reactRetry=f}}function Ia(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return a}var dE=null;function XT(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return a;o--}else u==="/$"&&o++}a=a.previousSibling}return null}function JT(a,o,u){switch(o=Hp(u),a){case"html":if(a=o.documentElement,!a)throw Error(nt(452));return a;case"head":if(a=o.head,!a)throw Error(nt(453));return a;case"body":if(a=o.body,!a)throw Error(nt(454));return a;default:throw Error(nt(451))}}function Nu(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);Oh(a)}var Zr=new Map,QT=new Set;function Kp(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Us=Rt.d;Rt.d={f:GC,r:HC,D:WC,C:KC,L:zC,m:$T,X:qC,S:YC,M:XC};function GC(){var a=Us.f(),o=Dc();return a||o}function HC(a){var o=dl(a);o!==null&&o.tag===5&&o.type==="form"?mm(o):Us.r(a)}var nd=typeof document>"u"?null:document;function ZT(a,o,u){var f=nd;if(f&&typeof o=="string"&&o){var E=wr(o);E='link[rel="'+a+'"][href="'+E+'"]',typeof u=="string"&&(E+='[crossorigin="'+u+'"]'),QT.has(E)||(QT.add(E),a={rel:a,crossOrigin:u,href:o},f.querySelector(E)===null&&(o=f.createElement("link"),wi(o,"link",a),fi(o),f.head.appendChild(o)))}}function WC(a){Us.D(a),ZT("dns-prefetch",a,null)}function KC(a,o){Us.C(a,o),ZT("preconnect",a,o)}function zC(a,o,u){Us.L(a,o,u);var f=nd;if(f&&a&&o){var E='link[rel="preload"][as="'+wr(o)+'"]';o==="image"&&u&&u.imageSrcSet?(E+='[imagesrcset="'+wr(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(E+='[imagesizes="'+wr(u.imageSizes)+'"]')):E+='[href="'+wr(a)+'"]';var T=E;switch(o){case"style":T=id(a);break;case"script":T=ad(a)}Zr.has(T)||(a=zt({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),Zr.set(T,a),f.querySelector(E)!==null||o==="style"&&f.querySelector(rd(T))||o==="script"&&f.querySelector(Du(T))||(o=f.createElement("link"),wi(o,"link",a),fi(o),f.head.appendChild(o)))}}function $T(a,o){Us.m(a,o);var u=nd;if(u&&a){var f=o&&typeof o.as=="string"?o.as:"script",E='link[rel="modulepreload"][as="'+wr(f)+'"][href="'+wr(a)+'"]',T=E;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=ad(a)}if(!Zr.has(T)&&(a=zt({rel:"modulepreload",href:a},o),Zr.set(T,a),u.querySelector(E)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Du(T)))return}f=u.createElement("link"),wi(f,"link",a),fi(f),u.head.appendChild(f)}}}function YC(a,o,u){Us.S(a,o,u);var f=nd;if(f&&a){var E=nc(f).hoistableStyles,T=id(a);o=o||"default";var w=E.get(T);if(!w){var P={loading:0,preload:null};if(w=f.querySelector(rd(T)))P.loading=5;else{a=zt({rel:"stylesheet",href:a,"data-precedence":o},u),(u=Zr.get(T))&&uE(a,u);var F=w=f.createElement("link");fi(F),wi(F,"link",a),F._p=new Promise(function(J,ct){F.onload=J,F.onerror=ct}),F.addEventListener("load",function(){P.loading|=1}),F.addEventListener("error",function(){P.loading|=2}),P.loading|=4,qp(w,o,f)}w={type:"stylesheet",instance:w,count:1,state:P},E.set(T,w)}}}function qC(a,o){Us.X(a,o);var u=nd;if(u&&a){var f=nc(u).hoistableScripts,E=ad(a),T=f.get(E);T||(T=u.querySelector(Du(E)),T||(a=zt({src:a,async:!0},o),(o=Zr.get(E))&&hE(a,o),T=u.createElement("script"),fi(T),wi(T,"link",a),u.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},f.set(E,T))}}function XC(a,o){Us.M(a,o);var u=nd;if(u&&a){var f=nc(u).hoistableScripts,E=ad(a),T=f.get(E);T||(T=u.querySelector(Du(E)),T||(a=zt({src:a,async:!0,type:"module"},o),(o=Zr.get(E))&&hE(a,o),T=u.createElement("script"),fi(T),wi(T,"link",a),u.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},f.set(E,T))}}function tv(a,o,u,f){var E=(E=pe.current)?Kp(E):null;if(!E)throw Error(nt(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=id(u.href),u=nc(E).hoistableStyles,f=u.get(o),f||(f={type:"style",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=id(u.href);var T=nc(E).hoistableStyles,w=T.get(a);if(w||(E=E.ownerDocument||E,w={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(a,w),(T=E.querySelector(rd(a)))&&!T._p&&(w.instance=T,w.state.loading=5),Zr.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},Zr.set(a,u),T||ev(E,a,u,w.state))),o&&f===null)throw Error(nt(528,""));return w}if(o&&f!==null)throw Error(nt(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=ad(u),u=nc(E).hoistableScripts,f=u.get(o),f||(f={type:"script",instance:null,count:0,state:null},u.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(nt(444,a))}}function id(a){return'href="'+wr(a)+'"'}function rd(a){return'link[rel="stylesheet"]['+a+"]"}function zp(a){return zt({},a,{"data-precedence":a.precedence,precedence:null})}function ev(a,o,u,f){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=a.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),wi(o,"link",u),fi(o),a.head.appendChild(o))}function ad(a){return'[src="'+wr(a)+'"]'}function Du(a){return"script[async]"+a}function Yp(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var f=a.querySelector('style[data-href~="'+wr(u.href)+'"]');if(f)return o.instance=f,fi(f),f;var E=zt({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return f=(a.ownerDocument||a).createElement("style"),fi(f),wi(f,"style",E),qp(f,u.precedence,a),o.instance=f;case"stylesheet":E=id(u.href);var T=a.querySelector(rd(E));if(T)return o.state.loading|=4,o.instance=T,fi(T),T;f=zp(u),(E=Zr.get(E))&&uE(f,E),T=(a.ownerDocument||a).createElement("link"),fi(T);var w=T;return w._p=new Promise(function(P,F){w.onload=P,w.onerror=F}),wi(T,"link",f),o.state.loading|=4,qp(T,u.precedence,a),o.instance=T;case"script":return T=ad(u.src),(E=a.querySelector(Du(T)))?(o.instance=E,fi(E),E):(f=u,(E=Zr.get(T))&&(f=zt({},u),hE(f,E)),a=a.ownerDocument||a,E=a.createElement("script"),fi(E),wi(E,"link",f),a.head.appendChild(E),o.instance=E);case"void":return null;default:throw Error(nt(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,qp(f,u.precedence,a));return o.instance}function qp(a,o,u){for(var f=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=f.length?f[f.length-1]:null,T=E,w=0;w<f.length;w++){var P=f[w];if(P.dataset.precedence===o)T=P;else if(T!==E)break}T?T.parentNode.insertBefore(a,T.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function uE(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function hE(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var Xp=null;function pE(a,o,u){if(Xp===null){var f=new Map,E=Xp=new Map;E.set(u,f)}else E=Xp,f=E.get(u),f||(f=new Map,E.set(u,f));if(f.has(a))return f;for(f.set(a,null),u=u.getElementsByTagName(a),E=0;E<u.length;E++){var T=u[E];if(!(T[cl]||T[Wi]||a==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var w=T.getAttribute(o)||"";w=a+w;var P=f.get(w);P?P.push(T):f.set(w,[T])}}return f}function nv(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function fE(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return a=o.disabled,typeof o.precedence=="string"&&a==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function iv(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var Lu=null;function JC(){}function QC(a,o,u){if(Lu===null)throw Error(nt(475));var f=Lu;if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var E=id(u.href),T=a.querySelector(rd(E));if(T){a=T._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(f.count++,f=Jp.bind(f),a.then(f,f)),o.state.loading|=4,o.instance=T,fi(T);return}T=a.ownerDocument||a,u=zp(u),(E=Zr.get(E))&&uE(u,E),T=T.createElement("link"),fi(T);var w=T;w._p=new Promise(function(P,F){w.onload=P,w.onerror=F}),wi(T,"link",u),o.instance=T}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,a),(a=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=Jp.bind(f),a.addEventListener("load",o),a.addEventListener("error",o))}}function rv(){if(Lu===null)throw Error(nt(475));var a=Lu;return a.stylesheets&&a.count===0&&ku(a,a.stylesheets),0<a.count?function(o){var u=setTimeout(function(){if(a.stylesheets&&ku(a,a.stylesheets),a.unsuspend){var f=a.unsuspend;a.unsuspend=null,f()}},6e4);return a.unsuspend=o,function(){a.unsuspend=null,clearTimeout(u)}}:null}function Jp(){if(this.count--,this.count===0){if(this.stylesheets)ku(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Pu=null;function ku(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Pu=new Map,o.forEach(ZC,a),Pu=null,Jp.call(a))}function ZC(a,o){if(!(o.state.loading&4)){var u=Pu.get(a);if(u)var f=u.get(null);else{u=new Map,Pu.set(a,u);for(var E=a.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<E.length;T++){var w=E[T];(w.nodeName==="LINK"||w.getAttribute("media")!=="not all")&&(u.set(w.dataset.precedence,w),f=w)}f&&u.set(null,f)}E=o.instance,w=E.getAttribute("data-precedence"),T=u.get(w)||f,T===f&&u.set(null,E),u.set(w,E),this.count++,f=Jp.bind(this),E.addEventListener("load",f),E.addEventListener("error",f),T?T.parentNode.insertBefore(E,T.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(E,a.firstChild)),o.state.loading|=4}}var Mu={$$typeof:Hn,Provider:null,Consumer:null,_currentValue:Qt,_currentValue2:Qt,_threadCount:0};function av(a,o,u,f,E,T,w,P){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=l_(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=l_(0),this.hiddenUpdates=l_(null),this.identifierPrefix=f,this.onUncaughtError=E,this.onCaughtError=T,this.onRecoverableError=w,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=P,this.incompleteTransitions=new Map}function sv(a,o,u,f,E,T,w,P,F,J,ct,mt){return a=new av(a,o,u,w,P,F,J,mt),o=1,T===!0&&(o|=24),T=Pr(3,null,null,o),a.current=T,T.stateNode=a,o=Wd(),o.refCount++,a.pooledCache=o,o.refCount++,T.memoizedState={element:f,isDehydrated:u,cache:o},tp(T),a}function _E(a){return a?(a=Is,a):Is}function mE(a,o,u,f,E,T){E=_E(E),f.context===null?f.context=E:f.pendingContext=E,f=mo(o),f.payload={element:u},T=T===void 0?null:T,T!==null&&(f.callback=T),u=Ls(a,f,o),u!==null&&(Sr(u,a,o),qd(u,a,o))}function ov(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function EE(a,o){ov(a,o),(a=a.alternate)&&ov(a,o)}function cv(a){if(a.tag===13){var o=vl(a,67108864);o!==null&&Sr(o,a,67108864),EE(a,67108864)}}var Qp=!0;function $C(a,o,u,f){var E=ot.T;ot.T=null;var T=Rt.p;try{Rt.p=2,Zp(a,o,u,f)}finally{Rt.p=T,ot.T=E}}function tA(a,o,u,f){var E=ot.T;ot.T=null;var T=Rt.p;try{Rt.p=8,Zp(a,o,u,f)}finally{Rt.p=T,ot.T=E}}function Zp(a,o,u,f){if(Qp){var E=Uu(f);if(E===null)jp(a,o,f,xu,u),SE(a,f);else if(dv(E,a,o,u,f))f.stopPropagation();else if(SE(a,f),o&4&&-1<ar.indexOf(a)){for(;E!==null;){var T=dl(E);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var w=io(T.pendingLanes);if(w!==0){var P=T;for(P.pendingLanes|=2,P.entangledLanes|=2;w;){var F=1<<31-er(w);P.entanglements[1]|=F,w&=~F}Qr(T),($e&6)===0&&(Wl=ja()+500,bu(0))}}break;case 13:P=vl(T,2),P!==null&&Sr(P,T,2),Dc(),EE(T,2)}if(T=Uu(f),T===null&&jp(a,o,f,xu,u),T===E)break;E=T}E!==null&&f.stopPropagation()}else jp(a,o,f,null,u)}}function Uu(a){return a=g_(a),st(a)}var xu=null;function st(a){if(xu=null,a=ll(a),a!==null){var o=jt(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=hn(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return xu=a,null}function lv(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ki()){case hr:return 2;case Ah:return 8;case rl:case My:return 32;case o_:return 268435456;default:return 32}default:return 32}}var gE=!1,Lo=null,Po=null,ko=null,xc=new Map,Vu=new Map,Mo=[],ar="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function SE(a,o){switch(a){case"focusin":case"focusout":Lo=null;break;case"dragenter":case"dragleave":Po=null;break;case"mouseover":case"mouseout":ko=null;break;case"pointerover":case"pointerout":xc.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vu.delete(o.pointerId)}}function Bu(a,o,u,f,E,T){return a===null||a.nativeEvent!==T?(a={blockedOn:o,domEventName:u,eventSystemFlags:f,nativeEvent:T,targetContainers:[E]},o!==null&&(o=dl(o),o!==null&&cv(o)),a):(a.eventSystemFlags|=f,o=a.targetContainers,E!==null&&o.indexOf(E)===-1&&o.push(E),a)}function dv(a,o,u,f,E){switch(o){case"focusin":return Lo=Bu(Lo,a,o,u,f,E),!0;case"dragenter":return Po=Bu(Po,a,o,u,f,E),!0;case"mouseover":return ko=Bu(ko,a,o,u,f,E),!0;case"pointerover":var T=E.pointerId;return xc.set(T,Bu(xc.get(T)||null,a,o,u,f,E)),!0;case"gotpointercapture":return T=E.pointerId,Vu.set(T,Bu(Vu.get(T)||null,a,o,u,f,E)),!0}return!1}function uv(a){var o=ll(a.target);if(o!==null){var u=jt(o);if(u!==null){if(o=u.tag,o===13){if(o=hn(u),o!==null){a.blockedOn=o,xy(a.priority,function(){if(u.tag===13){var f=xr();f=ro(f);var E=vl(u,f);E!==null&&Sr(E,u,f),EE(u,f)}});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function sd(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=Uu(a.nativeEvent);if(u===null){u=a.nativeEvent;var f=new u.constructor(u.type,u);E_=f,u.target.dispatchEvent(f),E_=null}else return o=dl(u),o!==null&&cv(o),a.blockedOn=u,!1;o.shift()}return!0}function TE(a,o,u){sd(a)&&u.delete(o)}function hv(){gE=!1,Lo!==null&&sd(Lo)&&(Lo=null),Po!==null&&sd(Po)&&(Po=null),ko!==null&&sd(ko)&&(ko=null),xc.forEach(TE),Vu.forEach(TE)}function $p(a,o){a.blockedOn===o&&(a.blockedOn=null,gE||(gE=!0,wt.unstable_scheduleCallback(wt.unstable_NormalPriority,hv)))}var tf=null;function vE(a){tf!==a&&(tf=a,wt.unstable_scheduleCallback(wt.unstable_NormalPriority,function(){tf===a&&(tf=null);for(var o=0;o<a.length;o+=3){var u=a[o],f=a[o+1],E=a[o+2];if(typeof f!="function"){if(st(f||u)===null)continue;break}var T=dl(u);T!==null&&(a.splice(o,3),o-=3,kl(T,{pending:!0,data:E,method:u.method,action:f},f,E))}}))}function Fu(a){function o(F){return $p(F,a)}Lo!==null&&$p(Lo,a),Po!==null&&$p(Po,a),ko!==null&&$p(ko,a),xc.forEach(o),Vu.forEach(o);for(var u=0;u<Mo.length;u++){var f=Mo[u];f.blockedOn===a&&(f.blockedOn=null)}for(;0<Mo.length&&(u=Mo[0],u.blockedOn===null);)uv(u),u.blockedOn===null&&Mo.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(f=0;f<u.length;f+=3){var E=u[f],T=u[f+1],w=E[pr]||null;if(typeof T=="function")w||vE(u);else if(w){var P=null;if(T&&T.hasAttribute("formAction")){if(E=T,w=T[pr]||null)P=w.formAction;else if(st(E)!==null)continue}else P=w.action;typeof P=="function"?u[f+1]=P:(u.splice(f,3),f-=3),vE(u)}}}function RE(a){this._internalRoot=a}ju.prototype.render=RE.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(nt(409));var u=o.current,f=xr();mE(u,f,a,o,null,null)},ju.prototype.unmount=RE.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;mE(a.current,2,null,a,null,null),Dc(),o[ys]=null}};function ju(a){this._internalRoot=a}ju.prototype.unstable_scheduleHydration=function(a){if(a){var o=Wg();a={blockedOn:null,target:a,priority:o};for(var u=0;u<Mo.length&&o!==0&&o<Mo[u].priority;u++);Mo.splice(u,0,a),u===0&&uv(a)}};var pv=on.version;if(pv!=="19.1.0")throw Error(nt(527,pv,"19.1.0"));Rt.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(nt(188)):(a=Object.keys(a).join(","),Error(nt(268,a)));return a=Ht(o),a=a!==null?St(a):null,a=a===null?null:a.stateNode,a};var eA={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:ot,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gu.isDisabled&&Gu.supportsFiber)try{al=Gu.inject(eA),Zn=Gu}catch{}}return Ug.createRoot=function(a,o){if(!kt(a))throw Error(nt(299));var u=!1,f="",E=pT,T=fT,w=_T,P=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(E=o.onUncaughtError),o.onCaughtError!==void 0&&(T=o.onCaughtError),o.onRecoverableError!==void 0&&(w=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(P=o.unstable_transitionCallbacks)),o=sv(a,1,!1,null,null,u,f,E,T,w,P,null),a[ys]=o.current,Fp(a),new RE(o)},Ug.hydrateRoot=function(a,o,u){if(!kt(a))throw Error(nt(299));var f=!1,E="",T=pT,w=fT,P=_T,F=null,J=null;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(E=u.identifierPrefix),u.onUncaughtError!==void 0&&(T=u.onUncaughtError),u.onCaughtError!==void 0&&(w=u.onCaughtError),u.onRecoverableError!==void 0&&(P=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(F=u.unstable_transitionCallbacks),u.formState!==void 0&&(J=u.formState)),o=sv(a,1,!0,o,u??null,f,E,T,w,P,F,J),o.context=_E(null),u=o.current,f=xr(),f=ro(f),E=mo(f),E.callback=null,Ls(u,E,f),u=f,o.current.lanes=u,Ld(o,u),Qr(o),a[ys]=o.current,Fp(a),new ju(o)},Ug.version="19.1.0",Ug}var hx;function pH(){if(hx)return xO.exports;hx=1;function wt(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(wt)}catch(on){console.error(on)}}return wt(),xO.exports=hH(),xO.exports}var fH=pH();const _H=fx(fH);var Py={exports:{}},mH=Py.exports,px;function EH(){return px||(px=1,function(wt,on){(function(Fe,nt){wt.exports=nt()})(mH,function(){function Fe(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var nt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof kO<"u"?kO:typeof self<"u"?self:{};function kt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var jt=function(t){try{return!!t()}catch{return!0}},hn=!jt(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),Ci=hn,Ht=Function.prototype,St=Ht.call,zt=Ci&&Ht.bind.bind(St,St),Yt=Ci?zt:function(t){return function(){return St.apply(t,arguments)}},he=Yt({}.isPrototypeOf),Qn=function(t){return t&&t.Math===Math&&t},le=Qn(typeof globalThis=="object"&&globalThis)||Qn(typeof window=="object"&&window)||Qn(typeof self=="object"&&self)||Qn(typeof nt=="object"&&nt)||Qn(typeof nt=="object"&&nt)||function(){return this}()||Function("return this")(),Mn=hn,Sn=Function.prototype,Ai=Sn.apply,Pi=Sn.call,Hn=typeof Reflect=="object"&&Reflect.apply||(Mn?Pi.bind(Ai):function(){return Pi.apply(Ai,arguments)}),Hr=Yt,Ye=Hr({}.toString),Ir=Hr("".slice),Wn=function(t){return Ir(Ye(t),8,-1)},Or=Wn,Va=Yt,Ba=function(t){if(Or(t)==="Function")return Va(t)},pa=typeof document=="object"&&document.all,ke=pa===void 0&&pa!==void 0?function(t){return typeof t=="function"||t===pa}:function(t){return typeof t=="function"},Fa={},Kn=!jt(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Hi=hn,ot=Function.prototype.call,Rt=Hi?ot.bind(ot):function(){return ot.apply(ot,arguments)},Qt={},pn={}.propertyIsEnumerable,H=Object.getOwnPropertyDescriptor,Tt=H&&!pn.call({1:2},1);Qt.f=Tt?function(t){var e=H(this,t);return!!e&&e.enumerable}:pn;var Nt,Ot,Gt=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},qe=jt,pe=Wn,tr=Object,Un=Yt("".split),fa=qe(function(){return!tr("z").propertyIsEnumerable(0)})?function(t){return pe(t)==="String"?Un(t,""):tr(t)}:tr,il=function(t){return t==null},Ch=il,a_=TypeError,vs=function(t){if(Ch(t))throw new a_("Can't call method on "+t);return t},s_=fa,ky=vs,no=function(t){return s_(ky(t))},ja=ke,ki=function(t){return typeof t=="object"?t!==null:ja(t)},hr={},Ah=hr,rl=le,My=ke,o_=function(t){return My(t)?t:void 0},Mi=function(t,e){return arguments.length<2?o_(Ah[t])||o_(rl[t]):Ah[t]&&Ah[t][e]||rl[t]&&rl[t][e]},Vg=le.navigator,al=Vg&&Vg.userAgent,Zn=al?String(al):"",Rs=le,er=Zn,Bg=Rs.process,Fg=Rs.Deno,jg=Bg&&Bg.versions||Fg&&Fg.version,Nd=jg&&jg.v8;Nd&&(Ot=(Nt=Nd.split("."))[0]>0&&Nt[0]<4?1:+(Nt[0]+Nt[1])),!Ot&&er&&(!(Nt=er.match(/Edge\/(\d+)/))||Nt[1]>=74)&&(Nt=er.match(/Chrome\/(\d+)/))&&(Ot=+Nt[1]);var Ga=Ot,io=Ga,bh=jt,Dd=le.String,sl=!!Object.getOwnPropertySymbols&&!bh(function(){var t=Symbol("symbol detection");return!Dd(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&io&&io<41}),c_=sl&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Gg=Mi,l_=ke,Ld=he,Uy=Object,ol=c_?function(t){return typeof t=="symbol"}:function(t){var e=Gg("Symbol");return l_(e)&&Ld(e.prototype,Uy(t))},Hg=String,ro=function(t){try{return Hg(t)}catch{return"Object"}},d_=ke,Wg=ro,xy=TypeError,$n=function(t){if(d_(t))return t;throw new xy(Wg(t)+" is not a function")},Wi=$n,pr=il,ys=function(t,e){var n=t[e];return pr(n)?void 0:Wi(n)},Ih=Rt,Kg=ke,zg=ki,Yg=TypeError,cl={exports:{}},Oh=le,ll=Object.defineProperty,dl=le,Pd=function(t,e){try{ll(Oh,t,{value:e,configurable:!0,writable:!0})}catch{Oh[t]=e}return e},nc="__core-js_shared__",fi=cl.exports=dl[nc]||Pd(nc,{});(fi.versions||(fi.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var wh=cl.exports,u_=wh,Wr=function(t,e){return u_[t]||(u_[t]=e||{})},ul=vs,Vy=Object,_a=function(t){return Vy(ul(t))},qg=_a,By=Yt({}.hasOwnProperty),Vn=Object.hasOwn||function(t,e){return By(qg(t),e)},Nh=Yt,Cs=0,h_=Math.random(),Xg=Nh(1 .toString),ao=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Xg(++Cs+h_,36)},p_=Wr,Dh=Vn,Fy=ao,Jg=sl,Kr=c_,ic=le.Symbol,f_=p_("wks"),Lh=Kr?ic.for||ic:ic&&ic.withoutSetter||Fy,fn=function(t){return Dh(f_,t)||(f_[t]=Jg&&Dh(ic,t)?ic[t]:Lh("Symbol."+t)),f_[t]},Ph=Rt,Qg=ki,wr=ol,__=ys,Zg=function(t,e){var n,i;if(Kg(n=t.toString)&&!zg(i=Ih(n,t))||Kg(n=t.valueOf)&&!zg(i=Ih(n,t)))return i;throw new Yg("Can't convert object to primitive value")},m_=TypeError,hl=fn("toPrimitive"),$g=function(t,e){if(!Qg(t)||wr(t))return t;var n,i=__(t,hl);if(i){if(n=Ph(i,t,e),!Qg(n)||wr(n))return n;throw new m_("Can't convert object to primitive value")}return Zg(t)},tS=ol,so=function(t){var e=$g(t,"string");return tS(e)?e:e+""},eS=ki,kh=le.document,nS=eS(kh)&&eS(kh.createElement),kd=function(t){return nS?kh.createElement(t):{}},jy=kd,iS=!Kn&&!jt(function(){return Object.defineProperty(jy("div"),"a",{get:function(){return 7}}).a!==7}),Mh=Kn,E_=Rt,g_=Qt,pl=Gt,fl=no,rS=so,S_=Vn,aS=iS,_l=Object.getOwnPropertyDescriptor;Fa.f=Mh?_l:function(t,e){if(t=fl(t),e=rS(e),aS)try{return _l(t,e)}catch{}if(S_(t,e))return pl(!E_(g_.f,t,e),t[e])};var As=jt,T_=ke,Md=/#|\.prototype\./,zr=function(t,e){var n=Uh[v_(t)];return n===xh||n!==sS&&(T_(e)?As(e):!!e)},v_=zr.normalize=function(t){return String(t).replace(Md,".").toLowerCase()},Uh=zr.data={},sS=zr.NATIVE="N",xh=zr.POLYFILL="P",Ud=zr,oS=$n,fr=hn,rc=Ba(Ba.bind),ma=function(t,e){return oS(t),e===void 0?t:fr?rc(t,e):function(){return t.apply(e,arguments)}},Ki={},cS=Kn&&jt(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),R_=ki,y_=String,xd=TypeError,bi=function(t){if(R_(t))return t;throw new xd(y_(t)+" is not an object")},lS=Kn,Gy=iS,Hy=cS,Vh=bi,Bh=so,Wy=TypeError,C_=Object.defineProperty,Ky=Object.getOwnPropertyDescriptor,A_="enumerable",b_="configurable",Fh="writable";Ki.f=lS?Hy?function(t,e,n){if(Vh(t),e=Bh(e),Vh(n),typeof t=="function"&&e==="prototype"&&"value"in n&&Fh in n&&!n[Fh]){var i=Ky(t,e);i&&i[Fh]&&(t[e]=n.value,n={configurable:b_ in n?n[b_]:i[b_],enumerable:A_ in n?n[A_]:i[A_],writable:!1})}return C_(t,e,n)}:C_:function(t,e,n){if(Vh(t),e=Bh(e),Vh(n),Gy)try{return C_(t,e,n)}catch{}if("get"in n||"set"in n)throw new Wy("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var zy=Ki,Yy=Gt,ac=Kn?function(t,e,n){return zy.f(t,e,Yy(1,n))}:function(t,e,n){return t[e]=n,t},Vd=le,I_=Hn,qy=Ba,Xy=ke,Jy=Fa.f,dS=Ud,ml=hr,Qy=ma,El=ac,uS=Vn,Zy=function(t){var e=function(n,i,r){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,r)}return I_(t,this,arguments)};return e.prototype=t.prototype,e},fe=function(t,e){var n,i,r,s,c,l,d,h,p,_=t.target,m=t.global,g=t.stat,C=t.proto,R=m?Vd:g?Vd[_]:Vd[_]&&Vd[_].prototype,y=m?ml:ml[_]||El(ml,_,{})[_],b=y.prototype;for(s in e)i=!(n=dS(m?s:_+(g?".":"#")+s,t.forced))&&R&&uS(R,s),l=y[s],i&&(d=t.dontCallGetSet?(p=Jy(R,s))&&p.value:R[s]),c=i&&d?d:e[s],(n||C||typeof l!=typeof c)&&(h=t.bind&&i?Qy(c,Vd):t.wrap&&i?Zy(c):C&&Xy(c)?qy(c):c,(t.sham||c&&c.sham||l&&l.sham)&&El(h,"sham",!0),El(y,s,h),C&&(uS(ml,r=_+"Prototype")||El(ml,r,{}),El(ml[r],s,c),t.real&&b&&(n||!b[s])&&El(b,s,c)))},$y=Math.ceil,tC=Math.floor,eC=Math.trunc||function(t){var e=+t;return(e>0?tC:$y)(e)},O_=eC,sc=function(t){var e=+t;return e!=e||e===0?0:O_(e)},nC=sc,hS=Math.max,pS=Math.min,jh=function(t,e){var n=nC(t);return n<0?hS(n+e,0):pS(n,e)},fS=sc,_S=Math.min,oc=function(t){var e=fS(t);return e>0?_S(e,9007199254740991):0},iC=oc,oo=function(t){return iC(t.length)},rC=no,mS=jh,ES=oo,gl=function(t){return function(e,n,i){var r=rC(e),s=ES(r);if(s===0)return!t&&-1;var c,l=mS(i,s);if(t&&n!=n){for(;s>l;)if((c=r[l++])!=c)return!0}else for(;s>l;l++)if((t||l in r)&&r[l]===n)return t||l||0;return!t&&-1}},cc={includes:gl(!0),indexOf:gl(!1)},aC=cc.includes;fe({target:"Array",proto:!0,forced:jt(function(){return!Array(1).includes()})},{includes:function(t){return aC(this,t,arguments.length>1?arguments[1]:void 0)}});var Gh=le,gS=hr,Nr=function(t,e){var n=gS[t+"Prototype"],i=n&&n[e];if(i)return i;var r=Gh[t],s=r&&r.prototype;return s&&s[e]},w_=Nr("Array","includes"),N_=ki,SS=Wn,TS=fn("match"),D_=function(t){var e;return N_(t)&&((e=t[TS])!==void 0?!!e:SS(t)==="RegExp")},sC=D_,oC=TypeError,vS={};vS[fn("toStringTag")]="z";var L_=String(vS)==="[object z]",cC=L_,Dr=ke,co=Wn,RS=fn("toStringTag"),yS=Object,CS=co(function(){return arguments}())==="Arguments",bs=cC?co:function(t){var e,n,i;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(r,s){try{return r[s]}catch{}}(e=yS(t),RS))=="string"?n:CS?co(e):(i=co(e))==="Object"&&Dr(e.callee)?"Arguments":i},P_=bs,lC=String,_i=function(t){if(P_(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return lC(t)},k_=fn("match"),Bd=fe,M_=function(t){if(sC(t))throw new oC("The method doesn't accept regular expressions");return t},AS=vs,lo=_i,Sl=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[k_]=!1,"/./"[t](e)}catch{}}return!1},U_=Yt("".indexOf);Bd({target:"String",proto:!0,forced:!Sl("includes")},{includes:function(t){return!!~U_(lo(AS(this)),lo(M_(t)),arguments.length>1?arguments[1]:void 0)}});var bS=Nr("String","includes"),uo=he,IS=w_,OS=bS,Hh=Array.prototype,x_=String.prototype,dC=function(t){var e=t.includes;return t===Hh||uo(Hh,t)&&e===Hh.includes?IS:typeof t=="string"||t===x_||uo(x_,t)&&e===x_.includes?OS:e},rt=kt(dC),wS=$n,NS=_a,V_=fa,Ea=oo,B_=TypeError,Lr="Reduce of empty array with no initial value",Yr=function(t){return function(e,n,i,r){var s=NS(e),c=V_(s),l=Ea(s);if(wS(n),l===0&&i<2)throw new B_(Lr);var d=t?l-1:0,h=t?-1:1;if(i<2)for(;;){if(d in c){r=c[d],d+=h;break}if(d+=h,t?d<0:l<=d)throw new B_(Lr)}for(;t?d>=0:l>d;d+=h)d in c&&(r=n(r,c[d],d,s));return r}},Tl={left:Yr(!1)},F_=jt,lc=function(t,e){var n=[][t];return!!n&&F_(function(){n.call(null,e||function(){return 1},1)})},ho=le,j_=Zn,vl=Wn,Fd=function(t){return j_.slice(0,t.length)===t},Rl=Fd("Bun/")?"BUN":Fd("Cloudflare-Workers")?"CLOUDFLARE":Fd("Deno/")?"DENO":Fd("Node.js/")?"NODE":ho.Bun&&typeof Bun.version=="string"?"BUN":ho.Deno&&typeof Deno.version=="object"?"DENO":vl(ho.process)==="process"?"NODE":ho.window&&ho.document?"BROWSER":"REST",Is=Rl==="NODE",uC=Tl.left;fe({target:"Array",proto:!0,forced:!Is&&Ga>79&&Ga<83||!lc("reduce")},{reduce:function(t){var e=arguments.length;return uC(this,t,e,e>1?arguments[1]:void 0)}});var Pr=Nr("Array","reduce"),G_=he,Os=Pr,Wh=Array.prototype,Kh=function(t){var e=t.reduce;return t===Wh||G_(Wh,t)&&e===Wh.reduce?Os:e},po=Kh,_r=kt(po),H_=Wn,Ha=Array.isArray||function(t){return H_(t)==="Array"},yl=fe,zh=Ha,Yh=Yt([].reverse),kr=[1,2];yl({target:"Array",proto:!0,forced:String(kr)===String(kr.reverse())},{reverse:function(){return zh(this)&&(this.length=this.length),Yh(this)}});var qr=Nr("Array","reverse"),dc=he,ws=qr,ga=Array.prototype,uc=function(t){var e=t.reverse;return t===ga||dc(ga,t)&&e===ga.reverse?ws:e},W_=uc,qh=kt(W_),K_=ao,zi=Wr("keys"),Nn=function(t){return zi[t]||(zi[t]=K_(t))},Ze=!jt(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),hc=Vn,Wa=ke,z_=_a,pc=Ze,Y_=Nn("IE_PROTO"),Xh=Object,jd=Xh.prototype,fc=pc?Xh.getPrototypeOf:function(t){var e=z_(t);if(hc(e,Y_))return e[Y_];var n=e.constructor;return Wa(n)&&e instanceof n?n.prototype:e instanceof Xh?jd:null},DS=Yt,Gd=$n,q_=ki,_c=function(t){return q_(t)||t===null},Ns=String,fo=TypeError,Ds=function(t,e,n){try{return DS(Gd(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},X_=ki,J_=vs,Hd=function(t){if(_c(t))return t;throw new fo("Can't set "+Ns(t)+" as a prototype")},Jh=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Ds(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(i,r){return J_(i),Hd(r),X_(i)&&(e?t(i,r):i.__proto__=r),i}}():void 0),Ka={},mi={},Cl=Vn,LS=no,hC=cc.indexOf,pC=mi,PS=Yt([].push),si=function(t,e){var n,i=LS(t),r=0,s=[];for(n in i)!Cl(pC,n)&&Cl(i,n)&&PS(s,n);for(;e.length>r;)Cl(i,n=e[r++])&&(~hC(s,n)||PS(s,n));return s},Wd=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Kd=si,zd=Wd.concat("length","prototype");Ka.f=Object.getOwnPropertyNames||function(t){return Kd(t,zd)};var mc={};mc.f=Object.getOwnPropertySymbols;var Al=Mi,bl=Ka,fC=mc,kS=bi,_C=Yt([].concat),MS=Al("Reflect","ownKeys")||function(t){var e=bl.f(kS(t)),n=fC.f;return n?_C(e,n(t)):e},_o=Vn,Q_=MS,Qh=Fa,US=Ki,Ec={},xS=si,Zh=Wd,Il=Object.keys||function(t){return xS(t,Zh)},VS=Kn,$h=cS,BS=Ki,Yd=bi,FS=no,jS=Il;Ec.f=VS&&!$h?Object.defineProperties:function(t,e){Yd(t);for(var n,i=FS(e),r=jS(e),s=r.length,c=0;s>c;)BS.f(t,n=r[c++],i[n]);return t};var Sa,tp=Mi("document","documentElement"),Z_=bi,mo=Ec,Ls=Wd,qd=mi,$_=tp,tm=kd,gc="prototype",Sc="script",em=Nn("IE_PROTO"),ep=function(){},Tc=function(t){return"<"+Sc+">"+t+"</"+Sc+">"},Xd=function(t){t.write(Tc("")),t.close();var e=t.parentWindow.Object;return t=null,e},Jd=function(){try{Sa=new ActiveXObject("htmlfile")}catch{}var t,e,n;Jd=typeof document<"u"?document.domain&&Sa?Xd(Sa):(e=tm("iframe"),n="java"+Sc+":",e.style.display="none",$_.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(Tc("document.F=Object")),t.close(),t.F):Xd(Sa);for(var i=Ls.length;i--;)delete Jd[gc][Ls[i]];return Jd()};qd[em]=!0;var vc=Object.create||function(t,e){var n;return t!==null?(ep[gc]=Z_(t),n=new ep,ep[gc]=null,n[em]=t):n=Jd(),e===void 0?n:mo.f(n,e)},nm=ki,Eo=ac,ve=Error,_n=Yt("".replace),oi=String(new ve("zxcasd").stack),Qd=/\n\s*at [^:]*:[^\n]*/,Ol=Qd.test(oi),Rc=Gt,np=!jt(function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Rc(1,7)),t.stack!==7)}),Zd=ac,wl=function(t,e){if(Ol&&typeof t=="string"&&!ve.prepareStackTrace)for(;e--;)t=_n(t,Qd,"");return t},mC=np,zn=Error.captureStackTrace,go={},im=go,GS=fn("iterator"),HS=Array.prototype,WS=function(t){return t!==void 0&&(im.Array===t||HS[GS]===t)},rm=bs,ip=ys,am=il,mr=go,ci=fn("iterator"),Nl=function(t){if(!am(t))return ip(t,ci)||ip(t,"@@iterator")||mr[rm(t)]},$d=Rt,rp=$n,sm=bi,Ps=ro,ap=Nl,om=TypeError,tu=function(t,e){var n=arguments.length<2?ap(t):e;if(rp(n))return sm($d(n,t));throw new om(Ps(t)+" is not iterable")},KS=Rt,cm=bi,zS=ys,lm=function(t,e,n){var i,r;cm(t);try{if(!(i=zS(t,"return"))){if(e==="throw")throw n;return n}i=KS(i,t)}catch(s){r=!0,i=s}if(e==="throw")throw n;if(r)throw i;return cm(i),n},YS=ma,qS=Rt,dm=bi,XS=ro,EC=WS,JS=oo,um=he,QS=tu,hm=Nl,pm=lm,ZS=TypeError,eu=function(t,e){this.stopped=t,this.result=e},fm=eu.prototype,Dl=function(t,e,n){var i,r,s,c,l,d,h,p=n&&n.that,_=!(!n||!n.AS_ENTRIES),m=!(!n||!n.IS_RECORD),g=!(!n||!n.IS_ITERATOR),C=!(!n||!n.INTERRUPTED),R=YS(e,p),y=function(I){return i&&pm(i,"normal",I),new eu(!0,I)},b=function(I){return _?(dm(I),C?R(I[0],I[1],y):R(I[0],I[1])):C?R(I,y):R(I)};if(m)i=t.iterator;else if(g)i=t;else{if(!(r=hm(t)))throw new ZS(XS(t)+" is not iterable");if(EC(r)){for(s=0,c=JS(t);c>s;s++)if((l=b(t[s]))&&um(fm,l))return l;return new eu(!1)}i=QS(t,r)}for(d=m?t.next:i.next;!(h=qS(d,i)).done;){try{l=b(h.value)}catch(I){pm(i,"throw",I)}if(typeof l=="object"&&l&&um(fm,l))return l}return new eu(!1)},gC=_i,$S=fe,Ll=he,sp=fc,nu=Jh,op=function(t,e,n){for(var i=Q_(e),r=US.f,s=Qh.f,c=0;c<i.length;c++){var l=i[c];_o(t,l)||n&&_o(n,l)||r(t,l,s(e,l))}},Pl=vc,cp=ac,lp=Gt,tT=function(t,e){nm(e)&&"cause"in e&&Eo(t,"cause",e.cause)},eT=function(t,e,n,i){mC&&(zn?zn(t,e):Zd(t,"stack",wl(n,i)))},nT=Dl,iT=function(t,e){return t===void 0?arguments.length<2?"":e:gC(t)},_m=fn("toStringTag"),iu=Error,rT=[].push,So=function(t,e){var n,i=Ll(dp,this);nu?n=nu(new iu,i?sp(this):dp):(n=i?this:Pl(dp),cp(n,_m,"Error")),e!==void 0&&cp(n,"message",iT(e)),eT(n,So,n.stack,1),arguments.length>2&&tT(n,arguments[2]);var r=[];return nT(t,rT,{that:r}),cp(n,"errors",r),n};nu?nu(So,iu):op(So,iu,{name:!0});var dp=So.prototype=Pl(iu.prototype,{constructor:lp(1,So),message:lp(1,""),name:lp(1,"AggregateError")});$S({global:!0},{AggregateError:So});var ru,au,kl,aT=ke,mm=le.WeakMap,Em=aT(mm)&&/native code/.test(String(mm)),gm=le,sT=ki,SC=ac,Sm=Vn,up=wh,su=Nn,Tm=mi,ou="Object already initialized",hp=gm.TypeError,oT=gm.WeakMap;if(Em||up.state){var Mr=up.state||(up.state=new oT);Mr.get=Mr.get,Mr.has=Mr.has,Mr.set=Mr.set,ru=function(t,e){if(Mr.has(t))throw new hp(ou);return e.facade=t,Mr.set(t,e),e},au=function(t){return Mr.get(t)||{}},kl=function(t){return Mr.has(t)}}else{var yc=su("state");Tm[yc]=!0,ru=function(t,e){if(Sm(t,yc))throw new hp(ou);return e.facade=t,SC(t,yc,e),e},au=function(t){return Sm(t,yc)?t[yc]:{}},kl=function(t){return Sm(t,yc)}}var To,cT,Cc,Ta={set:ru,get:au,has:kl,enforce:function(t){return kl(t)?au(t):ru(t,{})},getterFor:function(t){return function(e){var n;if(!sT(e)||(n=au(e)).type!==t)throw new hp("Incompatible receiver, "+t+" required");return n}}},Ml=Kn,cu=Vn,lu=Function.prototype,lT=Ml&&Object.getOwnPropertyDescriptor,vm=cu(lu,"name"),Ac={PROPER:vm&&(function(){}).name==="something",CONFIGURABLE:vm&&(!Ml||Ml&&lT(lu,"name").configurable)},dT=ac,Ei=function(t,e,n,i){return i&&i.enumerable?t[e]=n:dT(t,e,n),t},za=jt,vo=ke,uT=ki,Ro=vc,Ya=fc,gi=Ei,Ul=fn("iterator"),pp=!1;[].keys&&("next"in(Cc=[].keys())?(cT=Ya(Ya(Cc)))!==Object.prototype&&(To=cT):pp=!0);var Rm=!uT(To)||za(function(){var t={};return To[Ul].call(t)!==t});vo((To=Rm?{}:Ro(To))[Ul])||gi(To,Ul,function(){return this});var ym={IteratorPrototype:To,BUGGY_SAFARI_ITERATORS:pp},hT=bs,bc=L_?{}.toString:function(){return"[object "+hT(this)+"]"},fp=L_,pT=Ki.f,fT=ac,_T=Vn,_p=bc,Cm=fn("toStringTag"),va=function(t,e,n,i){var r=n?t:t&&t.prototype;r&&(_T(r,Cm)||pT(r,Cm,{configurable:!0,value:e}),i&&!fp&&fT(r,"toString",_p))},mT=ym.IteratorPrototype,ET=vc,TC=Gt,gT=va,Ii=go,Ui=function(){return this},mp=function(t,e,n,i){var r=e+" Iterator";return t.prototype=ET(mT,{next:TC(+!i,n)}),gT(t,r,!1,!0),Ii[r]=Ui,t},ST=fe,TT=Rt,vT=Ac,RT=mp,Ep=fc,Am=va,bm=Ei,Im=go,yT=ym,Om=vT.PROPER,xl=yT.BUGGY_SAFARI_ITERATORS,du=fn("iterator"),wm="keys",Vl="values",uu="entries",Nm=function(){return this},Dm=function(t,e,n,i,r,s,c){RT(n,e,i);var l,d,h,p=function(b){if(b===r&&R)return R;if(!xl&&b&&b in g)return g[b];switch(b){case wm:case Vl:case uu:return function(){return new n(this,b)}}return function(){return new n(this)}},_=e+" Iterator",m=!1,g=t.prototype,C=g[du]||g["@@iterator"]||r&&g[r],R=!xl&&C||p(r),y=e==="Array"&&g.entries||C;if(y&&(l=Ep(y.call(new t)))!==Object.prototype&&l.next&&(Am(l,_,!0,!0),Im[_]=Nm),Om&&r===Vl&&C&&C.name!==Vl&&(m=!0,R=function(){return TT(C,this)}),r)if(d={values:p(Vl),keys:s?R:p(wm),entries:p(uu)},c)for(h in d)(xl||m||!(h in g))&&bm(g,h,d[h]);else ST({target:e,proto:!0,forced:xl||m},d);return c&&g[du]!==R&&bm(g,du,R,{}),Im[e]=R,d},Bl=function(t,e){return{value:t,done:e}},CT=no,qa=go,gp=Ta;Ki.f;var vC=Dm,hu=Bl,Xa="Array Iterator",AT=gp.set,Sp=gp.getterFor(Xa);vC(Array,"Array",function(t,e){AT(this,{type:Xa,target:CT(t),index:0,kind:e})},function(){var t=Sp(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,hu(void 0,!0);switch(t.kind){case"keys":return hu(n,!1);case"values":return hu(e[n],!1)}return hu([n,e[n]],!1)},"values"),qa.Arguments=qa.Array;var pu=Ki,An=function(t,e,n){return pu.f(t,e,n)},RC=Mi,yC=An,bT=Kn,Fl=fn("species"),yo=he,IT=TypeError,Tp=function(t,e){if(yo(e,t))return t;throw new IT("Incorrect invocation")},fu=ke,Xr=wh,OT=Yt(Function.toString);fu(Xr.inspectSource)||(Xr.inspectSource=function(t){return OT(t)});var vp=Xr.inspectSource,wT=Yt,Lm=jt,Rp=ke,yp=bs,NT=vp,Ja=function(){},Yn=Mi("Reflect","construct"),_u=/^\s*(?:class|function)\b/,DT=wT(_u.exec),Oi=!_u.test(Ja),mu=function(t){if(!Rp(t))return!1;try{return Yn(Ja,[],t),!0}catch{return!1}},Pm=function(t){if(!Rp(t))return!1;switch(yp(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Oi||!!DT(_u,NT(t))}catch{return!0}};Pm.sham=!0;var jl,cn,nr,Ra,Eu=!Yn||Lm(function(){var t;return mu(mu.call)||!mu(Object)||!mu(function(){t=!0})||t})?Pm:mu,LT=Eu,CC=ro,km=TypeError,Er=bi,ya=function(t){if(LT(t))return t;throw new km(CC(t)+" is not a constructor")},PT=il,Ur=fn("species"),Cp=function(t,e){var n,i=Er(t).constructor;return i===void 0||PT(n=Er(i)[Ur])?e:ya(n)},ir=Yt([].slice),Ic=TypeError,gr=function(t,e){if(t<e)throw new Ic("Not enough arguments");return t},Ap=/(?:ipad|iphone|ipod).*applewebkit/i.test(Zn),rr=le,Qa=Hn,kT=ma,Oc=ke,gu=Vn,Gl=jt,wc=tp,MT=ir,Mm=kd,Su=gr,UT=Ap,bp=Is,Ip=rr.setImmediate,Um=rr.clearImmediate,AC=rr.process,$e=rr.Dispatch,bn=rr.Function,Ne=rr.MessageChannel,Ge=rr.String,tn=0,xi={},ks="onreadystatechange";Gl(function(){jl=rr.location});var Co=function(t){if(gu(xi,t)){var e=xi[t];delete xi[t],e()}},Tu=function(t){return function(){Co(t)}},Za=function(t){Co(t.data)},Bn=function(t){rr.postMessage(Ge(t),jl.protocol+"//"+jl.host)};Ip&&Um||(Ip=function(t){Su(arguments.length,1);var e=Oc(t)?t:bn(t),n=MT(arguments,1);return xi[++tn]=function(){Qa(e,void 0,n)},cn(tn),tn},Um=function(t){delete xi[t]},bp?cn=function(t){AC.nextTick(Tu(t))}:$e&&$e.now?cn=function(t){$e.now(Tu(t))}:Ne&&!UT?(Ra=(nr=new Ne).port2,nr.port1.onmessage=Za,cn=kT(Ra.postMessage,Ra)):rr.addEventListener&&Oc(rr.postMessage)&&!rr.importScripts&&jl&&jl.protocol!=="file:"&&!Gl(Bn)?(cn=Bn,rr.addEventListener("message",Za,!1)):cn=ks in Mm("script")?function(t){wc.appendChild(Mm("script"))[ks]=function(){wc.removeChild(this),Co(t)}}:function(t){setTimeout(Tu(t),0)});var Ca={set:Ip,clear:Um},Ao=le,xm=Kn,Jr=Object.getOwnPropertyDescriptor,Nc=function(t){if(!xm)return Ao[t];var e=Jr(Ao,t);return e&&e.value},Hl=function(){this.head=null,this.tail=null};Hl.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Si,vu,Ru,Wl,yu,Ms=Hl,Vi=/ipad|iphone|ipod/i.test(Zn)&&typeof Pebble<"u",bo=/web0s(?!.*chrome)/i.test(Zn),Aa=le,Kl=Nc,Op=ma,Cu=Ca.set,xT=Ms,Au=Ap,Vm=Vi,xr=bo,wp=Is,Sr=Aa.MutationObserver||Aa.WebKitMutationObserver,Bm=Aa.document,Fm=Aa.process,Np=Aa.Promise,$a=Kl("queueMicrotask");if(!$a){var Dc=new xT,zl=function(){var t,e;for(wp&&(t=Fm.domain)&&t.exit();e=Dc.get();)try{e()}catch(n){throw Dc.head&&Si(),n}t&&t.enter()};Au||wp||xr||!Sr||!Bm?!Vm&&Np&&Np.resolve?((Wl=Np.resolve(void 0)).constructor=Np,yu=Op(Wl.then,Wl),Si=function(){yu(zl)}):wp?Si=function(){Fm.nextTick(zl)}:(Cu=Op(Cu,Aa),Si=function(){Cu(zl)}):(vu=!0,Ru=Bm.createTextNode(""),new Sr(zl).observe(Ru,{characterData:!0}),Si=function(){Ru.data=vu=!vu}),$a=function(t){Dc.head||Si(),Dc.add(t)}}var Lc=$a,Pc=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},Io=le.Promise,VT=le,kc=Io,jm=ke,bC=Ud,IC=vp,OC=fn,Gm=Rl,Dp=Ga,Mc=kc&&kc.prototype,Lp=OC("species"),Hm=jm(VT.PromiseRejectionEvent),BT=bC("Promise",function(){var t=IC(kc),e=t!==String(kc);if(!e&&Dp===66||!Mc.catch||!Mc.finally)return!0;if(!Dp||Dp<51||!/native code/.test(t)){var n=new kc(function(r){r(1)}),i=function(r){r(function(){},function(){})};if((n.constructor={})[Lp]=i,!(n.then(function(){})instanceof i))return!0}return!(e||Gm!=="BROWSER"&&Gm!=="DENO"||Hm)}),Yl={CONSTRUCTOR:BT,REJECTION_EVENT:Hm},ba={},Wm=$n,FT=TypeError,Pp=function(t){var e,n;this.promise=new t(function(i,r){if(e!==void 0||n!==void 0)throw new FT("Bad Promise constructor");e=i,n=r}),this.resolve=Wm(e),this.reject=Wm(n)};ba.f=function(t){return new Pp(t)};var kp,Km,Tn=fe,ql=Is,Oo=le,Xl=Rt,wC=Ei,NC=va,DC=function(t){var e=RC(t);bT&&e&&!e[Fl]&&yC(e,Fl,{configurable:!0,get:function(){return this}})},Mp=$n,wo=ke,zm=ki,Up=Tp,Ym=Cp,No=Ca.set,Qr=Lc,bu=function(t,e){try{arguments.length===1?console.error(t):console.error(t,e)}catch{}},LC=Pc,jT=Ms,qm=Ta,xp=Io,Xm=Yl,GT=ba,Jl="Promise",Jm=Xm.CONSTRUCTOR,HT=Xm.REJECTION_EVENT,Qm=qm.getterFor(Jl),Zm=qm.set,$m=xp&&xp.prototype,Iu=xp,tE=$m,Ql=Oo.TypeError,eE=Oo.document,Vp=Oo.process,be=GT.f,nE=be,Bp=!!(eE&&eE.createEvent&&Oo.dispatchEvent),Fp="unhandledrejection",iE=function(t){var e;return!(!zm(t)||!wo(e=t.then))&&e},jp=function(t,e){var n,i,r,s=e.value,c=e.state===1,l=c?t.ok:t.fail,d=t.resolve,h=t.reject,p=t.domain;try{l?(c||(e.rejection===2&&PC(e),e.rejection=1),l===!0?n=s:(p&&p.enter(),n=l(s),p&&(p.exit(),r=!0)),n===t.promise?h(new Ql("Promise-chain cycle")):(i=iE(n))?Xl(i,n,d,h):d(n)):h(s)}catch(_){p&&!r&&p.exit(),h(_)}},Zl=function(t,e){t.notified||(t.notified=!0,Qr(function(){for(var n,i=t.reactions;n=i.get();)jp(n,t);t.notified=!1,e&&!t.rejection&&$l(t)}))},Ou=function(t,e,n){var i,r;Bp?((i=eE.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),Oo.dispatchEvent(i)):i={promise:e,reason:n},!HT&&(r=Oo["on"+t])?r(i):t===Fp&&bu("Unhandled promise rejection",n)},$l=function(t){Xl(No,Oo,function(){var e,n=t.facade,i=t.value;if(rE(t)&&(e=LC(function(){ql?Vp.emit("unhandledRejection",i,n):Ou(Fp,n,i)}),t.rejection=ql||rE(t)?2:1,e.error))throw e.value})},rE=function(t){return t.rejection!==1&&!t.parent},PC=function(t){Xl(No,Oo,function(){var e=t.facade;ql?Vp.emit("rejectionHandled",e):Ou("rejectionhandled",e,t.value)})},td=function(t,e,n){return function(i){t(e,i,n)}},Uc=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,Zl(t,!0))},Gp=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw new Ql("Promise can't be resolved itself");var i=iE(e);i?Qr(function(){var r={done:!1};try{Xl(i,e,td(Gp,r,t),td(Uc,r,t))}catch(s){Uc(r,s,t)}}):(t.value=e,t.state=1,Zl(t,!1))}catch(r){Uc({done:!1},r,t)}}};Jm&&(tE=(Iu=function(t){Up(this,tE),Mp(t),Xl(kp,this);var e=Qm(this);try{t(td(Gp,e),td(Uc,e))}catch(n){Uc(e,n)}}).prototype,(kp=function(t){Zm(this,{type:Jl,done:!1,notified:!1,parent:!1,reactions:new jT,rejection:!1,state:0,value:null})}).prototype=wC(tE,"then",function(t,e){var n=Qm(this),i=be(Ym(this,Iu));return n.parent=!0,i.ok=!wo(t)||t,i.fail=wo(e)&&e,i.domain=ql?Vp.domain:void 0,n.state===0?n.reactions.add(i):Qr(function(){jp(i,n)}),i.promise}),Km=function(){var t=new kp,e=Qm(t);this.promise=t,this.resolve=td(Gp,e),this.reject=td(Uc,e)},GT.f=be=function(t){return t===Iu||t===void 0?new Km(t):nE(t)}),Tn({global:!0,wrap:!0,forced:Jm},{Promise:Iu}),NC(Iu,Jl,!1,!0),DC(Jl);var wu=fn("iterator"),ln=!1;try{var aE=0,wi={next:function(){return{done:!!aE++}},return:function(){ln=!0}};wi[wu]=function(){return this},Array.from(wi,function(){throw 2})}catch{}var kC=Io,sE=function(t,e){try{if(!e&&!ln)return!1}catch{return!1}var n=!1;try{var i={};i[wu]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch{}return n},ed=Yl.CONSTRUCTOR||!sE(function(t){kC.all(t).then(void 0,function(){})}),Hp=Rt,WT=$n,KT=ba,oE=Pc,cE=Dl;fe({target:"Promise",stat:!0,forced:ed},{all:function(t){var e=this,n=KT.f(e),i=n.resolve,r=n.reject,s=oE(function(){var c=WT(e.resolve),l=[],d=0,h=1;cE(t,function(p){var _=d++,m=!1;h++,Hp(c,e,p).then(function(g){m||(m=!0,l[_]=g,--h||i(l))},r)}),--h||i(l)});return s.error&&r(s.value),n.promise}});var MC=fe,zT=Yl.CONSTRUCTOR;Io&&Io.prototype,MC({target:"Promise",proto:!0,forced:zT,real:!0},{catch:function(t){return this.then(void 0,t)}});var UC=Rt,YT=$n,xC=ba,VC=Pc,Do=Dl;fe({target:"Promise",stat:!0,forced:ed},{race:function(t){var e=this,n=xC.f(e),i=n.reject,r=VC(function(){var s=YT(e.resolve);Do(t,function(c){UC(s,e,c).then(n.resolve,i)})});return r.error&&i(r.value),n.promise}});var qT=ba;fe({target:"Promise",stat:!0,forced:Yl.CONSTRUCTOR},{reject:function(t){var e=qT.f(this);return(0,e.reject)(t),e.promise}});var lE=bi,BC=ki,FC=ba,Wp=function(t,e){if(lE(t),BC(e)&&e.constructor===t)return e;var n=FC.f(t);return(0,n.resolve)(e),n.promise},jC=fe,Ia=Io,dE=Yl.CONSTRUCTOR,XT=Wp,JT=Mi("Promise"),Nu=!dE;jC({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return XT(Nu&&this===JT?Ia:this,t)}});var Zr=Rt,QT=$n,Kp=ba,Us=Pc,GC=Dl;fe({target:"Promise",stat:!0,forced:ed},{allSettled:function(t){var e=this,n=Kp.f(e),i=n.resolve,r=n.reject,s=Us(function(){var c=QT(e.resolve),l=[],d=0,h=1;GC(t,function(p){var _=d++,m=!1;h++,Zr(c,e,p).then(function(g){m||(m=!0,l[_]={status:"fulfilled",value:g},--h||i(l))},function(g){m||(m=!0,l[_]={status:"rejected",reason:g},--h||i(l))})}),--h||i(l)});return s.error&&r(s.value),n.promise}});var HC=Rt,nd=$n,ZT=Mi,WC=ba,KC=Pc,zC=Dl,$T="No one promise resolved";fe({target:"Promise",stat:!0,forced:ed},{any:function(t){var e=this,n=ZT("AggregateError"),i=WC.f(e),r=i.resolve,s=i.reject,c=KC(function(){var l=nd(e.resolve),d=[],h=0,p=1,_=!1;zC(t,function(m){var g=h++,C=!1;p++,HC(l,e,m).then(function(R){C||_||(_=!0,r(R))},function(R){C||_||(C=!0,d[g]=R,--p||s(new n(d,$T)))})}),--p||s(new n(d,$T))});return c.error&&s(c.value),i.promise}});var YC=fe,qC=Hn,XC=ir,tv=ba,id=$n,rd=Pc,zp=le.Promise,ev=!1;YC({target:"Promise",stat:!0,forced:!zp||!zp.try||rd(function(){zp.try(function(t){ev=t===8},8)}).error||!ev},{try:function(t){var e=arguments.length>1?XC(arguments,1):[],n=tv.f(this),i=rd(function(){return qC(id(t),void 0,e)});return(i.error?n.reject:n.resolve)(i.value),n.promise}});var ad=ba;fe({target:"Promise",stat:!0},{withResolvers:function(){var t=ad.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Du=fe,Yp=Io,qp=jt,uE=Mi,hE=ke,Xp=Cp,pE=Wp,nv=Yp&&Yp.prototype;Du({target:"Promise",proto:!0,real:!0,forced:!!Yp&&qp(function(){nv.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=Xp(this,uE("Promise")),n=hE(t);return this.then(n?function(i){return pE(e,t()).then(function(){return i})}:t,n?function(i){return pE(e,t()).then(function(){throw i})}:t)}});var fE=Yt,iv=sc,Lu=_i,JC=vs,QC=fE("".charAt),rv=fE("".charCodeAt),Jp=fE("".slice),Pu=function(t){return function(e,n){var i,r,s=Lu(JC(e)),c=iv(n),l=s.length;return c<0||c>=l?t?"":void 0:(i=rv(s,c))<55296||i>56319||c+1===l||(r=rv(s,c+1))<56320||r>57343?t?QC(s,c):i:t?Jp(s,c,c+2):r-56320+(i-55296<<10)+65536}},ku={codeAt:Pu(!1),charAt:Pu(!0)},ZC=ku.charAt,Mu=_i,av=Ta,sv=Dm,_E=Bl,mE="String Iterator",ov=av.set,EE=av.getterFor(mE);sv(String,"String",function(t){ov(this,{type:mE,string:Mu(t),index:0})},function(){var t,e=EE(this),n=e.string,i=e.index;return i>=n.length?_E(void 0,!0):(t=ZC(n,i),e.index+=t.length,_E(t,!1))});var cv=hr.Promise,Qp={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},$C=le,tA=va,Zp=go;for(var Uu in Qp)tA($C[Uu],Uu),Zp[Uu]=Zp.Array;var xu=cv,st=kt(xu),lv=Nr("Array","values"),gE=bs,Lo=Vn,Po=he,ko=lv,xc=Array.prototype,Vu={DOMTokenList:!0,NodeList:!0},Mo=function(t){var e=t.values;return t===xc||Po(xc,t)&&e===xc.values||Lo(Vu,gE(t))?ko:e},ar=kt(Mo),SE=ro,Bu=TypeError,dv=ir,uv=Math.floor,sd=function(t,e){var n=t.length;if(n<8)for(var i,r,s=1;s<n;){for(r=s,i=t[s];r&&e(t[r-1],i)>0;)t[r]=t[--r];r!==s++&&(t[r]=i)}else for(var c=uv(n/2),l=sd(dv(t,0,c),e),d=sd(dv(t,c),e),h=l.length,p=d.length,_=0,m=0;_<h||m<p;)t[_+m]=_<h&&m<p?e(l[_],d[m])<=0?l[_++]:d[m++]:_<h?l[_++]:d[m++];return t},TE=sd,hv=Zn.match(/firefox\/(\d+)/i),$p=!!hv&&+hv[1],tf=/MSIE|Trident/.test(Zn),vE=Zn.match(/AppleWebKit\/(\d+)\./),Fu=!!vE&&+vE[1],RE=fe,ju=Yt,pv=$n,eA=_a,Gu=oo,a=function(t,e){if(!delete t[e])throw new Bu("Cannot delete property "+SE(e)+" of "+SE(t))},o=_i,u=jt,f=TE,E=lc,T=$p,w=tf,P=Ga,F=Fu,J=[],ct=ju(J.sort),mt=ju(J.push),tt=u(function(){J.sort(void 0)}),et=u(function(){J.sort(null)}),ce=E("sort"),Zt=!u(function(){if(P)return P<70;if(!(T&&T>3)){if(w)return!0;if(F)return F<603;var t,e,n,i,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)J.push({k:e+i,v:n})}for(J.sort(function(s,c){return c.v-s.v}),i=0;i<J.length;i++)e=J[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return r!=="DGBEFHACIJK"}});RE({target:"Array",proto:!0,forced:tt||!et||!ce||!Zt},{sort:function(t){t!==void 0&&pv(t);var e=eA(this);if(Zt)return t===void 0?ct(e):ct(e,t);var n,i,r=[],s=Gu(e);for(i=0;i<s;i++)i in e&&mt(r,e[i]);for(f(r,function(c){return function(l,d){return d===void 0?-1:l===void 0?1:c!==void 0?+c(l,d)||0:o(l)>o(d)?1:-1}}(t)),n=Gu(r),i=0;i<n;)e[i]=r[i++];for(;i<s;)a(e,i++);return e}});var mn=Nr("Array","sort"),q=he,W=mn,Q=Array.prototype,pt=function(t){var e=t.sort;return t===Q||q(Q,t)&&e===Q.sort?W:e},Mt=kt(pt),De=fe,Wt=Yt,ie=jh,Ni=RangeError,He=String.fromCharCode,xs=String.fromCodePoint,nA=Wt([].join);De({target:"String",stat:!0,forced:!!xs&&xs.length!==1},{fromCodePoint:function(t){for(var e,n=[],i=arguments.length,r=0;i>r;){if(e=+arguments[r++],ie(e,1114111)!==e)throw new Ni(e+" is not a valid code point");n[r]=e<65536?He(e):He(55296+((e-=65536)>>10),e%1024+56320)}return nA(n,"")}});var gx=jt,Sx=fn("iterator"),fv=!gx(function(){var t=new URL("b?a=1&b=2&c=3","https://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return t.pathname="c%20d",e.forEach(function(r,s){e.delete("b"),i+=s+r}),n.delete("a",2),n.delete("b",void 0),!t.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!e.size&&!0||!e.sort||t.href!=="https://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[Sx]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"}),Tx=Ei,iA=fe,GO=le,rA=Nc,vx=Mi,_v=Rt,Vs=Yt,yE=Kn,HO=fv,WO=Ei,Rx=An,yx=function(t,e,n){for(var i in e)n&&n.unsafe&&t[i]?t[i]=e[i]:Tx(t,i,e[i],n);return t},Cx=va,Ax=mp,aA=Ta,KO=Tp,sA=ke,bx=Vn,Ix=ma,Ox=bs,wx=bi,zO=ki,Vr=_i,Nx=vc,YO=Gt,qO=tu,Dx=Nl,mv=Bl,ef=gr,Lx=TE,Px=fn("iterator"),nf="URLSearchParams",XO=nf+"Iterator",JO=aA.set,ts=aA.getterFor(nf),kx=aA.getterFor(XO),QO=rA("fetch"),Ev=rA("Request"),CE=rA("Headers"),oA=Ev&&Ev.prototype,ZO=CE&&CE.prototype,Mx=GO.TypeError,Ux=GO.encodeURIComponent,xx=String.fromCharCode,Vx=vx("String","fromCodePoint"),Bx=parseInt,gv=Vs("".charAt),$O=Vs([].join),od=Vs([].push),t0=Vs("".replace),Fx=Vs([].shift),e0=Vs([].splice),n0=Vs("".split),i0=Vs("".slice),jx=Vs(/./.exec),Gx=/\+/g,Hx=/^[0-9a-f]+$/i,r0=function(t,e){var n=i0(t,e,e+2);return jx(Hx,n)?Bx(n,16):NaN},Wx=function(t){for(var e=0,n=128;n>0&&(t&n)!=0;n>>=1)e++;return e},Kx=function(t){var e=null;switch(t.length){case 1:e=t[0];break;case 2:e=(31&t[0])<<6|63&t[1];break;case 3:e=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:e=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return e>1114111?null:e},a0=function(t){for(var e=(t=t0(t,Gx," ")).length,n="",i=0;i<e;){var r=gv(t,i);if(r==="%"){if(gv(t,i+1)==="%"||i+3>e){n+="%",i++;continue}var s=r0(t,i+1);if(s!=s){n+=r,i++;continue}i+=2;var c=Wx(s);if(c===0)r=xx(s);else{if(c===1||c>4){n+="",i++;continue}for(var l=[s],d=1;d<c&&!(++i+3>e||gv(t,i)!=="%");){var h=r0(t,i+1);if(h!=h){i+=3;break}if(h>191||h<128)break;od(l,h),i+=2,d++}if(l.length!==c){n+="";continue}var p=Kx(l);p===null?n+="":r=Vx(p)}}n+=r,i++}return n},zx=/[!'()~]|%20/g,Yx={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},qx=function(t){return Yx[t]},s0=function(t){return t0(Ux(t),zx,qx)},cA=Ax(function(t,e){JO(this,{type:XO,target:ts(t).entries,index:0,kind:e})},nf,function(){var t=kx(this),e=t.target,n=t.index++;if(!e||n>=e.length)return t.target=null,mv(void 0,!0);var i=e[n];switch(t.kind){case"keys":return mv(i.key,!1);case"values":return mv(i.value,!1)}return mv([i.key,i.value],!1)},!0),o0=function(t){this.entries=[],this.url=null,t!==void 0&&(zO(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?gv(t,0)==="?"?i0(t,1):t:Vr(t)))};o0.prototype={type:nf,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,i,r,s,c,l,d=this.entries,h=Dx(t);if(h)for(n=(e=qO(t,h)).next;!(i=_v(n,e)).done;){if(s=(r=qO(wx(i.value))).next,(c=_v(s,r)).done||(l=_v(s,r)).done||!_v(s,r).done)throw new Mx("Expected sequence with length 2");od(d,{key:Vr(c.value),value:Vr(l.value)})}else for(var p in t)bx(t,p)&&od(d,{key:p,value:Vr(t[p])})},parseQuery:function(t){if(t)for(var e,n,i=this.entries,r=n0(t,"&"),s=0;s<r.length;)(e=r[s++]).length&&(n=n0(e,"="),od(i,{key:a0(Fx(n)),value:a0($O(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],i=0;i<e.length;)t=e[i++],od(n,s0(t.key)+"="+s0(t.value));return $O(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Sv=function(){KO(this,rf);var t=JO(this,new o0(arguments.length>0?arguments[0]:void 0));yE||(this.size=t.entries.length)},rf=Sv.prototype;if(yx(rf,{append:function(t,e){var n=ts(this);ef(arguments.length,2),od(n.entries,{key:Vr(t),value:Vr(e)}),yE||this.length++,n.updateURL()},delete:function(t){for(var e=ts(this),n=ef(arguments.length,1),i=e.entries,r=Vr(t),s=n<2?void 0:arguments[1],c=s===void 0?s:Vr(s),l=0;l<i.length;){var d=i[l];if(d.key!==r||c!==void 0&&d.value!==c)l++;else if(e0(i,l,1),c!==void 0)break}yE||(this.size=i.length),e.updateURL()},get:function(t){var e=ts(this).entries;ef(arguments.length,1);for(var n=Vr(t),i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){var e=ts(this).entries;ef(arguments.length,1);for(var n=Vr(t),i=[],r=0;r<e.length;r++)e[r].key===n&&od(i,e[r].value);return i},has:function(t){for(var e=ts(this).entries,n=ef(arguments.length,1),i=Vr(t),r=n<2?void 0:arguments[1],s=r===void 0?r:Vr(r),c=0;c<e.length;){var l=e[c++];if(l.key===i&&(s===void 0||l.value===s))return!0}return!1},set:function(t,e){var n=ts(this);ef(arguments.length,1);for(var i,r=n.entries,s=!1,c=Vr(t),l=Vr(e),d=0;d<r.length;d++)(i=r[d]).key===c&&(s?e0(r,d--,1):(s=!0,i.value=l));s||od(r,{key:c,value:l}),yE||(this.size=r.length),n.updateURL()},sort:function(){var t=ts(this);Lx(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=ts(this).entries,i=Ix(t,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)i((e=n[r++]).value,e.key,this)},keys:function(){return new cA(this,"keys")},values:function(){return new cA(this,"values")},entries:function(){return new cA(this,"entries")}},{enumerable:!0}),WO(rf,Px,rf.entries,{}),WO(rf,"toString",function(){return ts(this).serialize()},{enumerable:!0}),yE&&Rx(rf,"size",{get:function(){return ts(this).entries.length},configurable:!0,enumerable:!0}),Cx(Sv,nf),iA({global:!0,forced:!HO},{URLSearchParams:Sv}),!HO&&sA(CE)){var Xx=Vs(ZO.has),Jx=Vs(ZO.set),c0=function(t){if(zO(t)){var e,n=t.body;if(Ox(n)===nf)return e=t.headers?new CE(t.headers):new CE,Xx(e,"content-type")||Jx(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Nx(t,{body:YO(0,Vr(n)),headers:YO(0,e)})}return t};if(sA(QO)&&iA({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return QO(t,arguments.length>1?c0(arguments[1]):{})}}),sA(Ev)){var lA=function(t){return KO(this,oA),new Ev(t,arguments.length>1?c0(arguments[1]):{})};oA.constructor=lA,lA.prototype=oA,iA({global:!0,dontCallGetSet:!0,forced:!0},{Request:lA})}}var es,Qx={URLSearchParams:Sv,getState:ts},Zx=hr.URLSearchParams,l0=Kn,$x=Yt,tV=Rt,eV=jt,dA=Il,nV=mc,iV=Qt,rV=_a,aV=fa,af=Object.assign,d0=Object.defineProperty,sV=$x([].concat),oV=!af||eV(function(){if(l0&&af({b:1},af(d0({},"a",{enumerable:!0,get:function(){d0(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return t[n]=7,i.split("").forEach(function(r){e[r]=r}),af({},t)[n]!==7||dA(af({},e)).join("")!==i})?function(t,e){for(var n=rV(t),i=arguments.length,r=1,s=nV.f,c=iV.f;i>r;)for(var l,d=aV(arguments[r++]),h=s?sV(dA(d),s(d)):dA(d),p=h.length,_=0;p>_;)l=h[_++],l0&&!tV(c,d,l)||(n[l]=d[l]);return n}:af,cV=bi,lV=lm,dV=Kn,uV=Ki,hV=Gt,uA=function(t,e,n){dV?uV.f(t,e,hV(0,n)):t[e]=n},pV=ma,fV=Rt,_V=_a,mV=function(t,e,n,i){try{return i?e(cV(n)[0],n[1]):e(n)}catch(r){lV(t,"throw",r)}},EV=WS,gV=Eu,SV=oo,u0=uA,TV=tu,vV=Nl,h0=Array,Hu=Yt,hA=2147483647,RV=/[^\0-\u007E]/,p0=/[.\u3002\uFF0E\uFF61]/g,f0="Overflow: input needs wider integers to process",_0=RangeError,yV=Hu(p0.exec),sf=Math.floor,pA=String.fromCharCode,m0=Hu("".charCodeAt),E0=Hu([].join),cd=Hu([].push),CV=Hu("".replace),AV=Hu("".split),bV=Hu("".toLowerCase),g0=function(t){return t+22+75*(t<26)},IV=function(t,e,n){var i=0;for(t=n?sf(t/700):t>>1,t+=sf(t/e);t>455;)t=sf(t/35),i+=36;return sf(i+36*t/(t+38))},OV=function(t){var e=[];t=function(b){for(var I=[],L=0,U=b.length;L<U;){var x=m0(b,L++);if(x>=55296&&x<=56319&&L<U){var M=m0(b,L++);(64512&M)==56320?cd(I,((1023&x)<<10)+(1023&M)+65536):(cd(I,x),L--)}else cd(I,x)}return I}(t);var n,i,r=t.length,s=128,c=0,l=72;for(n=0;n<t.length;n++)(i=t[n])<128&&cd(e,pA(i));var d=e.length,h=d;for(d&&cd(e,"-");h<r;){var p=hA;for(n=0;n<t.length;n++)(i=t[n])>=s&&i<p&&(p=i);var _=h+1;if(p-s>sf((hA-c)/_))throw new _0(f0);for(c+=(p-s)*_,s=p,n=0;n<t.length;n++){if((i=t[n])<s&&++c>hA)throw new _0(f0);if(i===s){for(var m=c,g=36;;){var C=g<=l?1:g>=l+26?26:g-l;if(m<C)break;var R=m-C,y=36-C;cd(e,pA(g0(C+R%y))),m=sf(R/y),g+=36}cd(e,pA(g0(m))),l=IV(c,_,h===d),c=0,h++}}c++,s++}return E0(e,"")},wV=fe,fA=Kn,NV=fv,_A=le,S0=ma,ns=Yt,Tv=Ei,is=An,DV=Tp,mA=Vn,EA=oV,of=function(t){var e=_V(t),n=gV(this),i=arguments.length,r=i>1?arguments[1]:void 0,s=r!==void 0;s&&(r=pV(r,i>2?arguments[2]:void 0));var c,l,d,h,p,_,m=vV(e),g=0;if(!m||this===h0&&EV(m))for(c=SV(e),l=n?new this(c):h0(c);c>g;g++)_=s?r(e[g],g):e[g],u0(l,g,_);else for(l=n?new this:[],p=(h=TV(e,m)).next;!(d=fV(p,h)).done;g++)_=s?mV(h,r,[d.value,g],!0):d.value,u0(l,g,_);return l.length=g,l},Bs=ir,LV=ku.codeAt,PV=function(t){var e,n,i=[],r=AV(CV(bV(t),p0,"."),".");for(e=0;e<r.length;e++)n=r[e],cd(i,yV(RV,n)?"xn--"+OV(n):n);return E0(i,".")},Vc=_i,kV=va,MV=gr,T0=Qx,v0=Ta,UV=v0.set,vv=v0.getterFor("URL"),xV=T0.URLSearchParams,VV=T0.getState,AE=_A.URL,gA=_A.TypeError,Rv=_A.parseInt,BV=Math.floor,R0=Math.pow,rs=ns("".charAt),Fs=ns(/./.exec),bE=ns([].join),FV=ns(1 .toString),jV=ns([].pop),cf=ns([].push),SA=ns("".replace),GV=ns([].shift),HV=ns("".split),IE=ns("".slice),yv=ns("".toLowerCase),WV=ns([].unshift),TA="Invalid scheme",Wu="Invalid host",y0="Invalid port",C0=/[a-z]/i,KV=/[\d+-.a-z]/i,vA=/\d/,zV=/^0x/i,YV=/^[0-7]+$/,qV=/^\d+$/,A0=/^[\da-f]+$/i,XV=/[\0\t\n\r #%/:<>?@[\\\]^|]/,JV=/[\0\t\n\r #/:<>?@[\\\]^|]/,QV=/^[\u0000-\u0020]+/,ZV=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,$V=/[\t\n\r]/g,OE=function(t){var e,n,i,r;if(typeof t=="number"){for(e=[],n=0;n<4;n++)WV(e,t%256),t=BV(t/256);return bE(e,".")}if(typeof t=="object"){for(e="",i=function(s){for(var c=null,l=1,d=null,h=0,p=0;p<8;p++)s[p]!==0?(h>l&&(c=d,l=h),d=null,h=0):(d===null&&(d=p),++h);return h>l?d:c}(t),n=0;n<8;n++)r&&t[n]===0||(r&&(r=!1),i===n?(e+=n?":":"::",r=!0):(e+=FV(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},Cv={},b0=EA({},Cv,{" ":1,'"':1,"<":1,">":1,"`":1}),I0=EA({},b0,{"#":1,"?":1,"{":1,"}":1}),RA=EA({},I0,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ld=function(t,e){var n=LV(t,0);return n>32&&n<127&&!mA(e,t)?t:encodeURIComponent(t)},Av={ftp:21,file:null,http:80,https:443,ws:80,wss:443},wE=function(t,e){var n;return t.length===2&&Fs(C0,rs(t,0))&&((n=rs(t,1))===":"||!e&&n==="|")},O0=function(t){var e;return t.length>1&&wE(IE(t,0,2))&&(t.length===2||(e=rs(t,2))==="/"||e==="\\"||e==="?"||e==="#")},tB=function(t){return t==="."||yv(t)==="%2e"},yA={},w0={},CA={},N0={},D0={},AA={},L0={},P0={},bv={},Iv={},bA={},IA={},OA={},wA={},k0={},NA={},lf={},Uo={},M0={},Ku={},Bc={},DA=function(t,e,n){var i,r,s,c=Vc(t);if(e){if(r=this.parse(c))throw new gA(r);this.searchParams=null}else{if(n!==void 0&&(i=new DA(n,!0)),r=this.parse(c,null,i))throw new gA(r);(s=VV(new xV)).bindURL(this),this.searchParams=s}};DA.prototype={type:"URL",parse:function(t,e,n){var i,r,s,c,l,d=this,h=e||yA,p=0,_="",m=!1,g=!1,C=!1;for(t=Vc(t),e||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,t=SA(t,QV,""),t=SA(t,ZV,"$1")),t=SA(t,$V,""),i=of(t);p<=i.length;){switch(r=i[p],h){case yA:if(!r||!Fs(C0,r)){if(e)return TA;h=CA;continue}_+=yv(r),h=w0;break;case w0:if(r&&(Fs(KV,r)||r==="+"||r==="-"||r==="."))_+=yv(r);else{if(r!==":"){if(e)return TA;_="",h=CA,p=0;continue}if(e&&(d.isSpecial()!==mA(Av,_)||_==="file"&&(d.includesCredentials()||d.port!==null)||d.scheme==="file"&&!d.host))return;if(d.scheme=_,e)return void(d.isSpecial()&&Av[d.scheme]===d.port&&(d.port=null));_="",d.scheme==="file"?h=wA:d.isSpecial()&&n&&n.scheme===d.scheme?h=N0:d.isSpecial()?h=P0:i[p+1]==="/"?(h=D0,p++):(d.cannotBeABaseURL=!0,cf(d.path,""),h=M0)}break;case CA:if(!n||n.cannotBeABaseURL&&r!=="#")return TA;if(n.cannotBeABaseURL&&r==="#"){d.scheme=n.scheme,d.path=Bs(n.path),d.query=n.query,d.fragment="",d.cannotBeABaseURL=!0,h=Bc;break}h=n.scheme==="file"?wA:AA;continue;case N0:if(r!=="/"||i[p+1]!=="/"){h=AA;continue}h=bv,p++;break;case D0:if(r==="/"){h=Iv;break}h=Uo;continue;case AA:if(d.scheme=n.scheme,r===es)d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Bs(n.path),d.query=n.query;else if(r==="/"||r==="\\"&&d.isSpecial())h=L0;else if(r==="?")d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Bs(n.path),d.query="",h=Ku;else{if(r!=="#"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Bs(n.path),d.path.length--,h=Uo;continue}d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,d.path=Bs(n.path),d.query=n.query,d.fragment="",h=Bc}break;case L0:if(!d.isSpecial()||r!=="/"&&r!=="\\"){if(r!=="/"){d.username=n.username,d.password=n.password,d.host=n.host,d.port=n.port,h=Uo;continue}h=Iv}else h=bv;break;case P0:if(h=bv,r!=="/"||rs(_,p+1)!=="/")continue;p++;break;case bv:if(r!=="/"&&r!=="\\"){h=Iv;continue}break;case Iv:if(r==="@"){m&&(_="%40"+_),m=!0,s=of(_);for(var R=0;R<s.length;R++){var y=s[R];if(y!==":"||C){var b=ld(y,RA);C?d.password+=b:d.username+=b}else C=!0}_=""}else if(r===es||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()){if(m&&_==="")return"Invalid authority";p-=of(_).length+1,_="",h=bA}else _+=r;break;case bA:case IA:if(e&&d.scheme==="file"){h=NA;continue}if(r!==":"||g){if(r===es||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()){if(d.isSpecial()&&_==="")return Wu;if(e&&_===""&&(d.includesCredentials()||d.port!==null))return;if(c=d.parseHost(_))return c;if(_="",h=lf,e)return;continue}r==="["?g=!0:r==="]"&&(g=!1),_+=r}else{if(_==="")return Wu;if(c=d.parseHost(_))return c;if(_="",h=OA,e===IA)return}break;case OA:if(!Fs(vA,r)){if(r===es||r==="/"||r==="?"||r==="#"||r==="\\"&&d.isSpecial()||e){if(_!==""){var I=Rv(_,10);if(I>65535)return y0;d.port=d.isSpecial()&&I===Av[d.scheme]?null:I,_=""}if(e)return;h=lf;continue}return y0}_+=r;break;case wA:if(d.scheme="file",r==="/"||r==="\\")h=k0;else{if(!n||n.scheme!=="file"){h=Uo;continue}switch(r){case es:d.host=n.host,d.path=Bs(n.path),d.query=n.query;break;case"?":d.host=n.host,d.path=Bs(n.path),d.query="",h=Ku;break;case"#":d.host=n.host,d.path=Bs(n.path),d.query=n.query,d.fragment="",h=Bc;break;default:O0(bE(Bs(i,p),""))||(d.host=n.host,d.path=Bs(n.path),d.shortenPath()),h=Uo;continue}}break;case k0:if(r==="/"||r==="\\"){h=NA;break}n&&n.scheme==="file"&&!O0(bE(Bs(i,p),""))&&(wE(n.path[0],!0)?cf(d.path,n.path[0]):d.host=n.host),h=Uo;continue;case NA:if(r===es||r==="/"||r==="\\"||r==="?"||r==="#"){if(!e&&wE(_))h=Uo;else if(_===""){if(d.host="",e)return;h=lf}else{if(c=d.parseHost(_))return c;if(d.host==="localhost"&&(d.host=""),e)return;_="",h=lf}continue}_+=r;break;case lf:if(d.isSpecial()){if(h=Uo,r!=="/"&&r!=="\\")continue}else if(e||r!=="?")if(e||r!=="#"){if(r!==es&&(h=Uo,r!=="/"))continue}else d.fragment="",h=Bc;else d.query="",h=Ku;break;case Uo:if(r===es||r==="/"||r==="\\"&&d.isSpecial()||!e&&(r==="?"||r==="#")){if((l=yv(l=_))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(d.shortenPath(),r==="/"||r==="\\"&&d.isSpecial()||cf(d.path,"")):tB(_)?r==="/"||r==="\\"&&d.isSpecial()||cf(d.path,""):(d.scheme==="file"&&!d.path.length&&wE(_)&&(d.host&&(d.host=""),_=rs(_,0)+":"),cf(d.path,_)),_="",d.scheme==="file"&&(r===es||r==="?"||r==="#"))for(;d.path.length>1&&d.path[0]==="";)GV(d.path);r==="?"?(d.query="",h=Ku):r==="#"&&(d.fragment="",h=Bc)}else _+=ld(r,I0);break;case M0:r==="?"?(d.query="",h=Ku):r==="#"?(d.fragment="",h=Bc):r!==es&&(d.path[0]+=ld(r,Cv));break;case Ku:e||r!=="#"?r!==es&&(r==="'"&&d.isSpecial()?d.query+="%27":d.query+=r==="#"?"%23":ld(r,Cv)):(d.fragment="",h=Bc);break;case Bc:r!==es&&(d.fragment+=ld(r,b0))}p++}},parseHost:function(t){var e,n,i;if(rs(t,0)==="["){if(rs(t,t.length-1)!=="]"||(e=function(r){var s,c,l,d,h,p,_,m=[0,0,0,0,0,0,0,0],g=0,C=null,R=0,y=function(){return rs(r,R)};if(y()===":"){if(rs(r,1)!==":")return;R+=2,C=++g}for(;y();){if(g===8)return;if(y()!==":"){for(s=c=0;c<4&&Fs(A0,y());)s=16*s+Rv(y(),16),R++,c++;if(y()==="."){if(c===0||(R-=c,g>6))return;for(l=0;y();){if(d=null,l>0){if(!(y()==="."&&l<4))return;R++}if(!Fs(vA,y()))return;for(;Fs(vA,y());){if(h=Rv(y(),10),d===null)d=h;else{if(d===0)return;d=10*d+h}if(d>255)return;R++}m[g]=256*m[g]+d,++l!=2&&l!==4||g++}if(l!==4)return;break}if(y()===":"){if(R++,!y())return}else if(y())return;m[g++]=s}else{if(C!==null)return;R++,C=++g}}if(C!==null)for(p=g-C,g=7;g!==0&&p>0;)_=m[g],m[g--]=m[C+p-1],m[C+--p]=_;else if(g!==8)return;return m}(IE(t,1,-1)),!e))return Wu;this.host=e}else if(this.isSpecial()){if(t=PV(t),Fs(XV,t)||(e=function(r){var s,c,l,d,h,p,_,m=HV(r,".");if(m.length&&m[m.length-1]===""&&m.length--,(s=m.length)>4)return r;for(c=[],l=0;l<s;l++){if((d=m[l])==="")return r;if(h=10,d.length>1&&rs(d,0)==="0"&&(h=Fs(zV,d)?16:8,d=IE(d,h===8?1:2)),d==="")p=0;else{if(!Fs(h===10?qV:h===8?YV:A0,d))return r;p=Rv(d,h)}cf(c,p)}for(l=0;l<s;l++)if(p=c[l],l===s-1){if(p>=R0(256,5-s))return null}else if(p>255)return null;for(_=jV(c),l=0;l<c.length;l++)_+=c[l]*R0(256,3-l);return _}(t),e===null))return Wu;this.host=e}else{if(Fs(JV,t))return Wu;for(e="",n=of(t),i=0;i<n.length;i++)e+=ld(n[i],Cv);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return mA(Av,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme==="file"&&e===1&&wE(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,i=t.password,r=t.host,s=t.port,c=t.path,l=t.query,d=t.fragment,h=e+":";return r!==null?(h+="//",t.includesCredentials()&&(h+=n+(i?":"+i:"")+"@"),h+=OE(r),s!==null&&(h+=":"+s)):e==="file"&&(h+="//"),h+=t.cannotBeABaseURL?c[0]:c.length?"/"+bE(c,"/"):"",l!==null&&(h+="?"+l),d!==null&&(h+="#"+d),h},setHref:function(t){var e=this.parse(t);if(e)throw new gA(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t==="blob")try{return new df(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+OE(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Vc(t)+":",yA)},getUsername:function(){return this.username},setUsername:function(t){var e=of(Vc(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=ld(e[n],RA)}},getPassword:function(){return this.password},setPassword:function(t){var e=of(Vc(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=ld(e[n],RA)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?OE(t):OE(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,bA)},getHostname:function(){var t=this.host;return t===null?"":OE(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,IA)},getPort:function(){var t=this.port;return t===null?"":Vc(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Vc(t))===""?this.port=null:this.parse(t,OA))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+bE(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,lf))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Vc(t))===""?this.query=null:(rs(t,0)==="?"&&(t=IE(t,1)),this.query="",this.parse(t,Ku)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Vc(t))!==""?(rs(t,0)==="#"&&(t=IE(t,1)),this.fragment="",this.parse(t,Bc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var df=function(t){var e=DV(this,Br),n=MV(arguments.length,1)>1?arguments[1]:void 0,i=UV(e,new DA(t,!1,n));fA||(e.href=i.serialize(),e.origin=i.getOrigin(),e.protocol=i.getProtocol(),e.username=i.getUsername(),e.password=i.getPassword(),e.host=i.getHost(),e.hostname=i.getHostname(),e.port=i.getPort(),e.pathname=i.getPathname(),e.search=i.getSearch(),e.searchParams=i.getSearchParams(),e.hash=i.getHash())},Br=df.prototype,as=function(t,e){return{get:function(){return vv(this)[t]()},set:e&&function(n){return vv(this)[e](n)},configurable:!0,enumerable:!0}};if(fA&&(is(Br,"href",as("serialize","setHref")),is(Br,"origin",as("getOrigin")),is(Br,"protocol",as("getProtocol","setProtocol")),is(Br,"username",as("getUsername","setUsername")),is(Br,"password",as("getPassword","setPassword")),is(Br,"host",as("getHost","setHost")),is(Br,"hostname",as("getHostname","setHostname")),is(Br,"port",as("getPort","setPort")),is(Br,"pathname",as("getPathname","setPathname")),is(Br,"search",as("getSearch","setSearch")),is(Br,"searchParams",as("getSearchParams")),is(Br,"hash",as("getHash","setHash"))),Tv(Br,"toJSON",function(){return vv(this).serialize()},{enumerable:!0}),Tv(Br,"toString",function(){return vv(this).serialize()},{enumerable:!0}),AE){var U0=AE.createObjectURL,x0=AE.revokeObjectURL;U0&&Tv(df,"createObjectURL",S0(U0,AE)),x0&&Tv(df,"revokeObjectURL",S0(x0,AE))}kV(df,"URL"),wV({global:!0,forced:!NV,sham:!fA},{URL:df});var eB=fe,V0=jt,nB=gr,B0=_i,iB=fv,LA=Mi("URL"),rB=iB&&V0(function(){LA.canParse()}),aB=V0(function(){return LA.canParse.length!==1});eB({target:"URL",stat:!0,forced:!rB||aB},{canParse:function(t){var e=nB(arguments.length,1),n=B0(t),i=e<2||arguments[1]===void 0?void 0:B0(arguments[1]);try{return!!new LA(n,i)}catch{return!1}}});var sB=fe,oB=gr,F0=_i,cB=fv,lB=Mi("URL");sB({target:"URL",stat:!0,forced:!cB},{parse:function(t){var e=oB(arguments.length,1),n=F0(t),i=e<2||arguments[1]===void 0?void 0:F0(arguments[1]);try{return new lB(n,i)}catch{return null}}});var Ov=kt(hr.URL);let j0=!0,G0=!0;function wv(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function zu(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(c,l){if(c!==e)return r.apply(this,arguments);const d=h=>{const p=n(h);p&&(l.handleEvent?l.handleEvent(p):l(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,d),r.apply(this,[c,d])};const s=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(l))return s.apply(this,arguments);const d=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,d])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function dB(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(j0=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function uB(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(G0=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function H0(){if(typeof window=="object"){if(j0)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function PA(t,e){G0&&console.warn(t+" is deprecated, please use "+e+" instead.")}function W0(t){return Object.prototype.toString.call(t)==="[object Object]"}function K0(t){var e;return W0(t)?_r(e=Object.keys(t)).call(e,function(n,i){const r=W0(t[i]),s=r?K0(t[i]):t[i],c=r&&!Object.keys(s).length;return s===void 0||c?n:Object.assign(n,{[i]:s})},{}):t}function kA(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?kA(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{kA(t,t.get(r),n)})}))}function z0(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&s.push(c)}),s.forEach(c=>{t.forEach(l=>{l.type===i&&l.trackId===c.id&&kA(t,l,r)})}),r}const Y0=H0;function q0(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const h=typeof c[d]=="object"?c[d]:{ideal:c[d]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const p=function(_,m){return _?_+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(h.ideal!==void 0){l.optional=l.optional||[];let _={};typeof h.ideal=="number"?(_[p("min",d)]=h.ideal,l.optional.push(_),_={},_[p("max",d)]=h.ideal,l.optional.push(_)):(_[p("",d)]=h.ideal,l.optional.push(_))}h.exact!==void 0&&typeof h.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[p("",d)]=h.exact):["min","max"].forEach(_=>{h[_]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[p(_,d)]=h[_])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},r=function(c,l){if(e.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const d=function(h,p,_){p in h&&!(_ in h)&&(h[_]=h[p],delete h[p])};d((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let d=c.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const h=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||h)){let p;if(delete c.video.facingMode,d.exact==="environment"||d.ideal==="environment"?p=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(p=["front"]),p)return n.mediaDevices.enumerateDevices().then(_=>{let m=(_=_.filter(g=>g.kind==="videoinput")).find(g=>p.some(C=>{var R;return rt(R=g.label.toLowerCase()).call(R,C)}));return!m&&_.length&&rt(p).call(p,"back")&&(m=_[_.length-1]),m&&(c.video.deviceId=d.exact?{exact:m.deviceId}:{ideal:m.deviceId}),c.video=i(c.video),Y0("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return Y0("chrome: "+JSON.stringify(c)),l(c)},s=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,l,d){r(c,h=>{n.webkitGetUserMedia(h,l,p=>{d&&d(s(p))})})}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,d=>c(d).then(h=>{if(d.audio&&!h.getAudioTracks().length||d.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return h},h=>st.reject(s(h))))}}}function X0(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function J0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const s=new Event("track");s.track=i.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(i=>{let r;r=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const s=new Event("track");s.track=i,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else zu(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Q0(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){let d=r.apply(this,arguments);return d||(d=e(this,c),this._senders.push(d)),d};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){s.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(s=>{this._senders.push(e(this,s))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(s=>{const c=this._senders.find(l=>l.track===s);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Z0(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,i,r]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const s=function(l){const d={};return l.result().forEach(h=>{const p={id:h.id,timestamp:h.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type};h.names().forEach(_=>{p[_]=h.stat(_)}),d[p.id]=p}),d},c=function(l){return new Map(Object.keys(l).map(d=>[d,l[d]]))};if(arguments.length>=2){const l=function(d){i(c(s(d)))};return e.apply(this,[l,n])}return new st((l,d)=>{e.apply(this,[function(h){l(c(s(h)))},d])}).then(i,r)}}function $0(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>z0(s,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(r=>r._pc=this),i}),zu(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(r=>z0(r,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let i,r,s;return this.getSenders().forEach(c=>{c.track===n&&(i?s=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(r?s=!0:r=c),c.track===n)),s||i&&r?st.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():r?r.getStats():st.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function tw(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(d=>c.indexOf(d)===-1);this._shimmedLocalStreams[s.id]=[s].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(s);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function ew(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return tw(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(_=>_.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const h=new t.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}i.apply(this,[d])};const r=t.RTCPeerConnection.prototype.removeStream;function s(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(_=>{const m=d._reverseStreams[_],g=d._streams[m.id];p=p.replace(new RegExp(g.id,"g"),m.id)}),new RTCSessionDescription({type:h.type,sdp:p})}t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(g=>g===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[h.id];if(m)m.addTrack(d),st.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([d]);this._streams[h.id]=g,this._reverseStreams[g.id]=h,this.addStream(g)}return this.getSenders().find(g=>g.track===d)},["createOffer","createAnswer"].forEach(function(d){const h=t.RTCPeerConnection.prototype[d],p={[d](){const _=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[m=>{const g=s(this,m);_[0].apply(null,[g])},m=>{_[1]&&_[1].apply(null,m)},arguments[2]]):h.apply(this,arguments).then(m=>s(this,m))}};t.RTCPeerConnection.prototype[d]=p[d]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(d,h){let p=h.sdp;return Object.keys(d._reverseStreams||[]).forEach(_=>{const m=d._reverseStreams[_],g=d._streams[m.id];p=p.replace(new RegExp(m.id,"g"),g.id)}),new RTCSessionDescription({type:h.type,sdp:p})}(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=l.get.apply(this);return d.type===""?d:s(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let h;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(_=>d.track===_)&&(h=this._streams[p])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function MA(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function nw(t,e){zu(t,"negotiationneeded",n=>{const i=n.target;if(!(e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var iw=Object.freeze({__proto__:null,fixNegotiationNeeded:nw,shimAddTrackRemoveTrack:ew,shimAddTrackRemoveTrackWithNative:tw,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(i=>{const r=n.video&&n.video.width,s=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},r&&(n.video.mandatory.maxWidth=r),s&&(n.video.mandatory.maxHeight=s),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Q0,shimGetStats:Z0,shimGetUserMedia:q0,shimMediaStream:X0,shimOnTrack:J0,shimPeerConnection:MA,shimSenderReceiverGetStats:$0});function rw(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,c){PA("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,c)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(c,l,d){l in c&&!(d in c)&&(c[d]=c[l],delete c[l])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c.audio,"autoGainControl","mozAutoGainControl"),r(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return r(l,"mozAutoGainControl","autoGainControl"),r(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),r(l,"autoGainControl","mozAutoGainControl"),r(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function aw(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function UA(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],c={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=c[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,s,c]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!s)try{l.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;l.forEach((h,p)=>{l.set(p,Object.assign({},h,{type:n[h.type]||h.type}))})}return l}).then(s,c)}}function sw(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):st.resolve(new Map)}}function ow(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n}),zu(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function cw(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){PA("removeStream","removeTrack"),this.getSenders().forEach(n=>{var i;n.track&&rt(i=e.getTracks()).call(i,n.track)&&this.removeTrack(n)})})}function lw(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function dw(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(i){const{sender:s}=r,c=s.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(c).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return r})}function uw(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function hw(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?st.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function pw(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?st.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var fw=Object.freeze({__proto__:null,shimAddTransceiver:dw,shimCreateAnswer:pw,shimCreateOffer:hw,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,st.reject(i)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:uw,shimGetUserMedia:rw,shimOnTrack:aw,shimPeerConnection:UA,shimRTCDataChannel:lw,shimReceiverGetStats:ow,shimRemoveStream:cw,shimSenderGetStats:sw});function _w(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),rt(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r&&r.forEach(c=>{var l;this._localStreams?rt(l=this._localStreams).call(l,c)||this._localStreams.push(c):this._localStreams=[c]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const i=e.getTracks();this.getSenders().forEach(r=>{rt(i).call(i,r.track)&&this.removeTrack(r)})})}}function mw(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),rt(s=this._remoteStreams).call(s,r))return;this._remoteStreams.push(r);const c=new Event("addstream");c.stream=r,this.dispatchEvent(c)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(r=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(r)>=0)return;n._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,n.dispatchEvent(s)})}),e.apply(n,arguments)}}}function Ew(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(d,h){const p=arguments.length>=2?arguments[2]:arguments[0],_=n.apply(this,[p]);return h?(_.then(d,h),st.resolve()):_},e.createAnswer=function(d,h){const p=arguments.length>=2?arguments[2]:arguments[0],_=i.apply(this,[p]);return h?(_.then(d,h),st.resolve()):_};let l=function(d,h,p){const _=r.apply(this,[d]);return p?(_.then(h,p),st.resolve()):_};e.setLocalDescription=l,l=function(d,h,p){const _=s.apply(this,[d]);return p?(_.then(h,p),st.resolve()):_},e.setRemoteDescription=l,l=function(d,h,p){const _=c.apply(this,[d]);return p?(_.then(h,p),st.resolve()):_},e.addIceCandidate=l}function gw(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(Sw(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,i,r){e.mediaDevices.getUserMedia(n).then(i,r)}).bind(e))}function Sw(t){return t&&t.video!==void 0?Object.assign({},t,{video:K0(t.video)}):t}function Tw(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const r=[];for(let s=0;s<n.iceServers.length;s++){let c=n.iceServers[s];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(PA("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,r.push(c)):r.push(n.iceServers[s])}n.iceServers=r}return new e(n,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function vw(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Rw(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveVideo!==!0||r||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function yw(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Cw=Object.freeze({__proto__:null,shimAudioContext:yw,shimCallbacksAPI:Ew,shimConstraints:Sw,shimCreateOfferLegacy:Rw,shimGetUserMedia:gw,shimLocalStreamsAPI:_w,shimRTCIceServerUrls:Tw,shimRemoteStreamsAPI:mw,shimTrackEventTransceiver:vw}),Aw=`	
\v\f\r \u2028\u2029\uFEFF`,hB=vs,pB=_i,xA=Aw,bw=Yt("".replace),fB=RegExp("^["+xA+"]+"),_B=RegExp("(^|[^"+xA+"])["+xA+"]+$"),mB=function(t){return function(e){var n=pB(hB(e));return 1&t&&(n=bw(n,fB,"")),2&t&&(n=bw(n,_B,"$1")),n}},EB={trim:mB(3)},gB=Ac.PROPER,SB=jt,Iw=Aw,TB=EB.trim;fe({target:"String",proto:!0,forced:function(t){return SB(function(){return!!Iw[t]()||""[t]()!==""||gB&&Iw[t].name!==t})}("trim")},{trim:function(){return TB(this)}});var vB=Nr("String","trim"),RB=he,yB=vB,VA=String.prototype,CB=function(t){var e=t.trim;return typeof t=="string"||t===VA||RB(VA,t)&&e===VA.trim?yB:e},Bi=kt(CB),Ow={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,r)=>(r>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1])}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)r=s[c].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?s.push(c+"="+n.parameters[c]):s.push(c)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");i.profile=r[2];for(let c=3;c<r.length;c++){const l=r[c],d=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(d){const h=e.parseRtpMap(d),p=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(h.parameters=p.length?e.parseFmtp(p[0]):{},h.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(h.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(c=>{i.headerExtensions.push(e.parseExtmap(c))});const s=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(c=>{s.forEach(l=>{c.rtcpFeedback.find(d=>d.type===l.type&&d.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{r+=e.writeRtpMap(c),r+=e.writeFmtp(c),r+=e.writeRtcpFb(c)});let s=0;return i.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{r+=e.writeExtmap(c)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,c=r.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(m=>e.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),d=l.length>0&&l[0].ssrc;let h;const p=e.matchPrefix(n,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(g=>parseInt(g,10)));p.length>0&&p[0].length>1&&p[0][0]===d&&(h=p[0][1]),r.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let g={ssrc:d,codecPayloadType:parseInt(m.parameters.apt,10)};d&&h&&(g.rtx={ssrc:h}),i.push(g),s&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:d,mechanism:c?"red+ulpfec":"red"},i.push(g))}}),i.length===0&&d&&i.push({ssrc:d});let _=e.matchPrefix(n,"b=");return _.length&&(_=_[0].indexOf("b=TIAS:")===0?parseInt(_[0].substring(7),10):_[0].indexOf("b=AS:")===0?1e3*parseInt(_[0].substring(5),10)*.95-16e3:void 0,i.forEach(m=>{m.maxBitrate=_})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const c=e.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return s.length>0?(i=s[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const c=e.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const d=l[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return r=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const c=i!==void 0?i:2;return s=n||e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(Ow);var ww=Ow.exports,uf=kt(ww),AB=Fe({__proto__:null,default:uf},[ww]);function Nv(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new e(n),r=uf.parseCandidate(n.candidate),s=Object.assign(i,r);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,zu(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function BA(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||zu(t,"icecandidate",e=>{if(e.candidate){const n=uf.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Dv(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const d=uf.splitSections(l.sdp);return d.shift(),d.some(h=>{const p=uf.parseMLine(h);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},i=function(l){const d=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;const h=parseInt(d[1],10);return h!=h?-1:h},r=function(l){let d=65536;return e.browser==="firefox"&&(d=e.version<57?l===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),d},s=function(l,d){let h=65536;e.browser==="firefox"&&e.version===57&&(h=65535);const p=uf.matchPrefix(l.sdp,"a=max-message-size:");return p.length>0?h=parseInt(p[0].substr(19),10):e.browser==="firefox"&&d!==-1&&(h=2147483637),h},c=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),d=r(l),h=s(arguments[0],l);let p;p=d===0&&h===0?Number.POSITIVE_INFINITY:d===0||h===0?Math.max(d,h):Math.min(d,h);const _={};Object.defineProperty(_,"maxMessageSize",{get:()=>p}),this._sctp=_}return c.apply(this,arguments)}}function Lv(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},zu(t,"datachannel",i=>(e(i.channel,i.target),i))}function FA(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const c=new Event("connectionstatechange",r);s.dispatchEvent(c)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function jA(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=i.sdp.split(`
`).filter(s=>Bi(s).call(s)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:r}):i.sdp=r}return n.apply(this,arguments)}}function Pv(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?st.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),st.resolve())})}function kv(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var bB=Object.freeze({__proto__:null,removeExtmapAllowMixed:jA,shimAddIceCandidateNullOrEmpty:Pv,shimConnectionState:FA,shimMaxMessageSize:Dv,shimParameterlessSetLocalDescription:kv,shimRTCIceCandidate:Nv,shimRTCIceCandidateRelayProtocol:BA,shimSendThrowTypeError:Lv});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=H0,i=function(s){const c={browser:null,version:null};if(s===void 0||!s.navigator)return c.browser="Not a browser.",c;const{navigator:l}=s;if(l.mozGetUserMedia)c.browser="firefox",c.version=wv(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)c.browser="chrome",c.version=wv(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=wv(l.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return c}(t),r={browserDetails:i,commonShim:bB,extractVersion:wv,disableLog:dB,disableWarnings:uB,sdp:AB};switch(i.browser){case"chrome":if(!iw||!MA||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=iw,Pv(t,i),kv(t),q0(t,i),X0(t),MA(t,i),J0(t),ew(t,i),Q0(t),Z0(t),$0(t),nw(t,i),Nv(t),BA(t),FA(t),Dv(t,i),Lv(t),jA(t,i);break;case"firefox":if(!fw||!UA||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=fw,Pv(t,i),kv(t),rw(t,i),UA(t,i),aw(t),cw(t),sw(t),ow(t),lw(t),dw(t),uw(t),hw(t),pw(t),Nv(t),FA(t),Dv(t,i),Lv(t);break;case"safari":if(!Cw||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=Cw,Pv(t,i),kv(t),Tw(t),Rw(t),Ew(t),_w(t),mw(t),vw(t),gw(t),yw(t),Nv(t),BA(t),Dv(t,i),Lv(t),jA(t,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var GA=le;fe({global:!0,forced:GA.globalThis!==GA},{globalThis:GA});var Nw=kt(le),HA={exports:{}};(function(t,e){(function(n,i){var r="function",s="undefined",c="object",l="string",d="major",h="model",p="name",_="type",m="vendor",g="version",C="architecture",R="console",y="mobile",b="tablet",I="smarttv",L="wearable",U="embedded",x="Amazon",M="Apple",j="ASUS",K="BlackBerry",it="Browser",dt="Chrome",Ft="Firefox",Vt="Google",It="Huawei",Ue="LG",Ae="Microsoft",ur="Motorola",z="Opera",$="Samsung",ft="Sharp",Y="Sony",v="Xiaomi",D="Zebra",k="Facebook",Z="Chromium OS",Ut="Mac OS",Pe=" Browser",Pn=function(wn){for(var kn={},Be=0;Be<wn.length;Be++)kn[wn[Be].toUpperCase()]=wn[Be];return kn},Ua=function(wn,kn){return typeof wn===l&&Ts(kn).indexOf(Ts(wn))!==-1},Ts=function(wn){return wn.toLowerCase()},kg=function(wn,kn){if(typeof wn===l)return wn=wn.replace(/^\s\s*/,""),typeof kn===s?wn:wn.substring(0,500)},Th=function(wn,kn){for(var Be,Ar,to,gn,el,ne,eo=0;eo<kn.length&&!el;){var vh=kn[eo],ec=kn[eo+1];for(Be=Ar=0;Be<vh.length&&!el&&vh[Be];)if(el=vh[Be++].exec(wn))for(to=0;to<ec.length;to++)ne=el[++Ar],typeof(gn=ec[to])===c&&gn.length>0?gn.length===2?typeof gn[1]==r?this[gn[0]]=gn[1].call(this,ne):this[gn[0]]=gn[1]:gn.length===3?typeof gn[1]!==r||gn[1].exec&&gn[1].test?this[gn[0]]=ne?ne.replace(gn[1],gn[2]):i:this[gn[0]]=ne?gn[1].call(this,ne,gn[2]):i:gn.length===4&&(this[gn[0]]=ne?gn[3].call(this,ne.replace(gn[1],gn[2])):i):this[gn]=ne||i;eo+=2}},i_=function(wn,kn){for(var Be in kn)if(typeof kn[Be]===c&&kn[Be].length>0){for(var Ar=0;Ar<kn[Be].length;Ar++)if(Ua(kn[Be][Ar],wn))return Be==="?"?i:Be}else if(Ua(kn[Be],wn))return Be==="?"?i:Be;return kn.hasOwnProperty("*")?kn["*"]:wn},Ny={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Dy={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,g],[/opios[\/ ]+([\w\.]+)/i],[g,[p,z+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[g,[p,z+" GX"]],[/\bopr\/([\w\.]+)/i],[g,[p,z]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[p,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[g,[p,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,g],[/quark(?:pc)?\/([-\w\.]+)/i],[g,[p,"Quark"]],[/\bddg\/([\w\.]+)/i],[g,[p,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[p,"UC"+it]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[p,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[p,"Smart Lenovo "+it]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+it],g],[/\bfocus\/([\w\.]+)/i],[g,[p,Ft+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[p,z+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[p,z+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[p,"MIUI"+Pe]],[/fxios\/([\w\.-]+)/i],[g,[p,Ft]],[/\bqihoobrowser\/?([\w\.]*)/i],[g,[p,"360"]],[/\b(qq)\/([\w\.]+)/i],[[p,/(.+)/,"$1Browser"],g],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1"+Pe],g],[/samsungbrowser\/([\w\.]+)/i],[g,[p,$+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[g,[p,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[p,"Sogou Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[p,g],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[p],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[g,p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,k],g],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[p,dt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,dt+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[p,"Android "+it]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[g,i_,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],g],[/(wolvic|librewolf)\/([\w\.]+)/i],[p,g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[p,Ft+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[p,[g,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[p,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[C,"amd64"]],[/(ia32(?=;))/i],[[C,Ts]],[/((?:i[346]|x)86)[;\)]/i],[[C,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[C,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[C,"armhf"]],[/windows (ce|mobile); ppc;/i],[[C,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[C,/ower/,"",Ts]],[/(sun4\w)[;\)]/i],[[C,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[C,Ts]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[m,$],[_,b]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[h,[m,$],[_,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[m,M],[_,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[m,M],[_,b]],[/(macintosh);/i],[h,[m,M]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[m,ft],[_,y]],[/(?:honor)([-\w ]+)[;\)]/i],[h,[m,"Honor"],[_,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[m,It],[_,b]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[m,It],[_,y]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[h,/_/g," "],[m,v],[_,y]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[m,v],[_,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[m,"OPPO"],[_,y]],[/\b(opd2\d{3}a?) bui/i],[h,[m,"OPPO"],[_,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[m,"Vivo"],[_,y]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[m,"Realme"],[_,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[m,ur],[_,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[m,ur],[_,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[m,Ue],[_,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[m,Ue],[_,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[m,"Lenovo"],[_,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[m,"Nokia"],[_,y]],[/(pixel c)\b/i],[h,[m,Vt],[_,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[m,Vt],[_,y]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[m,Y],[_,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[m,Y],[_,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[m,"OnePlus"],[_,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[m,x],[_,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[m,x],[_,y]],[/(playbook);[-\w\),; ]+(rim)/i],[h,m,[_,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[m,K],[_,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[m,j],[_,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[m,j],[_,y]],[/(nexus 9)/i],[h,[m,"HTC"],[_,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[h,/_/g," "],[_,y]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[h,[m,"TCL"],[_,b]],[/(itel) ((\w+))/i],[[m,Ts],h,[_,i_,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[m,"Acer"],[_,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[m,"Meizu"],[_,y]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[m,"Ulefone"],[_,y]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[h,[m,"Energizer"],[_,y]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[h,[m,"Cat"],[_,y]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[h,[m,"Smartfren"],[_,y]],[/droid.+; (a(?:015|06[35]|142p?))/i],[h,[m,"Nothing"],[_,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,h,[_,y]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,h,[_,b]],[/(surface duo)/i],[h,[m,Ae],[_,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[m,"Fairphone"],[_,y]],[/(u304aa)/i],[h,[m,"AT&T"],[_,y]],[/\bsie-(\w*)/i],[h,[m,"Siemens"],[_,y]],[/\b(rct\w+) b/i],[h,[m,"RCA"],[_,b]],[/\b(venue[\d ]{2,7}) b/i],[h,[m,"Dell"],[_,b]],[/\b(q(?:mv|ta)\w+) b/i],[h,[m,"Verizon"],[_,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[m,"Barnes & Noble"],[_,b]],[/\b(tm\d{3}\w+) b/i],[h,[m,"NuVision"],[_,b]],[/\b(k88) b/i],[h,[m,"ZTE"],[_,b]],[/\b(nx\d{3}j) b/i],[h,[m,"ZTE"],[_,y]],[/\b(gen\d{3}) b.+49h/i],[h,[m,"Swiss"],[_,y]],[/\b(zur\d{3}) b/i],[h,[m,"Swiss"],[_,b]],[/\b((zeki)?tb.*\b) b/i],[h,[m,"Zeki"],[_,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],h,[_,b]],[/\b(ns-?\w{0,9}) b/i],[h,[m,"Insignia"],[_,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[m,"NextBook"],[_,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],h,[_,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],h,[_,y]],[/\b(ph-1) /i],[h,[m,"Essential"],[_,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[m,"Envizen"],[_,b]],[/\b(trio[-\w\. ]+) b/i],[h,[m,"MachSpeed"],[_,b]],[/\btu_(1491) b/i],[h,[m,"Rotor"],[_,b]],[/(shield[\w ]+) b/i],[h,[m,"Nvidia"],[_,b]],[/(sprint) (\w+)/i],[m,h,[_,y]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[m,Ae],[_,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[m,D],[_,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[m,D],[_,y]],[/smart-tv.+(samsung)/i],[m,[_,I]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[m,$],[_,I]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,Ue],[_,I]],[/(apple) ?tv/i],[m,[h,M+" TV"],[_,I]],[/crkey/i],[[h,dt+"cast"],[m,Vt],[_,I]],[/droid.+aft(\w+)( bui|\))/i],[h,[m,x],[_,I]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[m,ft],[_,I]],[/(bravia[\w ]+)( bui|\))/i],[h,[m,Y],[_,I]],[/(mitv-\w{5}) bui/i],[h,[m,v],[_,I]],[/Hbbtv.*(technisat) (.*);/i],[m,h,[_,I]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,kg],[h,kg],[_,I]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[_,I]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,h,[_,R]],[/droid.+; (shield) bui/i],[h,[m,"Nvidia"],[_,R]],[/(playstation [345portablevi]+)/i],[h,[m,Y],[_,R]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[m,Ae],[_,R]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[h,[m,$],[_,L]],[/((pebble))app/i],[m,h,[_,L]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[m,M],[_,L]],[/droid.+; (glass) \d/i],[h,[m,Vt],[_,L]],[/droid.+; (wt63?0{2,3})\)/i],[h,[m,D],[_,L]],[/droid.+; (glass) \d/i],[h,[m,Vt],[_,L]],[/(pico) (4|neo3(?: link|pro)?)/i],[m,h,[_,L]],[/; (quest( \d| pro)?)/i],[h,[m,k],[_,L]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[_,U]],[/(aeobc)\b/i],[h,[m,x],[_,U]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[_,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[_,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[_,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[_,y]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[p,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[p,g],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,g],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[p,[g,i_,Ny]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,i_,Ny],[p,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,Ut],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,g],[/\(bb(10);/i],[g,[p,K]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[p,Ft+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[p,dt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,Z],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,g],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,g]]},xa=function(wn,kn){if(typeof wn===c&&(kn=wn,wn=i),!(this instanceof xa))return new xa(wn,kn).getResult();var Be=typeof n!==s&&n.navigator?n.navigator:i,Ar=wn||(Be&&Be.userAgent?Be.userAgent:""),to=Be&&Be.userAgentData?Be.userAgentData:i,gn=kn?function(ne,eo){var vh={};for(var ec in ne)eo[ec]&&eo[ec].length%2==0?vh[ec]=eo[ec].concat(ne[ec]):vh[ec]=ne[ec];return vh}(Dy,kn):Dy,el=Be&&Be.userAgent==Ar;return this.getBrowser=function(){var ne={};return ne[p]=i,ne[g]=i,Th.call(ne,Ar,gn.browser),ne[d]=function(eo){return typeof eo===l?eo.replace(/[^\d\.]/g,"").split(".")[0]:i}(ne[g]),el&&Be&&Be.brave&&typeof Be.brave.isBrave==r&&(ne[p]="Brave"),ne},this.getCPU=function(){var ne={};return ne[C]=i,Th.call(ne,Ar,gn.cpu),ne},this.getDevice=function(){var ne={};return ne[m]=i,ne[h]=i,ne[_]=i,Th.call(ne,Ar,gn.device),el&&!ne[_]&&to&&to.mobile&&(ne[_]=y),el&&ne[h]=="Macintosh"&&Be&&typeof Be.standalone!==s&&Be.maxTouchPoints&&Be.maxTouchPoints>2&&(ne[h]="iPad",ne[_]=b),ne},this.getEngine=function(){var ne={};return ne[p]=i,ne[g]=i,Th.call(ne,Ar,gn.engine),ne},this.getOS=function(){var ne={};return ne[p]=i,ne[g]=i,Th.call(ne,Ar,gn.os),el&&!ne[p]&&to&&to.platform&&to.platform!="Unknown"&&(ne[p]=to.platform.replace(/chrome os/i,Z).replace(/macos/i,Ut)),ne},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ar},this.setUA=function(ne){return Ar=typeof ne===l&&ne.length>500?kg(ne,500):ne,this},this.setUA(Ar),this};xa.VERSION="0.7.40",xa.BROWSER=Pn([p,g,d]),xa.CPU=Pn([C]),xa.DEVICE=Pn([h,m,_,R,y,I,b,L,U]),xa.ENGINE=xa.OS=Pn([p,g]),t.exports&&(e=t.exports=xa),e.UAParser=xa;var tl=typeof n!==s&&(n.jQuery||n.Zepto);if(tl&&!tl.ua){var Ly=new xa;tl.ua=Ly.getResult(),tl.ua.get=function(){return Ly.getUA()},tl.ua.set=function(wn){Ly.setUA(wn);var kn=Ly.getResult();for(var Be in kn)tl.ua[Be]=kn[Be]}}})(typeof window=="object"?window:nt)})(HA,HA.exports);var IB=kt(HA.exports),Dw=Ca.clear;fe({global:!0,bind:!0,forced:le.clearImmediate!==Dw},{clearImmediate:Dw});var Lw=le,OB=Hn,wB=ke,NB=Rl,DB=Zn,LB=ir,PB=gr,kB=Lw.Function,MB=/MSIE .\./.test(DB)||NB==="BUN"&&function(){var t=Lw.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")}(),UB=fe,Pw=le,kw=Ca.set,xB=function(t,e){var n=1;return MB?function(i,r){var s=PB(arguments.length,1)>n,c=wB(i)?i:kB(i),l=s?LB(arguments,n):[],d=s?function(){OB(c,this,l)}:c;return t(d)}:t},Mw=Pw.setImmediate?xB(kw):kw;UB({global:!0,bind:!0,forced:Pw.setImmediate!==Mw},{setImmediate:Mw});var Uw=kt(hr.setImmediate),VB=le,BB=Lc,FB=$n,jB=gr,GB=Kn;fe({global:!0,dontCallGetSet:!0,forced:jt(function(){return GB&&Object.getOwnPropertyDescriptor(VB,"queueMicrotask").value.length!==1})},{queueMicrotask:function(t){jB(arguments.length,1),BB(FB(t))}});var xw=kt(hr.queueMicrotask);function Vw(t,e){return function(){return t.apply(e,arguments)}}const{toString:HB}=Object.prototype,{getPrototypeOf:WA}=Object,{iterator:Mv,toStringTag:Bw}=Symbol,Uv=(KA=Object.create(null),t=>{const e=HB.call(t);return KA[e]||(KA[e]=e.slice(8,-1).toLowerCase())});var KA;const js=t=>(t=t.toLowerCase(),e=>Uv(e)===t),xv=t=>e=>typeof e===t,{isArray:hf}=Array,NE=xv("undefined"),Fw=js("ArrayBuffer"),WB=xv("string"),$r=xv("function"),jw=xv("number"),Vv=t=>t!==null&&typeof t=="object",Bv=t=>{if(Uv(t)!=="object")return!1;const e=WA(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Bw in t||Mv in t)},KB=js("Date"),zB=js("File"),YB=js("Blob"),qB=js("FileList"),XB=js("URLSearchParams"),[JB,QB,ZB,$B]=["ReadableStream","Request","Response","Headers"].map(js);function DE(t,e){let n,i,{allOwnKeys:r=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),hf(t))for(n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else{const s=r?Object.getOwnPropertyNames(t):Object.keys(t),c=s.length;let l;for(n=0;n<c;n++)l=s[n],e.call(null,t[l],l,t)}}function Gw(t,e){e=e.toLowerCase();const n=Object.keys(t);let i,r=n.length;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const Yu=Nw!==void 0?Nw:typeof self<"u"?self:typeof window<"u"?window:kO,Hw=t=>!NE(t)&&t!==Yu,tF=(zA=typeof Uint8Array<"u"&&WA(Uint8Array),t=>zA&&t instanceof zA);var zA;const eF=js("HTMLFormElement"),Ww=(t=>{let{hasOwnProperty:e}=t;return(n,i)=>e.call(n,i)})(Object.prototype),nF=js("RegExp"),Kw=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};DE(n,(r,s)=>{let c;(c=e(r,s,t))!==!1&&(i[s]=c||r)}),Object.defineProperties(t,i)},iF=js("AsyncFunction"),zw=(Yw=typeof Uw=="function",qw=$r(Yu.postMessage),Yw?Uw:qw?(YA="axios@".concat(Math.random()),Fv=[],Yu.addEventListener("message",t=>{let{source:e,data:n}=t;e===Yu&&n===YA&&Fv.length&&Fv.shift()()},!1),t=>{Fv.push(t),Yu.postMessage(YA,"*")}):t=>setTimeout(t));var Yw,qw,YA,Fv;const rF=xw!==void 0?xw.bind(Yu):typeof process<"u"&&process.nextTick||zw;var at={isArray:hf,isArrayBuffer:Fw,isBuffer:function(t){return t!==null&&!NE(t)&&t.constructor!==null&&!NE(t.constructor)&&$r(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||$r(t.append)&&((e=Uv(t))==="formdata"||e==="object"&&$r(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&Fw(t.buffer),e},isString:WB,isNumber:jw,isBoolean:t=>t===!0||t===!1,isObject:Vv,isPlainObject:Bv,isReadableStream:JB,isRequest:QB,isResponse:ZB,isHeaders:$B,isUndefined:NE,isDate:KB,isFile:zB,isBlob:YB,isRegExp:nF,isFunction:$r,isStream:t=>Vv(t)&&$r(t.pipe),isURLSearchParams:XB,isTypedArray:tF,isFileList:qB,forEach:DE,merge:function t(){const{caseless:e}=Hw(this)&&this||{},n={},i=(r,s)=>{const c=e&&Gw(n,s)||s;Bv(n[c])&&Bv(r)?n[c]=t(n[c],r):Bv(r)?n[c]=t({},r):hf(r)?n[c]=r.slice():n[c]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&DE(arguments[r],i);return n},extend:function(t,e,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return DE(e,(r,s)=>{n&&$r(r)?t[s]=Vw(r,n):t[s]=r},{allOwnKeys:i}),t},trim:t=>Bi(t)?Bi(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,i)=>{let r,s,c;const l={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),s=r.length;s-- >0;)c=r[s],i&&!i(c,t,e)||l[c]||(e[c]=t[c],l[c]=!0);t=n!==!1&&WA(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:Uv,kindOfTest:js,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},toArray:t=>{if(!t)return null;if(hf(t))return t;let e=t.length;if(!jw(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Mv]).call(t);let i;for(;(i=n.next())&&!i.done;){const r=i.value;e.call(t,r[0],r[1])}},matchAll:(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},isHTMLForm:eF,hasOwnProperty:Ww,hasOwnProp:Ww,reduceDescriptors:Kw,freezeMethods:t=>{Kw(t,(e,n)=>{if($r(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];$r(i)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},i=r=>{r.forEach(s=>{n[s]=!0})};return hf(t)?i(t):i(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,i){return n.toUpperCase()+i}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:Gw,global:Yu,isContextDefined:Hw,isSpecCompliantForm:function(t){return!!(t&&$r(t.append)&&t[Bw]==="FormData"&&t[Mv])},toJSONObject:t=>{const e=new Array(10),n=(i,r)=>{if(Vv(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[r]=i;const s=hf(i)?[]:{};return DE(i,(c,l)=>{const d=n(c,r+1);!NE(d)&&(s[l]=d)}),e[r]=void 0,s}}return i};return n(t,0)},isAsyncFn:iF,isThenable:t=>t&&(Vv(t)||$r(t))&&$r(t.then)&&$r(t.catch),setImmediate:zw,asap:rF,isIterable:t=>t!=null&&$r(t[Mv])};function Re(t,e,n,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}at.inherits(Re,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:at.toJSONObject(this.config),code:this.code,status:this.status}}});const Xw=Re.prototype,Jw={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Jw[t]={value:t}}),Object.defineProperties(Re,Jw),Object.defineProperty(Xw,"isAxiosError",{value:!0}),Re.from=(t,e,n,i,r,s)=>{const c=Object.create(Xw);return at.toFlatObject(t,c,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),Re.call(c,t.message,e,n,i,r),c.cause=t,c.name=t.name,s&&Object.assign(c,s),c};function qA(t){return at.isPlainObject(t)||at.isArray(t)}function Qw(t){return at.endsWith(t,"[]")?t.slice(0,-2):t}function Zw(t,e,n){return t?t.concat(e).map(function(i,r){return i=Qw(i),!n&&r?"["+i+"]":i}).join(n?".":""):e}const aF=at.toFlatObject(at,{},null,function(t){return/^is[A-Z]/.test(t)});function jv(t,e,n){if(!at.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const i=(n=at.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!at.isUndefined(g[m])})).metaTokens,r=n.visitor||h,s=n.dots,c=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&at.isSpecCompliantForm(e);if(!at.isFunction(r))throw new TypeError("visitor must be a function");function d(m){if(m===null)return"";if(at.isDate(m))return m.toISOString();if(!l&&at.isBlob(m))throw new Re("Blob is not supported. Use a Buffer instead.");return at.isArrayBuffer(m)||at.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function h(m,g,C){let R=m;if(m&&!C&&typeof m=="object"){if(at.endsWith(g,"{}"))g=i?g:g.slice(0,-2),m=JSON.stringify(m);else if(at.isArray(m)&&function(y){return at.isArray(y)&&!y.some(qA)}(m)||(at.isFileList(m)||at.endsWith(g,"[]"))&&(R=at.toArray(m)))return g=Qw(g),R.forEach(function(y,b){!at.isUndefined(y)&&y!==null&&e.append(c===!0?Zw([g],b,s):c===null?g:g+"[]",d(y))}),!1}return!!qA(m)||(e.append(Zw(C,g,s),d(m)),!1)}const p=[],_=Object.assign(aF,{defaultVisitor:h,convertValue:d,isVisitable:qA});if(!at.isObject(t))throw new TypeError("data must be an object");return function m(g,C){if(!at.isUndefined(g)){if(p.indexOf(g)!==-1)throw Error("Circular reference detected in "+C.join("."));p.push(g),at.forEach(g,function(R,y){(!(at.isUndefined(R)||R===null)&&r.call(e,R,at.isString(y)?Bi(y).call(y):y,C,_))===!0&&m(R,C?C.concat(y):[y])}),p.pop()}}(t),e}function $w(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function XA(t,e){this._pairs=[],t&&jv(t,this,e)}const tN=XA.prototype;function sF(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function eN(t,e,n){if(!e)return t;const i=n&&n.encode||sF;at.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let s;if(s=r?r(e,n):at.isURLSearchParams(e)?e.toString():new XA(e,n).toString(i),s){const c=t.indexOf("#");c!==-1&&(t=t.slice(0,c)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}tN.append=function(t,e){this._pairs.push([t,e])},tN.toString=function(t){const e=t?function(n){return t.call(this,n,$w)}:$w;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var nN=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){at.forEach(this.handlers,function(e){e!==null&&t(e)})}},iN={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},rN={exports:{}},oF=fe,cF=Kn,aN=Ki.f;oF({target:"Object",stat:!0,forced:Object.defineProperty!==aN,sham:!cF},{defineProperty:aN});var sN=hr.Object,lF=rN.exports=function(t,e,n){return sN.defineProperty(t,e,n)};sN.defineProperty.sham&&(lF.sham=!0);var oN=kt(rN.exports),dF=TypeError,cN=Ha,uF=Eu,hF=ki,pF=fn("species"),lN=Array,fF=function(t){var e;return cN(t)&&(e=t.constructor,(uF(e)&&(e===lN||cN(e.prototype))||hF(e)&&(e=e[pF])===null)&&(e=void 0)),e===void 0?lN:e},dN=function(t,e){return new(fF(t))(e===0?0:e)},_F=jt,mF=Ga,EF=fn("species"),uN=function(t){return mF>=51||!_F(function(){var e=[];return(e.constructor={})[EF]=function(){return{foo:1}},e[t](Boolean).foo!==1})},gF=fe,SF=jt,TF=Ha,vF=ki,RF=_a,yF=oo,hN=function(t){if(t>9007199254740991)throw dF("Maximum allowed index exceeded");return t},pN=uA,CF=dN,AF=uN,bF=Ga,fN=fn("isConcatSpreadable"),IF=bF>=51||!SF(function(){var t=[];return t[fN]=!1,t.concat()[0]!==t}),OF=function(t){if(!vF(t))return!1;var e=t[fN];return e!==void 0?!!e:TF(t)};gF({target:"Array",proto:!0,forced:!IF||!AF("concat")},{concat:function(t){var e,n,i,r,s,c=RF(this),l=CF(c,0),d=0;for(e=-1,i=arguments.length;e<i;e++)if(OF(s=e===-1?c:arguments[e]))for(r=yF(s),hN(d+r),n=0;n<r;n++,d++)n in s&&pN(l,d,s[n]);else hN(d+1),pN(l,d++,s);return l.length=d,l}});var _N={},wF=Wn,NF=no,mN=Ka.f,DF=ir,EN=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];_N.f=function(t){return EN&&wF(t)==="Window"?function(e){try{return mN(e)}catch{return DF(EN)}}(t):mN(NF(t))};var pf={},LF=fn;pf.f=LF;var gN=hr,PF=Vn,kF=pf,MF=Ki.f,ti=function(t){var e=gN.Symbol||(gN.Symbol={});PF(e,t)||MF(e,t,{value:kF.f(t)})},UF=Rt,xF=Mi,VF=fn,BF=Ei,SN=function(){var t=xF("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,i=VF("toPrimitive");e&&!e[i]&&BF(e,i,function(r){return UF(n,this)},{})},FF=ma,jF=fa,GF=_a,HF=oo,WF=dN,TN=Yt([].push),KF=function(t){var e=t===1,n=t===2,i=t===3,r=t===4,s=t===6,c=t===7,l=t===5||s;return function(d,h,p,_){for(var m,g,C=GF(d),R=jF(C),y=HF(R),b=FF(h,p),I=0,L=_||WF,U=e?L(d,y):n||c?L(d,0):void 0;y>I;I++)if((l||I in R)&&(g=b(m=R[I],I,C),t))if(e)U[I]=g;else if(g)switch(t){case 3:return!0;case 5:return m;case 6:return I;case 2:TN(U,m)}else switch(t){case 4:return!1;case 7:TN(U,m)}return s?-1:i||r?r:U}},vN={forEach:KF(0)},Gv=fe,LE=le,JA=Rt,zF=Yt,ff=Kn,_f=sl,YF=jt,Yi=Vn,qF=he,QA=bi,Hv=no,ZA=so,XF=_i,$A=Gt,mf=vc,RN=Il,JF=Ka,yN=_N,QF=mc,CN=Fa,AN=Ki,ZF=Ec,bN=Qt,IN=Ei,$F=An,tb=Wr,ON=mi,wN=ao,t3=fn,e3=pf,n3=ti,i3=SN,r3=va,NN=Ta,Wv=vN.forEach,ta=Nn("hidden"),Kv="Symbol",PE="prototype",a3=NN.set,DN=NN.getterFor(Kv),Gs=Object[PE],qu=LE.Symbol,zv=qu&&qu[PE],s3=LE.RangeError,o3=LE.TypeError,eb=LE.QObject,LN=CN.f,Xu=AN.f,PN=yN.f,c3=bN.f,kN=zF([].push),Fc=tb("symbols"),kE=tb("op-symbols"),l3=tb("wks"),nb=!eb||!eb[PE]||!eb[PE].findChild,MN=function(t,e,n){var i=LN(Gs,e);i&&delete Gs[e],Xu(t,e,n),i&&t!==Gs&&Xu(Gs,e,i)},ib=ff&&YF(function(){return mf(Xu({},"a",{get:function(){return Xu(this,"a",{value:7}).a}})).a!==7})?MN:Xu,rb=function(t,e){var n=Fc[t]=mf(zv);return a3(n,{type:Kv,tag:t,description:e}),ff||(n.description=e),n},Yv=function(t,e,n){t===Gs&&Yv(kE,e,n),QA(t);var i=ZA(e);return QA(n),Yi(Fc,i)?(n.enumerable?(Yi(t,ta)&&t[ta][i]&&(t[ta][i]=!1),n=mf(n,{enumerable:$A(0,!1)})):(Yi(t,ta)||Xu(t,ta,$A(1,mf(null))),t[ta][i]=!0),ib(t,i,n)):Xu(t,i,n)},ab=function(t,e){QA(t);var n=Hv(e),i=RN(n).concat(BN(n));return Wv(i,function(r){ff&&!JA(UN,n,r)||Yv(t,r,n[r])}),t},UN=function(t){var e=ZA(t),n=JA(c3,this,e);return!(this===Gs&&Yi(Fc,e)&&!Yi(kE,e))&&(!(n||!Yi(this,e)||!Yi(Fc,e)||Yi(this,ta)&&this[ta][e])||n)},xN=function(t,e){var n=Hv(t),i=ZA(e);if(n!==Gs||!Yi(Fc,i)||Yi(kE,i)){var r=LN(n,i);return!r||!Yi(Fc,i)||Yi(n,ta)&&n[ta][i]||(r.enumerable=!0),r}},VN=function(t){var e=PN(Hv(t)),n=[];return Wv(e,function(i){Yi(Fc,i)||Yi(ON,i)||kN(n,i)}),n},BN=function(t){var e=t===Gs,n=PN(e?kE:Hv(t)),i=[];return Wv(n,function(r){!Yi(Fc,r)||e&&!Yi(Gs,r)||kN(i,Fc[r])}),i};_f||(qu=function(){if(qF(zv,this))throw new o3("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?XF(arguments[0]):void 0,e=wN(t),n=function(i){var r=this===void 0?LE:this;r===Gs&&JA(n,kE,i),Yi(r,ta)&&Yi(r[ta],e)&&(r[ta][e]=!1);var s=$A(1,i);try{ib(r,e,s)}catch(c){if(!(c instanceof s3))throw c;MN(r,e,s)}};return ff&&nb&&ib(Gs,e,{configurable:!0,set:n}),rb(e,t)},IN(zv=qu[PE],"toString",function(){return DN(this).tag}),IN(qu,"withoutSetter",function(t){return rb(wN(t),t)}),bN.f=UN,AN.f=Yv,ZF.f=ab,CN.f=xN,JF.f=yN.f=VN,QF.f=BN,e3.f=function(t){return rb(t3(t),t)},ff&&$F(zv,"description",{configurable:!0,get:function(){return DN(this).description}})),Gv({global:!0,wrap:!0,forced:!_f,sham:!_f},{Symbol:qu}),Wv(RN(l3),function(t){n3(t)}),Gv({target:Kv,stat:!0,forced:!_f},{useSetter:function(){nb=!0},useSimple:function(){nb=!1}}),Gv({target:"Object",stat:!0,forced:!_f,sham:!ff},{create:function(t,e){return e===void 0?mf(t):ab(mf(t),e)},defineProperty:Yv,defineProperties:ab,getOwnPropertyDescriptor:xN}),Gv({target:"Object",stat:!0,forced:!_f},{getOwnPropertyNames:VN}),i3(),r3(qu,Kv),ON[ta]=!0;var FN=sl&&!!Symbol.for&&!!Symbol.keyFor,d3=fe,u3=Mi,h3=Vn,p3=_i,jN=Wr,f3=FN,sb=jN("string-to-symbol-registry"),_3=jN("symbol-to-string-registry");d3({target:"Symbol",stat:!0,forced:!f3},{for:function(t){var e=p3(t);if(h3(sb,e))return sb[e];var n=u3("Symbol")(e);return sb[e]=n,_3[n]=e,n}});var m3=fe,E3=Vn,g3=ol,S3=ro,T3=FN,GN=Wr("symbol-to-string-registry");m3({target:"Symbol",stat:!0,forced:!T3},{keyFor:function(t){if(!g3(t))throw new TypeError(S3(t)+" is not a symbol");if(E3(GN,t))return GN[t]}});var HN=Ha,v3=ke,WN=Wn,R3=_i,KN=Yt([].push),y3=fe,zN=Mi,YN=Hn,C3=Rt,ME=Yt,qN=jt,XN=ke,JN=ol,QN=ir,A3=function(t){if(v3(t))return t;if(HN(t)){for(var e=t.length,n=[],i=0;i<e;i++){var r=t[i];typeof r=="string"?KN(n,r):typeof r!="number"&&WN(r)!=="Number"&&WN(r)!=="String"||KN(n,R3(r))}var s=n.length,c=!0;return function(l,d){if(c)return c=!1,d;if(HN(this))return d;for(var h=0;h<s;h++)if(n[h]===l)return d}}},b3=sl,I3=String,dd=zN("JSON","stringify"),qv=ME(/./.exec),ZN=ME("".charAt),O3=ME("".charCodeAt),w3=ME("".replace),N3=ME(1 .toString),D3=/[\uD800-\uDFFF]/g,$N=/^[\uD800-\uDBFF]$/,tD=/^[\uDC00-\uDFFF]$/,eD=!b3||qN(function(){var t=zN("Symbol")("stringify detection");return dd([t])!=="[null]"||dd({a:t})!=="{}"||dd(Object(t))!=="{}"}),nD=qN(function(){return dd("\uDF06\uD834")!=='"\\udf06\\ud834"'||dd("\uDEAD")!=='"\\udead"'}),L3=function(t,e){var n=QN(arguments),i=A3(e);if(XN(i)||t!==void 0&&!JN(t))return n[1]=function(r,s){if(XN(i)&&(s=C3(i,this,I3(r),s)),!JN(s))return s},YN(dd,null,n)},P3=function(t,e,n){var i=ZN(n,e-1),r=ZN(n,e+1);return qv($N,t)&&!qv(tD,r)||qv(tD,t)&&!qv($N,i)?"\\u"+N3(O3(t,0),16):t};dd&&y3({target:"JSON",stat:!0,forced:eD||nD},{stringify:function(t,e,n){var i=QN(arguments),r=YN(eD?L3:dd,null,i);return nD&&typeof r=="string"?w3(r,D3,P3):r}});var iD=mc,k3=_a;fe({target:"Object",stat:!0,forced:!sl||jt(function(){iD.f(1)})},{getOwnPropertySymbols:function(t){var e=iD.f;return e?e(k3(t)):[]}}),ti("asyncIterator"),ti("hasInstance"),ti("isConcatSpreadable"),ti("iterator"),ti("match"),ti("matchAll"),ti("replace"),ti("search"),ti("species"),ti("split");var M3=SN;ti("toPrimitive"),M3();var U3=Mi,x3=va;ti("toStringTag"),x3(U3("Symbol"),"Symbol"),ti("unscopables"),va(le.JSON,"JSON",!0);var V3=hr.Symbol,B3=fn,F3=Ki.f,rD=B3("metadata"),aD=Function.prototype;aD[rD]===void 0&&F3(aD,rD,{value:null}),ti("asyncDispose"),ti("dispose"),ti("metadata");var j3=V3,G3=Yt,ob=Mi("Symbol"),H3=ob.keyFor,W3=G3(ob.prototype.valueOf),sD=ob.isRegisteredSymbol||function(t){try{return H3(W3(t))!==void 0}catch{return!1}};fe({target:"Symbol",stat:!0},{isRegisteredSymbol:sD});for(var K3=Wr,oD=Mi,z3=Yt,Y3=ol,q3=fn,Xv=oD("Symbol"),cD=Xv.isWellKnownSymbol,lD=oD("Object","getOwnPropertyNames"),X3=z3(Xv.prototype.valueOf),dD=K3("wks"),cb=0,uD=lD(Xv),J3=uD.length;cb<J3;cb++)try{var hD=uD[cb];Y3(Xv[hD])&&q3(hD)}catch{}var pD=function(t){if(cD&&cD(t))return!0;try{for(var e=X3(t),n=0,i=lD(dD),r=i.length;n<r;n++)if(dD[i[n]]==e)return!0}catch{}return!1};fe({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:pD}),ti("customMatcher"),ti("observable"),fe({target:"Symbol",stat:!0},{isRegistered:sD}),fe({target:"Symbol",stat:!0,forced:!0},{isWellKnown:pD}),ti("matcher"),ti("metadataKey"),ti("patternMatch"),ti("replaceAll");var Ef=kt(j3),fD=kt(pf.f("iterator"));function UE(t){return UE=typeof Ef=="function"&&typeof fD=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Ef=="function"&&e.constructor===Ef&&e!==Ef.prototype?"symbol":typeof e},UE(t)}var Q3=kt(pf.f("toPrimitive"));function Z3(t){var e=function(n,i){if(UE(n)!="object"||!n)return n;var r=n[Q3];if(r!==void 0){var s=r.call(n,i);if(UE(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)}(t,"string");return UE(e)=="symbol"?e:e+""}function A(t,e,n){return(e=Z3(e))in t?oN(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _D=kt(Zx),$3={isBrowser:!0,classes:{URLSearchParams:_D!==void 0?_D:XA,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const lb=typeof window<"u"&&typeof document<"u",db=typeof navigator=="object"&&navigator||void 0,tj=lb&&(!db||["ReactNative","NativeScript","NS"].indexOf(db.product)<0),ej=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",nj=lb&&window.location.href||"http://localhost";function mD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ED(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mD(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mD(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var Tr=ED(ED({},Object.freeze({__proto__:null,hasBrowserEnv:lb,hasStandardBrowserEnv:tj,hasStandardBrowserWebWorkerEnv:ej,navigator:db,origin:nj})),$3),ij=bi,rj=Rt,aj=Vn,sj=he,oj=function(){var t=ij(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},gD=RegExp.prototype,SD=function(t){var e=t.flags;return e!==void 0||"flags"in gD||aj(t,"flags")||!sj(gD,t)?e:rj(oj,t)},cj=ku.charAt,TD=Rt,lj=bi,dj=ke,uj=Wn,hj=/./.exec,pj=TypeError,fj=fe,vD=Rt,RD=Ba,_j=mp,Jv=Bl,yD=vs,CD=oc,xE=_i,mj=bi,Ej=ki,gj=Wn,Sj=D_,AD=SD,Tj=ys,vj=jt,Rj=Cp,yj=function(t,e,n){return e+(n?cj(t,e).length:1)},Cj=function(t,e){var n=t.exec;if(dj(n)){var i=TD(n,t,e);return i!==null&&lj(i),i}if(uj(t)==="RegExp")return TD(hj,t,e);throw new pj("RegExp#exec called on incompatible receiver")},bD=Ta,Aj=fn("matchAll"),ID="RegExp String",OD=ID+" Iterator",bj=bD.set,Ij=bD.getterFor(OD),Oj=TypeError,ub=RD("".indexOf),Qv=RD("".matchAll),hb=!!Qv&&!vj(function(){Qv("a",/./)}),wj=_j(function(t,e,n,i){bj(this,{type:OD,regexp:t,string:e,global:n,unicode:i,done:!1})},ID,function(){var t=Ij(this);if(t.done)return Jv(void 0,!0);var e=t.regexp,n=t.string,i=Cj(e,n);return i===null?(t.done=!0,Jv(void 0,!0)):t.global?(xE(i[0])===""&&(e.lastIndex=yj(n,CD(e.lastIndex),t.unicode)),Jv(i,!1)):(t.done=!0,Jv(i,!1))}),wD=function(t){var e,n,i,r=mj(this),s=xE(t),c=Rj(r,RegExp),l=xE(AD(r));return e=new c(c===RegExp?r.source:r,l),n=!!~ub(l,"g"),i=!!~ub(l,"u"),e.lastIndex=CD(r.lastIndex),new wj(e,s,n,i)};fj({target:"String",proto:!0,forced:hb},{matchAll:function(t){var e,n,i,r,s=yD(this);if(Ej(t)){if(Sj(t)&&(e=xE(yD(AD(t))),!~ub(e,"g")))throw new Oj("`.matchAll` does not allow non-global regexes");if(hb)return Qv(s,t);if((i=Tj(t,Aj))===void 0&&gj(t)==="RegExp"&&(i=wD),i)return vD(i,t,s)}else if(hb)return Qv(s,t);return n=xE(s),r=new RegExp(t,"g"),vD(wD,r,n)}});var Nj=Nr("String","matchAll"),Dj=he,Lj=Nj,pb=String.prototype,Pj=function(t){var e=t.matchAll;return typeof t=="string"||t===pb||Dj(pb,t)&&e===pb.matchAll?Lj:e},kj=kt(Pj);function ND(t){function e(n,i,r,s){let c=n[s++];if(c==="__proto__")return!0;const l=Number.isFinite(+c),d=s>=n.length;return c=!c&&at.isArray(r)?r.length:c,d?(at.hasOwnProp(r,c)?r[c]=[r[c],i]:r[c]=i,!l):(r[c]&&at.isObject(r[c])||(r[c]=[]),e(n,i,r[c],s)&&at.isArray(r[c])&&(r[c]=function(h){const p={},_=Object.keys(h);let m;const g=_.length;let C;for(m=0;m<g;m++)C=_[m],p[C]=h[C];return p}(r[c])),!l)}if(at.isFormData(t)&&at.isFunction(t.entries)){const n={};return at.forEachEntry(t,(i,r)=>{e(function(s){return kj(at).call(at,/\w+|\[(\w*)]/g,s).map(c=>c[0]==="[]"?"":c[1]||c[0])}(i),r,n,0)}),n}return null}const fb={transitional:iN,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",i=n.indexOf("application/json")>-1,r=at.isObject(t);if(r&&at.isHTMLForm(t)&&(t=new FormData(t)),at.isFormData(t))return i?JSON.stringify(ND(t)):t;if(at.isArrayBuffer(t)||at.isBuffer(t)||at.isStream(t)||at.isFile(t)||at.isBlob(t)||at.isReadableStream(t))return t;if(at.isArrayBufferView(t))return t.buffer;if(at.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(r){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(c,l){return jv(c,new Tr.classes.URLSearchParams,Object.assign({visitor:function(d,h,p,_){return Tr.isNode&&at.isBuffer(d)?(this.append(h,d.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},l))}(t,this.formSerializer).toString();if((s=at.isFileList(t))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return jv(s?{"files[]":t}:t,c&&new c,this.formSerializer)}}return r||i?(e.setContentType("application/json",!1),function(c,l,d){if(at.isString(c))try{return(l||JSON.parse)(c),Bi(at).call(at,c)}catch(h){if(h.name!=="SyntaxError")throw h}return(d||JSON.stringify)(c)}(t)):t}],transformResponse:[function(t){const e=this.transitional||fb.transitional,n=e&&e.forcedJSONParsing,i=this.responseType==="json";if(at.isResponse(t)||at.isReadableStream(t))return t;if(t&&at.isString(t)&&(n&&!this.responseType||i)){const r=!(e&&e.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(s){if(r)throw s.name==="SyntaxError"?Re.from(s,Re.ERR_BAD_RESPONSE,this,null,this.response):s}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Tr.classes.FormData,Blob:Tr.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};at.forEach(["delete","get","head","post","put","patch"],t=>{fb.headers[t]={}});var _b=fb;const Mj=at.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),DD=Symbol("internals");function VE(t){var e;return t&&Bi(e=String(t)).call(e).toLowerCase()}function Zv(t){return t===!1||t==null?t:at.isArray(t)?t.map(Zv):String(t)}function mb(t,e,n,i,r){return at.isFunction(i)?i.call(this,e,n):(r&&(e=n),at.isString(e)?at.isString(i)?e.indexOf(i)!==-1:at.isRegExp(i)?i.test(e):void 0:void 0)}class $v{constructor(e){e&&this.set(e)}set(e,n,i){const r=this;function s(d,h,p){const _=VE(h);if(!_)throw new Error("header name must be a non-empty string");const m=at.findKey(r,_);(!m||r[m]===void 0||p===!0||p===void 0&&r[m]!==!1)&&(r[m||h]=Zv(d))}const c=(d,h)=>at.forEach(d,(p,_)=>s(p,_,h));if(at.isPlainObject(e)||e instanceof this.constructor)c(e,n);else if(at.isString(e)&&(e=Bi(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Bi(l=e).call(l)))c((d=>{const h={};let p,_,m;return d&&d.split(`
`).forEach(function(g){var C,R;m=g.indexOf(":"),p=Bi(C=g.substring(0,m)).call(C).toLowerCase(),_=Bi(R=g.substring(m+1)).call(R),!p||h[p]&&Mj[p]||(p==="set-cookie"?h[p]?h[p].push(_):h[p]=[_]:h[p]=h[p]?h[p]+", "+_:_)}),h})(e),n);else if(at.isObject(e)&&at.isIterable(e)){let d,h,p={};for(const _ of e){if(!at.isArray(_))throw TypeError("Object iterator must return a key-value pair");p[h=_[0]]=(d=p[h])?at.isArray(d)?[...d,_[1]]:[d,_[1]]:_[1]}c(p,n)}else e!=null&&s(n,e,i);var l;return this}get(e,n){if(e=VE(e)){const i=at.findKey(this,e);if(i){const r=this[i];if(!n)return r;if(n===!0)return function(s){const c=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=l.exec(s);)c[d[1]]=d[2];return c}(r);if(at.isFunction(n))return n.call(this,r,i);if(at.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=VE(e)){const i=at.findKey(this,e);return!(!i||this[i]===void 0||n&&!mb(0,this[i],i,n))}return!1}delete(e,n){const i=this;let r=!1;function s(c){if(c=VE(c)){const l=at.findKey(i,c);!l||n&&!mb(0,i[l],l,n)||(delete i[l],r=!0)}}return at.isArray(e)?e.forEach(s):s(e),r}clear(e){const n=Object.keys(this);let i=n.length,r=!1;for(;i--;){const s=n[i];e&&!mb(0,this[s],s,e,!0)||(delete this[s],r=!0)}return r}normalize(e){const n=this,i={};return at.forEach(this,(r,s)=>{var c;const l=at.findKey(i,s);if(l)return n[l]=Zv(r),void delete n[s];const d=e?function(h){return Bi(h).call(h).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,_,m)=>_.toUpperCase()+m)}(s):Bi(c=String(s)).call(c);d!==s&&delete n[s],n[d]=Zv(r),i[d]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return at.forEach(this,(i,r)=>{i!=null&&i!==!1&&(n[r]=e&&at.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,i]=e;return n+": "+i}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return r.forEach(c=>n.set(c)),n}static accessor(e){const n=(this[DD]=this[DD]={accessors:{}}).accessors,i=this.prototype;function r(s){const c=VE(s);n[c]||(function(l,d){const h=at.toCamelCase(" "+d);["get","set","has"].forEach(p=>{Object.defineProperty(l,p+h,{value:function(_,m,g){return this[p].call(this,d,_,m,g)},configurable:!0})})}(i,s),n[c]=!0)}return at.isArray(e)?e.forEach(r):r(e),this}}$v.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),at.reduceDescriptors($v.prototype,(t,e)=>{let{value:n}=t,i=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(r){this[i]=r}}}),at.freezeMethods($v);var Hs=$v;function Eb(t,e){const n=this||_b,i=e||n,r=Hs.from(i.headers);let s=i.data;return at.forEach(t,function(c){s=c.call(n,s,r.normalize(),e?e.status:void 0)}),r.normalize(),s}function LD(t){return!(!t||!t.__CANCEL__)}function gf(t,e,n){Re.call(this,t??"canceled",Re.ERR_CANCELED,e,n),this.name="CanceledError"}function PD(t,e,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(new Re("Request failed with status code "+n.status,[Re.ERR_BAD_REQUEST,Re.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}at.inherits(gf,Re,{__CANCEL__:!0});const tR=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const r=function(s,c){s=s||10;const l=new Array(s),d=new Array(s);let h,p=0,_=0;return c=c!==void 0?c:1e3,function(m){const g=Date.now(),C=d[_];h||(h=g),l[p]=m,d[p]=g;let R=_,y=0;for(;R!==p;)y+=l[R++],R%=s;if(p=(p+1)%s,p===_&&(_=(_+1)%s),g-h<c)return;const b=C&&g-C;return b?Math.round(1e3*y/b):void 0}}(50,250);return function(s,c){let l,d,h=0,p=1e3/c;const _=function(m){h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,d&&(clearTimeout(d),d=null),s.apply(null,m)};return[function(){const m=Date.now(),g=m-h;for(var C=arguments.length,R=new Array(C),y=0;y<C;y++)R[y]=arguments[y];g>=p?_(R,m):(l=R,d||(d=setTimeout(()=>{d=null,_(l)},p-g)))},()=>l&&_(l)]}(s=>{const c=s.loaded,l=s.lengthComputable?s.total:void 0,d=c-i,h=r(d);i=c,t({loaded:c,total:l,progress:l?c/l:void 0,bytes:d,rate:h||void 0,estimated:h&&l&&c<=l?(l-c)/h:void 0,event:s,lengthComputable:l!=null,[e?"download":"upload"]:!0})},n)},kD=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},MD=t=>function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return at.asap(()=>t(...n))};var Uj=Tr.hasStandardBrowserEnv?((t,e)=>n=>(n=new Ov(n,Tr.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new Ov(Tr.origin),Tr.navigator&&/(msie|trident)/i.test(Tr.navigator.userAgent)):()=>!0,xj=Tr.hasStandardBrowserEnv?{write(t,e,n,i,r,s){const c=[t+"="+encodeURIComponent(e)];at.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),at.isString(i)&&c.push("path="+i),at.isString(r)&&c.push("domain="+r),s===!0&&c.push("secure"),document.cookie=c.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function UD(t,e,n){let i=!function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}(e);return t&&(i||n==0)?function(r,s){return s?r.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):r}(t,e):e}function xD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const VD=t=>t instanceof Hs?function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?xD(Object(i),!0).forEach(function(r){A(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xD(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t):t;function Ju(t,e){e=e||{};const n={};function i(h,p,_,m){return at.isPlainObject(h)&&at.isPlainObject(p)?at.merge.call({caseless:m},h,p):at.isPlainObject(p)?at.merge({},p):at.isArray(p)?p.slice():p}function r(h,p,_,m){return at.isUndefined(p)?at.isUndefined(h)?void 0:i(void 0,h,0,m):i(h,p,0,m)}function s(h,p){if(!at.isUndefined(p))return i(void 0,p)}function c(h,p){return at.isUndefined(p)?at.isUndefined(h)?void 0:i(void 0,h):i(void 0,p)}function l(h,p,_){return _ in e?i(h,p):_ in t?i(void 0,h):void 0}const d={url:s,method:s,data:s,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l,headers:(h,p,_)=>r(VD(h),VD(p),0,!0)};return at.forEach(Object.keys(Object.assign({},t,e)),function(h){const p=d[h]||r,_=p(t[h],e[h],h);at.isUndefined(_)&&p!==l||(n[h]=_)}),n}var BD=t=>{const e=Ju({},t);let n,{data:i,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:c,headers:l,auth:d}=e;if(e.headers=l=Hs.from(l),e.url=eN(UD(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),d&&l.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),at.isFormData(i)){if(Tr.hasStandardBrowserEnv||Tr.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((n=l.getContentType())!==!1){const[h,...p]=n?n.split(";").map(_=>Bi(_).call(_)).filter(Boolean):[];l.setContentType([h||"multipart/form-data",...p].join("; "))}}if(Tr.hasStandardBrowserEnv&&(r&&at.isFunction(r)&&(r=r(e)),r||r!==!1&&Uj(e.url))){const h=s&&c&&xj.read(c);h&&l.set(s,h)}return e},Vj=typeof XMLHttpRequest<"u"&&function(t){return new st(function(e,n){const i=BD(t);let r=i.data;const s=Hs.from(i.headers).normalize();let c,l,d,h,p,{responseType:_,onUploadProgress:m,onDownloadProgress:g}=i;function C(){h&&h(),p&&p(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let R=new XMLHttpRequest;function y(){if(!R)return;const I=Hs.from("getAllResponseHeaders"in R&&R.getAllResponseHeaders());PD(function(L){e(L),C()},function(L){n(L),C()},{data:_&&_!=="text"&&_!=="json"?R.response:R.responseText,status:R.status,statusText:R.statusText,headers:I,config:t,request:R}),R=null}R.open(i.method.toUpperCase(),i.url,!0),R.timeout=i.timeout,"onloadend"in R?R.onloadend=y:R.onreadystatechange=function(){R&&R.readyState===4&&(R.status!==0||R.responseURL&&R.responseURL.indexOf("file:")===0)&&setTimeout(y)},R.onabort=function(){R&&(n(new Re("Request aborted",Re.ECONNABORTED,t,R)),R=null)},R.onerror=function(){n(new Re("Network Error",Re.ERR_NETWORK,t,R)),R=null},R.ontimeout=function(){let I=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const L=i.transitional||iN;i.timeoutErrorMessage&&(I=i.timeoutErrorMessage),n(new Re(I,L.clarifyTimeoutError?Re.ETIMEDOUT:Re.ECONNABORTED,t,R)),R=null},r===void 0&&s.setContentType(null),"setRequestHeader"in R&&at.forEach(s.toJSON(),function(I,L){R.setRequestHeader(L,I)}),at.isUndefined(i.withCredentials)||(R.withCredentials=!!i.withCredentials),_&&_!=="json"&&(R.responseType=i.responseType),g&&([d,p]=tR(g,!0),R.addEventListener("progress",d)),m&&R.upload&&([l,h]=tR(m),R.upload.addEventListener("progress",l),R.upload.addEventListener("loadend",h)),(i.cancelToken||i.signal)&&(c=I=>{R&&(n(!I||I.type?new gf(null,t,R):I),R.abort(),R=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const b=function(I){const L=/^([-+\w]{1,25})(:?\/\/|:)/.exec(I);return L&&L[1]||""}(i.url);b&&Tr.protocols.indexOf(b)===-1?n(new Re("Unsupported protocol "+b+":",Re.ERR_BAD_REQUEST,t)):R.send(r||null)})},Bj=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i,r=new AbortController;const s=function(h){if(!i){i=!0,l();const p=h instanceof Error?h:this.reason;r.abort(p instanceof Re?p:new gf(p instanceof Error?p.message:p))}};let c=e&&setTimeout(()=>{c=null,s(new Re("timeout ".concat(e," of ms exceeded"),Re.ETIMEDOUT))},e);const l=()=>{t&&(c&&clearTimeout(c),c=null,t.forEach(h=>{h.unsubscribe?h.unsubscribe(s):h.removeEventListener("abort",s)}),t=null)};t.forEach(h=>h.addEventListener("abort",s));const{signal:d}=r;return d.unsubscribe=()=>at.asap(l),d}},gb=kt(xu),FD=pf.f("asyncIterator"),Fj=kt(FD);function Sb(t,e){this.v=t,this.k=e}function Oa(t){return function(){return new BE(t.apply(this,arguments))}}function BE(t){var e,n;function i(s,c){try{var l=t[s](c),d=l.value,h=d instanceof Sb;gb.resolve(h?d.v:d).then(function(p){if(h){var _=s==="return"?"return":"next";if(!d.k||p.done)return i(_,p);p=t[_](p).value}r(l.done?"return":"normal",p)},function(p){i("throw",p)})}catch(p){r("throw",p)}}function r(s,c){switch(s){case"return":e.resolve({value:c,done:!0});break;case"throw":e.reject(c);break;default:e.resolve({value:c,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(s,c){return new gb(function(l,d){var h={key:s,arg:c,resolve:l,reject:d,next:null};n?n=n.next=h:(e=n=h,i(s,c))})},typeof t.return!="function"&&(this.return=void 0)}function re(t){return new Sb(t,0)}function eR(t){var e={},n=!1;function i(r,s){return n=!0,s=new gb(function(c){c(t[r](s))}),{done:!1,value:new Sb(s,1)}}return e[Ef!==void 0&&fD||"@@iterator"]=function(){return this},e.next=function(r){return n?(n=!1,r):i("next",r)},typeof t.throw=="function"&&(e.throw=function(r){if(n)throw n=!1,r;return i("throw",r)}),typeof t.return=="function"&&(e.return=function(r){return n?(n=!1,r):i("return",r)}),e}BE.prototype[typeof Ef=="function"&&Fj||"@@asyncIterator"]=function(){return this},BE.prototype.next=function(t){return this._invoke("next",t)},BE.prototype.throw=function(t){return this._invoke("throw",t)},BE.prototype.return=function(t){return this._invoke("return",t)};var Tb=kt(FD);function vb(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=Tb,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new nR(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function nR(t){function e(n){if(Object(n)!==n)return st.reject(new TypeError(n+" is not an object."));var i=n.done;return st.resolve(n.value).then(function(r){return{value:r,done:i}})}return nR=function(n){this.s=n,this.n=n.next},nR.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?st.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?st.reject(n):e(i.apply(this.s,arguments))}},new nR(t)}const jj=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let i,r=0;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},Gj=function(){var t=Oa(function*(e,n){var i,r=!1,s=!1;try{for(var c,l=vb(Hj(e));r=!(c=yield re(l.next())).done;r=!1){const d=c.value;yield*eR(vb(jj(d,n)))}}catch(d){s=!0,i=d}finally{try{r&&l.return!=null&&(yield re(l.return()))}finally{if(s)throw i}}});return function(e,n){return t.apply(this,arguments)}}(),Hj=function(){var t=Oa(function*(e){if(e[Tb])return void(yield*eR(vb(e)));const n=e.getReader();try{for(;;){const{done:i,value:r}=yield re(n.read());if(i)break;yield r}}finally{yield re(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),jD=(t,e,n,i)=>{const r=Gj(t,e);let s,c=0,l=d=>{s||(s=!0,i&&i(d))};return new ReadableStream({async pull(d){try{const{done:h,value:p}=await r.next();if(h)return l(),void d.close();let _=p.byteLength;if(n){let m=c+=_;n(m)}d.enqueue(new Uint8Array(p))}catch(h){throw l(h),h}},cancel:d=>(l(d),r.return())},{highWaterMark:2})};function GD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function HD(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?GD(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GD(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const iR=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",WD=iR&&typeof ReadableStream=="function",Wj=iR&&(typeof TextEncoder=="function"?(KD=new TextEncoder,t=>KD.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var KD;const zD=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return!!t(...n)}catch{return!1}},Kj=WD&&zD(()=>{let t=!1;const e=new Request(Tr.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),Rb=WD&&zD(()=>at.isReadableStream(new Response("").body)),rR={stream:Rb&&(t=>t.body)};var YD;iR&&(YD=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!rR[t]&&(rR[t]=at.isFunction(YD[t])?e=>e[t]():(e,n)=>{throw new Re("Response type '".concat(t,"' is not supported"),Re.ERR_NOT_SUPPORT,n)})}));const zj=async(t,e)=>{const n=at.toFiniteNumber(t.getContentLength());return n??(async i=>i==null?0:at.isBlob(i)?i.size:at.isSpecCompliantForm(i)?(await new Request(Tr.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:at.isArrayBufferView(i)||at.isArrayBuffer(i)?i.byteLength:(at.isURLSearchParams(i)&&(i+=""),at.isString(i)?(await Wj(i)).byteLength:void 0))(e)};var Yj=iR&&(async t=>{let{url:e,method:n,data:i,signal:r,cancelToken:s,timeout:c,onDownloadProgress:l,onUploadProgress:d,responseType:h,headers:p,withCredentials:_="same-origin",fetchOptions:m}=BD(t);h=h?(h+"").toLowerCase():"text";let g,C=Bj([r,s&&s.toAbortSignal()],c);const R=C&&C.unsubscribe&&(()=>{C.unsubscribe()});let y;try{if(d&&Kj&&n!=="get"&&n!=="head"&&(y=await zj(p,i))!==0){let x,M=new Request(e,{method:"POST",body:i,duplex:"half"});if(at.isFormData(i)&&(x=M.headers.get("content-type"))&&p.setContentType(x),M.body){const[j,K]=kD(y,tR(MD(d)));i=jD(M.body,65536,j,K)}}at.isString(_)||(_=_?"include":"omit");const b="credentials"in Request.prototype;g=new Request(e,HD(HD({},m),{},{signal:C,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:i,duplex:"half",credentials:b?_:void 0}));let I=await fetch(g);const L=Rb&&(h==="stream"||h==="response");if(Rb&&(l||L&&R)){const x={};["status","statusText","headers"].forEach(it=>{x[it]=I[it]});const M=at.toFiniteNumber(I.headers.get("content-length")),[j,K]=l&&kD(M,tR(MD(l),!0))||[];I=new Response(jD(I.body,65536,j,()=>{K&&K(),R&&R()}),x)}h=h||"text";let U=await rR[at.findKey(rR,h)||"text"](I,t);return!L&&R&&R(),await new st((x,M)=>{PD(x,M,{data:U,headers:Hs.from(I.headers),status:I.status,statusText:I.statusText,config:t,request:g})})}catch(b){throw R&&R(),b&&b.name==="TypeError"&&/Load failed|fetch/i.test(b.message)?Object.assign(new Re("Network Error",Re.ERR_NETWORK,t,g),{cause:b.cause||b}):Re.from(b,b&&b.code,t,g)}});const yb={http:null,xhr:Vj,fetch:Yj};at.forEach(yb,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const qD=t=>"- ".concat(t),qj=t=>at.isFunction(t)||t===null||t===!1;var XD={getAdapter:t=>{t=at.isArray(t)?t:[t];const{length:e}=t;let n,i;const r={};for(let s=0;s<e;s++){let c;if(n=t[s],i=n,!qj(n)&&(i=yb[(c=String(n)).toLowerCase()],i===void 0))throw new Re("Unknown adapter '".concat(c,"'"));if(i)break;r[c||"#"+s]=i}if(!i){const s=Object.entries(r).map(c=>{let[l,d]=c;return"adapter ".concat(l," ")+(d===!1?"is not supported by the environment":"is not available in the build")});throw new Re("There is no suitable adapter to dispatch the request "+(e?s.length>1?`since :
`+s.map(qD).join(`
`):" "+qD(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:yb};function Cb(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new gf(null,t)}function JD(t){return Cb(t),t.headers=Hs.from(t.headers),t.data=Eb.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),XD.getAdapter(t.adapter||_b.adapter)(t).then(function(e){return Cb(t),e.data=Eb.call(t,t.transformResponse,e),e.headers=Hs.from(e.headers),e},function(e){return LD(e)||(Cb(t),e&&e.response&&(e.response.data=Eb.call(t,t.transformResponse,e.response),e.response.headers=Hs.from(e.response.headers))),st.reject(e)})}const QD="1.9.0",aR={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{aR[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const ZD={};aR.transitional=function(t,e,n){function i(r,s){return"[Axios v"+QD+"] Transitional option '"+r+"'"+s+(n?". "+n:"")}return(r,s,c)=>{if(t===!1)throw new Re(i(s," has been removed"+(e?" in "+e:"")),Re.ERR_DEPRECATED);return e&&!ZD[s]&&(ZD[s]=!0,console.warn(i(s," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,s,c)}},aR.spelling=function(t){return(e,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(t)),!0)};var sR={assertOptions:function(t,e,n){if(typeof t!="object")throw new Re("options must be an object",Re.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let r=i.length;for(;r-- >0;){const s=i[r],c=e[s];if(c){const l=t[s],d=l===void 0||c(l,s,t);if(d!==!0)throw new Re("option "+s+" must be "+d,Re.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Re("Unknown option "+s,Re.ERR_BAD_OPTION)}},validators:aR};const xo=sR.validators;let oR=class{constructor(t){this.defaults=t||{},this.interceptors={request:new nN,response:new nN}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?r&&!String(n.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+r):n.stack=r}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=Ju(this.defaults,e);const{transitional:n,paramsSerializer:i,headers:r}=e;n!==void 0&&sR.assertOptions(n,{silentJSONParsing:xo.transitional(xo.boolean),forcedJSONParsing:xo.transitional(xo.boolean),clarifyTimeoutError:xo.transitional(xo.boolean)},!1),i!=null&&(at.isFunction(i)?e.paramsSerializer={serialize:i}:sR.assertOptions(i,{encode:xo.function,serialize:xo.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),sR.assertOptions(e,{baseUrl:xo.spelling("baseURL"),withXsrfToken:xo.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=r&&at.merge(r.common,r[e.method]);r&&at.forEach(["delete","get","head","post","put","patch","common"],g=>{delete r[g]}),e.headers=Hs.concat(s,r);const c=[];let l=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(e)===!1||(l=l&&g.synchronous,c.unshift(g.fulfilled,g.rejected))});const d=[];let h;this.interceptors.response.forEach(function(g){d.push(g.fulfilled,g.rejected)});let p,_=0;if(!l){const g=[JD.bind(this),void 0];for(g.unshift.apply(g,c),g.push.apply(g,d),p=g.length,h=st.resolve(e);_<p;)h=h.then(g[_++],g[_++]);return h}p=c.length;let m=e;for(_=0;_<p;){const g=c[_++],C=c[_++];try{m=g(m)}catch(R){C.call(this,R);break}}try{h=JD.call(this,m)}catch(g){return st.reject(g)}for(_=0,p=d.length;_<p;)h=h.then(d[_++],d[_++]);return h}getUri(t){return eN(UD((t=Ju(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};at.forEach(["delete","get","head","options"],function(t){oR.prototype[t]=function(e,n){return this.request(Ju(n||{},{method:t,url:e,data:(n||{}).data}))}}),at.forEach(["post","put","patch"],function(t){function e(n){return function(i,r,s){return this.request(Ju(s||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:r}))}}oR.prototype[t]=e(),oR.prototype[t+"Form"]=e(!0)});var cR=oR;class Ab{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new st(function(r){n=r});const i=this;this.promise.then(r=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](r);i._listeners=null}),this.promise.then=r=>{let s;const c=new st(l=>{i.subscribe(l),s=l}).then(r);return c.cancel=function(){i.unsubscribe(s)},c},e(function(r,s,c){i.reason||(i.reason=new gf(r,s,c),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new Ab(function(i){e=i}),cancel:e}}}var Xj=Ab;const bb={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(bb).forEach(t=>{let[e,n]=t;bb[n]=e});var Jj=bb;const Di=function t(e){const n=new cR(e),i=Vw(cR.prototype.request,n);return at.extend(i,cR.prototype,n,{allOwnKeys:!0}),at.extend(i,n,null,{allOwnKeys:!0}),i.create=function(r){return t(Ju(e,r))},i}(_b);Di.Axios=cR,Di.CanceledError=gf,Di.CancelToken=Xj,Di.isCancel=LD,Di.VERSION=QD,Di.toFormData=jv,Di.AxiosError=Re,Di.Cancel=Di.CanceledError,Di.all=function(t){return st.all(t)},Di.spread=function(t){return function(e){return t.apply(null,e)}},Di.isAxiosError=function(t){return at.isObject(t)&&t.isAxiosError===!0},Di.mergeConfig=Ju,Di.AxiosHeaders=Hs,Di.formToJSON=t=>ND(at.isHTMLForm(t)?new FormData(t):t),Di.getAdapter=XD.getAdapter,Di.HttpStatusCode=Jj,Di.default=Di;var sr=Di;const Qj=()=>{};function FE(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Qj};return t.promise=new st((e,n)=>{t.resolve=i=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(i),t.value=i)},t.reject=i=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(i))}}),t}const lR=new Map,dR=new Map,Vo=new Map;let Fn=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),de=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const $D=new IB;let Ws=$D.getResult(),Ib=null;function ae(t){if(!Ib){Ws=$D.getResult();const e=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return de.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return de.CHROME;case"Safari":case"Mobile Safari":return de.SAFARI;case"Edge":return de.EDGE;case"Firefox":return de.FIREFOX;case"QQ":case"QQBrowser":return de.QQ;case"Opera":return de.OPERA;case"WeChat":return de.WECHAT;default:return l.browser.name||""}}(Ws),n=tL(Ws),i=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}(Ws),r=Ws.os.version,s=tL(Ws,!1),c=Ws.device.type;if(!(e&&n&&i&&r))return{name:e,version:n,os:i,osVersion:r,browserVersion:s,deviceType:c};Ib={name:e,version:n,os:i,osVersion:r,browserVersion:s,deviceType:c}}return Ib}function tL(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function uR(){return ae().os}function eL(){const t=ae();return"".concat(t.os," ").concat(t.osVersion)}function hR(){const t=ae();return!!(Ws.engine.name==="WebKit"&&t.os===Fn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==de.SAFARI||qi()&&t.name!==de.SAFARI)}function jc(){return ae().name===de.CHROME}function li(){return ae().name===de.SAFARI}function nL(){return ae().name===de.EDGE}function en(){return ae().name===de.FIREFOX}function qi(){return ae().os===Fn.IOS}function jE(t){const e=ae();return!(e.name!==de.CHROME||!e.osVersion)&&Number(e.version)>=t}function iL(t){const e=ae();return!(e.name!==de.CHROME||!e.osVersion)&&Number(e.version)<t}function Ob(t,e,n){const i=ae();return!(i.name!==t||!i.osVersion)&&(n?Number(i.version)>=e&&Number(i.version)<=n:Number(i.version)===e)}function wb(t){const e=ae();return!(e.name!==de.EDGE||!e.osVersion)&&Number(e.version)>=t}function rL(t){const e=ae();return!(e.name!==de.SAFARI||!e.osVersion)&&Number(e.version)>=t}function aL(t,e,n){const i=ae();if(i.os!==Fn.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t}function sL(t,e,n){const i=ae();if(i.name!==de.SAFARI||!i.osVersion||!i.browserVersion)return!1;const r=i.browserVersion.split(".");return n?e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t:e?Number(r[0])===t&&Number(r[1])<=e||Number(r[0])<t:Number(r[0])<=t}function Nb(t){const e=ae();return!(e.name!==de.OPERA||!e.osVersion)&&Number(e.version)>=t}function oL(){const t=ae();if(t.os!==Fn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function Sf(){const t=ae();if(t.os!==Fn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function Db(){const t=ae();if(t.os!==Fn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function cL(){const t=ae();if(t.os!==Fn.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function ss(){return li()&&navigator.maxTouchPoints>0}function lL(){return ae().name===de.WECHAT}function dL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Lb(){const t=uR();return function(){const{deviceType:e}=ae();return e==="mobile"||e==="tablet"}()||t===Fn.ANDROID||t===Fn.IOS||t===Fn.HARMONY_OS}function Gc(){const t=ae();return t.name!==de.EDGE&&t.name!==de.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function pR(){return uR()===Fn.ANDROID}function GE(){const t=ae();return pR()&&(t.name===de.CHROME||t.name===de.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Lt(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function uL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ht(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?uL(Object(n),!0).forEach(function(i){Lt(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):uL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let O=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),G=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),Lt(this,"code",void 0),Lt(this,"message",void 0),Lt(this,"data",void 0),Lt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Hc(t,e){if(typeof t!="boolean")throw new G(O.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function xn(t,e,n){if(!rt(n).call(n,t))throw new G(O.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function ye(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(r){return typeof r=="number"&&r%1==0}(t))throw new G(O.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function Pb(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new G(O.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&ye(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&ye(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&ye(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&ye(t.ideal,"".concat(e,".ideal"),1,1/0)}else ye(t,e,1,1/0)}function ei(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,r=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new G(O.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!hL(t,n,i,r))throw new G(O.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function Wc(t,e){if(!Array.isArray(t))throw new G(O.INVALID_PARAMS,"".concat(e," should be an array"))}function nn(t){return t==null}function hL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!i||function(r){if(typeof r!="string")return!1;for(let s=0;s<r.length;s+=1){const c=r.charCodeAt(s);if(c<0||c>255)return!1}return!0}(t))}var HE=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(HE||{}),kb=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(kb||{});const pL=new class{constructor(){Lt(this,"_clientSize",null),Lt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Lt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Lt(this,"getStyle",t=>window.getComputedStyle(t,null)),Lt(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const i=this.getStyle(t),{display:r,visibility:s,opacity:c,filter:l}=i;return(r==="none"||rt(e=["hidden","collapse"]).call(e,s)||Number(c)<.1)&&(n=!1),!!n&&(l&&l.split(" ").filter(d=>{var h;const p=d.split("(")[0];return rt(h=["brightness","blur","opacity"]).call(h,p)}).map(d=>{const[h,p]=d.split(/\(|\)/);return[h,Number(p.match(/^[0-9\.]+/))]}).forEach(d=>{const[h,p]=d;switch(h){case"brightness":(p<.1||p>3)&&(n=!1);break;case"blur":p>3&&(n=!1);break;case"opacity":p<.1&&(n=!1)}}),n)}),Lt(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,i=!0;const r=c=>e(c);let s=t;for(;s&&i;)r(s)||(n=!1,i=!1),s=s.parentElement,s||(i=!1);return n}),Lt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Lt(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:i,right:r,top:s,bottom:c}=t.getBoundingClientRect(),l=this.getClientWidth(),d=this.getClientHeight();return{width:e,height:n,left:i,right:r,top:s,bottom:c,clientWidth:l,clientHeight:d,clientMin:Math.min(l,d)}}),Lt(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),Lt(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),Lt(this,"checkCoverForAPoint",(t,e,n)=>{const i=this.elementFromPoint(t,e);return i!==null&&i!==n}),Lt(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:i}=this._clientSize,r=t/6,s=e/6,c=[],l=10**6;for(let d=0;d<5;d++)for(let h=0;h<5;h++){const p=(n*l+(d===0?.1:d===4?(r*d*l-1e5)/l:r*d)*l)/l,_=(i*l+(h===0?.1:h===4?(s*h*l-1e5)/l:s*h)*l)/l;c.push({x:p,y:_})}return[...c]}),Lt(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),Lt(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),Lt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:i,clientHeight:r,clientWidth:s,clientMin:c}=this._clientSize;let l,d,h,p;if(t<0)l=0;else{if(!(t<s))return!1;l=t}if(e<0)return!1;if(d=e<s?e:s,n<0)h=0;else{if(!(n<r))return!1;h=n}if(i<0)return!1;p=i<r?i:r;const _=d-l,m=p-h;return this.checkSizeIsVisible(_,m,c)}),Lt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Lt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(HE.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(HE.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(HE.SIZE)}}return this.returnHiddenResult(HE.STYLE)}return this.returnHiddenResult(kb.UNMOUNTED)}return this.returnHiddenResult(kb.INVALID_HTML_ELEMENT)}),Lt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function Mb(t){return new TextEncoder().encode(t)}const fL=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},Ub=async t=>function(e,n){let i="";return new Uint8Array(e).forEach(r=>{i+=r.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",Mb(t)),16);let Xe=class{constructor(){Lt(this,"_events",{}),Lt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],i=this._indexOfListener(n,e);i!==-1&&n.splice(i,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(s=>s);for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(let s=0;s<e.length;s+=1){const c=e[s];c.once&&this.off(t,c.listener),c.listener.apply(this,i||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];[...this._events[t]||[]].forEach(r=>{r.once&&this.off(t,r.listener);try{r.listener.apply(this,n)}catch(s){console.error("safeEmit event:".concat(t," error ").concat(s==null?void 0:s.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},WE=null;function _L(){if(WE)return WE;if(window.electron)return WE=window.electron;if(!window.require)return null;try{return WE=window.require("electron"),WE}catch{return null}}let vn=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),rn=function(t){return t.TRACER="tracer",t}({});function mL(t){return ye(t.timeout,"config.timeout",0,1e5),ye(t.timeoutFactor,"config.timeoutFactor",0,100,!1),ye(t.maxRetryCount,"config.maxRetryConfig",0,1/0),ye(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Zj=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),_e=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function KE(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function EL(t){return ei(t.turnServerURL,"turnServerURL"),ei(t.username,"username"),ei(t.password,"password"),t.udpport&&ye(t.udpport,"udpport",1,99999,!0),t.forceturn&&Hc(t.forceturn,"forceturn"),t.security&&Hc(t.security,"security"),t.tcpport&&ye(t.tcpport,"tcpport",1,99999,!0),!0}function xb(t){return t.level!==void 0&&xn(t.level,"level",[1,2,3]),t.delay!==void 0&&ye(t.delay,"delay",0,3e3,!0),!0}let qt=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),di=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Fr=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Tf=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function ui(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return t.getListeners(e).length===0?st.reject(new G(O.UNEXPECTED_ERROR,"can not emit promise")):new st((s,c)=>{t.emit(e,...i,s,c)})}function Ie(t,e){if(t.getListeners(e).length===0)return st.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return ui(t,e,...i)}function ea(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return zE(t,e,...i)}function zE(t,e){let n=null,i=null;for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];if(t.emit(e,...s,l=>{n=l},l=>{i=l}),i!==null)throw i;if(n===null)throw new G(O.UNEXPECTED_ERROR,"handler is not sync");return n}const Rn=new class extends Xe{set networkState(t){this.emit(Tf.NETWORK_STATE_CHANGE,t,this._networkState),t===Fr.ONLINE?this.emit(Tf.ONLINE):t===Fr.OFFLINE&&(this.onlineWaiter=new st(e=>{this.once(Tf.ONLINE,()=>{this.onlineWaiter=void 0,e(Fr.ONLINE)})}),this.emit(Tf.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Fr.ONLINE}constructor(){super(),Lt(this,"_moduleName","network-indicator"),Lt(this,"_networkState",Fr.ONLINE),Lt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Fr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Fr.OFFLINE})}};function fR(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function vf(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function _R(t){st!==void 0?st.resolve().then(t):setTimeout(t,0)}function Je(t){return JSON.parse(JSON.stringify(t))}function Qu(t){try{return Je(t)}catch{return t}}const gL={};function ud(t,e){gL[e]||(gL[e]=!0,t())}function Zu(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i+=1)n[i]=e.charCodeAt(i);return n}function hd(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function SL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const i=new Uint8Array(e);i.set(n),n=i}return n}function TL(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=_r(e).call(e,(c,l)=>c+l.length,0),r=new Uint8Array(new ArrayBuffer(i));let s=0;return e.forEach(c=>{r.set(c,s),s+=c.length}),r}function Bo(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function vL(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?Bo(n):n.size}),e+138}function $j(t){const e=new G(O.TIMEOUT,"timeout");return new st((n,i)=>{window.setTimeout(()=>i(e),t)})}function ni(t){return new st(e=>{window.setTimeout(e,t)})}function Le(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+Le(t-n.length,"")}function $u(){return Le(32,"").toUpperCase()}const mR=()=>{},RL=new class{constructor(){Lt(this,"fnMap",new Map)}throttleByKey(t,e,n,i){for(var r=arguments.length,s=new Array(r>4?r-4:0),c=4;c<r;c++)s[c-4]=arguments[c];if(this.fnMap.has(e)){const l=this.fnMap.get(e);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const d=window.setTimeout(()=>{const h=this.fnMap.get(e);h&&h.fn(...h.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:d,args:s,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(e,ht(ht({},l),{},{fn:t,args:s,skipFn:i}))}else{const l=window.setTimeout(()=>{const d=this.fnMap.get(e);d&&d.fn(...d.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:l,args:s,skipFn:i})}}},yL=RL.throttleByKey.bind(RL);function CL(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function Vb(t,e){if(!CL(t)||!CL(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let i=0;i<e.length;i++)n[i]=Vb(t[i],e[i]);return n}{const n=ht({},t);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)?n[i]=Vb(t[i],e[i]):n[i]=e[i]);return n}}function AL(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let i=0;for(;t>0&&(n[i]=255&t,t>>=8,i++,i!==e););return n}function Bb(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function Fb(t){return _r(t).call(t,(e,n)=>e+n,0)}function bL(t){const e="0123456789abcdef";function n(L){let U,x="";for(U=0;U<=3;U++)x+=e.charAt(L>>8*U+4&15)+e.charAt(L>>8*U&15);return x}function i(L,U){const x=(65535&L)+(65535&U);return(L>>16)+(U>>16)+(x>>16)<<16|65535&x}function r(L,U,x,M,j,K){return i(function(it,dt){return it<<dt|it>>>32-dt}(i(i(U,L),i(M,K)),j),x)}function s(L,U,x,M,j,K,it){return r(U&x|~U&M,L,U,j,K,it)}function c(L,U,x,M,j,K,it){return r(U&M|x&~M,L,U,j,K,it)}function l(L,U,x,M,j,K,it){return r(U^x^M,L,U,j,K,it)}function d(L,U,x,M,j,K,it){return r(x^(U|~M),L,U,j,K,it)}const h=function(L){let U;const x=1+(L.length+8>>6),M=new Array(16*x);for(U=0;U<16*x;U++)M[U]=0;for(U=0;U<L.length;U++)M[U>>2]|=L.charCodeAt(U)<<U%4*8;return M[U>>2]|=128<<U%4*8,M[16*x-2]=8*L.length,M}(t);let p,_,m,g,C,R=1732584193,y=-271733879,b=-1732584194,I=271733878;for(p=0;p<h.length;p+=16)_=R,m=y,g=b,C=I,R=s(R,y,b,I,h[p+0],7,-680876936),I=s(I,R,y,b,h[p+1],12,-389564586),b=s(b,I,R,y,h[p+2],17,606105819),y=s(y,b,I,R,h[p+3],22,-1044525330),R=s(R,y,b,I,h[p+4],7,-176418897),I=s(I,R,y,b,h[p+5],12,1200080426),b=s(b,I,R,y,h[p+6],17,-1473231341),y=s(y,b,I,R,h[p+7],22,-45705983),R=s(R,y,b,I,h[p+8],7,1770035416),I=s(I,R,y,b,h[p+9],12,-1958414417),b=s(b,I,R,y,h[p+10],17,-42063),y=s(y,b,I,R,h[p+11],22,-1990404162),R=s(R,y,b,I,h[p+12],7,1804603682),I=s(I,R,y,b,h[p+13],12,-40341101),b=s(b,I,R,y,h[p+14],17,-1502002290),y=s(y,b,I,R,h[p+15],22,1236535329),R=c(R,y,b,I,h[p+1],5,-165796510),I=c(I,R,y,b,h[p+6],9,-1069501632),b=c(b,I,R,y,h[p+11],14,643717713),y=c(y,b,I,R,h[p+0],20,-373897302),R=c(R,y,b,I,h[p+5],5,-701558691),I=c(I,R,y,b,h[p+10],9,38016083),b=c(b,I,R,y,h[p+15],14,-660478335),y=c(y,b,I,R,h[p+4],20,-405537848),R=c(R,y,b,I,h[p+9],5,568446438),I=c(I,R,y,b,h[p+14],9,-1019803690),b=c(b,I,R,y,h[p+3],14,-187363961),y=c(y,b,I,R,h[p+8],20,1163531501),R=c(R,y,b,I,h[p+13],5,-1444681467),I=c(I,R,y,b,h[p+2],9,-51403784),b=c(b,I,R,y,h[p+7],14,1735328473),y=c(y,b,I,R,h[p+12],20,-1926607734),R=l(R,y,b,I,h[p+5],4,-378558),I=l(I,R,y,b,h[p+8],11,-2022574463),b=l(b,I,R,y,h[p+11],16,1839030562),y=l(y,b,I,R,h[p+14],23,-35309556),R=l(R,y,b,I,h[p+1],4,-1530992060),I=l(I,R,y,b,h[p+4],11,1272893353),b=l(b,I,R,y,h[p+7],16,-155497632),y=l(y,b,I,R,h[p+10],23,-1094730640),R=l(R,y,b,I,h[p+13],4,681279174),I=l(I,R,y,b,h[p+0],11,-358537222),b=l(b,I,R,y,h[p+3],16,-722521979),y=l(y,b,I,R,h[p+6],23,76029189),R=l(R,y,b,I,h[p+9],4,-640364487),I=l(I,R,y,b,h[p+12],11,-421815835),b=l(b,I,R,y,h[p+15],16,530742520),y=l(y,b,I,R,h[p+2],23,-995338651),R=d(R,y,b,I,h[p+0],6,-198630844),I=d(I,R,y,b,h[p+7],10,1126891415),b=d(b,I,R,y,h[p+14],15,-1416354905),y=d(y,b,I,R,h[p+5],21,-57434055),R=d(R,y,b,I,h[p+12],6,1700485571),I=d(I,R,y,b,h[p+3],10,-1894986606),b=d(b,I,R,y,h[p+10],15,-1051523),y=d(y,b,I,R,h[p+1],21,-2054922799),R=d(R,y,b,I,h[p+8],6,1873313359),I=d(I,R,y,b,h[p+15],10,-30611744),b=d(b,I,R,y,h[p+6],15,-1560198380),y=d(y,b,I,R,h[p+13],21,1309151649),R=d(R,y,b,I,h[p+4],6,-145523070),I=d(I,R,y,b,h[p+11],10,-1120210379),b=d(b,I,R,y,h[p+2],15,718787259),y=d(y,b,I,R,h[p+9],21,-343485551),R=i(R,_),y=i(y,m),b=i(b,g),I=i(I,C);return n(R)+n(y)+n(b)+n(I)}let t4=1,IL=console,Ti=class{static setLogger(t){IL=t}constructor(t,e){Lt(this,"id",void 0),Lt(this,"lockingPromise",st.resolve()),Lt(this,"locks",0),Lt(this,"name",""),Lt(this,"lockId",void 0),this.lockId=t4++,t&&(this.name=t),e&&(this.id=e),this.logger("created")}logger(t,e){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(e??"");IL.debug("".concat(n," ").concat(i))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,this.logger("locked",t);const n=new st(r=>{e=()=>{this.locks-=1,this.logger("unlocked",t),r()}}),i=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),i}};function Rf(t,e){return function(n,i,r){const s=r.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){const c=this[e];if(!c)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const l=await c.lock("From ".concat(t,".").concat(i));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await s.apply(this,h)}finally{l()}},r}}const In={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function jb(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function Ks(t,e,n,i){const r=Object.assign({},In,i);let s=r.timeout;const c=async()=>{await function(h){return new st(p=>{window.setTimeout(p,h)})}(s),s*=r.timeoutFactor,s=Math.min(r.maxRetryTimeout,s)};let l=!1;const d=new st(async(h,p)=>{e=e||(()=>!1),n=n||(()=>!0);for(let _=0;_<r.maxRetryCount;_+=1){if(l)return p(new G(O.OPERATION_ABORTED));try{const m=await t();if(!e(m,_)||_+1===r.maxRetryCount)return h(m);await c()}catch(m){if(!n(m,_)||_+1===r.maxRetryCount)return p(m);await c()}}});return d.cancel=()=>l=!0,d}let ER,OL=class{constructor(t){Lt(this,"input",[]),Lt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:_r(t=this.input).call(t,(e,n)=>e+n)/this.input.length}},gR=0,Gb=0;function Hb(t,e,n,i){return new st((r,s)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),gR+=Bo(e.data)):n&&(e.data.size?gR+=e.data.size:e.data instanceof FormData?gR+=vL(e.data):gR+=Bo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,sr.request(e).then(c=>{typeof c.data=="string"?Gb+=Bo(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?Gb+=c.data.byteLength:Gb+=Bo(JSON.stringify(c.data)),r(c.data)}).catch(c=>{sr.isCancel(c)?s(new G(O.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new G(O.NETWORK_TIMEOUT,c.message)):c.response?s(new G(O.NETWORK_RESPONSE_ERROR,c.response.status)):s(new G(O.NETWORK_ERROR,c.message))})})}async function e4(t,e){const n=new Blob([e.data],{type:"buffer"});return await Hb(t,ht(ht({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const wL=()=>window.isSecureContext!==void 0;function os(t){if(Array.isArray(t))return t.map(n=>n);if(!NL(t))return t;const e={};for(const n in t){const i=t[n];NL(i)||Array.isArray(i)?e[n]=os(i):e[n]=i}return e}function NL(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let Wb=class{constructor(t){Lt(this,"input",[]),Lt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Fo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},YE={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Fo,remoteCandidate:Fo},updateInterval:0},DL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},LL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},PL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},kL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let Kb=class{constructor(t,e){Lt(this,"onFirstVideoReceived",void 0),Lt(this,"onFirstVideoDecoded",void 0),Lt(this,"onFirstAudioReceived",void 0),Lt(this,"onFirstVideoDecodedTimeout",void 0),Lt(this,"onFirstAudioDecoded",void 0),Lt(this,"onSelectedLocalCandidateChanged",void 0),Lt(this,"onSelectedRemoteCandidateChanged",void 0),Lt(this,"videoIsReady",!1),Lt(this,"videoIsReady2",{}),Lt(this,"pc",void 0),Lt(this,"options",void 0),Lt(this,"intervalTimer",void 0),Lt(this,"stats",os(YE)),Lt(this,"isFirstVideoReceived",{}),Lt(this,"isFirstVideoDecoded",{}),Lt(this,"isFirstAudioReceived",{}),Lt(this,"isFirstAudioDecoded",{}),Lt(this,"isFirstVideoDecodedTimeout",{}),Lt(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new st(t=>{t({local:ht({},Fo),remote:ht({},Fo)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,r=0,s=0,c=0;for(const l of n)t[l].forEach((d,h)=>{if(!this.lossRateWindowStats[e-1][l][h]||!this.lossRateWindowStats[0][l][h])return;const p=this.lossRateWindowStats[e-1][l][h].packets-this.lossRateWindowStats[0][l][h].packets,_=this.lossRateWindowStats[e-1][l][h].packetsLost-this.lossRateWindowStats[0][l][h].packetsLost;l==="videoSend"||l==="audioSend"?(i+=p,s+=_):(r+=p,c+=_),Number.isNaN(p)||Number.isNaN(p)?d.packetLostRate=0:d.packetLostRate=p<=0||_<=0?0:_/(p+_)});t.sendPacketLossRate=i<=0||s<=0?0:s/(i+s),t.recvPacketLossRate=r<=0||c<=0?0:c/(r+c)}},n4=class extends Kb{constructor(){super(...arguments),Lt(this,"_stats",YE),Lt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=os(YE);const n=e.filter(r=>r.type==="ssrc");this.processSSRCStats(n);const i=e.find(r=>r.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(e=>{var n;const i=rt(n=e.id).call(n,"send");switch("".concat(e.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const r=os(LL);r.codec=e.googCodecName,r.adaptionChangeReason="none",e.googCpuLimitedResolution&&(r.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(r.adaptionChangeReason="bandwidth"),r.avgEncodeMs=Number(e.googAvgEncodeMs),r.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},r.firsCount=Number(e.googFirReceived),r.nacksCount=Number(e.googNacksReceived),r.plisCount=Number(e.googPlisReceived),r.frameCount=Number(e.framesEncoded),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(r),this._stats.rtt=r.rttMs;break}case"video_recv":{const r=os(DL),s=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(r.codec=e.googCodecName,r.targetDelayMs=Number(e.googTargetDelayMs),r.renderDelayMs=Number(e.googRenderDelayMs),r.currentDelayMs=Number(e.googCurrentDelayMs),r.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),r.decodeMs=Number(e.googDecodeMs),r.maxDecodeMs=Number(e.googMaxDecodeMs),r.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},r.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},r.decodeFrameRate=Number(e.googFrameRateDecoded),r.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},r.jitterBufferMs=Number(e.googJitterBufferMs),r.firsCount=Number(e.googFirsSent),r.nacksCount=Number(e.googNacksSent),r.plisCount=Number(e.googPlisSent),r.framesDecodeCount=Number(e.framesDecoded),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,r.decodedFrame.width,r.decodedFrame.height),this.isFirstVideoDecoded[r.ssrc]=!0),s){const c=s.stats,l=Date.now()-s.lts;r.framesDecodeFreezeTime=c.framesDecodeFreezeTime,r.framesDecodeInterval=c.framesDecodeInterval,r.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=l,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<s.stats.framesDecodeCount&&(r.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:ht({},r),lts:Date.now()}),this._stats.videoRecv.push(r);break}case"audio_recv":{const r=os(kL);r.codec=e.googCodecName,r.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,r.decodingCNG=Number(e.googDecodingCNG),r.decodingCTN=Number(e.googDecodingCTN),r.decodingCTSG=Number(e.googDecodingCTSG),r.decodingNormal=Number(e.googDecodingNormal),r.decodingPLC=Number(e.googDecodingPLC),r.decodingPLCCNG=Number(e.googDecodingPLCCNG),r.expandRate=Number(e.googExpandRate),r.accelerateRate=Number(e.googAccelerateRate),r.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),r.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),r.speechExpandRate=Number(e.googSpeechExpandRate),r.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),r.jitterBufferMs=Number(e.googJitterBufferMs),r.jitterMs=Number(e.googJitterReceived),r.bytes=Number(e.bytesReceived),r.packets=Number(e.packetsReceived),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),r.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.decodingNormal>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),this._stats.audioRecv.push(r);break}case"audio_send":{const r=os(PL);r.codec=e.googCodecName,r.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,r.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),r.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),r.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),r.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),r.bytes=Number(e.bytesSent),r.packets=Number(e.packetsSent),r.packetsLost=Number(e.packetsLost),r.ssrc=Number(e.ssrc),r.rttMs=Number(e.googRtt||0),this._stats.rtt=r.rttMs,this._stats.audioSend.push(r);break}}})}_getStats(){return new st((t,e)=>{this.pc.getStats(t,e)})}statsResponsesToObjects(t){const e=[];return t.result().forEach(n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(r=>{i[r]=n.stat(r)}),e.push(i)}),e}},qE=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),SR=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),zb=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),na=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var yf=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(yf||{});function XE(t,e,n,i){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:yf.kNone;if(!e)return;const s=Number(e[n]);if(typeof s!="number")return;const c=Number(e[i]);if(typeof c!="number")return;if(!t)return c?s/c*r:void 0;const l=Number(t[n]);if(typeof l!="number")return;const d=Number(t[i]);if(typeof d!="number")return;const h=c-d;return h?(s-l)/h*r:void 0}let ML=class extends Kb{constructor(){super(...arguments),Lt(this,"_stats",YE),Lt(this,"report",void 0),Lt(this,"lastDecodeVideoReceiverStats",new Map),Lt(this,"lastVideoFramesRecv",new Map),Lt(this,"lastVideoFramesSent",new Map),Lt(this,"lastVideoFramesDecode",new Map),Lt(this,"lastVideoFramesOutput",new Map),Lt(this,"lastVideoJBDelay",new Map),Lt(this,"lastAudioJBDelay",new Map),Lt(this,"mediaBytesSent",new Map),Lt(this,"mediaBytesRetransmit",new Map),Lt(this,"mediaBytesTargetEncode",new Map),Lt(this,"lastDecodeAudioReceiverStats",new Map),Lt(this,"lastAudioConcealment",new Map),Lt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=os(YE),this.report.forEach(t=>{switch(t.type){case na.OUTBOUND:case na.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,i=!e&&!("frameWidth"in t);t.type===na.OUTBOUND?e==="audio"||i?this.processAudioOutboundStats(t):(e==="video"||n)&&this.processVideoOutboundStats(t):t.type===na.INBOUND&&(e==="audio"||i?this.processAudioInboundStats(t):(e==="video"||n)&&this.processVideoInboundStats(t));break}case na.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case na.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:ht({},Fo),remote:ht({},Fo)};return t.forEach(n=>{let i;if(n.type===na.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===na.CANDIDATE_PAIR&&n.selected&&(i=n),i){const r=(s,c)=>{s.type=c.type,s.id=c.id,c.address&&(s.address=c.address),c.candidateType&&(s.candidateType=c.candidateType),c.port&&(s.port=c.port),c.priority&&(s.priority=c.priority),c.protocol&&(s.protocol=c.protocol),c.relayProtocol&&(s.relayProtocol=c.relayProtocol)};if(i.localCandidateId){const s=t.get(i.localCandidateId);s&&r(e.local,s)}if(i.remoteCandidateId){const s=t.get(i.remoteCandidateId);s&&r(e.remote,s)}}}),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===na.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===na.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===na.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ht({},e),ht({},this.stats.selectedCandidatePair.localCandidate)),t.type===na.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ht({},e),ht({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);e||(e=os(kL),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.packetsDiscarded=t.packetsDiscarded,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived,e.totalProcessingDelay=t.totalProcessingDelay,e.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=XE(n,e,"totalProcessingDelay","jitterBufferEmittedCount",yf.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,e),this.calculateAudioFreeze(e,n,t),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof t.concealedSamples=="number"&&(e.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,ht({},e))}calculateAudioFreeze(t,e,n){const i=this.lastAudioConcealment.get(t.ssrc);if(e!=null&&i!=null){const r=i.lts,s=n.timestamp,c=s-r;if(c<=0)return;const l=t.concealedSamples-e.concealedSamples-0,d=i.nonSilent+l,h=t.totalSamplesReceived-e.totalSamplesReceived;if(h<=0)return;const p=80*h/c,_=200*h/c,m=c/h;let g=0;t.freezeSamples80=e.freezeSamples80,t.freezeMs80=e.freezeMs80,d>p&&(i.plc80>0?(t.freezeSamples80+=l,t.freezeMs80+=Math.round(l*m)):(t.freezeSamples80+=d,t.freezeMs80+=Math.round(d*m)),g=i.plc80+1);let C=0;t.freezeSamples200=e.freezeSamples200,t.freezeMs200=e.freezeMs200,d>_&&(i.plc200>0?(t.freezeSamples200+=l,t.freezeMs200+=Math.round(l*m)):(t.freezeSamples200+=d,t.freezeMs200+=Math.round(d*m)),C=i.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:l,lts:s,plc80:g,plc200:C})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let e=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);e||(e=os(DL),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.framesDroppedCount=t.framesDropped,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,e.totalFreezesDuration=t.totalFreezesDuration,e.totalProcessingDelay=t.totalProcessingDelay,e.packetsDiscarded=t.packetsDiscarded,e.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,e.totalAssemblyTime=t.totalAssemblyTime,e.keyFramesDecoded=t.keyFramesDecoded,e.retransmittedBytesReceived=t.retransmittedBytesReceived,e.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),r=this.lastVideoFramesOutput.get(e.ssrc),s=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const c=e.decodedFrame?e.decodedFrame.width:0,l=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,c,l),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const c=n.stats,l=s-n.lts;e.framesDecodeFreezeTime=c.framesDecodeFreezeTime,e.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=l,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<c.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime,e.avgDecodeMs=XE(n==null?void 0:n.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=XE(n==null?void 0:n.stats,e,"totalProcessingDelay","framesDecodeCount",yf.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=XE(n==null?void 0:n.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",yf.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=XE(n==null?void 0:n.stats,e,"totalInterFrameDelay","framesDecodeCount",yf.kMillisecondsFromSeconds),i&&s-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:0}),e.framesDroppedCount&&t.framesReceived&&(r&&s-r.lts>=800?(e.outputFrameRate=Math.round((t.framesReceived-e.framesDroppedCount-r.count)/((s-r.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:s,rate:Math.max(e.outputFrameRate,0)})):r?e.outputFrameRate=r.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:t.framesReceived-e.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:ht({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find(i=>i.ssrc===t.ssrc);e||(e=os(LL),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const i=new Wb(10);i.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,i)}if(t.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(t.ssrc);if(i)i.add(t.retransmittedBytesSent);else{const r=new Wb(10);r.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,r)}}if(t.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(t.ssrc);if(i)i.add(t.totalEncodedBytesTarget);else{const r=new Wb(10);r.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,r)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,e.hugeFramesSent=t.hugeFramesSent,e.keyFramesEncoded=t.keyFramesEncoded,e.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const i=this.lastEncoderMs.get(t.ssrc);if(!i||i.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const r=t.framesEncoded-i.lastFrameCount,s=t.totalEncodeTime-i.lastEncoderTime;e.avgEncodeMs=1e3*s/r}}if(t.framesEncoded&&t.qpSum){const i=this.lastEncoderMs.get(t.ssrc);!i||i.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-i.lastQpSum)/(t.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const i=this.findRemoteStatsId(t.ssrc,na.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find(n=>n.ssrc===t.ssrc);if(e||(e=os(PL),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,e.retransmittedBytesSent=t.retransmittedBytesSent,e.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,na.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const i=Array.from(ar(n=this.report).call(n)).find(r=>r.type===e&&r.ssrc===t);return i?i.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var i,r,s,c;const l=e?this.report.get(e):void 0,d=(i=l==null?void 0:l.framesSent)!==null&&i!==void 0?i:t.framesSent;if(typeof d!="number")return;let h=(r=l==null?void 0:l.frameWidth)!==null&&r!==void 0?r:t.frameWidth,p=(s=l==null?void 0:l.frameHeight)!==null&&s!==void 0?s:t.frameHeight,_=(c=l==null?void 0:l.framesPerSecond)!==null&&c!==void 0?c:t.framesPerSecond;if(typeof h=="number"&&typeof p=="number"||(h=0,p=0),_==null){const m=Date.now(),g=this.lastVideoFramesSent.get(n.ssrc);g&&m-g.lts>=800?(_=Math.round((d-g.count)/((m-g.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:m,rate:_})):g?_=g.rate:this.lastVideoFramesSent.set(n.ssrc,{count:d,lts:m,rate:0})}n.sentFrame={width:h,height:p,frameRate:Math.max(0,_)}}processVideoTrackReceiverStats(t,e,n){var i,r,s,c,l;const d=e?this.report.get(e):void 0,h=(i=d==null?void 0:d.framesReceived)!==null&&i!==void 0?i:t.framesReceived,p=(r=d==null?void 0:d.frameWidth)!==null&&r!==void 0?r:t.frameWidth,_=(s=d==null?void 0:d.frameHeight)!==null&&s!==void 0?s:t.frameHeight,m=(c=d==null?void 0:d.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,g=(l=d==null?void 0:d.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount;if(typeof h=="number"){const C=this.lastVideoFramesRecv.get(n.ssrc),R=Date.now();n.framesReceivedCount=h;let y=0;C&&R-C.lts>=800?(y=Math.round((h-C.count)/((R-C.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:R,rate:y})):C?y=C.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:h,lts:R,rate:0}),n.receivedFrame={width:p||0,height:_||0,frameRate:y||0},n.decodedFrame={width:p||0,height:_||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:p||0,height:_||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(m&&g){const C=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let R=C.jitterBufferMs;const y=g-C.jitterBufferEmittedCount;y>0&&(R=1e3*(m-C.jitterBufferDelay)/y),n.jitterBufferMs=R,n.currentDelayMs=Math.round(R),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:m,jitterBufferEmittedCount:g,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var i,r,s,c;const l=e?this.report.get(e):void 0,d=(i=(r=l==null?void 0:l.echoReturnLoss)!==null&&r!==void 0?r:t.echoReturnLoss)!==null&&i!==void 0?i:0,h=(s=(c=l==null?void 0:l.echoReturnLossEnhancement)!==null&&c!==void 0?c:t.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;n.aecReturnLoss=d,n.aecReturnLossEnhancement=h}processAudioTrackReceiverStats(t,e,n){var i,r,s,c,l,d,h,p,_;const m=e?this.report.get(e):void 0,g=(i=m==null?void 0:m.removedSamplesForAcceleration)!==null&&i!==void 0?i:t.removedSamplesForAcceleration,C=(r=m==null?void 0:m.totalSamplesReceived)!==null&&r!==void 0?r:t.totalSamplesReceived,R=(s=m==null?void 0:m.jitterBufferDelay)!==null&&s!==void 0?s:t.jitterBufferDelay,y=(c=m==null?void 0:m.jitterBufferEmittedCount)!==null&&c!==void 0?c:t.jitterBufferEmittedCount,b=(l=m==null?void 0:m.audioLevel)!==null&&l!==void 0?l:t==null?void 0:t.audioLevel,I=(d=m==null?void 0:m.totalSamplesDuration)!==null&&d!==void 0?d:t==null?void 0:t.totalSamplesDuration,L=(h=m==null?void 0:m.concealedSamples)!==null&&h!==void 0?h:t.concealedSamples,U=(p=m==null?void 0:m.silentConcealedSamples)!==null&&p!==void 0?p:t.silentConcealedSamples,x=(_=m==null?void 0:m.concealmentEvents)!==null&&_!==void 0?_:t.concealmentEvents;if(typeof C=="number"&&(n.totalSamplesReceived=C),typeof U=="number"&&(n.silentConcealedSamples=U),typeof x=="number"&&(n.concealmentEvents=x),typeof L=="number"&&(n.concealedSamples=L),g&&C&&(n.accelerateRate=g/C),R&&y){const j=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let K=j.jitterBufferMs;const it=y-j.jitterBufferEmittedCount;it>0&&(K=1e3*(R-j.jitterBufferDelay)/it),n.jitterBufferMs=Math.round(K),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:R,jitterBufferEmittedCount:y,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=b;let M=1920;I&&C&&(M=C/I/50,n.receivedFrames=Math.round(C/M)),L&&(n.droppedFrames=Math.round(L/M))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach(r=>{t+=r.diffMean()}),this.mediaBytesRetransmit.forEach(r=>{e=e===null?r.diffMean():e+r.diffMean()}),this.mediaBytesTargetEncode.forEach(r=>{n=n===null?r.diffMean():n+r.diffMean()});const i=e!==null?t-e:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},i4=class extends Kb{updateStats(){return st.resolve()}};function Yb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null}();return s?s<76?new n4(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new ML(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(c){if(!window.RTCStatsReport)return!1;const l=c.getStats();return!!(l instanceof st||function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"}(l))}(t)?new ML(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new i4(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}const UL="websdk_ng_install_id";function qb(){try{if(N("INSTALL_ID"))return N("INSTALL_ID");let t=window.localStorage.getItem(UL);return t||(t=$u(),window.localStorage.setItem(UL,t)),Se("INSTALL_ID",t),t}catch{return}}const wa=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],i=e[2];return"".concat(n,".").concat(i)}return"4.0.0.999"}("4.23.4"),Xb=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let th=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const hi=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let l=0;l<6;l++)r.push("1");const s=r.join(""),c={};return c[t]=i,c[e]=s,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=hi;const TR={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},Jb={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Qb="v4.23.4-0-g17410532-dirty(6/5/2025, 4:24:52 PM)",Zb={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1},je=ht(ht(ht(ht({},Zb),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Jb,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},TR),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:void 0,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function Se(t,e,n){var i,r,s;rt(i=Object.keys(je)).call(i,t)&&(!n&&rt(r=Object.keys(zs)).call(r,t)||(je[t]=e,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||e!==!0||(je.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(je.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&e&&(s=!!e,je.USE_NEW_NETWORK_CONFIG=s,s&&(je.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],je.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],je.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],je.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],je.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",je.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",je.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(je.ENABLE_INSTANT_VIDEO=!0,je.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(je.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&e&&(je.NEW_TURN_MODE||(je.NEW_TURN_MODE=4))))}function N(t){return je[t]}Xb||(je.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],je.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],je.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],je.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],je.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],je.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],je.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",je.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",je.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",je.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",je.AREAS=["NORTH_AMERICA","OVERSEA"]);let xL=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const zs={};var $t=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}($t||{});let vR=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const VL=128,r4=96,BL=1e3,Cf=10;let a4=0;var FL=(()=>{var t={8:(i,r,s)=>{s.r(r),s.d(r,{Parser:()=>it,Printer:()=>Ue,parse:()=>$,print:()=>ft});const c=`
`,l="".concat("\r").concat(c),d=" ";let h;function p(Y){return Y>="0"&&Y<="9"}function _(Y){return Y>="!"&&Y<="~"}function m(Y){return _(Y)||Y>=""&&Y<=""}function g(Y){return Y==="!"||Y>="#"&&Y<="'"||Y>="*"&&Y<="+"||Y>="-"&&Y<="."||Y>="0"&&Y<="9"||Y>="A"&&Y<="Z"||Y>="^"&&Y<="~"}function C(Y){return Y>="1"&&Y<="9"}function R(Y){return Y>="A"&&Y<="Z"||Y>="a"&&Y<="z"}function y(Y){return Y==="d"||Y==="h"||Y==="m"||Y==="s"}function b(Y){return Y>""&&Y<"	"||Y>"\v"&&Y<"\f"||Y>""&&Y<""}function I(Y){return R(Y)||p(Y)||Y==="+"||Y==="/"}function L(Y){return p(Y)||R(Y)||Y==="+"||Y==="/"||Y==="-"||Y==="_"}function U(Y){return R(Y)||p(Y)||Y==="+"||Y==="/"}function x(Y,v){var D=Object.keys(Y);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Y);v&&(k=k.filter(function(Z){return Object.getOwnPropertyDescriptor(Y,Z).enumerable})),D.push.apply(D,k)}return D}function M(Y){for(var v=1;v<arguments.length;v++){var D=arguments[v]!=null?arguments[v]:{};v%2?x(Object(D),!0).forEach(function(k){j(Y,k,D[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(D)):x(Object(D)).forEach(function(k){Object.defineProperty(Y,k,Object.getOwnPropertyDescriptor(D,k))})}return Y}function j(Y,v,D){return v in Y?Object.defineProperty(Y,v,{value:D,enumerable:!0,configurable:!0,writable:!0}):Y[v]=D,Y}(function(Y){Y.VERSION="v",Y.ORIGIN="o",Y.SESSION_NAME="s",Y.INFORMATION="i",Y.URI="u",Y.EMAIL="e",Y.PHONE="p",Y.CONNECTION="c",Y.BANDWIDTH="b",Y.TIME="t",Y.REPEAT="r",Y.ZONE_ADJUSTMENTS="z",Y.KEY="k",Y.ATTRIBUTE="a",Y.MEDIA="m"})(h||(h={}));class K{consumeText(v,D){let k=D;for(;k<v.length;){const Z=v[k];if(Z==="\0"||Z==="\r"||Z===c)break;k+=1}if(k-D==0)throw new Error("Invalid text, at ".concat(v));return k}consumeUnicastAddress(v,D,k){return this.consumeTill(v,D,d)}consumeOneOrMore(v,D,k){let Z=D;for(;k(v[Z]);)Z++;if(Z-D==0)throw new Error("Invalid rule at ".concat(D,"."));return Z}consumeSpace(v,D){if(v[D]===d)return D+1;throw new Error("Invalid space at ".concat(D,"."))}consumeIP4Address(v,D){let k=D;for(let Z=0;Z<4;Z++)if(k=this.consumeDecimalUChar(v,k),Z!==3){if(v[k]!==".")throw new Error("Invalid IP4 address.");k++}return k}consumeDecimalUChar(v,D){let k=D;for(let Ut=0;Ut<3&&p(v[k]);Ut++,k++);if(k-D==0)throw new Error("Invalid decimal uchar.");const Z=parseInt(v.slice(D,k));if(Z>=0&&Z<=255)return k;throw new Error("Invalid decimal uchar")}consumeIP6Address(v,D){let k=this.consumeHexpart(v,D);return v[k]===":"&&(k+=1,k=this.consumeIP4Address(v,k)),k}consumeHexpart(v,D){let k=D;if(v[k]===":"&&v[k+1]===":"){k+=2;try{k=this.consumeHexseq(v,k)}catch{}return k}if(k=this.consumeHexseq(v,k),v[k]===":"&&v[k+1]===":"){k+=2;try{k=this.consumeHexseq(v,k)}catch{}return k}return k}consumeHexseq(v,D){let k=D;for(;k=this.consumeHex4(v,k),v[k]===":"&&v[k+1]!==":";)k+=1;return k}consumeHex4(v,D){let k=0;for(;k<4;k++)if(!((Z=v[D+k])>="0"&&Z<="9"||Z>="a"&&Z<="f"||Z>="A"&&Z<="F")){if(k===0)throw new Error("Invalid hex 4");break}var Z;return D+k}consumeFQDN(v,D){let k=D;for(;p(v[k])||R(v[k])||v[k]==="-"||v[k]===".";)k+=1;if(k-D<4)throw new Error("Invalid FQDN");return k}consumeExtnAddr(v,D){return this.consumeOneOrMore(v,D,m)}consumeMulticastAddress(v,D,k){switch(k){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(v,D);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(v,D);default:try{return this.consumeFQDN(v,D)}catch{return this.consumeExtnAddr(v,D)}}}consumeIP6MulticastAddress(v,D){const k=this.consumeHexpart(v,D);return v[k]==="/"?this.consumeInteger(v,k+1):k}consumeIP4MulticastAddress(v,D){let k=D+3;const Z=v.slice(D,k),Ut=parseInt(Z);if(Ut<224||Ut>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Pe=0;Pe<3;Pe++){if(v[k]!==".")throw new Error("Invalid IP4 multicast address.");k+=1,k=this.consumeDecimalUChar(v,k)}return v[k]==="/"&&(k+=1),k=this.consumeTTL(v,k),v[k]==="/"&&(k=this.consumeInteger(v,k)),k}consumeInteger(v,D){if(!C(v[D]))throw new Error("Invalid integer.");for(D+=1;p(v[D]);)D+=1;return D}consumeTTL(v,D){if(v[D]==="0")return D+1;if(!C(v[D]))throw new Error("Invalid TTL.");D+=1;for(let k=0;k<2&&p(v[D]);k++)D+=1;return D}consumeToken(v,D){return this.consumeOneOrMore(v,D,g)}consumeTime(v,D){let k=D;if(v[k]==="0")return k+1;for(C(v[k])&&(k+=1);p(v[k]);)k++;if(k-D<10)throw new Error("Invalid time");return k}consumeAddress(v,D){return this.consumeTill(v,D,d)}consumeTypedTime(v,D){let k=D;return k=this.consumeOneOrMore(v,k,p),y(v[k])?k+1:k}consumeRepeatInterval(v,D){if(!C(v[D]))throw new Error("Invalid repeat interval");for(D+=1;p(v[D]);)D+=1;return y(v[D])&&(D+=1),D}consumePort(v,D){return this.consumeOneOrMore(v,D,p)}consume(v,D,k){for(let Z=0;Z<k.length;Z++){if(D+Z>=v.length)throw new Error("consume exceeding value length");if(v[D+Z]!==k[Z])throw new Error("consume ".concat(k," failed at ").concat(Z))}return D+k.length}consumeTill(v,D,k){let Z=D;for(;Z<v.length&&(typeof k!="string"||v[Z]!==k)&&(typeof k!="function"||!k(v[Z]));)Z++;return Z}}class it extends K{constructor(){super(),j(this,"records",[]),j(this,"currentLine",0)}parse(v){const D=this.probeEOL(v);this.records=v.split(D).filter(tl=>!!Bi(tl).call(tl)).map(this.parseLine),this.currentLine=0;const k=this.parseVersion(),Z=this.parseOrigin(),Ut=this.parseSessionName(),Pe=this.parseInformation(),Pn=this.parseUri(),Ua=this.parseEmail(),Ts=this.parsePhone(),kg=this.parseConnection(),Th=this.parseBandWidth(),i_=this.parseTimeFields(),Ny=this.parseKey(),Dy=this.parseSessionAttribute(),xa=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:k,origin:Z,sessionName:Ut,information:Pe,uri:Pn,emails:Ua,phones:Ts,connection:kg,bandwidths:Th,timeFields:i_,key:Ny,attributes:Dy,mediaDescriptions:xa}}getCurrentRecord(){const v=this.records[this.currentLine];if(!v)throw new Error("Record doesn't exit.");return v}probeEOL(v){for(let D=0;D<v.length;D++)if(v[D]===c)return v[D-1]==="\r"?l:c;throw new Error("Invalid newline character.")}parseLine(v,D){if(v.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const k=v[0];if(v[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:k,value:v.slice(2),line:D,cur:0}}parseSessionAttribute(){const v=new Ft;for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==h.ATTRIBUTE)break;const k={attField:this.extractOneOrMore(D,Z=>g(Z)&&Z!==":"),_cur:0};D.value[D.cur]===":"&&(D.cur+=1,k.attValue=this.extractOneOrMore(D,b)),v.parse(k),this.currentLine++}return v.digest()}parseMediaAttributes(v){const D=new Vt(v);for(;this.currentLine<this.records.length;){const k=this.getCurrentRecord();if(k.type!==h.ATTRIBUTE)break;const Z={attField:this.extractOneOrMore(k,Ut=>g(Ut)&&Ut!==":"),_cur:0};k.value[k.cur]===":"&&(k.cur+=1,Z.attValue=this.extractOneOrMore(k,b)),D.parse(Z),this.currentLine++}return D.digest()}parseKey(){const v=this.getCurrentRecord();if(v.type===h.KEY){if(v.value==="prompt"||v.value==="clear:"||v.value==="base64:"||v.value==="uri:")return v.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const v=this.getCurrentRecord();if(v.type===h.ZONE_ADJUSTMENTS){const D=[];for(;;)try{const k=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);let Z=!1;v.value[v.cur]==="-"&&(Z=!0,v.cur+=1);const Ut=this.extract(v,this.consumeTypedTime);D.push({time:k,typedTime:Ut,back:Z})}catch{break}if(D.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,D}return[]}parseRepeat(){const v=[];for(;;){const D=this.getCurrentRecord();if(D.type!==h.REPEAT)break;{const k=this.extract(D,this.consumeRepeatInterval),Z=this.parseTypedTime(D);v.push({repeatInterval:k,typedTimes:Z}),this.currentLine++}}return v}parseTypedTime(v){const D=[];for(;;)try{this.consumeSpaceForRecord(v),D.push(this.extract(v,this.consumeTypedTime))}catch{break}if(D.length===0)throw new Error("Invalid typed time.");return D}parseTime(){const v=this.getCurrentRecord(),D=this.extract(v,this.consumeTime);this.consumeSpaceForRecord(v);const k=this.extract(v,this.consumeTime);return this.currentLine++,{startTime:D,stopTime:k}}parseBandWidth(){const v=[];for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==h.BANDWIDTH)break;{const k=this.extractOneOrMore(D,g);if(D.value[D.cur]!==":")throw new Error("Invalid bandwidth field.");D.cur++;const Z=this.extractOneOrMore(D,p);v.push({bwtype:k,bandwidth:Z}),this.currentLine++}}return v}parseVersion(){const v=this.getCurrentRecord();if(v.type!==h.VERSION)throw new Error("first sdp record must be version");const D=v.value.slice(0,this.consumeOneOrMore(v.value,0,p));if(D.length!==v.value.length)throw new Error('invalid proto version, "v='.concat(v.value,'"'));return this.currentLine++,D}parseOrigin(){const v=this.getCurrentRecord();if(v.type!==h.ORIGIN)throw new Error("second line of sdp must be origin");const D=this.extractOneOrMore(v,m);this.consumeSpaceForRecord(v);const k=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const Z=this.extractOneOrMore(v,p);this.consumeSpaceForRecord(v);const Ut=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const Pe=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const Pn=this.extract(v,this.consumeUnicastAddress);return this.currentLine++,{username:D,sessId:k,sessVersion:Z,nettype:Ut,addrtype:Pe,unicastAddress:Pn}}parseSessionName(){const v=this.getCurrentRecord();if(v.type===h.SESSION_NAME){const D=this.extract(v,this.consumeText);return this.currentLine++,D}}parseInformation(){const v=this.getCurrentRecord();if(v.type!==h.INFORMATION)return;const D=this.extract(v,this.consumeText);return this.currentLine++,D}parseUri(){const v=this.getCurrentRecord();if(v.type===h.URI)return this.currentLine++,v.value}parseEmail(){const v=[];for(;;){const D=this.getCurrentRecord();if(D.type!==h.EMAIL)break;v.push(D.value),this.currentLine++}return v}parsePhone(){const v=[];for(;;){const D=this.getCurrentRecord();if(D.type!==h.PHONE)break;v.push(D.value),this.currentLine++}return v}parseConnection(){const v=this.getCurrentRecord();if(v.type===h.CONNECTION){const D=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const k=this.extractOneOrMore(v,g);this.consumeSpaceForRecord(v);const Z=this.extract(v,this.consumeAddress);return this.currentLine++,{nettype:D,addrtype:k,address:Z}}}parseMedia(){const v=this.getCurrentRecord(),D=this.extract(v,this.consumeToken);this.consumeSpaceForRecord(v);let k=this.extract(v,this.consumePort);v.value[v.cur]==="/"&&(v.cur+=1,k+=this.extract(v,this.consumeInteger)),this.consumeSpaceForRecord(v);const Z=[];for(Z.push(this.extract(v,this.consumeToken));v.value[v.cur]==="/";)v.cur+=1,Z.push(this.extract(v,this.consumeToken));if(Z.length===0)throw new Error("Invalid proto");const Ut=this.parseFmt(v);return this.currentLine++,{mediaType:D,port:k,protos:Z,fmts:Ut}}parseTimeFields(){const v=[];for(;this.getCurrentRecord().type===h.TIME;){const D=this.parseTime(),k=this.parseRepeat(),Z=this.parseZone();v.push({time:D,repeats:k,zones:Z})}return v}parseMediaDescription(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.MEDIA;){const D=this.parseMedia(),k=this.parseInformation(),Z=this.parseConnections(),Ut=this.parseBandWidth(),Pe=this.parseKey(),Pn=this.parseMediaAttributes(D);v.push({media:D,information:k,connections:Z,bandwidths:Ut,key:Pe,attributes:Pn})}return v}parseConnections(){const v=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===h.CONNECTION;)v.push(this.parseConnection());return v}parseFmt(v){const D=[];for(;;)try{this.consumeSpaceForRecord(v),D.push(this.extract(v,this.consumeToken))}catch{break}if(D.length===0)throw new Error("Invalid fmts");return D}extract(v,D){for(var k=arguments.length,Z=new Array(k>2?k-2:0),Ut=2;Ut<k;Ut++)Z[Ut-2]=arguments[Ut];const Pe=D.call(this,v.value,v.cur,...Z),Pn=v.value.slice(v.cur,Pe);return v.cur=Pe,Pn}extractOneOrMore(v,D){const k=this.consumeOneOrMore(v.value,v.cur,D),Z=v.value.slice(v.cur,k);return v.cur=k,Z}consumeSpaceForRecord(v){if(v.value[v.cur]!==d)throw new Error("Invalid space at ".concat(v.cur,"."));v.cur+=1}}class dt extends K{constructor(){super(...arguments),j(this,"attributes",void 0),j(this,"digested",!1)}extractOneOrMore(v,D,k){const Z=this.consumeOneOrMore(v.attValue,v._cur,D),Ut=v.attValue.slice(v._cur,Z),[Pe,Pn]=k||[];if(typeof Pe=="number"&&Ut.length<Pe)throw new Error("error in length, should be more or equal than ".concat(Pe," characters."));if(typeof Pn=="number"&&Ut.length>Pn)throw new Error("error in length, should be less or equal than ".concat(Pn," characters."));return v._cur=Z,Ut}consumeAttributeSpace(v){if(v.attValue[v._cur]!==d)throw new Error("Invalid space at ".concat(v._cur,"."));v._cur+=1}extract(v,D){if(!v.attValue)throw new Error("Nothing to extract from attValue.");for(var k=arguments.length,Z=new Array(k>2?k-2:0),Ut=2;Ut<k;Ut++)Z[Ut-2]=arguments[Ut];const Pe=D.call(this,v.attValue,v._cur,...Z),Pn=v.attValue.slice(v._cur,Pe);return v._cur=Pe,Pn}atEnd(v){if(!v.attValue)throw new Error;return v._cur>=v.attValue.length}peekChar(v){if(!v.attValue)throw new Error;return v.attValue[v._cur]}peek(v,D){if(!v.attValue)throw new Error;for(let k=0;k<D.length;k++)if(D[k]!==v.attValue[v._cur+k])return!1;return!0}parseIceUfrag(v){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(v,I,[4,256])}parseIcePwd(v){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(v,I,[22,256])}parseIceOptions(v){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const D=[];for(;!this.atEnd(v);){D.push(this.extractOneOrMore(v,I));try{this.consumeAttributeSpace(v)}catch(k){if(this.atEnd(v))break;throw k}}this.attributes.iceOptions=D}parseFingerprint(v){const D=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const k=this.extract(v,this.consumeTill);this.attributes.fingerprints.push({hashFunction:D,fingerprint:k})}parseExtmap(v){const D=this.extractOneOrMore(v,p);let k;this.peekChar(v)==="/"&&(this.extract(v,this.consume,"/"),k=this.extract(v,this.consumeToken)),this.consumeAttributeSpace(v);const Z=this.extract(v,this.consumeTill,d),Ut=M(M({entry:parseInt(D,10)},k&&{direction:k}),{},{extensionName:Z});this.peekChar(v)===d&&(this.consumeAttributeSpace(v),Ut.extensionAttributes=this.extract(v,this.consumeTill)),this.attributes.extmaps.push(Ut)}parseSetup(v){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const D=this.extract(v,this.consumeTill);if(D!=="active"&&D!=="passive"&&D!=="actpass"&&D!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=D}}class Ft extends dt{constructor(){super(...arguments),j(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"group":this.parseGroup(v);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"fingerprint":this.parseFingerprint(v);break;case"setup":this.parseSetup(v);break;case"tls-id":this.parseTlsId(v);break;case"identity":this.parseIdentity(v);break;case"extmap":this.parseExtmap(v);break;case"msid-semantic":this.parseMsidSemantic(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(D){throw console.error("parsing session attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),D}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(v){const D=this.extract(v,this.consumeToken),k=[];for(;!this.atEnd(v)&&this.peekChar(v)===d;)this.consumeAttributeSpace(v),k.push(this.extract(v,this.consumeToken));this.attributes.groups.push({semantic:D,identificationTag:k})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(v){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(v,L)}parseIdentity(v){const D=this.extractOneOrMore(v,U),k=[];for(;!this.atEnd(v)&&this.peekChar(v)===d;){this.consumeAttributeSpace(v);const Z=this.extract(v,this.consumeToken);this.extract(v,this.consume,"=");const Ut=this.extractOneOrMore(v,Pe=>Pe!==d&&b(Pe));k.push({name:Z,value:Ut})}this.attributes.identities.push({assertionValue:D,extensions:k})}parseMsidSemantic(v){this.peekChar(v)===d&&this.consumeAttributeSpace(v);const D={semantic:this.extract(v,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(v)}catch{break}if(this.peekChar(v)==="*"){this.extract(v,this.consume,"*"),D.applyForAll=!0;break}{const k=this.extract(v,this.consumeTill,d);D.identifierList.push(k)}}this.attributes.msidSemantic=D}}class Vt extends dt{constructor(v){super(),j(this,"attributes",void 0),v.protos.indexOf("RTP")!==-1||v.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(v){if(this.digested)throw new Error("already digested");try{switch(v.attField){case"extmap":this.parseExtmap(v);break;case"setup":this.parseSetup(v);break;case"ice-ufrag":this.parseIceUfrag(v);break;case"ice-pwd":this.parseIcePwd(v);break;case"ice-options":this.parseIceOptions(v);break;case"candidate":this.parseCandidate(v);break;case"remote-candidate":this.parseRemoteCandidate(v);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(v);break;case"rtpmap":this.parseRtpmap(v);break;case"ptime":this.parsePtime(v);break;case"maxptime":this.parseMaxPtime(v);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(v);break;case"ssrc":this.parseSSRC(v);break;case"fmtp":this.parseFmtp(v);break;case"rtcp-fb":this.parseRtcpFb(v);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(v);break;case"mid":this.parseMid(v);break;case"msid":this.parseMsid(v);break;case"imageattr":this.parseImageAttr(v);break;case"rid":this.parseRid(v);break;case"simulcast":this.parseSimulcast(v);break;case"sctp-port":this.parseSctpPort(v);break;case"max-message-size":this.parseMaxMessageSize(v);break;case"ssrc-group":this.parseSSRCGroup(v);break;default:v.ignored=!0,this.attributes.unrecognized.push(v)}}catch(D){throw console.error("parsing media attribute ".concat(v.attField,' error, "a=').concat(v.attField,":").concat(v.attValue,'"')),D}if(!v.ignored&&v.attValue&&!this.atEnd(v))throw new Error("attribute parsing error")}parseCandidate(v){const D=this.extractOneOrMore(v,I,[1,32]);this.consumeAttributeSpace(v);const k=this.extractOneOrMore(v,p,[1,5]);this.consumeAttributeSpace(v);const Z=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const Ut=this.extractOneOrMore(v,p,[1,10]);this.consumeAttributeSpace(v);const Pe=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const Pn=this.extract(v,this.consumePort);this.consumeAttributeSpace(v),this.extract(v,this.consume,"typ"),this.consumeAttributeSpace(v);const Ua={foundation:D,componentId:k,transport:Z,priority:Ut,connectionAddress:Pe,port:Pn,type:this.extract(v,this.consumeToken),extension:{}};for(this.peek(v," raddr")&&(this.extract(v,this.consume," raddr"),this.consumeAttributeSpace(v),Ua.relAddr=this.extract(v,this.consumeAddress)),this.peek(v," rport")&&(this.extract(v,this.consume," rport"),this.consumeAttributeSpace(v),Ua.relPort=this.extract(v,this.consumePort));this.peekChar(v)===d;){this.consumeAttributeSpace(v);const Ts=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v),Ua.extension[Ts]=this.extractOneOrMore(v,_)}this.attributes.candidates.push(Ua)}parseRemoteCandidate(v){const D=[];for(;;){const k=this.extractOneOrMore(v,p,[1,5]);this.consumeAttributeSpace(v);const Z=this.extract(v,this.consumeAddress);this.consumeAttributeSpace(v);const Ut=this.extract(v,this.consumePort);D.push({componentId:k,connectionAddress:Z,port:Ut});try{this.consumeAttributeSpace(v)}catch{break}}this.attributes.remoteCandidatesList.push(D)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(v){const D=this.extract(v,this.consumeToken);this.consumeAttributeSpace(v);const k=this.extract(v,this.consumeTill,"/");this.extract(v,this.consume,"/");const Z={encodingName:k,clockRate:this.extractOneOrMore(v,p)};this.atEnd(v)||this.peekChar(v)!=="/"||(this.extract(v,this.consume,"/"),Z.encodingParameters=parseInt(this.extract(v,this.consumeTill),10));const Ut=this.attributes.payloads.find(Pe=>Pe.payloadType===parseInt(D,10));Ut?Ut.rtpMap=Z:this.attributes.payloads.push({payloadType:parseInt(D,10),rtpMap:Z,rtcpFeedbacks:[]})}parsePtime(v){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(v,this.consumeTill)}parseMaxPtime(v){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(v,this.consumeTill)}parseDirection(v){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=v.attField}parseSSRC(v){const D=this.extractOneOrMore(v,p);this.consumeAttributeSpace(v);const k=this.extract(v,this.consumeTill,":");let Z;this.peekChar(v)===":"&&(this.extract(v,this.consume,":"),Z=this.extract(v,this.consumeTill));const Ut=this.attributes.ssrcs.find(Pe=>Pe.ssrcId===parseInt(D,10));Ut?Ut.attributes[k]=Z:this.attributes.ssrcs.push({ssrcId:parseInt(D,10),attributes:{[k]:Z}})}parseFmtp(v){const D=this.extract(v,this.consumeTill,d);this.consumeAttributeSpace(v);const k=this.extract(v,this.consumeTill),Z={};k.split(";").forEach(Pe=>{let[Pn,Ua]=Pe.split("=");Pn=Bi(Pn).call(Pn);const Ts=typeof Ua=="string"?Bi(Ua).call(Ua):null;typeof Pn=="string"&&Pn.length>0&&(Z[Pn]=Ts)});const Ut=this.attributes.payloads.find(Pe=>Pe.payloadType===parseInt(D,10));Ut?Ut.fmtp={parameters:Z}:this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[],fmtp:{parameters:Z}})}parseFmtParameters(v){const D={},k=this.extract(v,this.consumeTill,"=");v._cur++;const Z=this.extract(v,this.consumeTill,";");for(D[k]=Z;v.attValue[v._cur]===";";){const Ut=this.extract(v,this.consumeTill,"=");v._cur++;const Pe=this.extract(v,this.consumeTill,";");D[Ut]=Pe}return D}parseRtcpFb(v){let D="";D=this.peekChar(v)==="*"?this.extract(v,this.consume,"*"):this.extract(v,this.consumeTill,d),this.consumeAttributeSpace(v);const k=this.extract(v,this.consumeTill,d);let Z;if(k==="trr-int")Z={type:k,interval:this.extract(v,this.consumeTill)};else{const Ut={type:k};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),Ut.parameter=this.extract(v,this.consumeToken),this.peekChar(v)===d&&(Ut.additional=this.extract(v,this.consumeTill))),Z=Ut}if(D==="*")this.attributes.rtcpFeedbackWildcards.push(Z);else{const Ut=this.attributes.payloads.find(Pe=>Pe.payloadType===parseInt(D,10));Ut?Ut.rtcpFeedbacks.push(Z):this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[Z]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(v){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const D={port:this.extract(v,this.consumePort)};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),D.netType=this.extractOneOrMore(v,g),this.consumeAttributeSpace(v),D.addressType=this.extractOneOrMore(v,g),this.consumeAttributeSpace(v),D.address=this.extract(v,this.consumeAddress)),this.attributes.rtcp=D}parseMsid(v){const D={id:this.extractOneOrMore(v,g,[1,64])};this.peekChar(v)===d&&(this.consumeAttributeSpace(v),D.appdata=this.extractOneOrMore(v,g,[1,64])),this.attributes.msids.push(D)}parseImageAttr(v){this.attributes.imageattr.push(v.attValue)}parseRid(v){const D=this.extractOneOrMore(v,Z=>R(Z)||p(Z)||Z==="_"||Z==="-");this.consumeAttributeSpace(v);const k={id:D,direction:this.extract(v,this.consumeToken),params:[]};if(this.peekChar(v)===d){if(this.consumeAttributeSpace(v),this.peek(v,"pt=")){this.extract(v,this.consume,"pt=");const Z=[];for(;;){const Ut=this.extract(v,this.consumeToken);Z.push(Ut);try{this.extract(v,this.consume,",")}catch{break}}k.payloads=Z,this.peekChar(v)===d&&this.extract(v,this.consume,d)}for(;;){const Z=this.extract(v,this.consumeToken);switch(Z){case"depend":{const Ut={type:Z,rids:this.extract(v,this.consume,"=").split(",")};k.params.push(Ut);break}default:{const Ut={type:Z};this.peekChar(v)==="="&&(this.extract(v,this.consume,"="),Ut.val=this.extract(v,this.consumeTill,";")),k.params.push(Ut)}}try{this.extract(v,this.consume,";")}catch{break}}}this.attributes.rids.push(k)}parseSimulcast(v){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=v.attValue,this.extract(v,this.consumeTill)}parseSctpPort(v){this.attributes.sctpPort=this.extractOneOrMore(v,p,[1,5])}parseMaxMessageSize(v){this.attributes.maxMessageSize=this.extractOneOrMore(v,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(v){this.attributes.mid=this.extract(v,this.consumeToken)}parseSSRCGroup(v){const D=this.extract(v,this.consumeToken),k=[];for(;;)try{this.consumeAttributeSpace(v);const Z=this.extract(v,this.consumeInteger);k.push(parseInt(Z,10))}catch{break}this.attributes.ssrcGroups.push({semantic:D,ssrcIds:k})}}function It(Y,v,D){return v in Y?Object.defineProperty(Y,v,{value:D,enumerable:!0,configurable:!0,writable:!0}):Y[v]=D,Y}class Ue{constructor(){It(this,"eol",l)}print(v,D){let k="";return D&&(this.eol=D),k+=this.printVersion(v.version),k+=this.printOrigin(v.origin),k+=this.printSessionName(v.sessionName),k+=this.printInformation(v.information),k+=this.printUri(v.uri),k+=this.printEmail(v.emails),k+=this.printPhone(v.phones),k+=this.printConnection(v.connection),k+=this.printBandwidth(v.bandwidths),k+=this.printTimeFields(v.timeFields),k+=this.printKey(v.key),k+=this.printSessionAttributes(v.attributes),k+=this.printMediaDescription(v.mediaDescriptions),k}printVersion(v){return"v=".concat(v).concat(this.eol)}printOrigin(v){return"o=".concat(v.username," ").concat(v.sessId," ").concat(v.sessVersion," ").concat(v.nettype," ").concat(v.addrtype," ").concat(v.unicastAddress).concat(this.eol)}printSessionName(v){return v?"s=".concat(v).concat(this.eol):""}printInformation(v){return v?"i=".concat(v).concat(this.eol):""}printUri(v){return v?"u=".concat(v).concat(this.eol):""}printEmail(v){let D="";for(const k of v)D+="e=".concat(k).concat(this.eol);return D}printPhone(v){let D="";for(const k of v)D+="e=".concat(k).concat(this.eol);return D}printConnection(v){return v?"c=".concat(v.nettype," ").concat(v.addrtype," ").concat(v.address).concat(this.eol):""}printBandwidth(v){let D="";for(const k of v)D+="b=".concat(k.bwtype,":").concat(k.bandwidth).concat(this.eol);return D}printTimeFields(v){let D="";for(const k of v){D+="t=".concat(k.time.startTime," ").concat(k.time.startTime).concat(this.eol);for(const Z of k.repeats)D+="r=".concat(Z.repeatInterval," ").concat(Z.typedTimes.join(" ")).concat(this.eol);k.zoneAdjustments&&(D+="z=",D+="z=".concat(k.zoneAdjustments.map(Z=>"".concat(Z.time," ").concat(Z.back?"-":""," ").concat(Z.typedTime)).join(" ")).concat(this.eol),D+=this.eol)}return D}printKey(v){return v?"k=".concat(v).concat(this.eol):""}printAttributes(v){let D="";for(const k of v)D+="a=".concat(k.attField).concat(k.attValue?":".concat(k.attValue):"").concat(this.eol);return D}printMediaDescription(v){let D="";for(const k of v)D+=this.printMedia(k.media),D+=this.printInformation(k.information),D+=this.printConnections(k.connections),D+=this.printBandwidth(k.bandwidths),D+=this.printKey(k.key),D+=this.printMediaAttributes(k);return D}printConnections(v){let D="";for(const k of v)D+=this.printConnection(k);return D}printMedia(v){return"m=".concat(v.mediaType," ").concat(v.port," ").concat(v.protos.join("/")," ").concat(v.fmts.join(" ")).concat(this.eol)}printSessionAttributes(v){return new ur(this.eol).print(v)}printMediaAttributes(v){return new z(this.eol).print(v)}}class Ae{constructor(v){It(this,"eol",void 0),this.eol=v}printIceUfrag(v){return v===void 0?"":"a=ice-ufrag:".concat(v).concat(this.eol)}printIcePwd(v){return v===void 0?"":"a=ice-pwd:".concat(v).concat(this.eol)}printIceOptions(v){return v===void 0?"":"a=ice-options:".concat(v.join(d)).concat(this.eol)}printFingerprints(v){return v.length>0?v.map(D=>"a=fingerprint:".concat(D.hashFunction).concat(d).concat(D.fingerprint)).join(this.eol)+this.eol:""}printExtmap(v){return v.map(D=>"a=extmap:".concat(D.entry).concat(D.direction?"/".concat(D.direction):"").concat(d).concat(D.extensionName).concat(D.extensionAttributes?"".concat(d).concat(D.extensionAttributes):"").concat(this.eol)).join("")}printSetup(v){return v===void 0?"":"a=setup:".concat(v).concat(this.eol)}printUnrecognized(v){return v.map(D=>"a=".concat(D.attField).concat(D.attValue?":".concat(D.attValue):"").concat(this.eol)).join("")}}class ur extends Ae{print(v){let D="";return D+=this.printGroups(v.groups),D+=this.printMsidSemantic(v.msidSemantic),D+=this.printIceLite(v.iceLite),D+=this.printIceUfrag(v.iceUfrag),D+=this.printIcePwd(v.icePwd),D+=this.printIceOptions(v.iceOptions),D+=this.printFingerprints(v.fingerprints),D+=this.printSetup(v.setup),D+=this.printTlsId(v.tlsId),D+=this.printIdentity(v.identities),D+=this.printExtmap(v.extmaps),D+=this.printUnrecognized(v.unrecognized),D}printGroups(v){let D="";return v.length>0&&(D+=v.map(k=>"a=group:".concat(k.semantic).concat(k.identificationTag.map(Z=>"".concat(d).concat(Z)).join("")).concat(this.eol)).join("")),D}printIceLite(v){return v===void 0?"":"a=ice-lite"+this.eol}printTlsId(v){return v?"a=tls-id:".concat(v).concat(this.eol):""}printIdentity(v){return v.length===0?"":v.map(D=>"a=identity:".concat(D.assertionValue).concat(D.extensions.map(k=>"".concat(d).concat(k.name).concat(k.value?"=".concat(k.value):"")))).join(this.eol)+this.eol}printMsidSemantic(v){if(!v)return"";let D="a=msid-semantic:".concat(v.semantic);return v.applyForAll?D+="".concat(d,"*"):v.identifierList.length>0&&(D+=v.identifierList.map(k=>"".concat(d).concat(k))),D+this.eol}}class z extends Ae{print(v){const D=v.attributes;let k="";return k+=this.printRTCP(D.rtcp),k+=this.printIceUfrag(D.iceUfrag),k+=this.printIcePwd(D.icePwd),k+=this.printIceOptions(D.iceOptions),k+=this.printCandidates(D.candidates),k+=this.printRemoteCandidatesList(D.remoteCandidatesList),k+=this.printEndOfCandidates(D.endOfCandidates),k+=this.printFingerprints(D.fingerprints),k+=this.printSetup(D.setup),k+=this.printMid(D.mid),k+=this.printExtmap(D.extmaps),k+=this.printRTPRelated(D),k+=this.printPtime(D.ptime),k+=this.printMaxPtime(D.maxPtime),k+=this.printDirection(D.direction),k+=this.printSSRCGroups(D.ssrcGroups),k+=this.printSSRC(D.ssrcs),k+=this.printRTCPMux(D.rtcpMux),k+=this.printRTCPMuxOnly(D.rtcpMuxOnly),k+=this.printRTCPRsize(D.rtcpRsize),k+=this.printMSId(D.msids),k+=this.printImageattr(D.imageattr),k+=this.printRid(D.rids),k+=this.printSimulcast(D.simulcast),k+=this.printSCTPPort(D.sctpPort),k+=this.printMaxMessageSize(D.maxMessageSize),k+=this.printUnrecognized(D.unrecognized),k}printCandidates(v){return v.map(D=>"a=candidate:".concat(D.foundation).concat(d).concat(D.componentId).concat(d).concat(D.transport).concat(d).concat(D.priority).concat(d).concat(D.connectionAddress).concat(d).concat(D.port).concat(d,"typ").concat(d).concat(D.type).concat(D.relAddr?"".concat(d,"raddr").concat(d).concat(D.relAddr):"").concat(D.relPort?"".concat(d,"rport").concat(d).concat(D.relPort):"").concat(Object.keys(D.extension).map(k=>"".concat(d).concat(k).concat(d).concat(D.extension[k])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(v){return v.map(D=>"a=remote-candidates:".concat(D.join(d)).concat(this.eol)).join("")}printEndOfCandidates(v){return v===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(v){if(!v.payloads)return"";const D=v.payloads;let k="";k+=v.rtcpFeedbackWildcards.map(Z=>this.printRTCPFeedback("*",Z)).join("");for(const Z of D)k+=this.printRtpMap(Z.payloadType,Z.rtpMap),k+=this.printFmtp(Z.payloadType,Z.fmtp),k+=Z.rtcpFeedbacks.map(Ut=>this.printRTCPFeedback(Z.payloadType,Ut)).join("");return k}printFmtp(v,D){if(!D)return"";const k=Object.keys(D.parameters);return k.length===1&&D.parameters[k[0]]===null?"a=fmtp:".concat(v).concat(d).concat(k[0]).concat(this.eol):"a=fmtp:".concat(v).concat(d).concat(Object.keys(D.parameters).map(Z=>"".concat(Z,"=").concat(D.parameters[Z])).join(";")).concat(this.eol)}printRtpMap(v,D){return D?"a=rtpmap:".concat(v).concat(d).concat(D.encodingName,"/").concat(D.clockRate).concat(D.encodingParameters?"/".concat(D.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(v,D){let k="a=rtcp-fb:".concat(v).concat(d),Z=D;return Z.type==="trr-int"?k+="ttr-int".concat(d).concat(Z.interval):(k+="".concat(Z.type),Z.parameter&&(k+="".concat(d).concat(Z.parameter),Z.additional&&(k+="".concat(d).concat(Z.additional)))),k+this.eol}printPtime(v){return v===void 0?"":"a=ptime:".concat(v).concat(this.eol)}printMaxPtime(v){return v===void 0?"":"a=maxptime:".concat(v).concat(this.eol)}printDirection(v){return v===void 0?"":"a=".concat(v).concat(this.eol)}printSSRC(v){return v.map(D=>Object.keys(D.attributes).map(k=>"a=ssrc:".concat(D.ssrcId.toString(10)).concat(d).concat(k).concat(D.attributes[k]?":".concat(D.attributes[k]):"").concat(this.eol)).join("")).join("")}printRTCPMux(v){return v===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(v){return v===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(v){return v===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(v){if(v===void 0)return"";let D="a=rtcp:".concat(v.port);return v.netType&&(D+="".concat(d).concat(v.netType)),v.addressType&&(D+="".concat(d).concat(v.addressType)),v.address&&(D+="".concat(d).concat(v.address)),D+this.eol}printMSId(v){return v.map(D=>"a=msid:".concat(D.id).concat(D.appdata?"".concat(d).concat(D.appdata):"").concat(this.eol)).join("")}printImageattr(v){return v.map(D=>"a=imageattr:".concat(D).concat(this.eol)).join("")}printRid(v){return v.map(D=>{let k="a=rid:".concat(D.id).concat(d).concat(D.direction);return D.payloads&&(k+="".concat(d,"pt=").concat(D.payloads.join(","))),D.params.length>0&&(k+="".concat(d).concat(D.params.map(Z=>Z.type==="depend"?"depend=".concat(Z.rids.join(",")):"".concat(Z.type,"=").concat(Z.val)).join(";"))),k+this.eol}).join("")}printSimulcast(v){return v===void 0?"":"a=simulcast:".concat(v).concat(this.eol)}printSCTPPort(v){return v===void 0?"":"a=sctp-port:".concat(v).concat(this.eol)}printMaxMessageSize(v){return v===void 0?"":"a=max-message-size:".concat(v).concat(this.eol)}printMid(v){return v===void 0?"":"a=mid:".concat(v).concat(this.eol)}printSSRCGroups(v){return v.map(D=>"a=ssrc-group:".concat(D.semantic).concat(D.ssrcIds.map(k=>"".concat(d).concat(k.toString(10))).join("")).concat(this.eol)).join("")}}function $(Y){return new it().parse(Y)}function ft(Y,v){return new Ue().print(Y,v)}}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}return n.d=(i,r)=>{for(var s in r)n.o(r,s)&&!n.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:r[s]})},n.o=(i,r)=>Object.prototype.hasOwnProperty.call(i,r),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function vr(t){return FL.parse(t)}function pd(t,e){return FL.print(t,e)}var s4=Nr("Array","keys"),o4=bs,c4=Vn,l4=he,d4=s4,$b=Array.prototype,u4={DOMTokenList:!0,NodeList:!0},h4=function(t){var e=t.keys;return t===$b||l4($b,t)&&e===$b.keys||c4(u4,o4(t))?d4:e},ia=kt(h4);function an(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Bt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jL(Object(n),!0).forEach(function(i){an(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const GL=new class extends Xe{constructor(){super(...arguments),an(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class p4{constructor(e){an(this,"logger",void 0),an(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function tI(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function HL(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Na={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},RR=Date.now(),JE=t=>{for(const e in Na)if(Object.prototype.hasOwnProperty.call(Na,e)&&Na[e]===t)return e;return"DEFAULT"},S=new class{constructor(){an(this,"proxyServerURL",void 0),an(this,"logLevel",Na.DEBUG),an(this,"uploadState","collecting"),an(this,"uploadLogWaitingList",[]),an(this,"uploadLogUploadingList",[]),an(this,"uploadErrorCount",0),an(this,"currentLogID",0),an(this,"url",void 0),an(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Na.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Na.INFO].concat(e);this.log.apply(this,i)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Na.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Na.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[Na.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Se("UPLOAD_LOG",!0)}disableLogUpload(){Se("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new p4(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-RR<100)return void setTimeout(()=>{this.log(...e)},Date.now()-RR);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=tI()+" Agora-SDK [".concat(JE(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const r=tI()+" %cAgora-SDK [".concat(JE(i),"]:");let s=[];if(!N("USE_NEW_LOG"))switch(i){case Na.DEBUG:s=[r,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,s);break;case Na.INFO:s=[r,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,s);break;case Na.WARNING:s=[r,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,s);break;case Na.ERROR:s=[r,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-RR<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-RR);const i=Math.max(0,Math.min(4,e[0]));e[0]=tI()+" Agora-SDK [".concat(JE(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(t){if(!N("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=HL()+" Agora-SDK [".concat(JE(t),"]:"):n[0]=HL()+" Agora-SDK [".concat(JE(t),"]:");let r="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),r+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:r,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:wa,process_id:N("PROCESS_ID"),payload:JSON.stringify(t)};return Ks(async()=>{const n=await sr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(N("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(N("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>{const i={status:-1,message:n.message,errorRange:t.map(r=>r.log_item_id)};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),GL.reportLogUploadError(i),!0},{timeout:N("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:N("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,N("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),N("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var WL;function f4(t){return ei(t.reportId,"params.reportId",0,100,!1),ei(t.category,"params.category",0,100,!1),ei(t.event,"params.event",0,100,!1),ei(t.label,"params.label",0,100,!1),ye(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(WL={}).FREE="free",WL.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const _4={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let jn=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),We=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let m4=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function At(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,i){const r=i.value;if(typeof r=="function"){const s=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);i.value=function(){for(var c,l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];let p=d;if(t.argsMap)try{p=t.argsMap(this,...d)}catch(m){S.warning(m),p=[]}try{JSON.stringify(p)}catch{S.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),p=[]}const _=(t.report||gt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(s,".").concat(String(n)),options:p,tag:rn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const m=r.apply(this,d);return m instanceof st?m.then(g=>(_.onSuccess(t.reportResult&&g),g)).catch(g=>{throw _.onError(g),g}):(_.onSuccess(t.reportResult&&m),m)}catch(m){throw _.onError(m),m}}}return i}}const gt=new class{constructor(){an(this,"baseInfoMap",new Map),an(this,"proxyServer",void 0),an(this,"eventUploadTimer",void 0),an(this,"setSessionIdTimer",void 0),an(this,"url",void 0),an(this,"sids",new Set),an(this,"backupUrl",void 0),an(this,"_appId",void 0),an(this,"_aid",0),an(this,"keyEventUploadPendingItems",[]),an(this,"normalEventUploadPendingItems",[]),an(this,"apiInvokeUploadPendingItems",[]),an(this,"apiInvokeCount",0),an(this,"apiInvokeLoggedCount",0),an(this,"ltsList",[]),an(this,"lastSendNormalEventTime",Date.now()),an(this,"customReportCounterTimer",void 0),an(this,"customReportCount",0),an(this,"extApiInvoke",async t=>{for(const e of t){const n=Bt(Bt({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:rn.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),N("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),N("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,e=>{let[n,i]=e;return n+i}),16)||0}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,s=!!N("SHOW_REPORT_INVOKER_LOG"),c=!!N("SHOW_REPORT_USER_INVOKER_LOG"),l=s||c&&e.id;l&&(this.apiInvokeLoggedCount+=1);const d=this.apiInvokeLoggedCount;function h(g,C){if(l){let R="[apiInvoke-".concat(d,"]");if(e.id&&(R+="[".concat(e.id,"]")),e.name&&(R+="[".concat(e.name,"]"),e.name===vn.JOIN))return S.info("".concat(R," ").concat(g));S.info("".concat(R," ").concat(g),g==="start"?e.options:C||"")}}const p=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null});h("start");let _=!1;ni(e.timeout).then(()=>{_||(this.sendApiInvoke(Bt(Bt({},p()),{},{error:O.API_INVOKE_TIMEOUT,success:!1})),h("timeout"))});const m=new G(O.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:g=>{const C=()=>{if(_)throw m;return _=!0,this.sendApiInvoke(Bt(Bt({},p()),{},{success:!0},e.reportResult&&{result:g})),h("onSuccess"),g};return n?yL(C,e.name+"Success",n,()=>_=!0):C()},onError:g=>{const C=()=>{if(_)throw g;_=!0,this.sendApiInvoke(Bt(Bt({},p()),{},{success:!1,error:g})),h("onFailure",g.toString())};return n?yL(C,e.name+"Error",n,()=>_=!0):C()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),i=this.createBaseInfo(t,n);i.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:N("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Xb?"global":"oversea",areas:N("AREAS")&&N("AREAS").join(",")},e.extend),{stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientRole:p}=e,_=Date.now(),m=Bt(Bt({},i),{},{eventType:jn.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:Qb,lts:_,elapse:_-n,extend:JSON.stringify(r),mode:e.mode,process:N("PROCESS_ID"),appType:N("APP_TYPE"),success:!0,version:wa,stringUid:s,channelProfile:c,channelMode:l,isABTestSuccess:d,lsid:h,clientType:rt(g=window.navigator.userAgent).call(g,"AgoraWebView")?42:20,clientRole:p,serviceId:N("PROCESS_ID"),extensionID:N("PLUGIN_INFO").join(",")||""});var g;this.send({type:We.SESSION,data:m},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt({},i),{},{role:e.role,eventType:jn.JOIN_CHOOSE_SERVER,lts:r,eventElapse:e.elapse||r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0});this.send({type:We.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt({},i),{},{eventType:jn.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||r-n.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:We.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;const r=Date.now(),{firstSuccess:s,addr:c,isProxy:l}=e,d=r-n.startTime,h=Bt(Bt({},i),{},{eventType:jn.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:d,eventElapse:r-e.lts,firstSuccess:s,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:qb(),isABTestSuccess:e.isABTestSuccess?1:0}),p=h.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=r),s)this.send({type:We.JOIN_GATEWAY,data:h},!0);else{let _;if(c)if(l){const g=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),C=c.match(/p=[0-9]{1,6}/g);_={isSuccess:p,gatewayIp:g&&g.length?g[0].split("=")[1].replace(/-/g,"."):"",port:C&&C.length?C[0].split("=")[1]:"",isProxy:l?1:0}}else{const g=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),C=c.match(/(:|p=)[0-9]{1,6}/g);_={isSuccess:p,gatewayIp:g&&g.length?g[0].split("//")[1].replace(/-/g,"."):"",port:C&&C.length?C[0].split(/:|p=/g)[1]:"",isProxy:l?1:0}}else _={isSuccess:p,gatewayIp:"",port:"",isProxy:l?1:0};delete h.success,delete h.eventType,delete h.firstSuccess,h.vid=Number(h.vid);const m=Object.assign({},h,_,{eventType:jn.REJOIN_GATEWAY});this.send({type:We.RE_JOIN_GATEWAY,data:m},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=Date.now(),r=Bt(Bt({},n.info),{},{lts:i,timeout:e,elapse:i-n.startTime});this.send({type:We.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt({},i),{},{eventType:jn.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:We.PUBLISH,data:s},!0)}subscribe(t,e,n){const i=this.baseInfoMap.get(t);if(!i)return;const r=i.info,s=Date.now(),c=Bt(Bt({},r),{},{eventType:jn.SUBSCRIBE,lts:s,eventElapse:e.eventElapse,elapse:s-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?c.peerSuid=e.peerid:c.peer=e.peerid,this.send({type:We.SUBSCRIBE,data:c},!0)}wsCompressorInit(t){var e;const n=[...ia(e=this.baseInfoMap).call(e)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const s=r.info,c=Date.now(),l=Bt(Bt({},s),{},{eventType:jn.WS_COMPRESSOR_INIT,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,status:t.status?1:2});this.send({type:We.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=Bt(Bt(Bt({},s),i),{},{elapse:c-r.startTime,eventType:e,lts:c,firstDecodeFrame:Math.max((i.firstFrame||c)-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=Bt(Bt(Bt({},s),i),{},{elapse:c-r.startTime,eventType:e,lts:c});this.send({type:n,data:l},!0)}abTest(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt(Bt({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:jn.AB_TEST,lts:r});this.send({type:We.AB_TEST,data:s},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt(Bt({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:r-n.startTime,eventType:jn.PC_STATS,lts:r,preallocation:e.preallocation?1:0});this.send({type:We.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt(Bt({},i),e),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:jn.UPDATE_REMOTE_RTPCAPABILITIES,lts:r});this.send({type:We.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,c=Date.now(),l=Bt(Bt(Bt({},s),i),{},{eventType:e,lts:c});this.send({type:n,data:l},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt({},i),{},{eventType:jn.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-n.startTime,success:e.succ});this.send({type:We.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt({},i),{},{eventType:jn.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:We.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt({},i),{},{eventType:jn.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:We.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(t){this.proxyServer=t,t?S.debug("reportProxyServerurl: ".concat(t)):S.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:We.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now();(function(s,c,l){const d=s[c];if(!d||typeof d!="string")return[s];s[c]="";const h=Bo(JSON.stringify(s));let p=0;const _=[];let m=0;for(let g=0;g<d.length;g++)m+=d.charCodeAt(g)<=127?1:3,m<=l-h||(_[_.length]=ht(ht({},s),{},{[c]:d.substring(p,g)}),p=g,m=d.charCodeAt(g)<=127?1:3);return p!==d.length-1&&(_[_.length]=ht(ht({},s),{},{[c]:d.substring(p)})),_})(Bt(Bt(Bt({},i),e),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:We.WORKER_EVENT,data:s},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt(Bt({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:We.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt(Bt({},i),e),{},{elapse:r-n.startTime,lts:r,extend:e.extend||void 0});this.send({type:We.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=Bt(Bt(Bt({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:We.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>N("CUSTOM_REPORT_LIMIT"))throw new G(O.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=e.map(r=>({type:We.USER_ANALYTICS,data:Bt(Bt({sid:t},r),{},{lts:n})}));try{N("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(r){throw S.error("send custom report message failed",r.toString()),new G(O.CUSTOM_REPORT_SEND_FAILED,r.message)}}sendApiInvoke(t){const e=N("NOT_REPORT_EVENT");if(t.tag&&rt(e)&&rt(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:r,cid:s}=n.info;let c;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof G){const{code:d,message:h}=t.error;c=d||h||t.error.toString()}else c=t.error.toString();const l={invokeId:t.invokeId,sid:t.sid,cname:i,cid:s,uid:r,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?c:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:We.API_INVOKE,data:l},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>N("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],i=[];for(;t.length;){const s=t.shift();n.length<20?n.push(s):i.push(s)}t.push(...i);for(const s of[...n]){var r;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),Mt(r=this.ltsList).call(r,(c,l)=>c-l))}return e||(this.lastSendNormalEventTime=Date.now()),N("ENABLE_EVENT_REPORT")&&n.length&&(N("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((s=>c=>{N("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>N("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-N("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){Rn.networkState===Fr.OFFLINE&&await st.race([Rn.onlineWaiter,ni(2*In.maxRetryTimeout)]);const e=r=>{let s=new Uint8Array;return r.forEach(c=>{const l=Mb(JSON.stringify(c.data)),d=new ArrayBuffer(5),h=(_=>{let m=0;return Object.entries(We).forEach(g=>{let[C,R]=g;R===_.type&&(m=m4[C])}),m})(c),p=new DataView(d);p.setUint16(0,l.byteLength,!0),p.setUint8(2,255&h),p.setUint8(3,h>>>8&255),p.setUint8(4,h>>>16&255),s=fL(s,new Uint8Array(d)),s=fL(s,l)}),s},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(N("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){r===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(N("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Hb(i,{timeout:1e4,data:e(t),headers:Bt(Bt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(r===1)throw s;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(l=>{const d=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return d&&d.info.vid&&+d.info.vid||0})(t[0]),i=n?void 0:this._aid,r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(l=>JSON.stringify(l)),vid:n,aid:i};Rn.networkState===Fr.OFFLINE&&await st.race([Rn.onlineWaiter,ni(2*In.maxRetryTimeout)]);const s=e?"/events/proto-raws":"/events/messages";let c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("EVENT_REPORT_DOMAIN"),"&p=").concat(N("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(N("EVENT_REPORT_DOMAIN"),":").concat(N("STATS_COLLECTOR_PORT")).concat(s));for(let l=0;l<2;l+=1){l===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(N("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(N("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(N("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(N("STATS_COLLECTOR_PORT")).concat(s)));try{e?await e4(c,{timeout:1e4,data:r}):await Hb(c,{timeout:1e4,data:r})}catch(d){if(l===1)throw d;continue}return}}createBaseInfo(t,e){const n=Object.assign({},_4);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:rn.TRACER}).onSuccess()}};GL.on("REPORT_LOG_UPLOAD",t=>{t.networkState=Rn.networkState,gt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:rn.TRACER}).onSuccess("logUploadError")});class B extends G{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),an(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,S)}throw(){super.throw(S)}}const ii={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function se(){return ii}function KL(){return"setSinkId"in HTMLAudioElement.prototype&&(!N("RESTRICTION_SET_PLAYBACK_DEVICE")||(jc()||nL())&&!Lb())}function zL(){return!ii.supportUnifiedPlan||N("CHROME_FORCE_PLAN_B")&&Gc()}let ri=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Af(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function oe(t,e,n,i,r){return{width:t,height:e,frameRate:n,bitrateMin:i,bitrateMax:r}}function cs(t,e,n,i,r){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:i,bitrateMax:r}}function eI(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const E4={"90p":oe(160,90),"90p_1":oe(160,90),"120p":oe(160,120,15,30,65),"120p_1":oe(160,120,15,30,65),"120p_3":oe(120,120,15,30,50),"120p_4":oe(212,120),"180p":oe(320,180,15,30,140),"180p_1":oe(320,180,15,30,140),"180p_3":oe(180,180,15,30,100),"180p_4":oe(240,180,15,30,120),"240p":oe(320,240,15,40,200),"240p_1":oe(320,240,15,40,200),"240p_3":oe(240,240,15,40,140),"240p_4":oe(424,240,15,40,220),"360p":oe(640,360,15,80,400),"360p_1":oe(640,360,15,80,400),"360p_3":oe(360,360,15,80,260),"360p_4":oe(640,360,30,80,600),"360p_6":oe(360,360,30,80,400),"360p_7":oe(480,360,15,80,320),"360p_8":oe(480,360,30,80,490),"360p_9":oe(640,360,15,80,800),"360p_10":oe(640,360,24,80,800),"360p_11":oe(640,360,24,80,1e3),"480p":oe(640,480,15,100,500),"480p_1":oe(640,480,15,100,500),"480p_2":oe(640,480,30,100,1e3),"480p_3":oe(480,480,15,100,400),"480p_4":oe(640,480,30,100,750),"480p_6":oe(480,480,30,100,600),"480p_8":oe(848,480,15,100,610),"480p_9":oe(848,480,30,100,930),"480p_10":oe(640,480,10,100,400),"720p":oe(1280,720,15,120,1130),"720p_auto":oe(1280,720,30,900,3e3),"720p_1":oe(1280,720,15,120,1130),"720p_2":oe(1280,720,30,120,2e3),"720p_3":oe(1280,720,30,120,1710),"720p_5":oe(960,720,15,120,910),"720p_6":oe(960,720,30,120,1380),"1080p":oe(1920,1080,15,120,2080),"1080p_1":oe(1920,1080,15,120,2080),"1080p_2":oe(1920,1080,30,120,3e3),"1080p_3":oe(1920,1080,30,120,3150),"1080p_5":oe(1920,1080,60,120,4780),"1440p":oe(2560,1440,30,120,4850),"1440p_1":oe(2560,1440,30,120,4850),"1440p_2":oe(2560,1440,60,120,7350),"4k":oe(3840,2160,30,120,8910),"4k_1":oe(3840,2160,30,120,8910),"4k_3":oe(3840,2160,60,120,13500)},g4={"480p":cs(640,480,5),"480p_1":cs(640,480,5),"480p_2":cs(640,480,30),"480p_3":cs(640,480,15),"720p":cs(1280,720,5),"720p_auto":oe(1280,720,30,900,3e3),"720p_1":cs(1280,720,5),"720p_2":cs(1280,720,30),"720p_3":cs(1280,720,15),"1080p":cs(1920,1080,5),"1080p_1":cs(1920,1080,5),"1080p_2":cs(1920,1080,30),"1080p_3":cs(1920,1080,15)},S4={"1SL1TL":eI(1,1),"3SL3TL":eI(3,3),"2SL3TL":eI(2,3)};function ls(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},E4[t]):t}function nI(t){return typeof t=="string"?Object.assign({},g4[t]):t}function yR(t){return typeof t=="string"?Object.assign({},S4[t]):t}const T4={speech_low_quality:Af(16e3,!1),speech_standard:Af(32e3,!1,18),music_standard:Af(48e3,!1),standard_stereo:Af(48e3,!0,56),high_quality:Af(48e3,!1,128),high_quality_stereo:Af(48e3,!0,192)};function CR(t){return typeof t=="string"?Object.assign({},T4[t]):t}const bf=[];function YL(t){return xn(t,"mediaSource",["screen","window","application"]),!0}let _t=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Ce=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),If=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),v4=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),R4=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),eh=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Of=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),wf=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),Nf=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),ra=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const iI={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},rI={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},qL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},y4={uplinkNetworkQuality:0,downlinkNetworkQuality:0},XL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Xi=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),aa=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),QE=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),nh=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),Li=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),jo=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const aI={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let AR=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function te(t,e,n,i,r){var s,c,l={};return Object.keys(i).forEach(function(d){l[d]=i[d]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=_r(s=qh(c=n.slice()).call(c)).call(s,function(d,h){return h(t,e,d)||d},l),r&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(r):void 0,l.initializer=void 0),l.initializer===void 0?(Object.defineProperty(t,e,l),null):l}function V(t,e,n){return(e=function(i){var r=function(s,c){if(typeof s!="object"||!s)return s;var l=s[Symbol.toPrimitive];if(l!==void 0){var d=l.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(i);return typeof r=="symbol"?r:r+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function JL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ke(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?JL(Object(n),!0).forEach(function(i){V(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):JL(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class QL extends Xe{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(eh.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),V(this,"trackMediaType",void 0),V(this,"_ID",void 0),V(this,"_rtpTransceiver",void 0),V(this,"_lowRtpTransceiver",void 0),V(this,"_hints",[]),V(this,"_isClosed",!1),V(this,"_originMediaStreamTrack",void 0),V(this,"mediaStreamTrack",void 0),V(this,"_external",{}),this._ID=n||Le(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(i){rt(bf).call(bf,i)||bf.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||ud(()=>{var n;gt.reportApiInvoke(null,{name:vn.GET_MEDIA_STREAM_TRACK,options:[],tag:rn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===If.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=bf.indexOf(e);n!==-1&&bf.splice(n,1)}(this),this.emit(Of.CLOSED),this.removeAllListeners(eh.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===If.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(eh.TRANSCEIVER_UPDATED,e,n)}}class Df extends QL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),V(this,"_enabled",!0),V(this,"_muted",!1),V(this,"_isExternalTrack",!1),V(this,"_isClosed",!1),V(this,"_enabledMutex",void 0),V(this,"processor",void 0),V(this,"_processorContext",void 0),V(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Ti("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(_t.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ie(this,_t.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Of.TRACK_ENDED)}stateCheck(e,n){if(S.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),Hc(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new G(O.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",S);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new G(O.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",S)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():st.resolve([])}}const ZL=window.AudioContext||window.webkitAudioContext;let sa=null;const Te=new class extends Xe{constructor(){super(...arguments),V(this,"prevState",void 0),V(this,"curState",void 0),V(this,"currentTime",void 0),V(this,"currentTimeStuckAt",void 0),V(this,"interruptDetectorTrack",void 0),V(this,"onLocalAudioTrackMute",()=>{S.info("ios15-interruption-start"),this.emit(ri.IOS_15_16_INTERRUPTION_START)}),V(this,"onLocalAudioTrackUnmute",async()=>{S.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?S.info("ios15-interruption-end-canceled"):(sa&&await sa.suspend(),this.emit(ri.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){S.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){S.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Lf(){if(!sa){if(function(){if(!ZL)return void S.error("your browser is not support web audio");S.info("create audio context");const t=Ke({},N("WEBAUDIO_INIT_OPTIONS"));S.debug("audio context init option:",JSON.stringify(t)),sa=new ZL(t),Te.curState=sa.state,sa.onstatechange=()=>{Te.prevState=Te.curState,Te.curState=sa?sa.state:void 0;const{prevState:e,curState:n}=Te,i=n==="running",r=n==="interrupted",s=e==="running",c=e==="suspended",l=e==="interrupted",d=ae().osVersion;(qi()||ss())&&s&&r&&(S.info("ios".concat(d,"-interruption-start")),Te.emit(ri.IOS_INTERRUPTION_START)),(qi()||ss())&&(c||l)&&i&&(S.info("ios".concat(d,"-interruption-end")),Te.emit(ri.IOS_INTERRUPTION_END)),e!==n&&Te.emit(ri.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=sa)===null||e===void 0?void 0:e.currentTime;Te.currentTime!==n?(Te.currentTimeStuckAt&&(S.debug("AudioContext current time resume at ".concat(n)),Te.currentTimeStuckAt=void 0),Te.currentTime=n):(n!==Te.currentTimeStuckAt&&(gt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:rn.TRACER}).onSuccess(),S.warning("AudioContext current time stuck at ".concat(n))),Te.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,r=!1,s=!1,c=!1;function l(R){e.state==="running"?d(!1):qi()||ss()?e.state==="suspended"&&(d(!0),R&&e.resume().then(h,h)):e.state!=="closed"&&(d(!0),R&&e.resume().then(h,h))}function d(R){if(r!==R){r=R;for(let y=0,b=n;y<b.length;y+=1){const I=b[y];R?window.addEventListener(I,p,{capture:!0,passive:!0}):window.removeEventListener(I,p,{capture:!0,passive:!0})}}}function h(){l(!1)}function p(){l(!0)}function _(R){if(!c)if(i.paused)if(R){let y;m(!1),c=!0;try{y=i.play(),y?y.then(g,g):(i.addEventListener("playing",g),i.addEventListener("abort",g),i.addEventListener("error",g))}catch{g()}}else m(!0);else m(!1)}function m(R){if(s!==R){s=R;for(let y=0,b=n;y<b.length;y++){const I=b[y];R?window.addEventListener(I,C,{capture:!0,passive:!0}):window.removeEventListener(I,C,{capture:!0,passive:!0})}}}function g(){i.removeEventListener("playing",g),i.removeEventListener("abort",g),i.removeEventListener("error",g),c=!1,_(!1)}function C(){_(!0)}if(qi()){const R=e.createMediaStreamDestination(),y=document.createElement("div");y.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=y.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=R.stream,_(!0)}Te.on(ri.STATE_CHANGE,function(){l(!0)}),l(!1)}(sa)}(),!sa)throw new G(O.NOT_SUPPORTED,"can not create audio context");return sa}return sa}function ih(t){if(function(){if(sI!==null)return sI;const i=Lf(),r=i.createBufferSource(),s=i.createGain(),c=i.createGain();r.connect(s),r.connect(c),r.disconnect(s);let l=!1;try{r.disconnect(s)}catch{l=!0}return r.disconnect(),sI=l,l}())return;const e=t.connect,n=t.disconnect;t.connect=(i,r,s)=>{var c;return t._inputNodes||(t._inputNodes=[]),rt(c=t._inputNodes).call(c,i)||(i instanceof AudioNode?(t._inputNodes.push(i),e.call(t,i,r,s)):e.call(t,i,r)),t},t.disconnect=(i,r,s)=>{n.call(t),i?fR(t._inputNodes,i):t._inputNodes=[];for(const c of t._inputNodes)e.call(t,c)}}let sI=null;function oI(t,e){let n=!1;const i=1/e;if(N("DISABLE_WEBAUDIO")){const r=window.setInterval(()=>{n?window.clearInterval(r):t(performance.now()/1e3)},1e3*i)}else{const r=Lf();let s=r.createGain();s.gain.value=0,s.connect(r.destination);const c=()=>{if(n)return void(s=null);const l=r.createOscillator();l.onended=c,l.connect(s),l.start(0),l.stop(r.currentTime+i),t(r.currentTime)};c()}return()=>{n=!0}}class $L{constructor(){V(this,"context",void 0),V(this,"analyserNode",void 0),V(this,"sourceNode",void 0),this.context=Lf(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||qi()||ss()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let r=0;r<e.length;++r)e[r]=i[r]/128-1}const n=_r(e).call(e,(i,r)=>i+r*r,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{S.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class tP extends Xe{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),V(this,"outputNode",void 0),V(this,"outputTrack",void 0),V(this,"isPlayed",!1),V(this,"sourceNode",void 0),V(this,"context",void 0),V(this,"audioBufferNode",void 0),V(this,"destNode",void 0),V(this,"audioOutputLevel",0),V(this,"volumeLevelAnalyser",void 0),V(this,"_processedNode",void 0),V(this,"playNode",void 0),V(this,"isDestroyed",!1),V(this,"onNoAudioInput",void 0),V(this,"isNoAudioInput",!1),V(this,"_noAudioInputCount",0),this.context=Lf(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),ih(this.outputNode),this.volumeLevelAnalyser=new $L}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(ra.ON_AUDIO_BUFFER,function(i){for(let r=0;r<i.outputBuffer.numberOfChannels;r+=1){const s=i.outputBuffer.getChannelData(r);for(let c=0;c<s.length;c+=1)s[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!se().webAudioMediaStreamDest)throw new G(O.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&_R(()=>{Te.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;qi()||ss()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let r=!1;for(let s=0;s<i.length;s++)i[s]!==0&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await ni(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class eP extends tP{get isFreeze(){return!1}constructor(e,n,i){var r;if(super(),V(this,"sourceNode",void 0),V(this,"track",void 0),V(this,"clonedTrack",void 0),V(this,"audioElement",void 0),V(this,"isCurrentTrackCloned",!1),V(this,"isRemoteTrack",!1),V(this,"originVolumeLevelAnalyser",void 0),V(this,"rebuildWebAudio",async()=>{if(S.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void S.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>S.info("resume success")),S.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),ih(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const h=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(h,this.context.currentTime),ih(this.outputNode),this.emit(ra.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new G(O.UNEXPECTED_ERROR);this.track=e;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),ih(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,S.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const d=this.context.createMediaStreamSource(new MediaStream([l]));ih(d),this.originVolumeLevelAnalyser=new $L,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const c=ae();n&&c.os===Fn.IOS&&Number((r=c.osVersion)===null||r===void 0?void 0:r.split(".")[0])<15&&(Te.on(ri.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),ih(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ra.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Te.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),S.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));ih(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function nP(t,e,n){const i=(s,c)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||c:s:c,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(r.video.mandatory.maxFrameRate=e.frameRate.max,r.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(r.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function C4(t,e){const n=await iP(t.mediaSource),{sourceId:i,audio:r}=await function(s){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new st((l,d)=>{const h=document.createElement("div");h.innerText="share screen",h.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const _=document.createElement("div");_.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",_.setAttribute("style","height: 12%;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const g=document.createElement("div");g.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const C=document.createElement("button");C.innerHTML="cancel",C.setAttribute("style","width: 85px;"),C.onclick=()=>{document.body.removeChild(b);const I=new Error("NotAllowedError");I.name="NotAllowedError",d(I)};let R=c;const y=document.createElement("div");if(c){const I=document.createElement("input");I.setAttribute("type","checkbox");const L=document.createElement("span");I.setAttribute("style","margin-right: 6px;"),L.innerText="Share audio",I.checked=R,I.onchange=()=>{R=I.checked},y.appendChild(I),y.appendChild(L)}g.appendChild(y),g.appendChild(C),p.appendChild(_),p.appendChild(m),p.appendChild(g);const b=document.createElement("div");b.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),b.appendChild(h),b.appendChild(p),document.body.appendChild(b),s.map(I=>{if(I.id){const L=document.createElement("div");L.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let U=I.thumbnail;try{const{width:x}=U.getSize();x>1920&&(U=U.resize({width:1920}))}catch(x){throw x&&x.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),x}L.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+U.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+I.name.replace(/[\u00A0-\u9999<>\&]/g,function(x){return"&#"+x.charCodeAt(0)+";"})+"</span>",L.onclick=()=>{document.body.removeChild(b),l({sourceId:I.id,audio:R})},m.appendChild(L)}})})}(n,e);return await nP(i,t,r)}async function iP(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=_L();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new G(O.ELECTRON_IS_NULL);let i=null;try{var r;i=((r=n.desktopCapturer)===null||r===void 0?void 0:r.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{i=null}i&&i.then||(i=new st((s,c)=>{n.desktopCapturer.getSources({types:e},(l,d)=>{l?c(l):s(d)})}));try{return await i}catch(s){throw new G(O.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const cI=new Ti("safari");let rP=!1,aP=!1;async function oa(t,e){let n=0,i=null;for(;n<2;)try{i=await A4(t,e,n>0);break}catch(r){if(r instanceof G)throw S.error("[".concat(e,"] ").concat(r.toString())),r;const s=bR(r.name||r.code||r,r.message);if(s.code===O.MEDIA_OPTION_INVALID){S.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await ni(500);continue}throw S.error("[".concat(e,"] ").concat(s.toString())),s}if(!i)throw new G(O.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function A4(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new G(O.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const i=se(),r=new MediaStream;if(t.audioSource&&r.addTrack(t.audioSource),t.videoSource&&r.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return S.debug("Using Video Source/ Audio Source"),r;if(t.screen)if(_L())t.screen.sourceId?Pf(r,await nP(t.screen.sourceId,t.screen,!!t.screenAudio)):Pf(r,await C4(t.screen,!!t.screenAudio));else if(jc()&&t.screen.extensionId&&t.screen.mandatory){if(!i.getStreamFromExtension)throw new G(O.NOT_SUPPORTED,"This browser does not support screen sharing");S.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const m=await(c=t.screen.extensionId,l=e,new st((g,C)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},R=>{if(!R||!R.streamId)return S.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),R),void C(new G(O.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));g(R.streamId)})}catch(R){S.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),R.toString()),C(new G(O.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=m,Pf(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(i.getDisplayMedia){var s;t.screen.mediaSource&&YL(t.screen.mediaSource);const m={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(s=t.screen.displaySurface)!==null&&s!==void 0?s:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:g,surfaceSwitching:C,systemAudio:R,preferCurrentTab:y}=t.screen,b={selfBrowserSurface:g,surfaceSwitching:C,systemAudio:R,preferCurrentTab:y};!g&&delete b.selfBrowserSurface,!C&&delete b.surfaceSwitching,!R&&delete b.systemAudio,!y&&delete b.preferCurrentTab,S.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:m,audio:t.screenAudio,controls:b})),Pf(r,await navigator.mediaDevices.getDisplayMedia(Ke({video:m,audio:t.screenAudio},b)))}else{if(!en())throw S.error("[".concat(e,"] This browser does not support screenSharing")),new G(O.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&YL(t.screen.mediaSource);const m={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};S.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(m))),Pf(r,await navigator.mediaDevices.getUserMedia(m))}}var c,l;if(!t.video&&!t.audio)return r;let d={video:t.video,audio:t.audio},h=N("MEDIA_DEVICE_CONSTRAINTS");if(h)try{typeof h=="string"&&(h=JSON.parse(h)),d=Vb(d,h)}catch{}S.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(d)),ae();let p,_=null;(li()||qi()||hR())&&(_=await cI.lock());try{p=await navigator.mediaDevices.getUserMedia(d)}catch(m){throw _&&_(),m}return d.audio&&(rP=!0),d.video&&(aP=!0),Pf(r,p),_&&_(),r}function bR(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new G(O.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new G(O.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new G(O.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new G(O.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new G(O.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new G(O.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return S.error("getUserMedia unexpected error",t),new G(O.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function Pf(t,e){const n=t.getVideoTracks()[0],i=t.getAudioTracks()[0],r=e.getVideoTracks()[0],s=e.getAudioTracks()[0];s&&(i&&t.removeTrack(i),t.addTrack(s)),r&&(n&&t.removeTrack(n),t.addTrack(r))}const ca=new class extends Xe{get state(){return this._state}set state(t){t!==this._state&&(this.emit(nh.STATE_CHANGE,t),this._state=t)}constructor(){super(),V(this,"_state",QE.IDLE),V(this,"isAccessMicrophonePermission",!1),V(this,"isAccessCameraPermission",!1),V(this,"lastAccessMicrophonePermission",!1),V(this,"lastAccessCameraPermission",!1),V(this,"checkdeviceMatched",!1),V(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(N("ENUMERATE_DEVICES_INTERVAL")||(pR()||uR()===Fn.HARMONY_OS)&&Gc())&&this.updateDevicesInfo()},N("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>S.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new G(O.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let s=!this.isAccessMicrophonePermission&&t,c=!this.isAccessCameraPermission&&e;r.audio&&(s=!1),r.video&&(c=!1);let l=null,d=null,h=null;if(!n&&(s||c)){if(cI.isLocked&&(S.debug("[device manager] wait GUM lock"),(await cI.lock())(),S.debug("[device manager] GUM unlock")),rP&&(s=!1,this.isAccessMicrophonePermission=!0),aP&&(c=!1,this.isAccessCameraPermission=!0),S.debug("[device manager] check media device permissions",t,e,s,c),s&&c){try{h=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){const _=bR(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;S.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{l=await navigator.mediaDevices.getUserMedia({audio:t})}catch(p){const _=bR(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;S.warning("getUserMedia failed in getDevices",_)}this.isAccessMicrophonePermission=!0}else if(c){try{d=await navigator.mediaDevices.getUserMedia({video:e})}catch(p){const _=bR(p.name||p.code||p,p.message);if(_.code===O.PERMISSION_DENIED)throw _;S.warning("getUserMedia failed in getDevices",_)}this.isAccessCameraPermission=!0}S.debug("[device manager] mic permission",t,"cam permission",e)}try{const p=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(_=>_.stop()),d&&d.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),l=null,d=null,h=null,p}catch(p){return l&&l.getTracks().forEach(_=>_.stop()),d&&d.getTracks().forEach(_=>_.stop()),h&&h.getTracks().forEach(_=>_.stop()),l=null,d=null,h=null,new G(O.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new G(O.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=QE.INITING;try{await this.updateDevicesInfo(),this.state=QE.INITEND}catch(t){throw S.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=QE.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new G(O.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const r=t.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),s=t.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");r&&s?s.groupId===r.groupId?S.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is the same group")):S.debug("[device-check] default input ".concat(r.label," and output ").concat(s.label," is not the same group")):S.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(r=>{if(!r.deviceId)return;const s=this.deviceInfoMap.get("".concat(r.kind,"_").concat(r.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const c={initAt:e,updateAt:e,device:r,state:"ACTIVE"};this.deviceInfoMap.set("".concat(r.kind,"_").concat(r.deviceId),c),n.push(c)}s&&(s.updateAt=e)}),this.deviceInfoMap.forEach((r,s)=>{r.state==="ACTIVE"&&r.updateAt!==e&&(r.state="INACTIVE",n.push(r))}),this.state!==QE.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(r=>{switch(r.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(nh.RECORDING_DEVICE_CHANGED,r);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(nh.CAMERA_DEVICE_CHANGED,r);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(nh.PLAYOUT_DEVICE_CHANGED,r)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(r=>r.kind==="audioinput"),n=t.filter(r=>r.kind==="videoinput"),i={audio:!1,video:!1};for(const r of e)if(r.label&&r.deviceId){i.audio=!0;break}for(const r of n)if(r.label&&r.deviceId){i.video=!0;break}return i}};let lI=!1;const la=new class extends Xe{constructor(){super(...arguments),V(this,"onAutoplayFailed",void 0),V(this,"onAudioAutoplayFailed",void 0)}};function sP(){if(ae(),!lI){const t=e=>{e.preventDefault(),lI=!1,GE()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};lI=!0,GE()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),S.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),la.onAutoplayFailed?la.onAutoplayFailed():la.onAudioAutoplayFailed?S.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):S.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),la.emit("autoplay-failed")}}function oP(t,e,n,i){if(!t)return;const r=gt.getBaseInfoBySessionId(t);if(!r)return;const s=r.info,c=Date.now(),l=Ke(Ke({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:c,elapse:c-r.startTime,cbRegistered:la.onAutoplayFailed||la.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:i,extend:void 0});gt.send({type:We.AUTOPLAY_FAILED,data:l},!0)}const b4=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],or=new class{constructor(){V(this,"onAutoplayFailed",void 0),V(this,"elementMap",new Map),V(this,"elementStateMap",new Map),V(this,"elementsNeedToResume",[]),V(this,"sinkIdMap",new Map),V(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const r=this.elementStateMap.get(n),s=i.srcObject.getAudioTracks()[0],c=s&&s.readyState;if(S.debug("resume after interrupted, ele: ".concat(r," audio: ").concat(c," ").concat(t)),c==="live"){if(t)return i.pause(),void i.play();if(Te.curState==="running")return Sf()?(i.pause(),void i.play()):void(r&&r==="paused"&&i.play())}})}),V(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(S.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Te.on(ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Te.on(ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Te.on(ri.STATE_CHANGE,()=>{qi()&&Te.prevState==="suspended"&&Te.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(i){throw new G(O.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(t,e,n,i){if(this.elementMap.has(e))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,r),this.elementMap.set(e,r),this.elementStateMap.set(e,Li.INIT),this.setVolume(e,n);const s=this.sinkIdMap.get(e);if(s)try{r.setSinkId(s).catch(l=>{S.warning("[".concat(e,"] set sink id failed"),l.toString())})}catch(l){S.warning("[".concat(e,"] set sink id failed"),l.toString())}const c=r.play();c&&c.then&&c.catch(l=>{i&&oP(i,"audio",l.message,e),S.warning("audio element play warning",l.toString()),this.elementMap.has(e)&&l.name==="NotAllowedError"&&(S.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),_R(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),sP()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){b4.forEach(n=>{e.addEventListener(n,i=>{const r=this.elementStateMap.get(t),s=i.type==="pause"?"paused":i.type;if(S.debug("[".concat(t,"] audio-element-status change ").concat(r," => ").concat(s)),i.type==="error"){const c=e==null?void 0:e.error;c&&S.error("[".concat(t,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(t,s)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{S.debug("Auto resume audio element success")}).catch(n=>{S.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new st(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{GE()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function dn(){return function(t,e,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new G(O.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",S);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];const l=i.apply(this,s);return l instanceof st?new st((d,h)=>{l.then(d).catch(h)}):l}),n}}class cP extends Xe{constructor(e){super(),V(this,"name","VideoProcessorDestination"),V(this,"ID","0"),V(this,"_source",void 0),V(this,"videoContext",void 0),V(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new G(O.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new G(O.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Xi.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Xi.ON_TRACK,void 0)}}class lP extends Xe{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),V(this,"constraintsMap",new Map),V(this,"statsRegistry",[]),V(this,"usageRegistry",[]),V(this,"trackId",void 0),V(this,"direction",void 0),V(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await ui(this,aa.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var i;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Ie(this,aa.REQUEST_UPDATE_CONSTRAINTS,Array.from(ar(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return S.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Ie(this,aa.REQUEST_UPDATE_CONSTRAINTS,Array.from(ar(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const c=s();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){S.error(new G(O.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof st&&(i=await i),e.push(Ke(Ke({},i),{},{direction:this.direction}))}catch(i){S.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class dP extends Xe{constructor(e){super(),V(this,"name","AudioProcessorDestination"),V(this,"ID","0"),V(this,"inputTrack",void 0),V(this,"inputNode",void 0),V(this,"audioProcessorContext",void 0),V(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new G(O.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new G(O.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Xi.ON_TRACK,void 0),this.emit(Xi.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Xi.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Xi.ON_NODE,this.inputNode))}}class uP extends Xe{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,i){super(),V(this,"constraintsMap",new Map),V(this,"statsRegistry",[]),V(this,"audioContext",void 0),V(this,"trackId",void 0),V(this,"direction",void 0),V(this,"usageRegistry",[]),V(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=i}async getConstraints(){return ui(this,aa.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var i;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Ie(this,aa.REQUEST_UPDATE_CONSTRAINTS,Array.from(ar(i=this.constraintsMap).call(i)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Ie(this,aa.REQUEST_UPDATE_CONSTRAINTS,Array.from(ar(n=this.constraintsMap).call(n)))}registerStats(e,n,i){this.statsRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:i})}unregisterStats(e,n){const i=this.statsRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name&&r.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:i,type:r,cb:s}of this.statsRegistry)try{const c=s();e.push({processorID:n,processorName:i,type:r,stats:c})}catch(c){S.error(new G(O.UNEXPECTED_ERROR,c.message))}return e}registerUsage(e,n){this.usageRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof st&&(i=await i),e.push(Ke(Ke({},i),{},{direction:this.direction}))}catch(i){S.error("gather extension usage error",i)}return e}getDirection(){return this.direction}}class dI extends Xe{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),V(this,"context",void 0),V(this,"processSourceNode",void 0),V(this,"outputTrack",void 0),V(this,"processedNode",void 0),V(this,"clonedTrack",void 0),V(this,"outputNode",void 0),this.outputNode=new I4}setVolume(){}createOutputTrack(){throw new G(O.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class I4{disconnect(){}connect(){}}function hP(t){return new st((e,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const s=qi()?"canplay":"playing";r.addEventListener(s,()=>{const c=r.videoWidth,l=r.videoHeight;!c&&en()||(i=!0,r.srcObject=null,r.remove(),e([c,l]))}),r.srcObject=new MediaStream([t]),r.play().catch(mR),setTimeout(()=>{i||(r.srcObject=null,r.remove(),e([r.videoWidth,r.videoHeight]))},4e3)})}function IR(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=ls(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!dL()&&n.frameRate&&(e.frameRate=n.frameRate),nL()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),en()&&(e.frameRate={ideal:30,max:30}),e}function pP(t){const e={};return dL()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,jc()&&t.ANS&&(e.googHighpassFilter=t.ANS))),e}function fP(t){const e=pP(t);if(t.encoderConfig){const n=CR(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),pR()&&(e.sampleRate=void 0),e}const O4=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:i,height:r}=t.getMediaStreamTrackSettings();let{frameRate:s=n,width:c=i,height:l=r}=e;if(!s||!c||!l)return;c=Bb(c),l=Bb(l),s=Bb(s);const{max:d,min:h}=function(g,C,R){const y=200*Math.pow(R/15,.6)*Math.pow(g*C/640/360,.75);return{min:Math.floor(y),max:Math.floor(4*y)}}(c,l,s),{bitrateMax:p,bitrateMin:_}=e||{};p||S.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(l,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(_,"]"));const{maxFramerate:m}=N("ENCODER_CONFIG_LIMIT");return m&&typeof m=="number"&&(s=Math.min(s,m)),{frameRate:s,bitrateMax:p||d,bitrateMin:_||h,scaleResolutionDownBy:1,scale:0}},_P=async(t,e,n)=>await(async(i,r,s)=>{const c=function(h){const p=[];for(let _=0;_<h.length;_+=2)p.push(parseInt(h.slice(_,_+2),16));return Uint8Array.from(p)}(bL(""+r+s)).slice(0,16),l=c.slice(0,12),d=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},d,i))})(t.buffer,e,n),uI=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new st((n,i)=>{e.toBlob(async r=>{if(e.remove(),r){const s=await mP(r);n({buffer:s,width:e.width,height:e.height})}else i(new G(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},mP=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var EP,gP,SP,TP,vP,RP,yP,CP,AP,bP,IP,OP,wP,NP,DP,LP,PP,kP,Qe,MP,UP,xP,VP,BP,FP,Go,jP,GP,HP,WP,KP,zP,YP,qP,XP,JP,QP,ZP,$P,pi;let sn=(EP=At({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),gP=At({argsMap:(t,e)=>[t.getTrackId(),e]}),SP=dn(),TP=Rf("LocalAudioTrack","_enabledMutex"),vP=At({argsMap:(t,e)=>[t.getTrackId(),e]}),RP=dn(),yP=Rf("LocalAudioTrack","_enabledMutex"),CP=At({argsMap:(t,e)=>[t.getTrackId(),e]}),AP=dn(),bP=dn(),IP=dn(),OP=At({argsMap:t=>[t.getTrackId()]}),wP=dn(),NP=At({argsMap:t=>[t.getTrackId()]}),DP=dn(),LP=At({argsMap:t=>[t.getTrackId()]}),PP=At({argsMap:(t,e)=>[t.getTrackId(),e.name]}),kP=At({argsMap:t=>[t.getTrackId()]}),te((Qe=class extends Df{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?or.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,i){super(t,n),V(this,"trackMediaType",Nf.AUDIO),V(this,"_encoderConfig",void 0),V(this,"_trackSource",void 0),V(this,"metadata",[]),V(this,"_enabled",!0),V(this,"_volume",100),V(this,"_useAudioElement",!0),V(this,"_bypassWebAudio",!1),V(this,"processor",void 0),V(this,"_processorContext",void 0),V(this,"_processorDestination",void 0),V(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i,this._trackSource=new dI,N("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),N("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),li()&&!sa?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){ye(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&or.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Ie(this,_t.NEED_REPLACE_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!KL())throw new G(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await or.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Ie(this,_t.NEED_ENABLE_TRACK,this),S.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(i){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Ie(this,_t.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Ie(this,_t.NEED_MUTE_TRACK,this):await Ie(this,_t.NEED_UNMUTE_TRACK,this))}getStats(){return ud(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ea(this,_t.GET_STATS)||Ke({},iI)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ra.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(ra.ON_AUDIO_BUFFER),this._source.on(ra.ON_AUDIO_BUFFER,n=>t(n))}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),or.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?or.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&or.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ie(this,_t.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return st.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new G(O.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new G(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(Xi.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Ie(this,_t.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ie(this,_t.NEED_REPLACE_TRACK,this))}),t.on(Xi.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Xi.ON_TRACK),t.removeAllListeners(Xi.ON_NODE)}bindProcessorContextEvents(t){t.on(aa.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(aa.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof dI&&(this._trackSource=new eP(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new uP(this._source.context,this.getTrackId(),"local"),e=new dP(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(ra.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(or.stop(this.getTrackId()),this._source.play()),Ie(this,_t.NEED_REPLACE_MIXING_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[EP],Object.getOwnPropertyDescriptor(Qe.prototype,"setVolume"),Qe.prototype),te(Qe.prototype,"setPlaybackDevice",[gP,SP],Object.getOwnPropertyDescriptor(Qe.prototype,"setPlaybackDevice"),Qe.prototype),te(Qe.prototype,"setEnabled",[TP,vP,RP],Object.getOwnPropertyDescriptor(Qe.prototype,"setEnabled"),Qe.prototype),te(Qe.prototype,"setMuted",[yP,CP,AP],Object.getOwnPropertyDescriptor(Qe.prototype,"setMuted"),Qe.prototype),te(Qe.prototype,"getStats",[bP],Object.getOwnPropertyDescriptor(Qe.prototype,"getStats"),Qe.prototype),te(Qe.prototype,"setAudioFrameCallback",[IP],Object.getOwnPropertyDescriptor(Qe.prototype,"setAudioFrameCallback"),Qe.prototype),te(Qe.prototype,"play",[OP,wP],Object.getOwnPropertyDescriptor(Qe.prototype,"play"),Qe.prototype),te(Qe.prototype,"stop",[NP,DP],Object.getOwnPropertyDescriptor(Qe.prototype,"stop"),Qe.prototype),te(Qe.prototype,"close",[LP],Object.getOwnPropertyDescriptor(Qe.prototype,"close"),Qe.prototype),te(Qe.prototype,"pipe",[PP],Object.getOwnPropertyDescriptor(Qe.prototype,"pipe"),Qe.prototype),te(Qe.prototype,"unpipe",[kP],Object.getOwnPropertyDescriptor(Qe.prototype,"unpipe"),Qe.prototype),Qe),ZE=(MP=At({argsMap:(t,e)=>[t.getTrackId(),e]}),UP=dn(),xP=Rf("MicrophoneAudioTrack","_enabledMutex"),VP=At({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),BP=dn(),FP=At({argsMap:t=>[t.getTrackId()]}),te((Go=class extends sn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,i){super(t,e.encoderConfig?CR(e.encoderConfig):{},i,N("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),V(this,"_config",void 0),V(this,"_deviceName","default"),V(this,"_constraints",void 0),V(this,"_originalConstraints",void 0),V(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(Sf()||Db())&&Te.bindInterruptDetectorTrack(this)}async setDevice(t){if(S.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await ca.getDeviceById(t),n={};n.audio=Ke({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=await oa(n,this.getTrackId())}catch(r){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),r.toString()),i=await oa({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await ca.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}S.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return S.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),N("AUTO_RESET_AUDIO_ROUTE")&&(qi()||ss())){const c=navigator.audioSession;c&&(t||(c.type="playback"),c.type="auto")}if(!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await Ie(this,_t.NEED_DISABLE_TRACK,this)}catch(c){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const r=Ke({},this._constraints),s=ca.searchDeviceIdByName(this._deviceName);s&&!r.deviceId&&(r.deviceId=s);try{n||(this._enabled=!0);const c=await oa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await Ie(this,_t.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}S.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Sf()||Db())&&Te.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((qi()||ss())&&this._enabled&&!this._isClosed&&Te.duringInterruption){const t=async()=>{Te.off(ri.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Te.on(ri.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Of.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=ca.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const i=await oa({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(aa.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(aa.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[MP,UP],Object.getOwnPropertyDescriptor(Go.prototype,"setDevice"),Go.prototype),te(Go.prototype,"setEnabled",[xP,VP,BP],Object.getOwnPropertyDescriptor(Go.prototype,"setEnabled"),Go.prototype),te(Go.prototype,"close",[FP],Object.getOwnPropertyDescriptor(Go.prototype,"close"),Go.prototype),Go),w4=(jP=At({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),GP=dn(),HP=At({argsMap:t=>[t.getTrackId()]}),WP=dn(),KP=At({argsMap:t=>[t.getTrackId()]}),zP=dn(),YP=At({argsMap:t=>[t.getTrackId()]}),qP=dn(),XP=At({argsMap:t=>[t.getTrackId()]}),JP=dn(),QP=At({argsMap:t=>[t.getTrackId()]}),ZP=At({argsMap:t=>[t.getTrackId()]}),$P=dn(),te((pi=class extends sn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,i){super(e.createOutputTrack(),n,i),V(this,"source",void 0),V(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(ra.AUDIO_SOURCE_STATE_CHANGE,r=>{this.safeEmit(Of.SOURCE_STATE_CHANGE,r)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){ye(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[jP,GP],Object.getOwnPropertyDescriptor(pi.prototype,"startProcessAudioBuffer"),pi.prototype),te(pi.prototype,"pauseProcessAudioBuffer",[HP,WP],Object.getOwnPropertyDescriptor(pi.prototype,"pauseProcessAudioBuffer"),pi.prototype),te(pi.prototype,"seekAudioBuffer",[KP,zP],Object.getOwnPropertyDescriptor(pi.prototype,"seekAudioBuffer"),pi.prototype),te(pi.prototype,"resumeProcessAudioBuffer",[YP,qP],Object.getOwnPropertyDescriptor(pi.prototype,"resumeProcessAudioBuffer"),pi.prototype),te(pi.prototype,"stopProcessAudioBuffer",[XP,JP],Object.getOwnPropertyDescriptor(pi.prototype,"stopProcessAudioBuffer"),pi.prototype),te(pi.prototype,"close",[QP],Object.getOwnPropertyDescriptor(pi.prototype,"close"),pi.prototype),te(pi.prototype,"setAudioBufferPlaybackSpeed",[ZP,$P],Object.getOwnPropertyDescriptor(pi.prototype,"setAudioBufferPlaybackSpeed"),pi.prototype),pi);class Dn extends sn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Lf().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,Le(8,"track-mix-")),V(this,"trackList",void 0),V(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(S.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):S.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){S.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}fR(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof Dn?n.emit(eh.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class N4 extends tP{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(ra.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),V(this,"audioBuffer",void 0),V(this,"sourceNode",void 0),V(this,"startPlayTime",0),V(this,"startPlayOffset",0),V(this,"pausePlayTime",0),V(this,"options",void 0),V(this,"currentLoopCount",0),V(this,"currentPlaybackSpeed",100),V(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):S.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const tk=new Map;function ek(t,e){if(t.length===0||e.length===0)return 1/0;const n=Fb(t),i=Fb(e);return Math.floor(i/n)}class hI{get rendFrameRate(){const e=Math.max(1,ek(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(S.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){V(this,"trackId",void 0),V(this,"config",void 0),V(this,"onFirstVideoFrameDecoded",void 0),V(this,"onVideoStateChanged",void 0),V(this,"freezeTimeCounterList",[]),V(this,"renderFreezeAccTime",0),V(this,"renderFreezeAccTime2",0),V(this,"isKeepLastFrame",!1),V(this,"timeUpdatedCount",0),V(this,"freezeTime",0),V(this,"playbackTime",0),V(this,"lastTimeUpdatedTime",0),V(this,"autoplayFailed",!1),V(this,"videoTrack",void 0),V(this,"videoElement",void 0),V(this,"cacheVideoElement",void 0),V(this,"_render_interframe_delays",[]),V(this,"_render_interframe_delays_sizes",[]),V(this,"_videoState",jo.VideoStateStopped),V(this,"videoElementCheckInterval",void 0),V(this,"videoElementFreezeTimeout",void 0),V(this,"_videoElementStatus",Li.NONE),V(this,"isGettingVideoDimensions",!1),V(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return S.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),V(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Te.curState==="running"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(eL())),cL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),V(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Li.PLAYING;break;case"loadeddata":if(this.videoState=jo.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Li.CANPLAY;break;case"stalled":this.videoElementStatus=Li.STALLED;break;case"suspend":this.videoElementStatus=Li.SUSPEND;break;case"pause":this.videoElementStatus=Li.PAUSED,qi()||ss()||li()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Li.WAITING;break;case"abort":this.videoElementStatus=Li.ABORT;break;case"ended":this.videoElementStatus=Li.ENDED;break;case"emptied":this.videoElementStatus=Li.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=Li.ERROR,S.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const r=i-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Ho.lastVisibleTime<Ho.lastHiddenTime||s<Ho.lastHiddenTime||s<Ho.lastVisibleTime)return;for(r>N("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=r),this.playbackTime+=r;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),V(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(eL())),cL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Te.on(ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Te.on(ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(r=>{e&&oP(e,"video",r.message,this.trackId),r.name==="NotAllowedError"?(S.warning("detected video element autoplay failed",r),this.autoplayFailed=!0,this.handleAutoPlayFailed()):S.warning("[".concat(this.trackId,"] play warning: "),r)});const i=ae();if((i.name==="Safari"&&Number(i.version)===15||Sf())&&n&&n.then){const r=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(r).catch(r)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return S.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height);return e.remove(),i}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const r=i.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,i.width,i.height),new st((s,c)=>{i.toBlob(async l=>{if(i.remove(),l){const d=await mP(l);s({buffer:d,width:i.width,height:i.height})}else c(new G(O.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await uI(e)}destroy(){Te.off(ri.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Te.off(ri.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=jo.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Li.INIT,!this.videoElementCheckInterval&&(nk.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)||(this.videoElementStatus=Li.DESTROYED)},1e3),N("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let s;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(l,N("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===jo.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=jo.VideoStateFrozen:document.addEventListener("visibilitychange",c))},d=(h,p)=>{if(this.videoElementStatus===Li.PLAYING){if(s){const g=p.presentationTime-s.presentationTime,C=p.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(C),this._render_interframe_delays.push(g);const R=Fb(this._render_interframe_delays_sizes),y=R-this._render_interframe_delays_sizes[0];if(R>30&&y>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===jo.VideoStateStarting&&(this.videoState=jo.VideoStateDecoding),this.videoState===jo.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,N("VIDEO_FREEZE_DURATION"))),g<N("VIDEO_FREEZE_DURATION")&&this.videoState===jo.VideoStateFrozen&&(this.videoState=jo.VideoStateDecoding),g>N("VIDEO_FREEZE_DURATION")&&Ho.lastVisibleTime>=Ho.lastHiddenTime&&s.timestamp>Ho.lastVisibleTime&&s.timestamp>Ho.lastHiddenTime){const b=Math.min(66,ek(this._render_interframe_delays_sizes,this._render_interframe_delays)),I=Math.max(0,g-(C-1)*b);this.renderFreezeAccTime2+=I>b?I:0,this.renderFreezeAccTime+=g}}s=Ke(Ke({},p),{},{timestamp:h})}var _,m;N("ENABLE_VIDEO_FRAME_CALLBACK")&&((_=(m=this.videoElement).requestVideoFrameCallback)===null||_===void 0||_.call(m,d))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),pR()&&!N("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=ae();i.name==="Safari"&&Number(i.version)===15||Sf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,en()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,en()&&this.videoElement.load());const r=this.videoElement.play();r!==void 0&&r.catch(s=>{S.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){nk.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Li.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{S.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{S.error(i)}),this.autoplayFailed=!1,GE()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};GE()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),sP()}}const nk=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class ik extends hI{constructor(e){super(e),V(this,"container",void 0),V(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,i):await uI(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",N("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var rk,ak,sk,ok,ck,lk,dk,uk,hk,pk,fk,_k,mk,Ek,gk,Sk,Tk,vk,Rk,yk,Ck,Ak,bk,Ik,Ok,wk,Xt,Nk,Dk,Lk,Pk,kk,Mk,Uk,xk,da;let xe=(rk=At({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),ak=dn(),sk=At({argsMap:t=>[t.getTrackId()]}),ok=Rf("LocalVideoTrack","_enabledMutex"),ck=At({argsMap:(t,e)=>[t.getTrackId(),e]}),lk=dn(),dk=Rf("LocalVideoTrack","_enabledMutex"),uk=At({argsMap:(t,e)=>[t.getTrackId(),e]}),hk=dn(),pk=At({argsMap:(t,e)=>[t.getTrackId(),e,t._saveEncodeBitrateRatio]}),fk=dn(),_k=At({argsMap:(t,e)=>[t.getTrackId(),e]}),mk=dn(),Ek=dn(),gk=At({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),Sk=dn(),Tk=dn(),vk=dn(),Rk=dn(),yk=dn(),Ck=dn(),Ak=dn(),bk=At({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Ik=At({argsMap:t=>[t.getTrackId()]}),Ok=At({argsMap:t=>[t.getTrackId()]}),wk=At({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),Xt=class _x extends Df{get videoHeight(){if(li()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(li()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Li.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,i,r,s,c){if(super(e,s),V(this,"trackMediaType",Nf.VIDEO),V(this,"_player",void 0),V(this,"isUseScaleResolutionDownBy",!1),V(this,"_videoVisibleTimer",null),V(this,"_previousVideoVisibleStatus",void 0),V(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),V(this,"_encoderConfig",void 0),V(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),V(this,"_optimizationMode",void 0),V(this,"_saveEncodeBitrateRatio",1),V(this,"_videoHeight",void 0),V(this,"_videoWidth",void 0),V(this,"_forceBitrateLimit",void 0),V(this,"_enabled",!0),V(this,"_processorDestination",void 0),V(this,"_processorContext",void 0),li()){const{width:l,height:d}=e.getSettings();this._videoWidth=l,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=r,this._hints=c||[],n&&this._hints.indexOf(Ce.CUSTOM_TRACK)!==-1?this._encoderConfig=Je(n):this._encoderConfig=n,this._hints.indexOf(Ce.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(Ob(de.CHROME,115)&&uR().indexOf("Windows")!==-1){const l=function(d,h){if("VideoFrame"in window&&"TransformStream"in window&&se().supportWebRTCInsertableStream){const p=new MediaStreamTrackProcessor(d),_=new MediaStreamTrackGenerator({kind:"video"});let m,g,C=Date.now();const R=()=>{y&&(clearInterval(y),y=void 0),m&&(m.close(),m=void 0),d.stop(),g=void 0,_.removeEventListener("ended",R)};let y=window.setInterval(()=>{if(g&&m&&Date.now()-C>1e3)try{_.readyState==="live"?g.enqueue(m.clone()):R()}catch{R()}},1e3);const b=new TransformStream({transform:(I,L)=>{_.readyState==="live"?(g=L,C=Date.now(),m===void 0?(m=I,L.enqueue(I.clone())):(L.enqueue(m),m=I)):I.close()}});return _.addEventListener("ended",R),p.readable.pipeThrough(b).pipeTo(_.writable),_}}(e);l&&(S.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}n&&this._hints.indexOf(Ce.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new lP(this.getTrackId(),"local"),this._processorDestination=new cP(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Ke(Ke(Ke({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new hI(i):this._player=new ik(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Of.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},N("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Ie(this,_t.NEED_DISABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Ie(this,_t.NEED_ENABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Ie(this,_t.NEED_MUTE_TRACK,this):await Ie(this,_t.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),S.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await Ie(this,_t.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new G(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=ls(e),N("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const i=IR({encoderConfig:e});(li()||qi()||ss())&&(i.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(r){const s=new G(O.UNEXPECTED_ERROR,r.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=e,this._hints.indexOf(Ce.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ie(this,_t.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(S)}}getStats(){return ud(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ea(this,_t.GET_STATS)||Ke({},rI)}async setBeautyEffect(e){S.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await uI(e)}async setBitrateLimit(e){S.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void S.error(O.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await Ie(this,_t.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return S.error(O.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,S.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){hP(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(mR)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new G(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");S.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=ls(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(Ce.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ie(this,_t.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!e||!n||!i)return;const{bitrateMax:r,bitrateMin:s}=this._encoderConfig;if(s==null||r==null){const{max:c,min:l}=function(d,h,p,_,m){const g=N("BITRATE_ADAPTER_TYPE");if(g==="DEFAULT_BITRATE")return{min:_,max:m};if(m===void 0){const C=Math.floor(200*Math.pow(p/15,.6)*Math.pow(d*h/640/360,.75));m=g==="STANDARD_BITRATE"?4*C:2*C,_=_??C}else _=_??Math.floor(m/10);return{min:_,max:m}}(e,n,i,s,r);if(this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=c,N("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&r==null){const[d,h]=function(p,_,m){const g=4*Math.floor(2e5*Math.pow(m/15,.6)*Math.pow(p*_/230400,.75)),C=p*_,R=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),y=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let b=ar(R).call(R).next().value,I=1;if(R.has(C))b=R.get(C);else{var L;const dt=Mt(L=Array.from(R.entries())).call(L,(Vt,It)=>{let[Ue]=Vt,[Ae]=It;return Ue-Ae}),Ft=dt.find(Vt=>{let[It]=Vt;return It>C});if(Ft){const Vt=dt.indexOf(Ft);if(Vt>0){const It=dt[Vt-1],Ue=(C-It[0])/(Ft[0]-It[0]);b=It[1]+Ue*(Ft[1]-It[1])}else b=Ft[1]}else b=dt[dt.length-1][1]}if(y.has(C))I=y.get(C);else{var U;const dt=Mt(U=Array.from(y.entries())).call(U,(Vt,It)=>{let[Ue]=Vt,[Ae]=It;return Ue-Ae}),Ft=dt.find(Vt=>{let[It]=Vt;return It>C});if(Ft){const Vt=dt.indexOf(Ft);if(Vt>0){const It=dt[Vt-1],Ue=(C-It[0])/(Ft[0]-It[0]);I=It[1]+Ue*(Ft[1]-It[1])}else I=Ft[1]}else I=dt[dt.length-1][1]}const x=N("VIDEO_NEW_BITRATE_RATIO");x&&x>0&&(b=x/100);const M=Math.floor(g*b),j=Math.floor(65e4*Math.pow(p*_/230400,.5)*Math.pow(m/15,.69));let K=M;const it=N("VIDEO_STANDARD_BITRATE_VERSION");return it&&it>0&&(it===1?K=g:it===2?K=M:it===3&&(K=j)),[Math.floor(K/1e3),I]}(e,n,i);this._encoderConfig.bitrateMax=d,this._encoderConfig.bitrateMin=l?Math.min(l,d):d,this._saveEncodeBitrateRatio=h,S.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else S.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(l,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:s,slot:c}=r;if(this.isPlaying&&s instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=pL.checkOneElementVisible(s),d=Object.assign({},l);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const h=gt.reportApiInvoke(null,{tag:rn.TRACER,name:vn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(i){throw new G(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new G(O.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=Ke(Ke({},i),ls(e))),i=Qu(i);const r=Le(8,"track-video-cloned-"),s=new _x(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Qu(this._scalabilityMode),this._optimizationMode,r,Qu(this._hints));return e&&i&&s.setEncoderConfiguration(i),S.debug("clone video track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new G(O.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new G(O.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(ud(()=>{gt.reportApiInvoke(null,{name:vn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:rn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!N("ENABLE_VIDEO_SEI")||!N("ENABLE_ENCODED_TRANSFORM"))return void S.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new G(O.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void S.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const r=i.codecs[0].mimeType.toLocaleLowerCase();r==="video/h264"?this.safeEmit("sei-to-send",e):S.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(Xi.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Ie(this,_t.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Ie(this,_t.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Xi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(aa.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(aa.REQUEST_CONSTRAINTS)}},te(Xt.prototype,"play",[rk,ak],Object.getOwnPropertyDescriptor(Xt.prototype,"play"),Xt.prototype),te(Xt.prototype,"stop",[sk],Object.getOwnPropertyDescriptor(Xt.prototype,"stop"),Xt.prototype),te(Xt.prototype,"setEnabled",[ok,ck,lk],Object.getOwnPropertyDescriptor(Xt.prototype,"setEnabled"),Xt.prototype),te(Xt.prototype,"setMuted",[dk,uk,hk],Object.getOwnPropertyDescriptor(Xt.prototype,"setMuted"),Xt.prototype),te(Xt.prototype,"setSaveEncodeBitrateRatio",[pk,fk],Object.getOwnPropertyDescriptor(Xt.prototype,"setSaveEncodeBitrateRatio"),Xt.prototype),te(Xt.prototype,"setEncoderConfiguration",[_k,mk],Object.getOwnPropertyDescriptor(Xt.prototype,"setEncoderConfiguration"),Xt.prototype),te(Xt.prototype,"getStats",[Ek],Object.getOwnPropertyDescriptor(Xt.prototype,"getStats"),Xt.prototype),te(Xt.prototype,"setBeautyEffect",[gk,Sk],Object.getOwnPropertyDescriptor(Xt.prototype,"setBeautyEffect"),Xt.prototype),te(Xt.prototype,"getCurrentFrameData",[Tk],Object.getOwnPropertyDescriptor(Xt.prototype,"getCurrentFrameData"),Xt.prototype),te(Xt.prototype,"getCurrentFrameImage",[vk],Object.getOwnPropertyDescriptor(Xt.prototype,"getCurrentFrameImage"),Xt.prototype),te(Xt.prototype,"setBitrateLimit",[Rk],Object.getOwnPropertyDescriptor(Xt.prototype,"setBitrateLimit"),Xt.prototype),te(Xt.prototype,"setOptimizationMode",[yk],Object.getOwnPropertyDescriptor(Xt.prototype,"setOptimizationMode"),Xt.prototype),te(Xt.prototype,"setScalabiltyMode",[Ck],Object.getOwnPropertyDescriptor(Xt.prototype,"setScalabiltyMode"),Xt.prototype),te(Xt.prototype,"updateMediaStreamTrackResolution",[Ak],Object.getOwnPropertyDescriptor(Xt.prototype,"updateMediaStreamTrackResolution"),Xt.prototype),te(Xt.prototype,"pipe",[bk],Object.getOwnPropertyDescriptor(Xt.prototype,"pipe"),Xt.prototype),te(Xt.prototype,"unpipe",[Ik],Object.getOwnPropertyDescriptor(Xt.prototype,"unpipe"),Xt.prototype),te(Xt.prototype,"close",[Ok],Object.getOwnPropertyDescriptor(Xt.prototype,"close"),Xt.prototype),te(Xt.prototype,"replaceTrack",[wk],Object.getOwnPropertyDescriptor(Xt.prototype,"replaceTrack"),Xt.prototype),Xt),pI=(Nk=At({argsMap:(t,e)=>[t.getTrackId(),e]}),Dk=dn(),Lk=Rf("CameraVideoTrack","_enabledMutex"),Pk=At({argsMap:(t,e)=>[t.getTrackId(),e]}),kk=dn(),Mk=At({argsMap:(t,e)=>[t.getTrackId(),e]}),Uk=dn(),xk=At({argsMap:t=>[t.getTrackId()]}),da=class mx extends xe{get __className__(){return"CameraVideoTrack"}constructor(e,n,i,r,s,c){super(e,ls(n.encoderConfig),r,s,c),V(this,"_config",void 0),V(this,"_originalConstraints",void 0),V(this,"_constraints",void 0),V(this,"_enabled",!0),V(this,"_deviceName","default"),V(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Sf()||Db())&&!function(){const l=ae();if(l.os!==Fn.IOS||!l.osVersion)return!1;const d=l.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2}()&&lL()&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=e.label,this._encoderConfig=ls(this._config.encoderConfig),Te.on(ri.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Te.on(ri.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(S.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await ca.getDeviceById(e),i={};i.video=Ke({},this._constraints),i.video.deviceId={exact:e},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await oa(i,this.getTrackId())}catch(s){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),r=await oa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await ca.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}S.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){S.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:Ke(Ke({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await oa(n,this.getTrackId())}catch(r){throw S.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),r.toString()),i=await oa({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),r}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=Ke({},n.video),S.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await oa({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await Ie(this,_t.NEED_ENABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Ie(this,_t.NEED_DISABLE_TRACK,this)}catch(i){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new G(O.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=ls(e),N("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const i=Je(this._config);i.encoderConfig=e;const r=IR(i);(li()||qi()||ss())&&(r.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(s){const c=new G(O.UNEXPECTED_ERROR,s.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(Ce.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Ie(this,_t.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(S)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((qi()||ss())&&this._enabled&&!this._isClosed&&Te.duringInterruption){const e=async()=>{Te.off(ri.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Te.on(ri.IOS_INTERRUPTION_END,e)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Of.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=ca.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const r=await oa({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Te.off(ri.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Te.off(ri.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;e&&(i=Ke(Ke({},i),ls(e))),i=Qu(i);const r=Le(8,"track-cam-cloned-"),s=new mx(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Qu(Ke(Ke({},this._config),{},{encoderConfig:i})),Qu(this._constraints),Qu(this._scalabilityMode),this._optimizationMode,r);return e&&i&&s.setEncoderConfiguration(i),S.debug("clone track from ".concat(this.getTrackId()," to ").concat(r,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(aa.REQUEST_UPDATE_CONSTRAINTS,async(e,n,i)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),n()}catch(r){i(r)}}),this.processorContext.on(aa.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},te(da.prototype,"setDevice",[Nk,Dk],Object.getOwnPropertyDescriptor(da.prototype,"setDevice"),da.prototype),te(da.prototype,"setEnabled",[Lk,Pk,kk],Object.getOwnPropertyDescriptor(da.prototype,"setEnabled"),da.prototype),te(da.prototype,"setEncoderConfiguration",[Mk,Uk],Object.getOwnPropertyDescriptor(da.prototype,"setEncoderConfiguration"),da.prototype),te(da.prototype,"close",[xk],Object.getOwnPropertyDescriptor(da.prototype,"close"),da.prototype),da);function fI(t,e,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=Ke(Ke({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?S.debug("[".concat(t,"] set content hint to"),n.optimizationMode):S.debug("[".concat(t,"] set content hint failed")))):S.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Vk,Bk,Fk,jk,Da,Gk,Hk,Wk,Kk,zk,Yk,Fi;class qk extends QL{getUserId(){return this._userId}constructor(e,n,i,r){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(r.clientId,"_").concat(Le(5,""))),V(this,"_userId",void 0),V(this,"_uintId",void 0),V(this,"_isDestroyed",!1),V(this,"store",void 0),V(this,"processor",void 0),V(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let kf=(Vk=At({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Bk=At({argsMap:t=>[t.getTrackId()]}),Fk=At({argsMap:(t,e)=>[t.getTrackId(),e.name]}),jk=At({argsMap:t=>[t.getTrackId()]}),te((Da=class extends qk{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Li.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,i){super(t,e,n,i),V(this,"_videoVisibleTimer",null),V(this,"_previousVideoVisibleStatus",void 0),V(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),V(this,"trackMediaType",Nf.VIDEO),V(this,"_videoWidth",void 0),V(this,"_videoHeight",void 0),V(this,"_player",void 0),V(this,"processorDestination",void 0),V(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new lP(this.getTrackId(),"remote"),this.processorDestination=new cP(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return ud(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ea(this,_t.GET_STATS)||Ke({},XL)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const i=document.getElementById(t);i?t=i:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=Ke(Ke({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new hI(n):this._player=new ik(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(wf.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=i=>{this.safeEmit(wf.VIDEO_STATE_CHANGED,i)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(wf.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},N("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){hP(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(mR)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:r,slot:s}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&s instanceof HTMLElement){const c=pL.checkOneElementVisible(r),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const d=gt.reportApiInvoke(null,{tag:rn.TRACER,name:vn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new G(O.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new G(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Xi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Xi.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(eh.SEI_RECEIVED,t)}}).prototype,"play",[Vk],Object.getOwnPropertyDescriptor(Da.prototype,"play"),Da.prototype),te(Da.prototype,"stop",[Bk],Object.getOwnPropertyDescriptor(Da.prototype,"stop"),Da.prototype),te(Da.prototype,"pipe",[Fk],Object.getOwnPropertyDescriptor(Da.prototype,"pipe"),Da.prototype),te(Da.prototype,"unpipe",[jk],Object.getOwnPropertyDescriptor(Da.prototype,"unpipe"),Da.prototype),Da),Mf=(Gk=At({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),Hk=At({argsMap:(t,e)=>[t.getTrackId(),e]}),Wk=At({argsMap:t=>[t.getTrackId()]}),Kk=At({argsMap:t=>[t.getTrackId()]}),zk=At({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Yk=At({argsMap:t=>[t.getTrackId()]}),te((Fi=class extends qk{get isPlaying(){return this._useAudioElement?or.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,i){super(t,e,n,i),V(this,"trackMediaType",Nf.AUDIO),V(this,"_source",void 0),V(this,"_useAudioElement",!0),V(this,"_volume",100),V(this,"processorContext",void 0),V(this,"processorDestination",void 0),V(this,"_played",!1),V(this,"_bypassWebAudio",!1),N("DISABLE_WEBAUDIO")?(this._source=new dI,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new eP(t,!0),N("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ra.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(wf.FIRST_FRAME_DECODED)}),this.processorContext=new uP(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new dP(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ra.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ra.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(ra.ON_AUDIO_BUFFER),this._source.on(ra.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?or.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!KL())throw new G(O.NOT_SUPPORTED,"your browser does not support setting the audio output device");await or.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ud(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ea(this,_t.GET_STATS)||Ke({},qL)}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),or.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?or.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&or.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new G(O.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new G(O.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new G(O.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Xi.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Xi.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Xi.ON_TRACK),this.processorDestination.removeAllListeners(Xi.ON_NODE)}}).prototype,"setVolume",[Gk],Object.getOwnPropertyDescriptor(Fi.prototype,"setVolume"),Fi.prototype),te(Fi.prototype,"setPlaybackDevice",[Hk],Object.getOwnPropertyDescriptor(Fi.prototype,"setPlaybackDevice"),Fi.prototype),te(Fi.prototype,"play",[Wk],Object.getOwnPropertyDescriptor(Fi.prototype,"play"),Fi.prototype),te(Fi.prototype,"stop",[Kk],Object.getOwnPropertyDescriptor(Fi.prototype,"stop"),Fi.prototype),te(Fi.prototype,"pipe",[zk],Object.getOwnPropertyDescriptor(Fi.prototype,"pipe"),Fi.prototype),te(Fi.prototype,"unpipe",[Yk],Object.getOwnPropertyDescriptor(Fi.prototype,"unpipe"),Fi.prototype),Fi);const Ho=new class extends Xe{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),V(this,"_lastHiddenTime",0),V(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),S.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Xk extends Xe{constructor(e,n){super(),V(this,"trackMediaType",Nf.DATA),V(this,"_version",1),V(this,"_type",3),V(this,"_config",void 0),V(this,"_originDataChannel",void 0),V(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),V(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),V(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return N("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new st((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const i=setTimeout(()=>{var r;n(new G(O.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((r=this._originDataChannel)===null||r===void 0?void 0:r.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new G(O.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new G(O.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[AR.OPEN,AR.CLOSE,AR.ERROR].forEach(n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),e.addEventListener(n,i)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[i,r]=n;e.removeEventListener(i,r)}),this._datachannelEventMap.clear()}}class D4 extends Xk{constructor(e){super(e),V(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),r=new DataView(i).getUint8(3);if(r!==this.id)return void(N("SHOW_DATASTREAM2_LOG")&&S.debug("invalid datachannel id: ".concat(r," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(AR.MESSAGE,s)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class L4 extends Xk{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function OR(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>Ov.revokeObjectURL(t),0),new Worker(Ov.createObjectURL(t))}const Jk=71,_I=1,mI=2,EI=1,Qk=2;var Kc=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(Kc||{});function Zk(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=t.getUint8(0);if(n!==Jk)return;const i=t.getUint16(1),r=_I+mI+i,s=new Uint8Array(t.byteLength-r);s.set(new Uint8Array(t.buffer,r,t.byteLength-r));const c={m:n,tlvLen:i,tlv:[],frame:s};let l=_I+mI;for(;l<r;){const d=t.getUint8(l),h=t.getUint16(l+EI),p=EI+Qk;if(d===Kc.AUDIO_LEVEL){let _=t.getUint8(l+p);for(let m=1;m<h;m++)_=_<<8|t.getUint8(l+p+m);c.tlv.push({tag:d,length:h,value:e?127^_>>1:127&_})}else if(d===Kc.METADATA||d===Kc.AUDIO_64_BIT_PTS){const _=new Uint8Array(h);for(let m=0;m<h;m++)_[m]=t.getUint8(l+p+m);c.tlv.push({tag:d,length:h,value:_})}l+=p+h}return c}const wR=new Map,NR=127,rh=1e-10,gI=139/13,DR=new Map;function SI(t,e,n){const i="".concat(t,"-").concat(e,"-").concat(n);let r=0;return DR.has(i)?r=DR.get(i):(r=Math.log(function(c,l){const d=c-l;l<d&&(l=d);let h=1;for(let p=c,_=1;p>l;p--,_++)h=h*p/_;return h}(e,t))+t*Math.log(.5)+(e-t)*Math.log(1-.5)-Math.log(n)+n*t,DR.set(i,r)),r<rh&&(r=rh),r}function $k(t,e,n){const i=e.length,r=t.length/i;let s=!1;for(let c=0,l=0;c<i;c++){let d=0;for(let h=l+r;l<h;l++)t[l]>n&&d++;e[c]!==d&&(e[c]=d,s=!0)}return s}window.cache=DR;let P4=0;class tM{constructor(e){V(this,"id",void 0),V(this,"immediates",[]),V(this,"lastNonSilence",-1),V(this,"immediateSpeechActivityScore",rh),V(this,"lastLevelChangedTime",Date.now()),V(this,"levels",[]),V(this,"longs",[]),V(this,"longSpeechActivityScore",rh),V(this,"mediums",[]),V(this,"mediumSpeechActivityScore",rh),V(this,"minLevel",0),V(this,"nextMinLevel",0),V(this,"nextMinLevelWindowLength",0),V(this,"energyScore",0),this.id=e||"".concat(P4++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const e=this.immediates,n=this.levels,i=this.minLevel+gI;let r=!1;for(let s=0;s<e.length;++s){let c=n[s];c<i&&(c=0);const l=Math.floor(c/gI);e[s]!==l&&(e[s]=l,r=!0)}return r}computeLongs(){return $k(this.mediums,this.longs,4)}computeMediums(){return $k(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=SI(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=SI(this.longs[0],10,47),this.longSpeechActivityScore>rh&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=SI(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(qh(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=e;return e<0&&(i=0),e>NR&&(i=NR),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+gI?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>NR&&(n=NR),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class k4{constructor(e){V(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?e=!0:setTimeout(this.execute.bind(this),n)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class TI{constructor(e,n,i){V(this,"isDominant",void 0),V(this,"energyRanking",void 0),V(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=n,this.energyScore=i}}class M4 extends Xe{constructor(e){super(),V(this,"dominantId",null),V(this,"lastDecisionTime",0),V(this,"lastLevelChangedTime",0),V(this,"lastLevelIdleTime",0),V(this,"relativeSpeechActivities",[]),V(this,"speakers",new Map),V(this,"enableSilence",!1),V(this,"timeoutToSilenceInterval",0),V(this,"decisionMaker",null),V(this,"loudest",[]),V(this,"numLoudestToTrack",3),V(this,"energyExpireTimeMs",250),V(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(n=>n.id===e)}levelChanged(e,n){const i=Date.now(),r=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const s=r.levelChanged(n,i);return this.updateLoudestList(r,s,i)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(e){e.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(e){let n=this.speakers.get(e);return n||(n=new tM(e),this.speakers.set(e,n),this.maybeStartDecisionMaker()),n}updateLoudestList(e,n,i){const r=e.id===this.dominantId;if(n<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==e;)++d;return new TI(r,d,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new TI(r,0,e.energyScore);const s=i-this.energyExpireTimeMs;let c=0;for(;c<this.loudest.length;){const d=this.loudest[c];if(d.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(d.id!==e.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<e.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new TI(r,l,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new k4(this),this.decisionMaker.execute())}makeDecision(e){let n=null,i=null;const r=this.speakers.size;let s=null;if(r===0)s=null;else if(r===1){var c;const l=ar(c=this.speakers).call(c).next().value;this.enableSilence&&l&&(s=l.id,l.evaluateSpeechActivityScores(e),e-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){const p=this.speakers.entries().next();p.value&&(s=p.value[0],l=p.value[1])}else s=l.id;l!=null&&l.evaluateSpeechActivityScores(e);const d=this.relativeSpeechActivities;let h=2;for(const p of this.speakers.entries()){const[_,m]=p;if(m===l)continue;m.evaluateSpeechActivityScores(e);for(let y=0;y<d.length;++y){const b=l==null?rh:l.getSpeechActivityScore(y);d[y]=Math.log(m.getSpeechActivityScore(y)/b)}const g=d[0],C=d[1],R=d[2];g>3&&C>2&&R>0&&C>h&&(h=C,s=_)}this.enableSilence&&l!=null&&s===l.id&&e-l.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(n=this.dominantId,this.dominantId=s,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const e=Date.now(),n=300-(e-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):i=n;let r=300-(e-this.lastDecisionTime);return r<=0&&(this.lastDecisionTime=e,this.makeDecision(e),r=300-(Date.now()-e)),r>0&&i>r&&(i=r),i}timeoutIdleLevels(e){const n=[];for(const r of ar(i=this.speakers).call(i)){var i;const s=e-r.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||r.id!==this.dominantId)?n.push(r.id):300<s&&r.levelTimedOut()}n.forEach(r=>this.speakers.delete(r))}}const Uf=new Map;let Ys=null,LR=null;const eM=3;let ah=[];const qs=new Map,PR=new Map;class U4{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,n){V(this,"id",void 0),V(this,"track",void 0),V(this,"score",0),V(this,"active",!0),V(this,"muted",!1),V(this,"timer",0),V(this,"actives",0),V(this,"inactives",0),this.id=e,this.track=n,this.setActive(qs.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const e=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=function(){const r=[],s=[];return Array.from(ar(qs).call(qs)).forEach(c=>{c.active?r.push(c):s.push(c)}),{actives:r,inactives:s}}();if(n.length>3){let r;n.forEach(s=>{(!r||r.score>s.score)&&(r=s)}),r&&r.setActive(!1)}if(n.length<3&&i.length>0){let r;i.forEach(s=>{(!r||r.score<s.score)&&s.id!==this.id&&(r=s)}),r&&e&&!this.active&&(r.samples>40&&r.activeRate-this.activeRate>.4?r.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const e=function(n){let i;return Array.from(ar(qs).call(qs)).forEach(r=>{!r.active||r.id===n||r.samples<40||(!i||r.score<i.score)&&(i=r)}),i}(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const e=function(n){let i;return Array.from(ar(qs).call(qs)).forEach(r=>{r.active||r.id===n||r.samples<40||(!i||r.score>i.score)&&(i=r)}),i}(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let kR;function nM(t){const e=qs.get(t);e&&(qs.delete(t),e.clearTimer())}const MR=new Map,x4=new Map;function V4(t,e,n){let i=new Uint8Array(t,e,n),r=[],s=0;for(;r.length<n;)s+3<n&&i[s]===0&&i[s+1]===0&&i[s+2]===3&&(i[s+3]===0||i[s+3]===1||i[s+3]===2||i[s+3]===3)?(r.push(i[s],i[s+1],i[s+3]),s+=4):(r.push(i[s]),s++);return new Uint8Array(r)}const UR=new Map,$E=new Map;(function(){const t=ae();ii.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ii.getStreamFromExtension=t.name===de.CHROME&&Number(t.version)>34,ii.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),ii.supportMinBitrate=t.name===de.CHROME||t.name===de.EDGE,ii.supportSetRtpSenderParameters=function(){const e=ae();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Gc()||!(!li()&&!hR())||e.name===de.FIREFOX&&Number(e.version)>=64)}(),t.name===de.SAFARI&&(Number(t.version)>=14?ii.supportDualStream=!0:ii.supportDualStream=!1),ii.webAudioMediaStreamDest=function(){const e=ae();return!(e.name===de.SAFARI&&Number(e.version)<12)}(),ii.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ii.supportWebGL=typeof WebGLRenderingContext<"u",ii.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Gc()||(ii.webAudioWithAEC=!0),ii.supportShareAudio=function(){const e=ae();return(e.os===Fn.WIN_10||e.os===Fn.WIN_81||e.os===Fn.WIN_7||e.os===Fn.LINUX||e.os===Fn.MAC_OS||e.os===Fn.CHROMIUM_OS)&&e.name===de.CHROME&&Number(e.version)>=74}(),ii.supportDataChannel=!!(jE(76)||function(e){const n=ae();return!(n.name!==de.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||rL(14)),ii.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!en()&&!!e&&e.prototype.setConfiguration instanceof Function}(),ii.supportWebRTCEncodedTransform=function(){const e=ae();return e.name==="Chrome"&&Number(e.version)>=87||e.name==="Safari"&&Number(e.version)>=15}(),ii.supportWebRTCInsertableStream=function(){const e=ae();return(e.name===de.CHROME||e.name===de.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ii.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ii.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,_R(()=>{ii.supportDualStreamEncoding=function(){const e=ae();return!!N("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&N("CHROME_DUAL_STREAM_USE_ENCODING"))}(),S.debug("browser ua: ",navigator.userAgent),S.info("browser info: ",t),S.info("browser compatibility: ",ii)})})();const B4=["CHINA","GLOBAL"],iM=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],sh=[],xf=[];function oh(t,e){return!!e&&sh.some(n=>n.uid===t&&n.channelName===e)}function vI(){return xf.length>0}var F4=vN.forEach,rM=lc("forEach")?[].forEach:function(t){return F4(this,t,arguments.length>1?arguments[1]:void 0)};fe({target:"Array",proto:!0,forced:[].forEach!==rM},{forEach:rM});var j4=Nr("Array","forEach"),G4=bs,H4=Vn,W4=he,K4=j4,RI=Array.prototype,z4={DOMTokenList:!0,NodeList:!0},Y4=function(t){var e=t.forEach;return t===RI||W4(RI,t)&&e===RI.forEach||H4(z4,G4(t))?K4:e},q4=kt(Y4),X4=_a,aM=Il;fe({target:"Object",stat:!0,forced:jt(function(){aM(1)})},{keys:function(t){return aM(X4(t))}});var J4=kt(hr.Object.keys),Q4=kt(po),Z4=kt(W_),$4=fe,sM=Ha,tG=Eu,eG=ki,oM=jh,nG=oo,iG=no,rG=uA,aG=fn,sG=ir,oG=uN("slice"),cG=aG("species"),yI=Array,lG=Math.max;$4({target:"Array",proto:!0,forced:!oG},{slice:function(t,e){var n,i,r,s=iG(this),c=nG(s),l=oM(t,c),d=oM(e===void 0?c:e,c);if(sM(s)&&(n=s.constructor,(tG(n)&&(n===yI||sM(n.prototype))||eG(n)&&(n=n[cG])===null)&&(n=void 0),n===yI||n===void 0))return sG(s,l,d);for(i=new(n===void 0?yI:n)(lG(d-l,0)),r=0;l<d;l++,r++)l in s&&rG(i,r,s[l]);return i.length=r,i}});var dG=Nr("Array","slice"),uG=he,hG=dG,CI=Array.prototype,pG=function(t){var e=t.slice;return t===CI||uG(CI,t)&&e===CI.slice?hG:e},fG=kt(pG);function Et(t,e,n,i,r){var s,c,l,d={};return q4(s=J4(i)).call(s,function(h){d[h]=i[h]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=Q4(c=Z4(l=fG(n).call(n)).call(l)).call(c,function(h,p){return p(t,e,h)||h},d),r&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(r):void 0,d.initializer=void 0),d.initializer===void 0?(oN(t,e,d),null):d}let xR=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),AI=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),ds=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Ji=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),yt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Me=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Dt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),bt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),tg=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),Jt=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Qi=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),xt=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function VR(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw S.error("Invalid Channel Name ".concat(t)),new B(O.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function BR(t){if(e=t,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||hL(t,1,255)))throw new B(O.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof t=="string"&&S.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let zc=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const _G={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},bI={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function II(t,e){ei(t.url,"".concat(e,".url"),1,1e3,!1),nn(t.x)||ye(t.x,"".concat(e,".x"),0,1e4),nn(t.y)||ye(t.y,"".concat(e,".y"),0,1e4),nn(t.width)||ye(t.width,"".concat(e,".width"),0,1e4),nn(t.height)||ye(t.height,"".concat(e,".height"),0,1e4),nn(t.zOrder)||ye(t.zOrder,"".concat(e,".zOrder"),0,255),nn(t.alpha)||ye(t.alpha,"".concat(e,".alpha"),0,1,!1)}const mG={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let fd=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),OI=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Ln=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function cM(t){if(!t.channelName)throw new B(O.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new B(O.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&ei(t.token,"info.token",1,2047),BR(t.uid),VR(t.channelName),!0}let Zi=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Yc=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Rr=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Vf=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Ee=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),qn=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),FR=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),Gn=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),ue=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const lM=[ue.AFRICA,ue.ASIA,ue.CHINA,ue.EUROPE,ue.GLOBAL,ue.INDIA,ue.JAPAN,ue.NORTH_AMERICA,ue.OCEANIA,ue.OVERSEA,ue.SOUTH_AMERICA];let vi=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const jR={CHINA:{},ASIA:{CODE:vi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:vi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:vi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:vi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:vi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:vi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:vi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:vi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:vi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:vi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:vi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:vi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:vi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Xb&&(jR.CHINA={CODE:vi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let eg=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function dM(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class uM extends Xe{constructor(e,n){super(),A(this,"onICEConnectionStateChange",void 0),A(this,"onConnectionStateChange",void 0),A(this,"onDTLSTransportStateChange",void 0),A(this,"onDTLSTransportError",void 0),A(this,"onICETransportStateChange",void 0),A(this,"onFirstAudioReceived",void 0),A(this,"onFirstVideoReceived",void 0),A(this,"onFirstAudioDecoded",void 0),A(this,"onFirstVideoDecoded",void 0),A(this,"onFirstVideoDecodedTimeout",void 0),A(this,"onSelectedLocalCandidateChanged",void 0),A(this,"onSelectedRemoteCandidateChanged",void 0),A(this,"onICECandidateError",void 0),A(this,"getLocalVideoStats",void 0)}}class hM extends uM{constructor(e,n){super(e,n),A(this,"establishPromise",void 0)}}let ut=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Ri=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),qc=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const pM=["disconnected","failed"];let X=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),me=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),vt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),us=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),hs=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Xn=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),fM=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Wo=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),La=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Xs=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Bf=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),En=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Ff=function(t){return t.ABORT="abort",t}({}),_d=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),EG=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const gG={[xR.ACCESS_POINT]:{[Ji.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ji.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ji.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ji.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ji.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ji.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ji.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[xR.UNILBS]:{[ds.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ds.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ds.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ds.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ds.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ds.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ds.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ds.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ds.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ds.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ds.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ds.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[xR.STRING_UID_ALLOCATOR]:{[AI.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[AI.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[AI.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function jf(t){const e=gG[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===xR.ACCESS_POINT){const i=t%1e4;if(i.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const SG={[yt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[yt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[yt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[yt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[yt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[yt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[yt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[yt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[yt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[yt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[yt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[yt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[yt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[yt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[yt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[yt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[yt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[yt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[yt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[yt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[yt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[yt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[yt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[yt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[yt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[yt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[yt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[yt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[yt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[yt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[yt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[yt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[yt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[yt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[yt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[yt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[yt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[yt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[yt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[yt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[yt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[yt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[yt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[yt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[yt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[yt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[yt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[yt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[yt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[yt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[yt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[yt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[yt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[yt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[yt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[yt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[yt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[yt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[yt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[yt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[yt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[yt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[yt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[yt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function ng(t){return SG[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function _M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function wI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_M(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_M(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function NI(t,e){if(typeof t=="string")return t;const{proxy:n,host:i,port:r}=t;if(e){const s=N("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(s,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const TG=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,vG=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,RG=/wss:\/\/(.+):([0-9]+)\/?/,yG=/wss:\/\/(.[^\/]+)\/?/;let CG=0;class AG{constructor(e,n){A(this,"id",0),A(this,"store",void 0),A(this,"recordIndex",void 0),A(this,"websockets",[]),A(this,"try443PortDuration",2e3),A(this,"forceCloseWSDuration",5e3),A(this,"try443PortTimeout",null),A(this,"forceCloseTimeout",null),A(this,"isTry443PortFailed",!1),A(this,"isNormalPortFailed",!1),A(this,"useDoubleDomain",!1),A(this,"useProxy",!1),A(this,"startTime",Date.now()),this.id=++CG,this.try443PortDuration=N("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;const n=Date.now()-this.startTime;for(var i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];S.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...r)}createWebSocket(e,n,i){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:i});const r=N("GATEWAY_DOMAINS"),s=Date.now(),c=[],l=r.find(m=>{var g;return rt(g=e.host).call(g,m)});l||(this.useDoubleDomain=!1);const d=[];if(this.useDoubleDomain)r.forEach(m=>{d.push(NI(wI(wI({},e),{},{host:e.host.replace(l,m)}),n))});else{const m=wI({},e);if(n&&l){const g=r.find(C=>C!==l);g&&(m.host=m.host.replace(l,g))}d.push(NI(m,n))}try{d.forEach(m=>{const g=new WebSocket(m);g.binaryType="arraybuffer",c.push(g),this.logger("ws is connecting:",g.url)})}catch(m){if(this.logger("ws create failed"),c.forEach(g=>g.close()),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,i);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,i);throw new B(O.WS_ERR,"init websocket failed! Error: ".concat(m.toString()))}const h=FE();this.store&&this.store.recordJoinChannelService({urls:c.map(m=>m.url),service:"gateway"},this.recordIndex),c.forEach(m=>{m.onopen=()=>{this.logger("onopen: ws ".concat(m.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(g=>{g!==m&&(g.onopen=null,g.onclose=null,g.onmessage=null,g.close(),this.logger("close backup websocket: ".concat(g.url)))}),this.websockets.length=0,h.resolve(m)},m.onclose=g=>{this.logger("onclose: ws ".concat(m.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(m.readyState));const C=c.every(R=>R.readyState===WebSocket.CLOSED||R.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(C)),C&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(g.reason)),h.reject({code:g.code,reason:FR.A_ROUND_WS_FAILED})):!n&&C&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),_()),n?this.isTry443PortFailed=C:this.isNormalPortFailed=C},m.onmessage=g=>this.logger("".concat(m.url," onmessage: ").concat(g.data))}),this.websockets.push(...c);const p=()=>{this.websockets.forEach(m=>m.readyState!==WebSocket.OPEN&&m.close())},_=()=>{if(h.isResolved)return p();ae().os===Fn.MAC_OS&&en()&&p(),this.createWebSocket(e,!0,!0).then(m=>{h.resolve(m)}).catch(m=>{this.isNormalPortFailed&&h.reject(m),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",h.isResolved),this.forceCloseTimeout=null,p()},this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,p()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",h.isResolved),this.try443PortTimeout=null,_()},this.try443PortDuration)})(),h.promise}chooseBestWebsocket(e,n,i,r){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(s){let c,l,d;return[,c,l,d]=s.match(TG)||[],c||([,l,d]=s.match(vG)||[]),l&&d||([,l,d]=s.match(RG)||[]),l&&d||([,l]=s.match(yG)||[]),l||S.warning("un-destructible url: ",s),{proxy:c,host:l,port:d||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,i&&this.useProxy&&(S.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(e,!!i,!1).finally(()=>this.clearTimeout())}}function mM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class EM extends Xe{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;rt(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(xt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(xt.CONNECTED):this._state==="closed"?this.emit(xt.CLOSED):this._state==="failed"&&this.emit(xt.FAILED))}resetReconnectCount(e){S.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),A(this,"_websocketUrl",null),A(this,"connectionID",0),A(this,"currentURLIndex",0),A(this,"urls",[]),A(this,"_reconnectMode","tryNext"),A(this,"reconnectReason",void 0),A(this,"_initMutex",void 0),A(this,"name",void 0),A(this,"_state","closed"),A(this,"reconnectInterrupter",void 0),A(this,"websocket",void 0),A(this,"retryConfig",void 0),A(this,"reconnectCount",0),A(this,"forceCloseTimeout",5e3),A(this,"onlineReconnectListener",void 0),A(this,"useCompress",void 0),A(this,"tryDoubleDomain",!1),A(this,"use443PortOnly",!1),A(this,"wsInflateLength",0),A(this,"wsDeflateLength",0),A(this,"closeEstablishingWs",()=>{}),A(this,"store",void 0),A(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=e,this.retryConfig=function(_){for(var m=1;m<arguments.length;m++){var g=arguments[m]!=null?arguments[m]:{};m%2?mM(Object(g),!0).forEach(function(C){A(_,C,g[C])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(g)):mM(Object(g)).forEach(function(C){Object.defineProperty(_,C,Object.getOwnPropertyDescriptor(g,C))})}return _}({},n),this.useCompress=i,this.tryDoubleDomain=r,this.use443PortOnly=s,this._initMutex=new Ti("websocket",c?c.clientId:void 0);const{timeout:l,timeoutFactor:d}=n,h=Math.max(300,Math.floor(3*l/5)),p=Math.max(1.2,Math.floor(8*d)/10);Fr.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p),Rn.on(Tf.NETWORK_STATE_CHANGE,(_,m)=>{_!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(_)),_===Fr.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const r=FE(),s=this.urls[this.currentURLIndex];N("ENABLE_PREALLOC_PC")&&this.emit(fM.PRE_CONNECT_PC),this.createWebSocketConnection(s).then(r.resolve).catch(r.reject),this.once(xt.CLOSED,()=>{r.reject(new G(O.WS_DISCONNECT))}),this.once(xt.CONNECTED,r.resolve),await r.promise}catch{}finally{i()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void S.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),S.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new G(O.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(i){throw new G(O.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const i=FE();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=p=>{var _;(_=this.store)===null||_===void 0||_.signalChannelOpen(),S.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},s=async p=>{var _;if(S.debug("[".concat(this.name,"] websocket close ").concat((_=this.websocket)===null||_===void 0?void 0:_.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new G(O.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");const m=ea(this,xt.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,g=await this.reconnectWithAction(m);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!g)return i.reject(new G(O.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);i.resolve()}},c=p=>{this.emit(xt.ON_MESSAGE,p)},l=p=>{S.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),N("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=N("GATEWAY_WSS_ADDRESS")),S.debug("[".concat(this.name,"] start connect, url:"),e);const d=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var h;this._websocketUrl=NI(e);const p=await this.chooseBestWebsocketConnection(e);this.websocket=p,r&&r(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=c,this.websocket.onerror=l,(h=this.store)===null||h===void 0||h.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(p){const _=this.state==="closed",m=p instanceof G,g=m&&p.code===O.WS_ABORT,C=m&&p.code===O.WS_ERR,R=m?p.message:p&&(p.reason||p.toString());S.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(R)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:g?"aborted":"error",errors:[p]},d),_||C?(i.reject(_?new G(O.WS_DISCONNECT,"websocket is closed: ".concat(R)):new G(O.WS_ERR,"init websocket failed: ".concat(R))),C&&S.error("[".concat(this.name,"] init websocket failed: ").concat(R))):s&&s(p)}return i.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;S.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||Rn.isOnline||!Rn.onlineWaiter||(this.onlineReconnectListener=Rn.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const c=jb(this.reconnectCount,this.retryConfig);S.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(e)),await st.race([ni(c),this.onlineReconnectListener||new st(()=>{})])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const r=async(c,l)=>{this.emit(xt.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(e==="retry")await r(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);S.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await r(this.urls[this.currentURLIndex],e)}else e==="recover"&&(S.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ui(this,xt.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(c){var s;S.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const l=c==null||(s=c.data)===null||s===void 0?void 0:s.desc;return Array.isArray(l)&&rt(l).call(l,"dynamic key expired")?(this.emit(xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class DI extends EM{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const i=FE(),r=function(c,l){return new AG(c,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),i.reject(new G(O.WS_ABORT,"choose best websocket aborted"))};const s=N("GATEWAY_DOMAINS");return S.debug("[choose-best-ws] currentDomain: ",e,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class ig extends EM{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new st((i,r)=>{let s=!1;const c=[];this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),c.forEach(C=>{C.onclose=null,C.onopen=null,C.onmessage=null,C.close()}),r(new G(O.WS_ABORT,"choose best websocket aborted"))};const l=N("GATEWAY_DOMAINS");let d;const h=e.indexOf("?h="),p=l.find(C=>h!==-1?rt(e).call(e,C,h):rt(e).call(e,C));S.debug("[choose-best-ws] currentDomain: ",p,", domains: ",l);let _=!this.tryDoubleDomain||!p;if(!_&&p){var m;const C=Date.now();try{l.forEach(R=>{const y=h===-1?e.replace(p,R):e.substr(0,h)+e.substr(h).replace(p,R),b=new WebSocket(y);b.binaryType="arraybuffer",c.push(b),S.debug("[choose-best-ws] ws is connecting:",b.url)})}catch{for(S.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach(y=>y.close());c.length;)c.pop();_=!0}(m=this.store)===null||m===void 0||m.recordJoinChannelService({urls:c.map(R=>R.url),service:"gateway"},n),c.forEach(R=>{R.onopen=()=>{if(s)return;const y=Date.now()-C;S.debug("[choose-best-ws] ws open cost ".concat(y,"ms")),c.filter(b=>b!==R).forEach(b=>{S.debug("[choose-best-ws]close backup websocket: ".concat(b.url)),b.close()}),s=!0,i(R)},R.onclose=y=>{d=y,!s&&(c.find(b=>!(b.readyState===WebSocket.CLOSED||b.readyState===WebSocket.CLOSING))||(S.debug("[choose-best-ws] all websocket is closed"),s=!0,r(d)))},R.onmessage=y=>{S.debug("[choose-best-ws]".concat(R.url," onmessage: ").concat(y.data))}}),ni(this.forceCloseTimeout).then(()=>{c.forEach(R=>{R.readyState!==WebSocket.OPEN&&R.close()})})}if(_){var g;let C;S.debug("[choose-best-ws] use single url: ",e),(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:[e],service:"gateway"},n);try{C=new WebSocket(e),c.push(C),C.binaryType="arraybuffer"}catch(R){const y=new G(O.WS_ERR,"init websocket failed! Error: ".concat(R.toString()));return S.error("[".concat(this.name,"]").concat(y)),void r(y)}C.onopen=()=>{i(C)},C.onclose=R=>{r(R)},C.onmessage=R=>{S.debug("[choose-best-ws]".concat(C.url," onmessage: ").concat(R.data))},ni(this.forceCloseTimeout).then(()=>{C&&C.readyState!==WebSocket.OPEN&&C.close()})}}).then(i=>(this.closeEstablishingWs=void 0,i)).catch(i=>{throw this.closeEstablishingWs=void 0,i})}}class bG extends Xe{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Me.CONNECTED?this.emit(Dt.WS_CONNECTED):e===Me.RECONNECTING?this.emit(Dt.WS_RECONNECTING,this._websocketReconnectReason):e===Me.CLOSED&&this.emit(Dt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),A(this,"_disconnectedReason",void 0),A(this,"_websocketReconnectReason",void 0),A(this,"_connectionState",Me.CLOSED),A(this,"reconnectToken",void 0),A(this,"websocket",void 0),A(this,"openConnectionTime",void 0),A(this,"clientId",void 0),A(this,"lastMsgTime",Date.now()),A(this,"uploadCache",[]),A(this,"uploadCacheInterval",void 0),A(this,"rttRolling",new OL(5)),A(this,"pingpongTimer",void 0),A(this,"wsInflateDataTimer",void 0),A(this,"pingpongTimeoutCount",0),A(this,"joinResponse",void 0),A(this,"multiIpOption",void 0),A(this,"initError",void 0),A(this,"spec",void 0),A(this,"store",void 0),A(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Dt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){if(this.emit(r._type,r._message),r._type===Jt.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Jt.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(_e.UID_BANNED);break;case 15:this.close(_e.IP_BANNED);break;case 16:this.close(_e.CHANNEL_BANNED)}if(r._type===Jt.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case yt.ERR_LICENSE_MISSING:this.close(_e.LICENSE_MISSING);break;case yt.ERR_LICENSE_EXPIRED:this.close(_e.LICENSE_EXPIRED);break;case yt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(_e.LICENSE_MINUTES_EXCEEDED);break;case yt.ERR_LICENSE_PERIOD_INVALID:this.close(_e.LICENSE_PERIOD_INVALID);break;case yt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(_e.LICENSE_MULTIPLE_SDK_SERVICE);break;case yt.ERR_LICENSE_ILLEGAL:this.close(_e.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new DI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,N("JOIN_GATEWAY_USE_DUAL_DOMAIN"),N("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Me.CONNECTED&&this.reconnect("retry",di.OFFLINE)})}async request(e,n,i,r){const s=Le(6,""),c={_id:s,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new st((C,R)=>{if(this.connectionState===Me.CONNECTED)return C();const y=()=>{this.off(Dt.WS_CLOSED,b),C()},b=()=>{this.off(Dt.WS_CONNECTED,y),R(new B(O.WS_ABORT))};this.once(Dt.WS_CONNECTED,y),this.once(Dt.WS_CLOSED,b),e!==bt.PUBLISH&&e!==bt.PUBLISH_DATASTREAM&&e!==bt.SUBSCRIBE&&e!==bt.SUBSCRIBE_DATASTREAM&&e!==bt.UNSUBSCRIBE&&e!==bt.UNSUBSCRIBE_DATASTREAM&&e!==bt.UNPUBLISH&&e!==bt.UNPUBLISH_DATASTREAM&&e!==bt.CONTROL&&e!==bt.RESTART_ICE||this.once(Dt.DISCONNECT_P2P,()=>{R(new B(O.DISCONNECT_P2P))}),e!==bt.PUBLISH&&e!==bt.RESTART_ICE||this.once(Dt.ABORT_P2P_EXECUTION,()=>{R(new B(O.DISCONNECT_P2P))})});if(this.connectionState!==Me.CONNECTING&&this.connectionState!==Me.RECONNECTING||e===bt.JOIN||e===bt.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const h=new st((C,R)=>{let y=!1;const b=(L,U)=>{y=!0,C({isSuccess:L==="success",message:U||{}}),this.off(Dt.WS_CLOSED,I),this.off(Dt.WS_RECONNECTING,I),this.emit(Dt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),b);const I=()=>{R(new B(O.WS_ABORT,"type: ".concat(e))),this.off(Dt.WS_CLOSED,I),this.off(Dt.WS_RECONNECTING,I),this.off("res-@".concat(s),b)};this.once(Dt.WS_CLOSED,I),this.once(Dt.WS_RECONNECTING,I),ni(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||y||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Dt.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(C){if(this.connectionState===Me.CLOSED||e===bt.LEAVE)throw new B(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?C.throw():e===bt.JOIN||e===bt.REJOIN?null:(await d(),await this.request(e,n))}if(p.isSuccess)return p.message;const _=Number(p.message.error_code||p.message.code),m=ng(_),g=new B(O.UNEXPECTED_RESPONSE,"".concat(m.desc,": ").concat(p.message.error_str),{code:_,data:p.message,desc:m.desc});return m.action==="success"?p.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(_,", message: ").concat(m.desc,", action: ").concat(m.action)),_===yt.ERR_TOO_MANY_BROADCASTERS?((e===bt.JOIN||e===bt.REJOIN)&&(this.initError=g,this.close()),g.throw()):m.action==="failed"?g.throw():m.action==="quit"?(this.initError=g,this.close(),g.throw()):(_===yt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",di.MULTI_IP)):this.reconnect(m.action,di.SERVER_ERROR),e===bt.JOIN||e===bt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new st(i=>{const r=s=>{(!n||n(s))&&(this.off(e,r),i(s))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(tg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const s=N("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Me.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},N("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new st((n,i)=>{this.once(Dt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Dt.WS_CLOSED,r=>i(this.initError||new B(O.WS_ABORT,r))),this.connectionState=Me.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||_e.LEAVE,this.connectionState=Me.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Dt.ABORT_P2P_EXECUTION);const e=await ui(this,Dt.REQUEST_JOIN_INFO),n=await this.request(bt.JOIN,e);if(!n)return this.emit(Dt.REPORT_JOIN_GATEWAY,FR.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Dt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Me.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new B(O.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=zE(this,Dt.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(bt.REJOIN,e);return!!n&&(this.connectionState=Me.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(Jt.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(Jt.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(Jt.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(Jt.MUTE_AUDIO,{uid:i.uid}):this.emit(Jt.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(Jt.MUTE_VIDEO,{uid:i.uid}):this.emit(Jt.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(Jt.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(Jt.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(Jt.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(Jt.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(Jt.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){S.debug("[".concat(this.clientId,"] receive notification: "),e);const n=ng(e.code);if(e.code===28&&"detail"in e&&(S.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(Dt.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(_e.UID_BANNED),void this.close()):void this.reconnect(n.action,di.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=N("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(S.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>N("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",di.TIMEOUT):this.request(bt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),N("REPORT_STATS")&&this.send(bt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(tg.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(xt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Dt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(xt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(xt.CLOSED,()=>{this.connectionState=Me.CLOSED}),this.websocket.on(xt.FAILED,()=>{this._disconnectedReason=_e.NETWORK_ERROR,this.connectionState=Me.CLOSED}),this.websocket.on(xt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Me.CONNECTED?this.connectionState=Me.RECONNECTING:this.connectionState=Me.CONNECTING}),this.websocket.on(xt.WILL_RECONNECT,(e,n,i)=>{const r=zE(this,Dt.IS_P2P_DISCONNECTED),s=r||e!=="retry";r&&e==="retry"&&(S.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=FR.P2P_DISCONNECTED),s&&(S.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(Dt.REPORT_JOIN_GATEWAY,n||FR.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Dt.DISCONNECT_P2P)),i(e)}),this.websocket.on(xt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{S.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",di.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(Dt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof B){if(e.code===O.UNEXPECTED_RESPONSE&&e.data.code===yt.ERR_NO_AUTHORIZED)return this.initError=new B(O.TOKEN_EXPIRE,"dynamic key expired"),void this.close(_e.TOKEN_EXPIRE);S.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",di.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(xt.REQUEST_NEW_URLS,(e,n)=>{ui(this,Dt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(fM.PRE_CONNECT_PC,()=>{this.emit(Dt.PRE_CONNECT_PC)})}}let IG=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),yn=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function gM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function GR(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function md(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(N("TURN_DOMAIN")):(S.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function LI(t,e){t.addresses||(t.addresses=[]);const n=function(l,d){if(N("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(_=>{let{ip:m,port:g}=_;return{address:"".concat(m,":").concat(g)}});const h=N("GATEWAY_DOMAINS");let p=h[1]&&rt(d).call(d,h[1])?1:0;return l.map(_=>{let{domain_prefix:m,port:g,ip:C}=_;if(m)return{address:"".concat(m,".").concat(h[p++%h.length],":").concat(g)};const R=/^[\.\:\d]+$/.test(C),y=R?"".concat(C.replace(/[^\d]/g,"-"),".").concat(h[p++%h.length],":").concat(g):"".concat(C,":").concat(g);return R||S.debug("Cannot recognized as ip address: ".concat(C,", use as host")),{ip:C,port:g,address:y}})}(t.addresses,e),i=Array.isArray(t.detail)&&t.detail[18];if(i&&typeof i=="string"){const l=i.split(";");for(let d=0;d<l.length;d++){var r;const h=Bi(r=l[d]).call(r);n[d]&&h&&(n[d].ip6=h)}}const s=t.detail&&t.detail.candidate;let c;if(s){const[l,d]=s.split(":");l&&d&&(c={port:Number(d),ip:l,address:"".concat(l,":").concat(d)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function jr(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function SM(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(jr(e.width),"x").concat(jr(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function TM(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function rg(t,e){let n,i,r;switch(e){case yn.CHOOSE_SERVER:i=4096,r="choose server";break;case yn.CLOUD_PROXY:i=1048576,r="proxy";break;case yn.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case yn.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new B(O.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(s=>{s.buffer&&s.buffer.flag===i&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(c=>GR(GR({},c),{},{ticket:s.buffer.cert})),server_ts:t.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:GR(GR({},s.buffer.detail),t.detail),flag:s.buffer.flag,opid:t.opid,cert:s.buffer.cert})}),!n)throw new B(O.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function vM(t,e){return await st.all(t.addresses.map(async n=>({address:N("USE_TURN_IP")?n.ip:md(n.ip),tcpport:n.port,udpport:n.port,username:e&&N("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():hi.username,password:e&&N("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Ub(e.toString()):hi.password})))}function PI(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),i=e.videoHeight||n.height,r=e.videoWidth||n.width;return i&&r?Math.max(Math.min(i,r)/Math.min(jr(t.height),jr(t.width)),1):(S.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ed(t){let{candidateType:e,relayProtocol:n,type:i,address:r,port:s,protocol:c}=t;const l={candidateType:e,relayProtocol:n,protocol:c};if(i!=="local-candidate"){const d=r.split(".");d.length>=4&&(d[1]="*",d[2]="*"),l.address=d.join("."),l.port=s}return l}function HR(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:N("SVC_MODE");if(N("ENABLE_SVC"))return function(e){return e in SR}(t)?t:SR.L1T3}const RM={[ut.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[ut.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function WR(t,e,n){e.forEach(i=>{var r;const s=RM[t].find(l=>{var d;let{key:h}=l;return rt(d=i.extensionName).call(d,h)});if(!s)return;const c=n.find(l=>{let{extensionName:d}=l;return rt(d).call(d,s.key)});c&&rt(r=c.extensionName).call(r,"gdpr_forbidden")&&(i.extensionName=c.extensionName)})}function Gf(t,e){e.forEach(n=>{var i;const r=RM[t].find(s=>{var c;let{key:l}=s;return rt(c=n.extensionName).call(c,l)});rt(i=n.extensionName).call(i,"gdpr_forbidden")&&r&&(n.extensionName=r.extensionName)})}function yM(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||rt(t).call(t,"abs-send-time")}function KR(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||rt(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function CM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function AM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?CM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):CM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function ag(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:l,filterVideoCodec:d}=e,{useXR:h}=n;let p=[],_=[],m=[],g=[],C=!1,R=!1;if(vr(t).mediaDescriptions.forEach(b=>{i&&i!==b.attributes.direction||(b.media.mediaType!=="video"||C||(_=b.attributes.payloads,g=b.attributes.extmaps,C=!0),b.media.mediaType!=="audio"||R||(p=b.attributes.payloads,m=b.attributes.extmaps,R=!0))}),!g||_.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!m||p.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(_.forEach(b=>{var I;(I=b.rtpMap)!==null&&I!==void 0&&I.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),h&&b.rtcpFeedbacks.push({type:"rrtr"})}),p.forEach(b=>{var I;(I=b.rtpMap)!==null&&I!==void 0&&I.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),h&&b.rtcpFeedbacks.push({type:"rrtr"})}),r&&(p=p.filter(b=>{var I;return((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())!=="rtx"}),_=_.filter(b=>{var I;return((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())!=="rtx"})),s&&(_=_.filter(b=>{var I;return!/(red)|(ulpfec)|(flexfec)/i.test(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName)||"")})),c&&(p=p.filter(b=>{var I;return!/(red)|(ulpfec)|(flexfec)/i.test(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName)||"")})),l&&(l==null?void 0:l.length)>0&&(p=p.filter(b=>{var I;return rt(l).call(l,((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())||"")})),d&&(d==null?void 0:d.length)>0){const b=_.filter(I=>{var L;return rt(d).call(d,((L=I.rtpMap)===null||L===void 0?void 0:L.encodingName.toLowerCase())||"")});_=b.concat(r?[]:UI(b,_))}const y=N("UNSUPPORTED_VIDEO_CODEC");return y&&y.length>0&&(_=_.filter(b=>!(b.rtpMap&&rt(y).call(y,b.rtpMap.encodingName.toLowerCase())))),{audioCodecs:p,videoCodecs:_,audioExtensions:m,videoExtensions:g}}function gd(t){const e=vr(t);let n,i;for(const r of e.mediaDescriptions){if(!n){const s=r.attributes.iceUfrag,c=r.attributes.icePwd;if(!s||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:c}}if(!i){const s=r.attributes.fingerprints;s.length>0&&(i={fingerprints:s})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function bM(t,e){const n=[],i=t.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),r=t.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),s=t.attributes.ssrcs;if(r)r.ssrcIds.forEach(c=>{var l;const d=(l=i.find(h=>h.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:e?d:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:e?l:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function IM(t,e,n){const{cname:i}=t;let r=[];e&&(r=OM(e)),r.length===0&&(r=t.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),S.debug("Using candidates from gateway."));const s={fingerprints:t.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},c={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let l;switch(t.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}const d=YR(t.rtpCapabilities),h=[];return Array.isArray(n)&&n.length>0&&n.forEach(p=>{h.push({kind:ut.VIDEO,ssrcId:p.v,rtx:p.v_rtx,mslabel:"".concat(p.v,"_").concat(p.a)},{kind:ut.AUDIO,ssrcId:p.a,mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:s,iceParameters:c,candidates:r,rtpCapabilities:d,setup:l,cname:i,preSSRCs:h}}function OM(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],S.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),S.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function ch(t,e,n){const i=[],r=[];return t.forEach(s=>{let{ssrcId:c,rtx:l}=s;const d=Le(8,"track-"),h={ssrcId:c,attributes:AM({label:d,mslabel:n=n||Le(10,""),msid:"".concat(n," ").concat(d)},e&&{cname:e})};if(i.push(h),l!==void 0){const p={ssrcId:l,attributes:AM({label:d,mslabel:n,msid:"".concat(n," ").concat(d)},e&&{cname:e})};i.push(p),r.push({semantic:"FID",ssrcIds:[c,l]})}}),t.length>1&&r.push({semantic:"SIM",ssrcIds:t.map(s=>{let{ssrcId:c}=s;return c})}),{ssrcs:i,ssrcGroups:r}}function Hf(t,e){e instanceof sn&&t.attributes.payloads.forEach(n=>{var i;const r=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!r||["opus","pcmu","pcma","g722"].indexOf(r)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),r==="opus"&&typeof N("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=N("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=e._encoderConfig;s&&(r!=="pcmu"&&r!=="pcma"&&r!=="g722"&&(s.bitrate&&!en()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),e instanceof ZE&&r==="opus"&&e._config.DTX&&(n.fmtp.parameters.usedtx="1"))})}function kI(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function MI(t,e){var n;if(!(e instanceof xe&&e._encoderConfig&&e._hints.indexOf(Ce.SCREEN_TRACK)===-1))return;const i=e._encoderConfig;se().supportMinBitrate&&i.bitrateMin&&t.attributes.payloads.forEach(r=>{var s,c;rt(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))}),se().supportMinBitrate&&!rt(n=e._hints).call(n,Ce.LOW_STREAM)&&i.bitrateMax&&t.attributes.payloads.forEach(r=>{var s,c;rt(s=["h264","h265","vp8","vp9","av1"]).call(s,((c=r.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(N("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))})}function wM(t){if(t.media.mediaType!=="video")return;const e=ae();if(e.name!==de.SAFARI&&e.os!==Fn.IOS)return;const n=t.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function zR(t,e,n){if(!e)return;let i,r;if(t.media.mediaType==="video"?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),e.twcc===!0){const s=i.find(c=>KR(c.extensionName));if(s){const c=s.extensionName;t.attributes.extmaps.find(d=>KR(d.extensionName))||t.attributes.extmaps.push({entry:s.entry,extensionName:c}),function(d,h){return h.filter(p=>!!d.find(_=>_.payloadType===p.payloadType&&!!_.rtcpFeedbacks.find(m=>m.type==="transport-cc")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="transport-cc")||d.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){const s=t.attributes.extmaps.findIndex(c=>KR(c.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(e.remb===!0){const s=i.find(c=>yM(c.extensionName));if(s){const c=s.extensionName;t.attributes.extmaps.find(d=>d.extensionName===c)||t.attributes.extmaps.push({entry:s.entry,extensionName:c}),function(d,h){return h.filter(p=>!!d.find(_=>_.payloadType===p.payloadType&&!!_.rtcpFeedbacks.find(m=>m.type==="goog-remb")))}(r,t.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(h=>h.type==="goog-remb")||d.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){const s=t.attributes.extmaps.findIndex(c=>yM(c.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(d=>d.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function NM(t,e,n){if(en()||t.media.mediaType!=="video"||!(e instanceof xe)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!N("SIMULCAST")||n==="vp9"&&N("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,r=t.attributes.ssrcs[0],s=t.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===r.ssrcId),c={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let l=1;l<i;l++)t.attributes.ssrcs.push({ssrcId:r.ssrcId+l,attributes:Je(r.attributes)}),c.ssrcIds.push(r.ssrcId+l),s&&(t.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+l,attributes:Je(r.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+l,s.ssrcIds[1]+l]}));t.attributes.ssrcGroups.unshift(c)}async function DM(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:r,recv:s,sendrecv:c}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0;const p=ag(h,l,d,"sendonly"),_=ag(h,l,d,"recvonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ps(p,_,"videoExtensions",m,g,C),ps(p,_,"videoCodecs",m,g,C),ps(p,_,"audioExtensions",m,g,C),ps(p,_,"audioCodecs",m,g,C),N("RAISE_H264_BASELINE_PRIORITY")){const R=[],y=[];C.videoCodecs.forEach((b,I)=>{var L;if(((L=b.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"){var U,x;const M=C.videoCodecs[I+1],j=M&&UM(b,M),K=(U=b.fmtp)===null||U===void 0?void 0:U.parameters["profile-level-id"],it=(x=b.fmtp)===null||x===void 0?void 0:x.parameters["packetization-mode"];!K||K!==N("FIRST_H264_PROFILE_LEVEL_ID")||N("FIRST_PACKETIZATION_MODE")&&it!==N("FIRST_PACKETIZATION_MODE")?j?y.push([b,M]):y.push([b]):j?R.push([b,M]):R.push([b])}}),R.length>0&&y.length>0&&(S.debug("raising H264 baseline profile priority"),C.videoCodecs.forEach((b,I)=>{var L;if(((L=b.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"){const U=UM(b,C.videoCodecs[I+1]),x=R.shift()||y.shift()||[];x.length>0&&(U?C.videoCodecs.splice(I,2,...x):C.videoCodecs.splice(I,1,...x))}}),g.videoCodecs=g.videoCodecs.filter(b=>{var I,L;return!(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLocaleLowerCase())==="h264"&&((L=b.fmtp)===null||L===void 0?void 0:L.parameters["profile-level-id"])!==N("FIRST_H264_PROFILE_LEVEL_ID"))}),N("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(b=>{var I,L;return!(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLocaleLowerCase())==="h264"&&((L=b.fmtp)===null||L===void 0?void 0:L.parameters["profile-level-id"])!==N("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:m,recv:g,sendrecv:C}}(t,e,i);try{n.close()}catch{}return{send:r,recv:s,sendrecv:c}}function LM(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=ag(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ps(t,e,"videoExtensions",n,i,r),ps(t,e,"videoCodecs",n,i,r),ps(t,e,"audioExtensions",n,i,r),ps(t,e,"audioCodecs",n,i,r),N("RAISE_H264_BASELINE_PRIORITY")){const s=r.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const c=r.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(c<s){S.debug("raising H264 baseline profile priority");const l=r.videoCodecs[s];r.videoCodecs.splice(s,1),r.videoCodecs.splice(c,0,l)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:i,sendrecv:r}}function ps(t,e,n,i,r,s){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return t[n].forEach(l=>{e[n].some((d,h)=>{if(l.entry===d.entry&&l.extensionName===d.extensionName)return c.push(h),!0})?s[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return t[n].forEach(l=>{e[n].some((d,h)=>{if(l.payloadType===d.payloadType&&JSON.stringify(l)===JSON.stringify(d))return c.push(h),!0})?s[n].push(l):i[n].push(l)}),void e[n].forEach((l,d)=>{c.indexOf(d)===-1&&r[n].push(l)})}}function YR(t){const{send:e,recv:n,sendrecv:i}=t;if(!i){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let r,s;return e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...i.audioCodecs],s.videoCodecs=[...n.videoCodecs,...i.videoCodecs],s.audioExtensions=[...n.audioExtensions,...i.audioExtensions],s.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):s=i,{send:r,recv:s}}function Wf(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function sg(t,e,n,i){let r=[];if(t===ut.VIDEO){if(N("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(r=e.videoCodecs.filter(s=>{var c;return rt(c=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===N("H264_PROFILE_LEVEL_ID")})),!Array.isArray(r)||r.length===0){let s=[];const c=[],l=[],d=[];if(n.videoCodecs.forEach(h=>{const p=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"";rt(p).call(p,i)?s.push(h):rt(p).call(p,"vp9")?c.push(h):rt(p).call(p,"vp8")?l.push(h):rt(p).call(p,"h264")&&d.push(h)}),s.length===0){let h="";c.length!==0?(s=c,h="vp9"):l.length!==0?(s=l,h="vp8"):d.length!==0&&(s=d,h="h264"),S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(h))}s.length!==0&&(r=e.videoCodecs.filter(h=>s.some(p=>p.payloadType===h.payloadType)))}if(r.length===0&&(S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),r=e.videoCodecs),N("USE_PUB_RTX")||N("USE_SUB_RTX")){const s=UI(r,e.videoCodecs);r=[...r,...s]}}else{r=e.audioCodecs.filter(c=>{var l;return rt(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,i)});const s=e.audioCodecs.filter(c=>{var l;return rt(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,"red")});r.length===0&&(S.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=e.audioCodecs.filter(c=>{var l;return rt(l=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(l,"opus")})),N("ENABLE_AUDIO_RED")&&s.length!==0&&(r=[...s,...r])}return r}function UI(t,e){const n=t.map(i=>i.payloadType.toString());return e.filter(i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&rt(n).call(n,i.fmtp&&i.fmtp.parameters.apt))}async function og(t,e,n){const i=e.toString(),r=kM(i,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:i});const s=await t.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let c=s.sdp;c=PM(c,n||{}),r==null||r(c||""),await t.setLocalDescription({type:"answer",sdp:c})}function PM(t,e,n){const i=vr(t),{useXR:r}=e;return i.mediaDescriptions.forEach(s=>{var c;s.attributes.mid&&(Array.isArray(n)&&!rt(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&Wf(s),r&&rt(c=["audio","video"]).call(c,s.media.mediaType)&&s.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(d=>d.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),pd(i)}function kM(t,e,n,i){if(N("SDP_LOGGING"))return S.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(i,`
`),t),e==="offer"?r=>{kM(r,"answer",n==="local"?"remote":"local",i)}:void 0}function MM(t){const e=N("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(n=>rt(t).call(t,n))}function UM(t,e){try{var n;return((n=t.fmtp)===null||n===void 0?void 0:n.parameters.apt)===e.payloadType.toString()}catch{return!1}}function xM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Gr(t,e){return typeof N(t)===e?N(t):void 0}function OG(){try{const t=N("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?xM(Object(i),!0).forEach(function(r){A(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xM(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}({},t)}catch(t){return S.debug("handle gateway attributes failed: ",t),{}}}const VM={};function Sd(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&S.debug("install service ".concat(t.name)),VM[t.name]=t}function Xc(t){const e=VM[t];if(!e)throw new G(O.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function BM(t,e){return Xc("DataStream").create(t,e)}function qR(){return Xc("InterceptFrame").create()}function FM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Ko(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?FM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):FM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const xI=new Map;class wG extends Xe{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(qn.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(qn.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){S.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){var i,r,s;super(),A(this,"store",void 0),A(this,"joinInfo",void 0),A(this,"key",void 0),A(this,"ntpOffset",0),A(this,"signal",void 0),A(this,"role",void 0),A(this,"inChannelInfo",{joinAt:null,duration:0}),A(this,"spec",void 0),A(this,"_state","DISCONNECTED"),A(this,"_statsCollector",void 0),A(this,"_disconnectedReason",void 0),A(this,"isSignalRecover",!1),A(this,"hasChangeBGPAddress",!1),A(this,"trafficStatsInterval",void 0),A(this,"networkQualityInterval",void 0),A(this,"_joinGatewayStartTime",0),A(this,"_signalTimeout",!1),A(this,"_clientRoleOptions",void 0),A(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?(i={spec:Ko(Ko({},n),{},{retryConfig:n.websocketRetryConfig}),store:e},(r=(s=Xc("P2PChannel")).createSubmodule)===null||r===void 0?void 0:r.call(s,i)):new bG(Ko(Ko({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,i){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const r=Date.now();let s=xI.get(e.cname);if(s||(s=new Map,xI.set(e.cname,s)),this._isProactiveJoin=!0,s.has(e.uid)){const h=new B(O.UID_CONFLICT);throw gt.joinGateway(e.sid,{lts:r,succ:!1,ec:h.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),h}s.set(e.uid,!0),this.joinInfo=e,this.key=n;let c=0;this.joinGatewayStartTime=r;const l=e.proxyServer;try{S.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));const h=e.gatewayAddrs.map(p=>{let{address:_}=p;const[m,g]=_.split(":"),C={host:m,port:g};return e.proxyServer&&(C.proxy=e.proxyServer),C});c=(await this.signal.init(h)).uid,S.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){var d;throw S.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),gt.joinGateway(e.sid,{lts:r,succ:!1,ec:((d=h.data)===null||d===void 0?void 0:d.desc)||h.code,errorMsg:h.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!l,signalChannel:"0",preload:e.preload}),s.delete(e.uid),this.signal.close(),h}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),S.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{S.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(qn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(qn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(qn.NETWORK_QUALITY,{uplinkNetworkQuality:TM(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:TM(this._statsCollector.trafficStats.B_dnq)}):this.emit(qn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==_e.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Me.CONNECTED||await function(i,r){return r===1/0?i:st.race([i,$j(r)])}(this.signal.request(bt.LEAVE,void 0,!0),3e3)}catch(i){S.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==_e.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:N("PUB_EXTEND"),twcc:!!N("PUBLISH_TWCC"),rtx:!!N("USE_PUB_RTX")};try{return(await this.signal.request(bt.PUBLISH,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===yt.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw s}}async publishDataChannel(e,n,i){var r;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(r=n.maxRetransmits)!==null&&r!==void 0?r:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(bt.PUBLISH_DATASTREAM,s,!0)}catch(c){if(i&&c.data&&c.data.code===yt.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw c}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(bt.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(i){S.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await st.all(e.map(n=>this.signal.request(bt.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){S.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!N("SUBSCRIBE_TWCC"),rtx:!!N("USE_SUB_RTX")||void 0,extend:N("SUB_EXTEND"),svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return await this.signal.request(bt.PRE_SUBSCRIBE,r,!0)}catch(s){if(i&&s.data&&s.data.code===yt.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(e,n,!1);throw s}}async subscribe(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!N("SUBSCRIBE_TWCC"),rtx:!!N("USE_SUB_RTX"),extend:N("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return(await this.signal.request(bt.SUBSCRIBE,r,!0))._message}catch(s){if(i&&s.data&&s.data.code===yt.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw s}}async subscribeDataChannel(e,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(bt.SUBSCRIBE_DATASTREAM,r,!0)}catch(s){if(i&&s.data&&s.data.code===yt.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw s}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!N("USE_SUB_RTX"),twcc:!!N("SUBSCRIBE_TWCC"),svc:Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0};try{return await this.signal.request(bt.SUBSCRIBE_STREAMS,i,!0)}catch(r){if(n&&r.data&&r.data.code===yt.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),r.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw r}}async setVideoProfile(e){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let r=i.frameRate,s=i.width,c=i.height,l=!0;return typeof r!="number"&&(r=r.exact||r.ideal||r.max||r.min||0,r||(l=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,r||(l=!1)),l?{stream_type:0,width:s,height:c,fps:r,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(e);if(n)return this.signal.request(bt.SET_VIDEO_PROFILE,n);S.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(bt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(i){S.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await st.all(e.map(i=>this.signal.request(bt.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0)))}catch(i){S.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(e){try{await this.signal.request(bt.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){S.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(bt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(bt.GATEWAY_INFO)}async renewToken(e){await this.signal.request(bt.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,n){n&&(this._clientRoleOptions=Object.assign({},n)),N("CLIENT_ROLE_OPTIONS")&&(S.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(N("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},N("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),N("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},N("CLIENT_ROLE_OPTIONS")),S.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(N("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let i,r=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(bt.SET_CLIENT_ROLE,{role:e,level:r,delay:i,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(bt.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(bt.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(bt.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(bt.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(bt.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Ko({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(bt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=xI.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:hi.username,password:hi.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Ko(Ko({},hi),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(bt.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(r=>r.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&_R(()=>{this.emit(qn.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var n;if(!this.joinInfo||!this.key)throw new B(O.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let r=N("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}var s;r&&r.length>128&&(r=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(qn.UPDATE_GATEWAY_CONFIG),s=this.store.clientId,rt(xf).call(xf,s)||xf.push(s);const c=!(en()||iL(87)||zL())&&typeof N("ENABLE_PRE_SUB")=="boolean"&&N("ENABLE_PRE_SUB"),l=!zL()&&Gr("ENABLE_PREALLOC_PC","boolean"),d=OG(),h=jE(87)||function(){const _=ae();if(_.name!==de.SAFARI||!_.browserVersion)return!1;const m=_.browserVersion.split(".");return Number(m[0])>15||Number(m[0])===15&&Number(m[1])>=4}(),p=Ko({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:wa,browser:navigator.userAgent,process_id:N("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:N("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:Ko(Ko({enableEncodedTransform:!!N("ENABLE_AUDIO_METADATA")&&h||!!N("ENABLE_AUDIO_TOPN")&&Ob(de.CHROME,87,116)||void 0,enableAudioMetadata:!!N("ENABLE_AUDIO_METADATA")&&h,enableAudioPts:!!N("ENABLE_AUDIO_PTS_METADATA")&&h,topnSmoothLevel:N("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:N("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:N("TOPN_SWITCH_HOLD_MS"),topnAudioGain:N("TOPN_AUDIO_GAIN"),enablePublishedUserList:N("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:N("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Gr("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Gr("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Gr("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:N("USE_PUB_RTX")===!0||N("USE_SUB_RTX")===!0||void 0,disableFEC:N("DISABLE_FEC"),enableNTPReport:!!N("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!N("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!N("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Gr("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!N("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!N("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Gr("USE_XR","boolean"),enableLossbasedBwe:Gr("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!N("ENABLE_AUT_CC")||void 0,enableCCFallback:Gr("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:l,preSubNum:c?Gr("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Gr("PUBLISH_TWCC","boolean"),enableSubTWCC:Gr("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Gr("USE_PUB_RTX","boolean"),enableSubRTX:Gr("USE_SUB_RTX","boolean"),enableSubSVC:N("ENABLE_SVC")?N("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(N("SVC"))&&N("SVC").length!==0?N("SVC"):void 0,enableSvcExtended:N("ENABLE_SVC")&&Array.isArray(N("SVC_EXTENDED"))&&N("SVC_EXTENDED").length!==0?N("SVC_EXTENDED"):void 0},d),{},{audioDuplicate:Gr("ENABLE_AUDIO_RED","boolean")?(n=Gr("AUDIO_DUPLICATE_NUM","number"))!==null&&n!==void 0?n:2:void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(p.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(p.aes_mode=this.joinInfo.aesmode,N("ENCRYPT_AES")?(p.aes_secret=this.joinInfo.aespassword,p.aes_encrypt=!0):p.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(p.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(p.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(p.default_video_stream=this.joinInfo.defaultVideoStream),p}getRejoinMessage(){if(!this.joinInfo)throw new B(O.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Dt.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Dt.WS_RECONNECTING,e=>{this.joinInfo&&gt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||di.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",gt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Dt.WS_CLOSED,e=>{let n;switch(e){case _e.LEAVE:n=di.LEAVE;break;case _e.UID_BANNED:case _e.IP_BANNED:case _e.CHANNEL_BANNED:case _e.SERVER_ERROR:n=di.SERVER_ERROR;break;case _e.FALLBACK:n=di.FALLBACK;break;case _e.LICENSE_MISSING:case _e.LICENSE_EXPIRED:case _e.LICENSE_MINUTES_EXCEEDED:case _e.LICENSE_PERIOD_INVALID:case _e.LICENSE_MULTIPLE_SDK_SERVICE:case _e.LICENSE_ILLEGAL:case _e.TOKEN_EXPIRE:n=e;break;default:n=di.NETWORK_ERROR}S.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+di.NETWORK_ERROR)),this.joinInfo&&gt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===_e.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==_e.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Dt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const e=N("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(S.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(gt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void S.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Se("EVENT_REPORT_DOMAIN",e[1]),Se("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Se("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(Jt.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(Dt.REQUEST_RECOVER,(e,n,i)=>{if(!this.joinInfo)return i(new B(O.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ui(this,qn.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(Dt.REQUEST_JOIN_INFO,async(e,n,i)=>{var r;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const s=Je((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(N("NEW_TURN_MODE")&&s){let h=s.servers,p=s.serversFromGateway;const _=this.signal.currentURLIndex;h.length>0&&(h=[h[_%h.length]],s.servers=h),Array.isArray(p)&&p.length>0&&(p=[p[0]],s.serversFromGateway=p),S.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(_))}const{iceParameters:c,dtlsParameters:l,rtpCapabilities:d}=await ui(this,qn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:s});try{e(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:l,rtpCapabilities:d,version:"2"}}))}catch(h){n(h)}}),this.signal.on(Dt.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(Dt.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let i,r="";var s;e instanceof B?(i=((s=e.data)===null||s===void 0?void 0:s.desc)||e.code,r=e.message):i=e,gt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:r,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Dt.IS_P2P_DISCONNECTED,e=>{e(zE(this,qn.IS_P2P_DISCONNECTED))}),this.signal.on(Dt.DISCONNECT_P2P,()=>{this.emit(qn.DISCONNECT_P2P)}),this.signal.on(Dt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Dt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Dt.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(qn.JOIN_RESPONSE,e,n)}),this.signal.on(Dt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=N("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const i=OM(e);this.emit(qn.PRE_CONNECT_PC,{candidates:i,fingerprint:n})}}}),this.signal.on(Dt.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof N("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(N("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(bt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(bt.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw S.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(bt.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(bt.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw S.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(e){const n={users:e.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(bt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(e,n){const i={action:e.find(r=>r.stream_type===Ee.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(bt.CONTROL,i,!0,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),r),r}}async unmuteLocal(e,n){const i={action:e.find(r=>r.stream_type===Ee.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(bt.CONTROL,i,!0,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),r),r}}async muteRemote(e,n){const i={action:e===ut.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(bt.CONTROL,i,!0,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),r),r}}async unmuteRemote(e,n){const i={action:e===ut.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(bt.CONTROL,i,!0,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),r),r}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(bt.RESTART_ICE,n,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(e,n){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,n||di.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!N("GATEWAY_WSS_ADDRESS"))return N("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(S.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(bt.SET_PARAMETER,{enablePublishAudioFilter:e})}}let XR=0,VI=0;function Js(t,e,n,i){return new st((r,s)=>{e.timeout=e.timeout||N("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),XR+=Bo(e.data)):n&&(e.data.size?XR+=e.data.size:e.data instanceof FormData?XR+=vL(e.data):XR+=Bo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,sr.request(e).then(c=>{typeof c.data=="string"?VI+=Bo(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?VI+=c.data.byteLength:VI+=Bo(JSON.stringify(c.data)),i&&r({data:c.data,headers:c.headers}),r(c.data)}).catch(c=>{sr.isCancel(c)?s(new B(O.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?s(new B(O.NETWORK_TIMEOUT,c.message)):c.response?s(new B(O.NETWORK_RESPONSE_ERROR,c.response.status)):s(new B(O.NETWORK_ERROR,c.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(z){var $=0;return function(){return $<z.length?{done:!1,value:z[$++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(z,$,ft){return z==Array.prototype||z==Object.prototype||(z[$]=ft.value),z},i,r=function(z){z=[typeof globalThis=="object"&&globalThis,z,typeof window=="object"&&window,typeof self=="object"&&self,typeof nt=="object"&&nt];for(var $=0;$<z.length;++$){var ft=z[$];if(ft&&ft.Math==Math)return ft}throw Error("Cannot find global object")}(this);function s(z,$){if($)t:{var ft=r;z=z.split(".");for(var Y=0;Y<z.length-1;Y++){var v=z[Y];if(!(v in ft))break t;ft=ft[v]}($=$(Y=ft[z=z[z.length-1]]))!=Y&&$!=null&&n(ft,z,{configurable:!0,writable:!0,value:$})}}function c(z){return(z={next:z})[Symbol.iterator]=function(){return this},z}function l(z){var $=typeof Symbol<"u"&&Symbol.iterator&&z[Symbol.iterator];return $?$.call(z):{next:e(z)}}if(s("Symbol",function(z){function $(v,D){this.A=v,n(this,"description",{configurable:!0,writable:!0,value:D})}if(z)return z;$.prototype.toString=function(){return this.A};var ft="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Y=0;return function v(D){if(this instanceof v)throw new TypeError("Symbol is not a constructor");return new $(ft+(D||"")+"_"+Y++,D)}}),s("Symbol.iterator",function(z){if(z)return z;z=Symbol("Symbol.iterator");for(var $="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ft=0;ft<$.length;ft++){var Y=r[$[ft]];typeof Y=="function"&&typeof Y.prototype[z]!="function"&&n(Y.prototype,z,{configurable:!0,writable:!0,value:function(){return c(e(this))}})}return z}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var d;t:{var h={};try{h.__proto__={a:!0},d=h.a;break t}catch{}d=!1}i=d?function(z,$){if(z.__proto__=$,z.__proto__!==$)throw new TypeError(z+" is not extensible");return z}:null}var p=i;function _(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function m(z){if(z.m)throw new TypeError("Generator is already running");z.m=!0}function g(z,$){return z.h=3,{value:$}}function C(z){this.g=new _,this.G=z}function R(z,$,ft,Y){try{var v=$.call(z.g.j,ft);if(!(v instanceof Object))throw new TypeError("Iterator result "+v+" is not an object");if(!v.done)return z.g.m=!1,v;var D=v.value}catch(k){return z.g.j=null,z.g.s(k),y(z)}return z.g.j=null,Y.call(z.g,D),y(z)}function y(z){for(;z.g.h;)try{var $=z.G(z.g);if($)return z.g.m=!1,{value:$.value,done:!1}}catch(ft){z.g.v=void 0,z.g.s(ft)}if(z.g.m=!1,z.g.l){if($=z.g.l,z.g.l=null,$.F)throw $.D;return{value:$.return,done:!0}}return{value:void 0,done:!0}}function b(z){this.next=function($){return z.o($)},this.throw=function($){return z.s($)},this.return=function($){return function(ft,Y){m(ft.g);var v=ft.g.j;return v?R(ft,"return"in v?v.return:function(D){return{value:D,done:!0}},Y,ft.g.return):(ft.g.return(Y),y(ft))}(z,$)},this[Symbol.iterator]=function(){return this}}function I(z,$){return $=new b(new C($)),p&&z.prototype&&p($,z.prototype),$}if(_.prototype.o=function(z){this.v=z},_.prototype.s=function(z){this.l={D:z,F:!0},this.h=this.C||this.u},_.prototype.return=function(z){this.l={return:z},this.h=this.u},C.prototype.o=function(z){return m(this.g),this.g.j?R(this,this.g.j.next,z,this.g.o):(this.g.o(z),y(this))},C.prototype.s=function(z){return m(this.g),this.g.j?R(this,this.g.j.throw,z,this.g.o):(this.g.s(z),y(this))},s("Array.prototype.entries",function(z){return z||function(){return function($,ft){$ instanceof String&&($+="");var Y=0,v=!1,D={next:function(){if(!v&&Y<$.length){var k=Y++;return{value:ft(k,$[k]),done:!1}}return v=!0,{done:!0,value:void 0}}};return D[Symbol.iterator]=function(){return D},D}(this,function($,ft){return[$,ft]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var L=function(z,$){for(var ft=0;ft<z.length;ft++)$(z[ft])},U=function(z){return z.replace(/\r?\n|\r/g,`\r
`)},x=function(z,$,ft){return $ instanceof Blob?(ft=ft!==void 0?ft+"":typeof $.name=="string"?$.name:"blob",$.name===ft&&Object.prototype.toString.call($)!=="[object Blob]"||($=new File([$],ft)),[String(z),$]):[String(z),String($)]},M=function(z,$){if(z.length<$)throw new TypeError($+" argument required, but only "+z.length+" present.")},j=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,K=j.FormData,it=j.XMLHttpRequest&&j.XMLHttpRequest.prototype.send,dt=j.Request&&j.fetch,Ft=j.navigator&&j.navigator.sendBeacon,Vt=j.Element&&j.Element.prototype,It=j.Symbol&&Symbol.toStringTag;It&&(Blob.prototype[It]||(Blob.prototype[It]="Blob"),"File"in j&&!File.prototype[It]&&(File.prototype[It]="File"));try{new File([],"")}catch{j.File=function($,ft,Y){return $=new Blob($,Y||{}),Object.defineProperties($,{name:{value:ft},lastModified:{value:+(Y&&Y.lastModified!==void 0?new Date(Y.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),It&&Object.defineProperty($,It,{value:"File"}),$}}var Ue=function(z){return z.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ae=function(z){this.i=[];var $=this;z&&L(z.elements,function(ft){if(ft.name&&!ft.disabled&&ft.type!=="submit"&&ft.type!=="button"&&!ft.matches("form fieldset[disabled] *"))if(ft.type==="file"){var Y=ft.files&&ft.files.length?ft.files:[new File([],"",{type:"application/octet-stream"})];L(Y,function(v){$.append(ft.name,v)})}else ft.type==="select-multiple"||ft.type==="select-one"?L(ft.options,function(v){!v.disabled&&v.selected&&$.append(ft.name,v.value)}):ft.type==="checkbox"||ft.type==="radio"?ft.checked&&$.append(ft.name,ft.value):(Y=ft.type==="textarea"?U(ft.value):ft.value,$.append(ft.name,Y))})};if((t=Ae.prototype).append=function(z,$,ft){M(arguments,2),this.i.push(x(z,$,ft))},t.delete=function(z){M(arguments,1);var $=[];z=String(z),L(this.i,function(ft){ft[0]!==z&&$.push(ft)}),this.i=$},t.entries=function z(){var $,ft=this;return I(z,function(Y){if(Y.h==1&&($=0),Y.h!=3)return $<ft.i.length?Y=g(Y,ft.i[$]):(Y.h=0,Y=void 0),Y;$++,Y.h=2})},t.forEach=function(z,$){M(arguments,1);for(var ft=l(this),Y=ft.next();!Y.done;Y=ft.next()){var v=l(Y.value);Y=v.next().value,v=v.next().value,z.call($,v,Y,this)}},t.get=function(z){M(arguments,1);var $=this.i;z=String(z);for(var ft=0;ft<$.length;ft++)if($[ft][0]===z)return $[ft][1];return null},t.getAll=function(z){M(arguments,1);var $=[];return z=String(z),L(this.i,function(ft){ft[0]===z&&$.push(ft[1])}),$},t.has=function(z){M(arguments,1),z=String(z);for(var $=0;$<this.i.length;$++)if(this.i[$][0]===z)return!0;return!1},t.keys=function z(){var $,ft,Y,v,D=this;return I(z,function(k){if(k.h==1&&($=l(D),ft=$.next()),k.h!=3)return ft.done?void(k.h=0):(Y=ft.value,v=l(Y),g(k,v.next().value));ft=$.next(),k.h=2})},t.set=function(z,$,ft){M(arguments,2),z=String(z);var Y=[],v=x(z,$,ft),D=!0;L(this.i,function(k){k[0]===z?D&&(D=!Y.push(v)):Y.push(k)}),D&&Y.push(v),this.i=Y},t.values=function z(){var $,ft,Y,v,D=this;return I(z,function(k){if(k.h==1&&($=l(D),ft=$.next()),k.h!=3)return ft.done?void(k.h=0):(Y=ft.value,(v=l(Y)).next(),g(k,v.next().value));ft=$.next(),k.h=2})},Ae.prototype._asNative=function(){for(var z=new K,$=l(this),ft=$.next();!ft.done;ft=$.next()){var Y=l(ft.value);ft=Y.next().value,Y=Y.next().value,z.append(ft,Y)}return z},Ae.prototype._blob=function(){var z="----formdata-polyfill-"+Math.random(),$=[],ft="--"+z+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Y,v){return typeof Y=="string"?$.push(ft+Ue(U(v))+`"\r
\r
`+U(Y)+`\r
`):$.push(ft+Ue(U(v))+'"; filename="'+Ue(Y.name)+`"\r
Content-Type: `+(Y.type||"application/octet-stream")+`\r
\r
`,Y,`\r
`)}),$.push("--"+z+"--"),new Blob($,{type:"multipart/form-data; boundary="+z})},Ae.prototype[Symbol.iterator]=function(){return this.entries()},Ae.prototype.toString=function(){return"[object FormData]"},Vt&&!Vt.matches&&(Vt.matches=Vt.matchesSelector||Vt.mozMatchesSelector||Vt.msMatchesSelector||Vt.oMatchesSelector||Vt.webkitMatchesSelector||function(z){for(var $=(z=(this.document||this.ownerDocument).querySelectorAll(z)).length;0<=--$&&z.item($)!==this;);return-1<$}),It&&(Ae.prototype[It]="FormData"),it){var ur=j.XMLHttpRequest.prototype.setRequestHeader;j.XMLHttpRequest.prototype.setRequestHeader=function(z,$){ur.call(this,z,$),z.toLowerCase()==="content-type"&&(this.B=!0)},j.XMLHttpRequest.prototype.send=function(z){z instanceof Ae?(z=z._blob(),this.B||this.setRequestHeader("Content-Type",z.type),it.call(this,z)):it.call(this,z)}}dt&&(j.fetch=function(z,$){return $&&$.body&&$.body instanceof Ae&&($.body=$.body._blob()),dt.call(this,z,$)}),Ft&&(j.navigator.sendBeacon=function(z,$){return $ instanceof Ae&&($=$._asNative()),Ft.call(this,z,$)}),j.FormData=Ae}})();const cg=()=>{const t=N("AREAS");return t.length===0&&t.push(ue.GLOBAL),_r(t).call(t,(e,n,i)=>{const r=jM(n);return r?i===0?r:"".concat(e,",").concat(r):e},"")},jM=t=>t===ue.OVERSEA?"".concat(vi.ASIA,",").concat(vi.EUROPE,",").concat(vi.AFRICA,",").concat(vi.NORTH_AMERICA,",").concat(vi.SOUTH_AMERICA,",").concat(vi.OCEANIA):vi[t],NG=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const i=jR[n],r=Object.keys(i);r&&r.map(s=>{s!=="CODE"&&(e[s]=e[s].concat(i[s]))})}),e},JR={GLOBAL:{ASIA:[ue.CHINA,ue.JAPAN,ue.INDIA,ue.KOREA,ue.HKMC],EUROPE:[],NORTH_AMERICA:[ue.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},QR=Object.keys(JR[ue.GLOBAL]),BI=[ue.CHINA,ue.NORTH_AMERICA,ue.EUROPE,ue.ASIA,ue.JAPAN,ue.INDIA,ue.OCEANIA,ue.SOUTH_AMERICA,ue.AFRICA,ue.KOREA,ue.HKMC,ue.US],DG=function(t,e){let n=[];if(rt(t).call(t,ue.GLOBAL)){const s=[ue.GLOBAL,ue.OVERSEA],c=Object.keys(jR);if(e===ue.GLOBAL)throw new B(O.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===ue.CHINA)n=[ue.OVERSEA];else if(r=e,rt(QR).call(QR,r)){const l=(i=e,JR[ue.GLOBAL][i]||[]),d=[...s,e,...l];n=c.filter(h=>!rt(d).call(d,h))}else if(function(l){let d=!1;return QR.forEach(h=>{var p;rt(p=JR[ue.GLOBAL][h]).call(p,l)&&(d=!0)}),d}(e)){const l=function(h){let p;return QR.forEach(_=>{var m;rt(m=JR[ue.GLOBAL][_]).call(m,h)&&(p=_)}),p}(e),d=[...s,l,e];n=c.filter(h=>!rt(d).call(d,h))}else n=t;n=function(l){const d=[];return BI.forEach(h=>{rt(l).call(l,h)&&d.push(h)}),d.concat(l.filter(h=>!rt(BI).call(BI,h)))}(n)}else n=t;var i,r;return n};function GM(t){var e,n;if(!t&&rt(e=N("AREAS")).call(e,ue.EXTENSIONS))return S.debug("update area from ap : reset"),void FI(B4,!0);if(!rt(n=N("AREAS")).call(n,ue.GLOBAL)||!t)return;let i=jR.EXTENSIONS;i&&(i={CODE:jM(ue.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},S.debug("update area from ap success: ".concat(t,",config is "),i),Se("AREAS",[ue.EXTENSIONS],!0),Object.keys(i).map(r=>{r==="LOG_UPLOAD_SERVER"||r==="EVENT_REPORT_DOMAIN"||r==="EVENT_REPORT_BACKUP_DOMAIN"||r==="PROXY_SERVER_TYPE3"?Se(r,i[r][0]):Se(r,i[r])}))}function FI(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=gt.reportApiInvoke(null,{name:vn.SET_AREA,options:t,tag:rn.TRACER});try{let i=[];if(typeof t=="string"&&(i=[t]),Array.isArray(t)&&(t.forEach(s=>{if(!rt(lM).call(lM,s))throw new B(O.INVALID_PARAMS,"invalid area code")}),i=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:s,excludedArea:c}=t;if(!s)throw new B(O.INVALID_PARAMS,"area code is needed");let l=s;typeof s=="string"&&(l=[s]),i=c?DG(l,c):l}if(!e){if(zs.AREAS){const s=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void S.warning("setArea is prohibited because of config-distribute")}if(rt(i).call(i,ue.GLOBAL)&&N("AREAS")===ue.EXTENSIONS){const s=new B(O.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void S.warning("setArea is prohibited because of ap extensions")}}Se("AREAS",i,e);const r=NG(i);Object.keys(r).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Se(s,r[s][0]):Se(s,r[s])}),S.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function HM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function zo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?HM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):HM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let jI=1;function LG(t,e,n,i,r){jI+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:jI,requestId:jI,version:wa,cname:n.cname},c={service_name:e,json_body:JSON.stringify(s)};let l,d,h=t[0];return Ks(async()=>{l=Date.now();const p=await Js(h,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-l,p.code!==0){const g=new B(O.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:d});throw S.error(g.toString()),g}const _=JSON.parse(p.json_body);if(_.code!==200){const g=new B(O.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(_.code,", reason: ").concat(_.reason),{code:_.code,responseTime:d});throw S.error(g.toString()),g}if(!_.servers||_.servers.length===0){const g=new B(O.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:_.code,responseTime:d});throw S.error(g.toString()),g}const m=function(g,C){return{addressList:g.servers.map(R=>"wss://".concat(R.address.replace(/\./g,"-"),".").concat(N("WORKER_DOMAIN"),":").concat(R.wss,"?serviceName=").concat(encodeURIComponent(C))),workerToken:g.workerToken,vid:g.vid}}(_,e);return N("LIVE_STREAMING_ADDRESS")&&(m.addressList=N("LIVE_STREAMING_ADDRESS")instanceof Array?N("LIVE_STREAMING_ADDRESS"):[N("LIVE_STREAMING_ADDRESS")]),zo(zo({},m),{},{responseTime:d})},(p,_)=>(gt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(p.addressList),firstSuccess:_===0,responseTime:d,serverIp:t[_%t.length]}),!1),(p,_)=>(gt.apworkerEvent(n.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:e,responseTime:d,serverIp:t[_%t.length]}),!!(p.code!==O.OPERATION_ABORTED&&p.code!==O.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(h=t[(_+1)%t.length],!0)),r)}let GI=1;function WM(t,e,n,i){let{url:r,areaCode:s}=t;const{clientId:c,sid:l}=e,d=Date.now();let h;const p=e.role,[_,m]=WI(e,s,[yn.CHOOSE_SERVER]);let g=Rn.networkState;return Ks(async()=>{g&&Rn.networkState===Fr.OFFLINE&&Rn.onlineWaiter&&await st.race([Rn.onlineWaiter,ni(i&&i.maxRetryTimeout||In.maxRetryTimeout)]),g=Rn.networkState;const{data:C,headers:R}=await Js(r,{data:_,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=R.http3==="1"?1:-1,gt.reportResourceTiming(r,l),zM(C,r,e,d,[yn.CHOOSE_SERVER],h);const y=rg(C,yn.CHOOSE_SERVER);return HI(y),LI(y,r)},C=>(C&&gt.joinChooseServer(l,{role:p,lts:d,succ:!0,csAddr:r,opid:m,serverList:C.gatewayAddrs.map(R=>R.address),ec:null,cid:C.cid.toString(),uid:C.uid.toString(),csIp:C.csIp,unilbsServerIds:[yn.CHOOSE_SERVER].toString(),isHttp3:h,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:C.res.detail&&C.res.detail[38]}),!1),C=>C.code!==O.OPERATION_ABORTED&&(C.code===O.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(gt.joinChooseServer(l,{role:p,lts:d,succ:!1,csAddr:r,serverList:null,opid:m,ec:C.code,csIp:C.data&&C.data.csIp,unilbsServerIds:[yn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:g}),isHttp3:h,corssRegionTagReq:e.apRequestDetail}),S.warning("[".concat(c||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),C),!0)),i)}function KM(t,e,n,i){let r,{url:s,areaCode:c,serviceIds:l}=t;const d=Date.now(),h=e.role,[p,_]=WI(e,c,l);let m;return Ks(async()=>{m&&Rn.networkState===Fr.OFFLINE&&Rn.onlineWaiter&&await st.race([Rn.onlineWaiter,ni(i&&i.maxRetryTimeout||In.maxRetryTimeout)]),m=Rn.networkState;const{data:g,headers:C}=await Js(s,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r=C.http3==="1"?1:-1,gt.reportResourceTiming(s,e.sid),zM(g,s,e,d,l,r);const R=rg(g,yn.CHOOSE_SERVER),y=rg(g,e.cloudProxyServer==="proxy5"?yn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?yn.CLOUD_PROXY:yn.CLOUD_PROXY_FALLBACK);return HI(R),{gatewayInfo:LI(R,s),proxyInfo:y,url:s}},g=>(g.gatewayInfo&&gt.joinChooseServer(e.sid,{role:h,lts:d,succ:!0,csAddr:s,serverList:g.gatewayInfo.gatewayAddrs.map(C=>C.address),ec:null,opid:_,cid:g.gatewayInfo.cid.toString(),uid:g.gatewayInfo.uid.toString(),csIp:g.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:r,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:g.gatewayInfo.res.detail&&g.gatewayInfo.res.detail[38]}),g.proxyInfo&&gt.joinWebProxyAP(e.sid,{lts:d,sucess:1,apServerAddr:s,turnServerAddrList:g.proxyInfo.addresses.map(C=>C.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:l.toString()}),!1),g=>g.code!==O.OPERATION_ABORTED&&(g.code===O.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(gt.joinWebProxyAP(e.sid,{lts:d,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:g.code,eventType:e.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:m})}),S.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),g),!0)),i)}const zM=(t,e,n,i,r,s)=>{const{sid:c,clientId:l,cloudProxyServer:d}=n,h=[],p=_=>{_.flag===4096?gt.joinChooseServer(c,{role:n.role,lts:i,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:_.error.message,csIp:_.error.data&&_.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:s,corssRegionTagReq:n.apRequestDetail}):_.flag!==1048576&&_.flag!==4194304&&_.flag!==4194310||gt.joinWebProxyAP(c,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:_.error.code,eventType:d,unilbsServerIds:r.toString()})};if(t.response_body.forEach(_=>{const m=_.buffer.code;if(_.uri===23&&m===0&&!_.buffer.edges_services)if(_.buffer.flag===4194310)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),_.buffer.edges_services=[];else{const g={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:_.buffer.flag};h.push(g),p(g)}if(m!==0){const g=jf(m),C={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,g.desc,{desc:g.desc,retry:g.retry,csIp:t.detail[502]}),flag:_.buffer.flag};_.buffer.flag===4194310?S.warning(C.error.toString()):h.push(C),p(C)}}),h.length)throw S.warning("[".concat(l||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message,", retry: ").concat(_.error.data.retry)).join(" | "))),new B(O.CAN_NOT_GET_GATEWAY_SERVER,h.map(_=>"flag: ".concat(_.flag,", message: ").concat(_.error.message)).join(" | "),{retry:!!h.find(_=>_.error.data.retry),csIp:t.detail[502],desc:[...new Set(h.map(_=>{var m;return _==null||(m=_.error)===null||m===void 0||(m=m.data)===null||m===void 0?void 0:m.desc}).filter(_=>!!_))]})},HI=t=>{var e,n,i,r;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new B(O.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(N("AP_AREA")&&((i=t.detail)!==null&&i!==void 0&&i[23]&&typeof((r=t.detail)===null||r===void 0?void 0:r[23])=="string"?GM(t.detail[23].toLowerCase()):GM()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const c=t.detail[19],l=c==null?void 0:c.split(";");for(let d=0;d<l.length;d++){var s;const h=Bi(s=l[d]).call(s);t.addresses[d]&&l&&(t.addresses[d].fingerprint=h)}}if(N("GATEWAY_ADDRESS")&&N("GATEWAY_ADDRESS").length>0){S.debug("assign gateway address to",N("GATEWAY_ADDRESS"));const c=N("GATEWAY_ADDRESS").map(l=>{var d,h;const p=(d=(h=t.addresses.find(_=>_.ip===l.ip&&_.port===l.port))===null||h===void 0?void 0:h.fingerprint)!==null&&d!==void 0?d:"";return{ip:l.ip,port:l.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:p}});t.addresses=c}},PG=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const i=jf(n.buffer.code);throw new B(O.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw S.debug("update ticket request received ap response without response body:",e),new B(O.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},WI=(t,e,n)=>{const i=Math.floor(Math.random()*1e12),r=t.role==="host"?"1":t.role==="audience"?"2":void 0,s={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:zo(zo(zo({6:t.stringUid,11:e,12:N("USE_NEW_TOKEN")?"1":void 0},r?{17:r}:{}),{},{22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};s.request_bodies.forEach(l=>{t.multiIP&&t.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]},kG=(t,e)=>{const n=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let Kf=0;function zf(t){return st.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const lg=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:s}=t,c=0;const l=e;let d,h=0;const p=async()=>{const _=(()=>{const m=c*l,g=m+l;return n.slice(m,g).map(i)})();s&&s.push(..._);try{d=await zf(_)}catch(m){if(h+=l,c++,!(h>=n.length))return void await p();r(m)}_.forEach(m=>m.cancel())};return await p(),d},YM=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:i}=t;const r=e.length;let s=0;const c=async()=>{const l=n(e.shift());try{return await l}catch(d){if(s++,s>=r||i!=null&&i(d))throw d;return c()}};return c()};async function KI(t,e,n,i){return{gatewayInfo:await async function(s,c,l,d){let h=null;const p=[],_=async()=>{const g=N("WEBCS_DOMAIN").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(y=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:cg()})),C=d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),R=await lg({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(S.debug("[".concat(s.clientId,"] Connect to choose_server:"),y.url),WM(y,s,c,l)),allFailedhandler:y=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:p});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},C),R},m=async()=>{if(await ni(1e3),h!==null)return h;const g=N("WEBCS_DOMAIN_BACKUP_LIST").map(y=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"),areaCode:cg()})),C=d.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),R=await lg({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(S.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),y.url),WM(y,s,c,l)),allFailedhandler:y=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:p});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},C),R};try{return h=await zf([_(),m()]),p.length&&p.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),h}catch(g){throw g[0]}}(t,e,n,i)}}async function qM(t,e,n,i,r){const s=t.cloudProxyServer;if(s==="disabled"){if(t.useLocalAccessPoint)return await KI(t,e,n,r);if(N("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:m,proxyInfo:g}=await QM(t,e,n,r);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:m};const C=g.map(R=>({turnServerURL:R.address,tcpport:R.tcpport||hi.tcpport,udpport:R.udpport||hi.udpport,username:R.username||hi.username,password:R.password||hi.password,forceturn:!1,security:!0}));if(r.useP2P){var c;const R=(c=t.uid)!==null&&c!==void 0?c:m.uid,y="glb:".concat(R.toString()),b=await Ub(y),I=g.map(L=>({turnServerURL:L.address,tcpport:L.tcpport||hi.tcpport,udpport:L.udpport||hi.udpport,username:y,password:b,forceturn:!1,security:!0}));C.push(...I)}return t.turnServer={mode:"manual",servers:C},{gatewayInfo:m}}return await KI(t,e,n,r)}const{proxyInfo:l,gatewayInfo:d}=await QM(t,e,n,r),h={gatewayInfo:d},p=l.map(m=>({turnServerURL:m.address,tcpport:s==="proxy3"?void 0:m.tcpport?m.tcpport:hi.tcpport,udpport:s==="proxy4"?void 0:m.udpport?m.udpport:hi.udpport,username:m.username||hi.username,password:m.password||hi.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(r.useP2P){var _;const m=(_=t.uid)!==null&&_!==void 0?_:d.uid,g="glb:".concat(m.toString()),C=await Ub(g),R=l.map(y=>({turnServerURL:y.address,tcpport:s==="proxy3"?void 0:y.tcpport||hi.tcpport,udpport:s==="proxy4"?void 0:y.udpport||hi.udpport,username:g,password:C,forceturn:s!=="proxy4",security:s==="proxy5"}));p.push(...R)}return t.turnServer={mode:"manual",servers:p},S.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(s)),h}async function XM(t,e,n,i,r){const s=N("ACCOUNT_REGISTER").slice(0,N("AJAX_REQUEST_CONCURRENT"));let c=[];c=e.proxyServer?s.map(d=>"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1")):s.map(d=>"https://".concat(d,"/api/v1"));const l=r==null?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const d=await async function(h,p,_,m,g){const C=Date.now(),R={sid:_.sid,opid:10,appid:_.appId,string_uid:p};let y=h[0];const b=await Ks(()=>Js(y+"".concat(y.indexOf("?")===-1?"?":"&","action=stringuid"),{data:R,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(I,L)=>{if(I.code===0){if(I.uid<=0||I.uid>=Math.pow(2,32))throw S.error("Invalid Uint Uid ".concat(p," => ").concat(I.uid),I),gt.reqUserAccount(R.sid,{lts:C,success:!1,serverAddr:y,stringUid:R.string_uid,uid:I.uid,errorCode:O.INVALID_UINT_UID_FROM_STRING_UID,extend:R}),new B(O.INVALID_UINT_UID_FROM_STRING_UID);return gt.reqUserAccount(R.sid,{lts:C,success:!0,serverAddr:y,stringUid:R.string_uid,uid:I.uid,errorCode:null,extend:R}),!1}const U=jf(I.code);return U.retry&&(y=h[(L+1)%h.length]),gt.reqUserAccount(R.sid,{lts:C,success:!1,serverAddr:y,stringUid:R.string_uid,uid:I.uid,errorCode:U.desc,extend:R}),U.retry},(I,L)=>I.code!==O.OPERATION_ABORTED&&(gt.reqUserAccount(R.sid,{lts:C,success:!1,serverAddr:y,stringUid:R.string_uid,uid:null,errorCode:I.code,extend:R}),y=h[(L+1)%h.length],!0),g);if(b.code!==0){const I=jf(b.code);throw new B(O.UNEXPECTED_RESPONSE,I.desc)}return b}(c,t,e,n,i);return r==null||r.recordJoinChannelService({status:"success",endTs:Date.now()},l),d.uid}catch(d){throw r==null||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},l),d}}async function MG(t,e,n){const i=N("ACCOUNT_REGISTER");let r=[];r=e.proxyServer?i.map(s=>"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1")):i.map(s=>"https://".concat(s,"/api/v1"));try{return await YM({referenceList:r,asyncMapHandler:c=>async function(l,d,h,p){const _=Date.now(),m={sid:h.sid,opid:10,appid:h.appId,string_uid:d};try{const g=await Js(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:m,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(g.code!==0){const C=jf(g.code);throw new B(O.UNEXPECTED_RESPONSE,"preload sua error:".concat(C.desc),C)}if(g.uid<=0||g.uid>=Math.pow(2,32))throw new B(O.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:_,url:l,req:m,uid:g.uid,elapse:Date.now()-_}}catch(g){throw g}}(c,t,e,n),closeFn:c=>c.code===O.OPERATION_ABORTED||c.code===O.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(s){throw s}}async function UG(t,e,n){const i=N("CDS_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config")),r=i.map(d=>function(h,p,_,m){const g=ae(),C={flag:64,cipher_method:0,features:zo(zo(zo(zo(zo({install_id:qb(),device:g.name,system:g.os,system_general:navigator.userAgent,vendor:p.appId,version:wa,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:IG.WEB_RTC,browser_name:g.name,browser_version:g.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),g.os&&{os_name:g.os}),g.osVersion&&{os_version:g.osVersion}),{},{detail:""})};return Ks(()=>Js(h,{data:C,timeout:1e3,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,R=>R.code!==O.OPERATION_ABORTED,m)}(d,t,e,n));let s=null,c=null,l={};try{s=await zf(r)}catch(d){if(d.code===O.OPERATION_ABORTED)throw d;c=d}if(r.forEach(d=>d.cancel()),gt.reportApiInvoke(t.sid,{name:vn.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:s}}).onSuccess(),s&&s.test_tags)try{l=function(d){if(!d.test_tags)return{};const h=d.test_tags,p=Object.keys(h),_={};return p.forEach(m=>{var g;const C=Bi(g=m.slice(4)).call(g),R=JSON.parse(h[m]),y=R[1];_[C]={tag:R[0]||"",value:y}}),_}(s)}catch{}return l}async function JM(t,e){const n=N("WEBCS_DOMAIN").concat(N("WEBCS_DOMAIN_BACKUP_LIST")).map(i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:cg(),serviceIds:[yn.CHOOSE_SERVER,yn.CLOUD_PROXY_FALLBACK]}));try{return await YM({referenceList:n,asyncMapHandler:r=>async function(s,c,l){let d,{url:h,areaCode:p,serviceIds:_}=s;const m=Date.now(),[g,C]=WI(c,p,_);let R=Rn.networkState;try{R&&Rn.networkState===Fr.OFFLINE&&Rn.onlineWaiter&&await st.race([Rn.onlineWaiter,ni(In.maxRetryTimeout)]),R=Rn.networkState;const{data:y,headers:b}=await Js(h,{data:g,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=b.http3==="1"?1:-1,(x=>{const M=[];if(x.response_body.forEach(j=>{const K=j.buffer.code;if(j.uri===23&&K===0&&!j.buffer.edges_services)if(j.buffer.flag===4194310)j.buffer.edges_services=[];else{const it={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:x.detail[502]}),flag:j.buffer.flag};M.push(it)}if(K!==0){const it=jf(K),dt={error:new B(O.CAN_NOT_GET_GATEWAY_SERVER,it.desc,{desc:it.desc,retry:it.retry,csIp:x.detail[502]}),flag:j.buffer.flag};j.buffer.flag===4194310?S.warning(dt.error.toString()):M.push(dt)}}),M.length)throw new B(O.CAN_NOT_GET_GATEWAY_SERVER,M.map(j=>"flag: ".concat(j.flag,", message: ").concat(j.error.message)).join(" | "),{retry:!!M.find(j=>j.error.data.retry),csIp:x.detail[502],desc:[...new Set(M.map(j=>{var K;return j==null||(K=j.error)===null||K===void 0||(K=K.data)===null||K===void 0?void 0:K.desc}).filter(j=>!!j))]})})(y);const L=rg(y,yn.CHOOSE_SERVER),U=rg(y,yn.CLOUD_PROXY_FALLBACK);return HI(L),{gatewayInfo:LI(L,h),proxyInfo:U,opid:C,requestTime:m,url:h,isHttp3:d,elapse:Date.now()-m}}catch(y){throw y}}(r,t,e),closeFn:r=>r.code===O.OPERATION_ABORTED||r.code===O.CAN_NOT_GET_GATEWAY_SERVER&&!r.data.retry})}catch(i){throw i}}async function QM(t,e,n,i){const r=N("PROXY_SERVER_TYPE3"),s=(g,C,R)=>{let y=R||r;return Array.isArray(y)&&(y=C%2==0?r[1]:r[0]),"https://".concat(y,"/ap/?url=").concat(g)};let c=null;const l=[],d=async()=>{const g=N("WEBCS_DOMAIN").slice(0,N("AJAX_REQUEST_CONCURRENT")).map((y,b)=>{let I;return I=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b),{url:I,areaCode:cg(),serviceIds:[yn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?yn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?yn.CLOUD_PROXY:yn.CLOUD_PROXY_FALLBACK]}}),C=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),R=await lg({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(S.debug("[".concat(t.clientId,"] Connect to choose_server:"),y.url),KM(y,t,e,n)),allFailedhandler:y=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},C),R},h=async()=>{if(await ni(1e3),c!==null)return c;const g=N("WEBCS_DOMAIN_BACKUP_LIST").map((y,b)=>{let I;return I=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(y,"/api/v2/transpond/webrtc?v=2"):s("".concat(y,"/api/v2/transpond/webrtc?v=2"),b),{url:I,areaCode:cg(),serviceIds:[yn.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?yn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?yn.CLOUD_PROXY:yn.CLOUD_PROXY_FALLBACK]}}),C=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(y=>y.url)}),R=await lg({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:y=>(S.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),y.url),KM(y,t,e,n)),allFailedhandler:y=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:y},C),y[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},C),R};let p,_,m;try{({gatewayInfo:p,proxyInfo:_,url:m}=await zf([d(),h()]))}catch(g){throw g[0]}if(l.length&&l.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),!p||!_)throw new B(O.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=m,t.cloudProxyServer!=="disabled"&&Array.isArray(r)&&m){const g=/^https?:\/\/(.+?)(\/.*)?$/.exec(m)[1];rt(r).call(r,g)&&(t.proxyServer=g,S.setProxyServer(g),gt.setProxyServer(g))}return c={gatewayInfo:p,proxyInfo:await vM(_,p.uid)},c}async function xG(t,e,n){const i=N("UAP_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(s=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),r=i.map(s=>function(c,l,d,h){const p={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:wa,cname:l.cname,uid:l.uid.toString(),requestId:GI,seq:GI};GI+=1;const _={service_name:"tele_channel",json_body:JSON.stringify(p)};return Ks(async()=>{const m=await Js(c,{data:_,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(m.code!==0){const C=new B(O.UNEXPECTED_RESPONSE,"cross channel ap error, code"+m.code,{retry:!0});throw S.error(C.toString()),C}const g=JSON.parse(m.json_body);if(g.code!==200){const C=new B(O.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(g.code,", reason: ").concat(g.reason));throw S.error(C.toString()),C}if(!g.servers||g.servers.length===0){const C=new B(O.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw S.error(C.toString()),C}return{vid:g.vid,workerToken:g.workerToken,addressList:(N("CHANNEL_MEDIA_RELAY_SERVERS")||g.servers).map(C=>"wss://".concat(C.address.replace(/\./g,"-"),".").concat(N("WORKER_DOMAIN"),":").concat(C.wss))}},void 0,m=>!!(m.code!==O.OPERATION_ABORTED&&m.code!==O.UNEXPECTED_RESPONSE||m.data&&m.data.retry),h)}(s,t,e,n));try{const s=await zf(r);return r.forEach(c=>c.cancel()),s}catch(s){throw s[0]}}async function VG(t,e,n){let i=null;const r=[],s=async c=>{const l=N(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2"));return c&&(await ni(1e3),i!==null)?i:await lg({fragementLength:N("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:d=>(S.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),d),function(h,p,_,m){const[g]=kG(p,[yn.CHOOSE_SERVER]);let C=Rn.networkState;return Ks(async()=>{C&&Rn.networkState===Fr.OFFLINE&&Rn.onlineWaiter&&await st.race([Rn.onlineWaiter,ni(m&&m.maxRetryTimeout||In.maxRetryTimeout)]),C=Rn.networkState;const R=await Js(h,{data:g,cancelToken:_,headers:{"Content-Type":"multipart/form-data;"}},!0);return PG(R,h)},()=>!1,R=>R.code!==O.OPERATION_ABORTED&&(R.code===O.UPDATE_TICKET_FAILED?R.data.retry:(S.warning("[".concat(p.clientId,"] update ticket network error, retry"),R),!0)),m)}(d,t,e,n)),allFailedhandler:d=>{throw d[0]},promisesCollector:r})};try{return i=await zf([s(!1),s(!0)]),r.length&&r.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function ZM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function zI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ZM(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ZM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class BG extends Xe{get isSuccess(){return!!this.configs}constructor(e,n){super(),A(this,"configs",void 0),A(this,"store",void 0),A(this,"joinInfo",void 0),A(this,"cancelToken",void 0),A(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),A(this,"interval",void 0),A(this,"mutex",void 0),A(this,"mutableParamsRead",!1),A(this,"configCache",{}),A(this,"limit_bitrate",void 0),this.mutex=new Ti("config-distribute",e),this.store=n}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),N("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},N("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,gt.reportApiInvoke(null,{options:void 0,name:vn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:rn.TRACER}).onSuccess(JSON.stringify(zs))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void S.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await UG(this.joinInfo,this.cancelToken,this.retryConfig),S.debug("[config-distribute] get config distribute",JSON.stringify(e));const i=function(r){var s;const c=Mt(s=Object.keys(r).filter(h=>/^webrtc_ng_global_parameter/.test(h))).call(s);for(let h=0;h<c.length;h++)for(let p=c.length-1;p>h;p--){const _=c[p],m=r[_].value;if(typeof m.__priority=="number"){const g=m.__priority,C=c[p-1],R=r[C].value;if(typeof R.__priority=="number"){if(!(g>R.__priority))continue;{const y=_;c[p]=c[p-1],c[p-1]=y}}else{const y=_;c[p]=c[p-1],c[p-1]=y}}}const l=Date.now();let d={};return c.forEach(h=>{const p=r[h].value.__expires;p&&p<=l||(d[h]=r[h])}),d}(e);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const r=new B(O.NETWORK_RESPONSE_ERROR,i);S.warning("[config-distribute] ".concat(r.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){dM(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(eg.UPDATE_BITRATE_LIMIT,e):this.emit(eg.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&zI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{const n={},i=Object.keys(e),r=[];i.forEach(s=>{const c=e[s].value;n[s]=c;const l=c.__id;if(l&&this.configCache[s]&&this.configCache[s].__id===l)return;const d=c.__type,h=e[s].value,p=e[s].tag;let _=0;d?d===xL.REALTIME&&(_=1):Object.keys(h).some(m=>Object.prototype.hasOwnProperty.call(Zb,m)||!vI()&&Object.prototype.hasOwnProperty.call(TR,m)?(_=1,!0):void 0),r.push({tag:p,isApplied:_,feature:s,params:JSON.stringify(c)})}),r.forEach(s=>{let{tag:c,feature:l,params:d,isApplied:h}=s;this.store.sessionId&&gt.abTest(this.store.sessionId,{intSucc:1,isApplied:h,tag:c,feature:l,params:d,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){S.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(e){const n=function(r){const s={};return Object.keys(r).forEach(c=>{const l=r[c].value,d=l.__expires,h=l.__type;Object.keys(l).forEach(p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=zI(zI({value:l[p]},d&&{expires:d}),h&&{type:h}))})}),s}(e);try{var i;const r=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,r&&dM(r)&&this.handleBitrateLimit(r),this.limit_bitrate=r,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(e),function(l){try{const d=Date.now();Object.keys(l).forEach(h=>{const{value:p,type:_,expires:m}=l[h];m&&m<=d||((_===xL.REALTIME||Object.prototype.hasOwnProperty.call(Zb,h))&&(zs[h]=p,je[h]=p,S.debug("Update realtime parameters from config distribute",h,p)),_||vI()||!Object.prototype.hasOwnProperty.call(TR,h)||(zs[h]=p,je[h]=p,S.debug("Update gateway parameters from config distribute",h,p)))})}catch(d){S.error("Error update config immediately: ".concat(l),d.message)}}(n);const s=JSON.stringify(n),c=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",c),S.debug("Caching global parameters ".concat(s))}catch(r){S.error("Error caching global parameters:",r.message)}}handleGlobalParameterConfig(e){try{const n=Date.now();Object.keys(e).forEach(i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(je,i)){const{value:r,expires:s}=e[i];if(s&&s<=n)return;(function(c,l){try{return typeof c=="object"&&typeof l=="object"&&JSON.stringify(c)===JSON.stringify(l)}catch{return!1}})(je[i],r)||(zs[i]=r,je[i]=r,this.emit(eg.UPDATE_CLIENT_ROLE_OPTIONS,r),S.debug("Updating client role options: ".concat(JSON.stringify(r))))}})}catch(n){S.error("Error handling global parameter config:",n.message)}}}class FG extends Xe{constructor(){super(...arguments),A(this,"resultStorage",new Map)}setLocalAudioStats(e,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(e,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(i))}setRemoteAudioStats(e,n){const i=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const i=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(e,n,i){if(N("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(i),r.result.length>=5)){var s;const c=rt(s=r.result).call(s,!0);r.isPrevNormal&&!c&&this.emit("exception",$M[e],e,n),!r.isPrevNormal&&c&&this.emit("exception",$M[e]+2e3,e+"_RECOVER",n),r.isPrevNormal=c,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof Dn&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=jr(n._encoderConfig.frameRate));const r=e.captureFrameRate;return!i||!r||!(i>10&&r<5||i<10&&i>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof Dn&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const $M={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},yi=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function t1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function lh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?t1(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):t1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class dg{constructor(e){A(this,"store",void 0),A(this,"onStatsException",void 0),A(this,"onUploadPublishDuration",void 0),A(this,"onStatsChanged",void 0),A(this,"onVideoCodecChanged",void 0),A(this,"localStats",new Map),A(this,"remoteStats",new Map),A(this,"updateStatsInterval",void 0),A(this,"trafficStats",void 0),A(this,"trafficStatsPeerList",[]),A(this,"uplinkStats",void 0),A(this,"exceptionMonitor",void 0),A(this,"p2pChannel",void 0),A(this,"scalabilityMode",SR.L1T1),A(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new FG,this.exceptionMonitor.on("exception",(n,i,r)=>{this.onStatsException&&this.onStatsException(n,i,r)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(X.LocalAudioTrack)||lh({},iI)}getLocalVideoTrackStats(){return this.localStats.get(X.LocalVideoTrack)||lh({},rI)}getRemoteAudioTrackStats(e){const n=(s,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const s=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.audioStats;s&&(i[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{audioStats:l}]=s;l&&(i[c]=n(c,l))});return i}getRemoteNetworkQualityStats(e){const n={};if(e){var i;const r=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.networkStats;r&&(n[e]=r)}else Array.from(this.remoteStats.entries()).forEach(r=>{let[s,{networkStats:c}]=r;c&&(n[s]=c)});return n}getRemoteVideoTrackStats(e){const n=(s,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(e){var r;const s=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.videoStats;s&&(i[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[c,{videoStats:l}]=s;l&&(i[c]=n(c,l))});return i}getRTCStats(){let e=0,n=0,i=0,r=0;const s=this.localStats.get(X.LocalAudioTrack);s&&(e+=s.sendBytes,n+=s.sendBitrate);const c=this.localStats.get(X.LocalVideoTrack);c&&(e+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(X.LocalVideoLowTrack);l&&(e+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(h=>{let{audioStats:p,videoStats:_}=h;p&&(i+=p.receiveBytes,r+=p.receiveBitrate),_&&(i+=_.receiveBytes,r+=_.receiveBitrate)});let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:n,SendBytes:e,RecvBytes:i,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const r=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),s=r!=null&&r.videoSSRC?yi.measureFromSubscribeStart(this.store.clientId,r.videoSSRC):0,c=r!=null&&r.audioSSRC?yi.measureFromSubscribeStart(this.store.clientId,r.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>c?s:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&S.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,i){if(!e)return!1;const r=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,s=!i||n.framesDecodeCount>i.framesDecodeCount;return r||!s}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[i,r]=n;switch(i){case X.LocalVideoTrack:case X.LocalVideoLowTrack:{const l=r,d=lh({},rI),h=e.getStats(),p=e.getLocalMedia(i);if(h){const _=h.videoSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(_){const m=e.getLocalVideoSize(),g=e.getEncoderConfig(X.LocalVideoTrack);var s;(_.codec==="H264"||_.codec==="H265"||_.codec==="VP8"||_.codec==="VP9"||_.codec==="AV1X"||_.codec==="AV1")&&(d.codecType=_.codec,(l==null?void 0:l.codecType)!==_.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,_.codec.toLocaleLowerCase()))),d.sendBytes=_.bytes,d.sendBitrate=l?8*Math.max(0,d.sendBytes-l.sendBytes):0,_.inputFrame?(d.captureFrameRate=_.inputFrame.frameRate,d.captureResolutionHeight=_.inputFrame.height,d.captureResolutionWidth=_.inputFrame.width):m&&(d.captureResolutionWidth=m.width,d.captureResolutionHeight=m.height),_.sentFrame?(d.sendFrameRate=_.sentFrame.frameRate,d.sendResolutionHeight=_.sentFrame.height,d.sendResolutionWidth=_.sentFrame.width):m&&(d.sendResolutionWidth=m.width,d.sendResolutionHeight=m.height),_.avgEncodeMs&&(d.encodeDelay=_.avgEncodeMs),g&&g.bitrateMax?d.targetSendBitrate=1e3*g.bitrateMax:_.targetBitrate&&(d.targetSendBitrate=_.targetBitrate),d.sendPackets=_.packets,d.sendPacketsLost=_.packetsLost,d.sendJitterMs=_.jitterMs,d.sendRttMs=_.rttMs,d.totalDuration=l?l.totalDuration+1:1,d.totalFreezeTime=l?l.totalFreezeTime:0,this.isLocalVideoFreeze(_)&&(d.totalFreezeTime+=1),_.scalabilityMode&&this.scalabilityMode!==_.scalabilityMode&&(S.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(_.scalabilityMode)),this.scalabilityMode=_.scalabilityMode)}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var c;this.localStats.set(i,d),((l==null?void 0:l.sendResolutionWidth)!==d.sendResolutionWidth||(l==null?void 0:l.sendResolutionHeight)!==d.sendResolutionHeight)&&((c=this.onStatsChanged)===null||c===void 0||c.call(this,"resolution",{width:d.sendResolutionWidth,height:d.sendResolutionHeight})),d&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,d);break}case X.LocalAudioTrack:{const l=r,d=lh({},iI),h=e.getStats(),p=e.getLocalMedia(i);if(h){const _=h.audioSend.find(m=>m.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(_){if(_.codec!=="opus"&&_.codec!=="aac"&&_.codec!=="PCMU"&&_.codec!=="PCMA"&&_.codec!=="G722"||(d.codecType=_.codec),_.inputLevel)d.sendVolumeLevel=Math.round(32767*_.inputLevel);else{const m=e.getLocalAudioVolume();m&&(d.sendVolumeLevel=Math.round(32767*m))}d.sendBytes=_.bytes,d.sendPackets=_.packets,d.sendPacketsLost=_.packetsLost,d.sendJitterMs=_.jitterMs,d.sendRttMs=_.rttMs,d.sendBitrate=l?8*Math.max(0,d.sendBytes-l.sendBytes):0}}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(X.LocalAudioTrack,d),d&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,d);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var i,r;let[s,{videoStats:c,audioStats:l,videoPcStats:d}]=n;const h=l,p=c,_=d,m=lh({},qL),g=lh({},XL),C=lh({},y4),{audioTrack:R,videoTrack:y,audioSSRC:b,videoSSRC:I}=e.getRemoteMedia(s);let L;L=this.store.useP2P?e.getStats(!0):e.getStats();const U=(i=L)===null||i===void 0?void 0:i.audioRecv.find(K=>K.ssrc===b),x=(r=L)===null||r===void 0?void 0:r.videoRecv.find(K=>K.ssrc===I),M=this.trafficStats&&this.trafficStats.peer_delay.find(K=>K.peer_uid===s);if(U&&(U.codec!=="opus"&&U.codec!=="aac"&&U.codec!=="PCMU"&&U.codec!=="PCMA"&&U.codec!=="G722"||(m.codecType=U.codec),U.outputLevel?m.receiveLevel=Math.round(32767*U.outputLevel):R&&(m.receiveLevel=Math.round(32767*R.getVolumeLevel())),m.receiveBytes=U.bytes,m.receivePackets=U.packets,m.receivePacketsLost=U.packetsLost,m.receivePacketsDiscarded=U.packetsDiscarded,m.packetLossRate=m.receivePacketsLost/(m.receivePackets+m.receivePacketsLost),m.receiveBitrate=h?8*Math.max(0,m.receiveBytes-h.receiveBytes):0,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,m.freezeRate=m.totalFreezeTime/m.totalDuration,m.receiveDelay=U.jitterBufferMs,m.totalDuration>10&&dg.isRemoteAudioFreeze(R)&&(m.totalFreezeTime+=1)),x){var j;x.codec!=="H264"&&x.codec!=="H265"&&x.codec!=="VP8"&&x.codec!=="VP9"&&x.codec!=="AV1X"&&x.codec!=="AV1"||(g.codecType=x.codec),g.receiveBytes=x.bytes,g.receiveBitrate=p?8*Math.max(0,g.receiveBytes-p.receiveBytes):0,g.decodeFrameRate=x.decodeFrameRate<0?0:x.decodeFrameRate,g.renderFrameRate=x.decodeFrameRate<0?0:x.decodeFrameRate,x.outputFrame&&(g.renderFrameRate=x.outputFrame.frameRate),x.receivedFrame?(g.receiveFrameRate=x.receivedFrame.frameRate,g.receiveResolutionHeight=x.receivedFrame.height,g.receiveResolutionWidth=x.receivedFrame.width):y&&(g.receiveResolutionHeight=y._videoHeight||0,g.receiveResolutionWidth=y._videoWidth||0),x.framesRateFirefox!==void 0&&(g.receiveFrameRate=Math.round(x.framesRateFirefox)),g.receivePackets=x.packets,g.receivePacketsLost=x.packetsLost,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost);const K=p?p.totalFreezeTime:0,it=p?p.totalDuration:0;g.totalDuration=p?p.totalDuration+1:1,g.totalFreezeTime=(j=x.totalFreezesDuration)!==null&&j!==void 0?j:K||0,g.receiveDelay=x.jitterBufferMs||0;const dt=!!I&&e.getRemoteVideoIsReady(I);x.totalFreezesDuration===void 0&&y&&dt&&dg.isRemoteVideoFreeze(y,x,_)&&(g.totalFreezeTime+=1),g.freezeRate=Math.max(0,Math.min((g.totalFreezeTime-K)/(g.totalDuration-it),1))}M&&(m.end2EndDelay=M.B_ad,g.end2EndDelay=M.B_vd,m.transportDelay=M.B_ed,g.transportDelay=M.B_ed,m.currentPacketLossRate=M.B_ealr4/100,g.currentPacketLossRate=M.B_evlr4/100,C.uplinkNetworkQuality=M.B_punq?M.B_punq:0,C.downlinkNetworkQuality=M.B_pdnq?M.B_pdnq:0),this.remoteStats.set(s,{audioStats:m,videoStats:g,videoPcStats:x,networkStats:C}),R&&this.exceptionMonitor.setRemoteAudioStats(R,m),y&&this.exceptionMonitor.setRemoteVideoStats(y,g)})}}class e1{constructor(){A(this,"destChannelMediaInfos",new Map),A(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){cM(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){cM(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){VR(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function n1(t){if(!(t instanceof e1))return new B(O.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new B(O.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new B(O.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Td{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){A(this,"uid",void 0),A(this,"_uintid",void 0),A(this,"_trust_in_room_",!0),A(this,"_trust_audio_enabled_state_",!0),A(this,"_trust_video_enabled_state_",!0),A(this,"_trust_audio_mute_state_",!0),A(this,"_trust_video_mute_state_",!0),A(this,"_audio_muted_",!1),A(this,"_video_muted_",!1),A(this,"_audio_enabled_",!0),A(this,"_video_enabled_",!0),A(this,"_audio_added_",!1),A(this,"_video_added_",!1),A(this,"_is_pre_created",!1),A(this,"_video_pre_subscribed",!1),A(this,"_audio_pre_subscribed",!1),A(this,"_trust_video_stream_added_state_",!0),A(this,"_trust_audio_stream_added_state_",!0),A(this,"_audioTrack",void 0),A(this,"_videoTrack",void 0),A(this,"_dataChannels",[]),A(this,"_audioSSRC",void 0),A(this,"_videoSSRC",void 0),A(this,"_audioOrtc",void 0),A(this,"_videoOrtc",void 0),A(this,"_cname",void 0),A(this,"_rtxSsrcId",void 0),A(this,"_videoMid",void 0),A(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}function i1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function r1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?i1(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const ug="9",a1=4e4;function s1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Jc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?s1(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}var Yf=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(Yf||{});const ZR=new Map;function o1(t,e,n,i){let{scale:r}=t;if(r===0&&i===Yf.UP||r>=e.length-1&&i===Yf.DOWN)return t;let s=Jc(Jc({},t),{},{scale:i===Yf.DOWN?++r:--r});switch(n){case"maintain-framerate":s=Jc(Jc({},s),e[r].motion);break;case"maintain-resolution":s=Jc(Jc({},s),e[r].detail);break;case"balanced":s=Jc(Jc({},s),e[r].balanced)}return s}function c1(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:l1(e)};ZR.set(t,n)}else ZR.delete(t)}function l1(t){const e=Jc({},t),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:r,bitrateMin:s}=e,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:h,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:_,BWE_SCALE_DOWN_THRESHOLD:m,PERF_SCALE_DOWN_THRESHOLD:g,PERF_SCALE_UP_THRESHOLD:C,BALANCE_BITRATE_FACTOR:R,BALANCE_FRAMERATE_FACTOR:y,BALANCE_RESOLUTION_FACTOR:b,MOTION_RESOLUTION_FACTOR:I,MOTION_BITRATE_FACTOR:L,DETAIL_FRAMERATE_FACTOR:U,DETAIL_BITRATE_FACTOR:x}=Jb,M=Math.min(e.frameRate,l),j=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(m,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(g,1)*M),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:s}}];for(let K=1;K<=d;K++){const it={bwe_up:Math.round(Math.pow(_,K)*n),bwe_down:Math.round(Math.pow(m,K+1)*n),fps_up:Math.round(Math.pow(C,K)*M),fps_down:Math.round(Math.pow(g,K+1)*M)},dt={scaleResolutionDownBy:r/Math.pow(b,K),frameRate:Math.max(Math.round(Math.pow(y,K)*i),c),bitrateMax:Math.max(Math.round(Math.pow(R,K)*n),p),bitrateMin:Math.max(Math.round(Math.pow(R,K)*s),h)},Ft={scaleResolutionDownBy:r/Math.pow(I,K),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(L,K)*n),p),bitrateMin:Math.max(Math.round(Math.pow(L,K)*s),h)},Vt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(U,K)*i),c),bitrateMax:Math.max(Math.round(Math.pow(x,K)*n),p),bitrateMin:Math.max(Math.round(Math.pow(x,K)*s),h)};j.push({scale:K,threshold:it,balanced:dt,motion:Ft,detail:Vt})}return j}function jG(t,e,n,i,r,s){const c=ZR.get(t)||{overUse:0,underUse:0,adaptationList:l1(r)},{adaptationList:l}=c;ZR.set(t,c);const{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:h}=Jb,{scale:p}=i;let _,m;return typeof e=="number"&&e>0&&function(g,C,R,y){if(C>=R.length)return!1;let{threshold:{fps_down:b}}=R[C];return N("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(b=R[0].threshold.fps_down),g<b}(e,p,l,s)&&(c.overUse++,m=qE.CPU,c.overUse>d)||typeof n=="number"&&n>0&&function(g,C,R){if(C>=R.length)return!1;const{threshold:{bwe_down:y}}=R[C];return g<y}(n,p,l)&&(c.overUse++,m=qE.BANDWIDTH,c.overUse>d)?(c.overUse=0,c.underUse=0,_=o1(i,l,s,Yf.DOWN),[_,m]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(g,C,R,y){if(C===0)return;let{threshold:{fps_up:b}}=R[C];return N("FORCE_AG_HIGH_FRAMERATE")&&y==="maintain-framerate"&&(b=R[1].threshold.fps_up),g>b}(e,p,l,s)&&function(g,C,R){if(C===0)return;const{threshold:{bwe_up:y}}=R[C];return g>y}(n,p,l)&&(c.underUse++,c.underUse>h&&(c.overUse=0,c.underUse=0,_=o1(i,l,s,Yf.UP),_.scale===0&&(m=qE.NONE))),[_,m])}function d1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function YI(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?d1(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function GG(t){var e;return!!N("ENABLE_AG_ADAPTATION")&&!!(t instanceof pI||rt(e=t._hints).call(e,Ce.CUSTOM_TRACK))&&(!!N("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const i=ae();if(i.os!==Fn.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return Number(r[0])>=n}(14)&&aL(17,4)||rL(14)&&sL(17,4,!0)))}const $R=new Map;function ty(t,e){const n=$R.get(t);if(n){const{timer:i}=n;window.clearTimeout(i),$R.delete(t)}e.qualityLimitationReason=qE.NONE,c1(t)}function HG(t,e){var n;let i;switch(e){case X.LocalAudioTrack:i=Ee.Audio;break;case X.LocalVideoTrack:i=rt(n=t._hints).call(n,Ce.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case X.LocalVideoLowTrack:i=Ee.Low}return i}function qI(t){const e=se();if(t.some(n=>n._bypassWebAudio))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function XI(t,e){qI(t);const n=new Dn;return t.forEach(i=>n.addAudioTrack(i)),n}const WG=!se().supportUnifiedPlan||N("CHROME_FORCE_PLAN_B")&&Gc();function ey(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return WG?(n={spec:e,store:t},Xc("PlanBConnection").create(n)):new Yo(e,t)}function JI(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function u1(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(KE(t.turnServer.servers))return!1;if(N("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var ee;function h1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Qs(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?h1(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let Yo=(ee=class yh extends hM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return rt(n=Object.keys(vR)).call(n,e)}))]}constructor(e,n){super(e,n),A(this,"id",Le(5,"connection-")),A(this,"store",void 0),A(this,"peerConnection",void 0),A(this,"forceTurn",!1),A(this,"remoteSDP",void 0),A(this,"initialOffer",void 0),A(this,"transportEventReceiver",void 0),A(this,"statsFilter",void 0),A(this,"extension",{useXR:N("USE_XR")}),A(this,"localCapabilities",void 0),A(this,"remoteCodecs",void 0),A(this,"localCandidateCount",0),A(this,"allCandidatesReceived",!1),A(this,"isPreallocation",!1),A(this,"preSSRCMap",new Map),A(this,"dataStreamChannelMap",new Map),A(this,"establishPromise",void 0),A(this,"recoveredDataChannelIds",[]),A(this,"currentDataChannelId",1),A(this,"supportAV1RtpSpec",!1),A(this,"mutex",void 0),A(this,"qualityLimitationReason",qE.NONE),A(this,"isFirstConnected",!1),this.store=n,this.forceTurn=u1(e),this.mutex=new Ti("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(yh.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=Yb(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,en()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);if(i)return{transceiver:i,track:i.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void S.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else S.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=gd(i.sdp),s=await DM({filterRTX:!N("USE_PUB_RTX")&&!N("USE_SUB_RTX"),filterVideoFec:N("FILTER_VIDEO_FEC"),filterAudioFec:N("FILTER_AUDIO_FEC"),filterVideoCodec:N("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=YR(s),this.initialOffer=i,N("ENABLE_SVC")&&this.store.codec=="av1"){const l=await async function(){try{const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:SR.L1T3}]});const h=await d.createOffer();if(!h.sdp)return void d.close();const p=vr(h.sdp).mediaDescriptions[0];if(!p)return;const _=p.attributes.extmaps.find(m=>m.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return d.close(),_}catch{return}}();var e;l&&(this.supportAV1RtpSpec=!0,(e=s.send)===null||e===void 0||e.videoExtensions.push(l))}let c;return i.sdp&&MM(i.sdp)&&(c=Je(s),(n=c).send&&(Gf(ut.VIDEO,n.send.videoExtensions),Gf(ut.AUDIO,n.send.audioExtensions)),n.recv&&(Gf(ut.VIDEO,n.recv.videoExtensions),Gf(ut.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(Gf(ut.VIDEO,n.sendrecv.videoExtensions),Gf(ut.AUDIO,n.sendrecv.audioExtensions))),Qs(Qs({},r),{},{rtpCapabilities:c||s,offerSDP:i.sdp})}catch(i){throw new G(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&MM(this.initialOffer.sdp)&&(n=e.rtpCapabilities,i=this.localCapabilities,n.send&&(WR(ut.VIDEO,n.send.videoExtensions,i.send.videoExtensions),WR(ut.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(WR(ut.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),WR(ut.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Je(this._localCapabilities)}get rtpCapabilities(){return Je(this._rtpCapabilities)}get candidates(){return Je(this._candidates)}get iceParameters(){return Je(this._iceParameters)}get dtlsParameters(){return Je(this._dtlsParameters)}constructor(h){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1];A(this,"sessionDesc",void 0),A(this,"_localCapabilities",void 0),A(this,"_rtpCapabilities",void 0),A(this,"_candidates",void 0),A(this,"_originCandidates",void 0),A(this,"_iceParameters",void 0),A(this,"_isUseExtmapAllowMixed",void 0),A(this,"_dtlsParameters",void 0),A(this,"setup",void 0),A(this,"currentMidIndex",void 0),A(this,"cname",void 0),A(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=p,h=Je(h);const{iceParameters:_,dtlsParameters:m,candidates:g,rtpCapabilities:C,setup:R,localCapabilities:y,cname:b}=h;this._rtpCapabilities=C,this._candidates=g,this._originCandidates=Je(g),this._iceParameters=_,this._dtlsParameters=m,this._localCapabilities=y,this.setup=R,this.cname=b,this.sessionDesc=this.updateRemoteRTPCapabilities(C),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(h){const p=this.candidates,_=this.dtlsParameters,m=this.iceParameters,g=this.rtpCapabilities.send;let C=this.sessionDesc.mediaDescriptions.length-1;for(let R=1;R<h;R++){const y=2*R+2e4,b=2*R+a1,{ssrcs:I,ssrcGroups:L}=ch([{ssrcId:y}],this.cname),{ssrcs:U,ssrcGroups:x}=ch([{ssrcId:b,rtx:N("USE_SUB_RTX")?b+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:ug,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.videoCodecs.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:m.iceUfrag,icePwd:m.icePwd,unrecognized:[],candidates:p,extmaps:g.videoExtensions,fingerprints:_.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:U,ssrcGroups:x,rtcpFeedbackWildcards:[],payloads:g.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++C)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:ug,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.audioCodecs.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:m.iceUfrag,icePwd:m.icePwd,unrecognized:[],candidates:p,extmaps:g.audioExtensions,fingerprints:_.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:I,ssrcGroups:L,rtcpFeedbackWildcards:[],payloads:g.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++C)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return pd(this.sessionDesc)}send(h,p,_,m){const{ssrcs:g,ssrcGroups:C}=ch(p,this.cname,N("SYNC_GROUP")?_:void 0),R=this.findPreloadMediaDesc(g);if(R){if(en()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,R.attributes.mid),m&&(m.twcc||m.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(R);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(R,m),{mid:R.attributes.mid,needExchangeSDP:!0}}return{mid:R.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(h,g);let b;return y===-1||y===1&&(li()||function(){const I=ae();return!(I.name!==de.CHROME||!I.osVersion)&&Number(I.version)<=90}()||N("ENABLE_ENCODED_TRANSFORM")&&jc())||y===0&&N("USE_SUB_RTX")||oL()?(b=this.createOrRecycleSendMedia(h,g,C,"sendonly",m),this.updateBundleMids()):(b=Je(this.sessionDesc.mediaDescriptions[y]),b.attributes.direction="sendonly",b.attributes.ssrcs=g,b.attributes.ssrcGroups=C,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(b,m)),en()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,b.attributes.mid),{mid:b.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:h,needExchangeSDP:p}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:h.attributes.mid,needExchangeSDP:p}}batchSend(h){const p=h.map(g=>{let{kind:C,ssrcMsg:R,mslabel:y}=g;return this.send(C,R,y)}),_=[];let m=!1;return p.forEach(g=>{let{mid:C,needExchangeSDP:R}=g;R&&(m=!0),_.push(C)}),{mids:_,needExchangeSDP:m}}stopSending(h){const p=this.sessionDesc.mediaDescriptions.filter(_=>_.attributes.mid&&h.indexOf(_.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");p.forEach(_=>{_.attributes.mid==="0"||en()||oL()?_.attributes.ssrcs=[]:(_.attributes.ssrcs=[],_.attributes.direction="inactive",_.media.port="0")}),this.updateBundleMids()}mute(h){const p=this.sessionDesc.mediaDescriptions.find(_=>_.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(h){const p=this.sessionDesc.mediaDescriptions.find(_=>_.attributes.mid===h);if(!p)throw new Error("mediaDescription not found with ".concat(h," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}muteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(_=>rt(h).call(h,_.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(_=>{_.attributes.direction="inactive"})}unmuteRemote(h){const p=this.sessionDesc.mediaDescriptions.filter(_=>rt(h).call(h,_.attributes.mid||""));if(p.length!==h.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach(_=>{_.attributes.direction="recvonly"})}receive(h,p,_,m){h.forEach((g,C)=>{this.createOrRecycleRecvMedia(g,[],"recvonly",p,_,m[C])}),this.updateBundleMids()}stopReceiving(h){const p=this.sessionDesc.mediaDescriptions.filter(_=>h.indexOf(_.attributes.mid)!==-1);if(p.length!==h.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");p.forEach(_=>{_.media.port="0",_.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(h){const p=this.sessionDesc||vr((_=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(_?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var _;this._rtpCapabilities=h;const m=this.rtpCapabilities.send,g=this.localCapabilities.send;for(const C of p.mediaDescriptions){if(C.attributes.iceUfrag=this._iceParameters.iceUfrag,C.attributes.icePwd=this._iceParameters.icePwd,C.attributes.fingerprints=this._dtlsParameters.fingerprints,C.attributes.candidates=this._candidates,C.attributes.setup=this.setup,C.media.mediaType==="application"&&(C.attributes.sctpPort="5000"),C.media.mediaType==="video"){if(m.videoCodecs.length===0){const R=g.videoCodecs.filter(y=>{var b,I;return(b=y.rtpMap)===null||b===void 0?void 0:rt(I=b.encodingName.toLowerCase()).call(I,"vp8")})||[g.videoCodecs[0]];C.media.fmts=R.map(y=>y.payloadType.toString(10)),C.attributes.payloads=R,C.attributes.extmaps=[]}else if(C.media.fmts=m.videoCodecs.map(R=>R.payloadType.toString(10)),C.attributes.payloads=m.videoCodecs,C.attributes.extmaps=m.videoExtensions,N("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:R,ssrcGroups:y}=ch([{ssrcId:a1,rtx:N("USE_SUB_RTX")?40001:void 0}],this.cname);C.attributes.ssrcs=R,C.attributes.ssrcGroups=y}}if(C.media.mediaType==="audio"){if(m.audioCodecs.length===0){const R=g.audioCodecs.filter(y=>{var b,I;return(b=y.rtpMap)===null||b===void 0?void 0:rt(I=b.encodingName.toLowerCase()).call(I,"opus")})||[g.audioCodecs[0]];C.media.fmts=R.map(y=>y.payloadType.toString(10)),C.attributes.payloads=R,C.attributes.extmaps=[]}else if(C.media.fmts=m.audioCodecs.map(R=>R.payloadType.toString(10)),C.attributes.payloads=m.audioCodecs,C.attributes.extmaps=m.audioExtensions,Wf(C),N("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:R,ssrcGroups:y}=ch([{ssrcId:2e4}],this.cname);C.attributes.ssrcs=R,C.attributes.ssrcGroups=y}}}return this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(h){const p=this._originCandidates.filter(m=>m.transport==="udp"),_=[];if(p.forEach(m=>{_.push(r1(r1({},m),{},{foundation:"tcpcandidate",priority:Number(m.priority)-1+"",transport:"tcp",port:Number(m.port)+90+""}))}),p.length!==0){switch(h){case Ri.TCP_RELAY:this._candidates=_;break;case Ri.UDP_TCP_RELAY:case Ri.RELAY:this._candidates=[...p,..._];break;default:this._candidates=p}for(const m of this.sessionDesc.mediaDescriptions)m.attributes.candidates=this.candidates}}restartICE(h){h=Je(h),this._iceParameters=h,this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.iceUfrag=h.iceUfrag,p.attributes.icePwd=h.icePwd})}predictReceivingMids(h){const p=[];for(let _=0;_<h;_++)p.push((this.currentMidIndex+_+1).toString(10));return p}findAvailableMediaIndex(h,p){return this.sessionDesc.mediaDescriptions.findIndex(_=>{const m=_.media.mediaType===h&&_.media.port!=="0"&&(_.attributes.direction==="sendonly"||_.attributes.direction==="sendrecv")&&_.attributes.ssrcs.length===0;if(en()){if(m){const g=this.firefoxSsrcMidMap.get(p[0].ssrcId);return!(g||_.attributes.mid!=="0"&&_.attributes.mid!=="1")||!(!g||g!==_.attributes.mid)}return!1}return m})}createOrRecycleDataChannel(){for(const _ of this.sessionDesc.mediaDescriptions)if(_.media.mediaType==="application")return{mediaDesc:_,needExchangeSDP:!1};this.currentMidIndex+=1;const h="".concat(this.currentMidIndex),p={media:{mediaType:"application",port:ug,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(h),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(p),{mediaDesc:p,needExchangeSDP:!0}}createOrRecycleRecvMedia(h,p,_,m,g,C){const R=h._mediaStreamTrack.kind,y=this.rtpCapabilities.recv,b=sg(R,y,this.localCapabilities.send,R===ut.VIDEO?m:g),I=R===ut.VIDEO?y.videoExtensions:y.audioExtensions;this.currentMidIndex+=1;const L="".concat(this.currentMidIndex);let U={media:{mediaType:R,port:ug,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:I,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:b,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(L)}};U=this.mungRecvMediaDsec(U,h,C);const x=this.findFirstClosedMedia(R);if(x){const M=this.sessionDesc.mediaDescriptions.indexOf(x);this.sessionDesc.mediaDescriptions[M]=U}else this.sessionDesc.mediaDescriptions.push(U);return U}updateRemoteCodec(h,p,_){const m=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(U=>U.rtpMap&&U.rtpMap.encodingName.toLowerCase()||"").filter(U=>{var x;return rt(x=Object.keys(vR)).call(x,U)}))],g=new Set(p);if(m.every(U=>g.has(U)))return S.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(p)),!1;const C=this._rtpCapabilities.recv.videoCodecs.filter(U=>p.some(x=>{var M;return rt(M=U.rtpMap&&U.rtpMap.encodingName.toLowerCase()||"").call(M,x)}));if(C.length===0)return S.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(m," codecs: ").concat(p)),!1;const R=[...new Set(C.map(U=>U.rtpMap&&U.rtpMap.encodingName.toLowerCase()||""))];let y;if(S.debug("updateRemoteCodec, from ".concat(m," to ").concat(R)),h.length===0)y=this.sessionDesc.mediaDescriptions.filter(U=>U.media.mediaType==="video"&&U.attributes.direction==="recvonly");else if(y=this.sessionDesc.mediaDescriptions.filter(U=>U.attributes.mid&&U.media.mediaType==="video"&&rt(h).call(h,U.attributes.mid)&&U.attributes.direction==="recvonly"),y.length!==h.length)return S.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(h,", codecs: ").concat(p)),!1;if(N("USE_PUB_RTX")||N("USE_SUB_RTX")){const U=UI(C,this.rtpCapabilities.recv.videoCodecs);C.push(...U)}this._rtpCapabilities.recv.videoCodecs=C;const b=this.localCapabilities.send,I=this.rtpCapabilities.recv,L=sg(ut.VIDEO,I,b,_);return y.forEach(U=>{const x=L.map(M=>M.payloadType.toString(10));S.debug("updateRemoteCodec mid: ".concat(U.attributes.mid,", from"),U.attributes.payloads,"to",L),U.attributes.payloads=L,U.media.fmts=x}),!0}createOrRecycleSendMedia(h,p,_,m,g){const C=this.rtpCapabilities.send,R=h===ut.VIDEO?C.videoCodecs:C.audioCodecs,y=h===ut.VIDEO?C.videoExtensions:C.audioExtensions;this.currentMidIndex+=1;const b="".concat(this.currentMidIndex);let I={media:{mediaType:h,port:ug,protos:["UDP","TLS","RTP","SAVPF"],fmts:R.map(U=>U.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:_,rtcpFeedbackWildcards:[],payloads:R,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(b)}};I=this.mungSendMediaDesc(I,g);const L=this.findFirstClosedMedia(h);if(L){const U=this.sessionDesc.mediaDescriptions.indexOf(L);this.sessionDesc.mediaDescriptions[U]=I}else this.sessionDesc.mediaDescriptions.push(I);return I}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(h=>h.media.port!=="0").map(h=>h.attributes.mid)}mungRecvMediaDsec(h,p,_){const m=Je(h);return kI(m),Hf(m,p),MI(m,p),wM(m),zR(m,_,this.localCapabilities.send),m}mungSendMediaDesc(h,p){const _=Je(h);return zR(_,p,this.localCapabilities.recv),Wf(_),_}updateRecvMedia(h,p){const _=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===h);if(_!==-1){const m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_],p);this.sessionDesc.mediaDescriptions[_]=m}}bumpMid(h){this.currentMidIndex+=h}findFirstClosedMedia(h){return this.sessionDesc.mediaDescriptions.find(p=>en()?p.media.port==="0"&&p.media.mediaType===h:p.media.port==="0")}findPreloadMediaDesc(h){return this.sessionDesc.mediaDescriptions.find(p=>{var _;return((_=p.attributes)===null||_===void 0||(_=_.ssrcs[0])===null||_===void 0?void 0:_.ssrcId)===h[0].ssrcId})}getSSRC(h){var p;return(p=this.sessionDesc.mediaDescriptions.find(_=>_.attributes.mid===h))===null||p===void 0?void 0:p.attributes.ssrcs}}(Qs(Qs({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const r=this.remoteSDP.toString(),s=PM(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c==null||c(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r});const l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),N("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(N("PRELOAD_MEDIA_COUNT"));const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p)}const{preSSRCs:d}=e;if(Array.isArray(d)&&d.length>0){const{mids:h}=this.remoteSDP.batchSend(d.map(p=>({kind:p.kind,ssrcMsg:[{ssrcId:p.ssrcId,rtx:p.rtx}],mslabel:p.mslabel})));h.forEach((p,_)=>{this.preSSRCMap.set(d[_].ssrcId,p)}),await og(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(r){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}var n,i}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:i}=e;if(Array.isArray(i)&&i.length>0){const{mids:r}=this.remoteSDP.batchSend(i.map(s=>Object.assign({},{kind:s.kind,ssrcMsg:[{ssrcId:s.ssrcId,rtx:s.rtx}],mslabel:s.mslabel})));r.forEach((s,c)=>{this.preSSRCMap.set(i[c].ssrcId,s)})}await og(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Oa(function*(){const s=yield re(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=HR();e.forEach(y=>{const b=r.peerConnection.addTransceiver(y._mediaStreamTrack,Qs({direction:"sendonly"},y.trackMediaType==="video"&&r.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));c.push(b),y._updateRtpTransceiver(b)}),en()&&N("SIMULCAST")===!0&&(yield re(r.applySimulcastForFirefox(c,e)));const d=yield re(r.peerConnection.createOffer()),h=r.remoteSDP.predictReceivingMids(e.length),p=r.mungSendOfferSDP(d.sdp,e,h),_=vr(p),m=h.map(y=>{const b=_.mediaDescriptions.find(I=>I.attributes.mid===y);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return bM(b,N("USE_PUB_RTX"))});let g;try{g=yield m}catch(y){g=[],r.remoteSDP.receive(e,n,i,g);const b=r.remoteSDP.toString();throw yield re(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield re(r.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield re(r.stopSending(h,!0)),y}r.remoteSDP.receive(e,n,i,g);const C=r.remoteSDP.toString(),R=r.logSDPExchange(p,"offer","local","send");return yield re(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield re(r.applySimulcastEncodings(c,e)),yield re(r.applySendEncodings(c,e)),R==null||R(C),yield re(r.peerConnection.setRemoteDescription({type:"answer",sdp:C})),c.map((y,b)=>{const I=h[b];return{localSSRC:m[b],id:I,transceiver:y}})}catch(c){throw c instanceof G?c:new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(e);if(i&&i.readyState==="open")S.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:N("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,i)}n.forEach(s=>{s._updateOriginDataChannel(i)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),S.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else S.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof G?i:new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof G?n:new G(O.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(d=>{var h;ty(this.id+d.mid,this),d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);c&&(await og(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:s,transceiver:l}}catch(s){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(e);return i&&(await og(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(r=>{const s=this.peerConnection.getTransceivers().find(c=>c.mid===r);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:r,transceiver:s}})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(s=>{Array.from(this.preSSRCMap.entries()).some(c=>{let[l,d]=c;if(d===s)return this.preSSRCMap.delete(l),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString();r==null||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Oa(function*(){const i=yield re(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=se().supportPCSetConfiguration,s=N("FORCE_TURN_TCP")||n.forceTurn;if(e===Ri.RELAY&&!r)return;if(r&&!s){const _=e===Ri.RELAY?"relay":"all",m=n.peerConnection.getConfiguration();m.iceTransportPolicy!==_&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,n.peerConnection.setConfiguration(m))}n.remoteSDP.updateCandidates(e);const c=yield re(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const l=gd(c.sdp),{remoteIceParameters:d}=yield l.iceParameters;n.remoteSDP.restartICE(d);const h=n.remoteSDP.toString(),p=n.logSDPExchange(c.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield re(n.peerConnection.setLocalDescription(c)),p==null||p(h),yield re(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(r){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ri.TCP_RELAY),await og(this.peerConnection,this.remoteSDP,this.extension)}catch(n){S.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{ty(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Qs(Qs({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new G(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?en()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:Qs(Qs({},Fo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:Qs(Qs({},Fo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var n;const i="code: ".concat(e.errorCode,", message: ").concat(e.errorText),r=e.port?"local: ".concat(e.port):"";S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(e.url||"",", host_candidate:").concat(r)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},N("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&(KE(e.turnServer.servers)?n.iceServers=e.turnServer.servers:N("NEW_TURN_MODE")&&n.iceServers?(N("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&n.iceServers.push(...yh.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):n.iceServers.push(...yh.newTurnServerConfigToIceServers(e.turnServer.servers)),N("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...yh.turnServerConfigToIceServers(e.turnServer.servers)),N("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...yh.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),N("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),N("ENABLE_ENCODED_TRANSFORM")&&se().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(md(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!N("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}static newTurnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{const r=N("NEW_TURN_MODE");r===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):r===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):r===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(md(i.turnServerURL),":443?transport=tcp")}):r===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(md(i.turnServerURL),":443?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var r;n!=null&&n.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,n.state))},n.onerror=r=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in r?r.error:r)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const r=n==null?void 0:n.iceTransport.state;var s;r&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,r))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:r,remote:s}=i.getSelectedCandidatePair();S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i,r;if(n||(n=this.peerConnection.getSenders().find(y=>y.track===e._mediaStreamTrack)),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!se().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},c={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const l=function(R,y){return R.getTransceivers().find(b=>b.sender.track===y||b.receiver.track===y)}(this.peerConnection,e._mediaStreamTrack),d=O4(e);if(GG(e)&&l&&n&&d&&this.getLocalVideoStats&&rt(i=["vp8","vp9"]).call(i,this.store.codec)){var h;const R=s.degradationPreference||(rt(h=e._hints).call(h,Ce.CUSTOM_TRACK)?N("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(y,b,I,L,U,x){if(ty(y,I),U(b),L!=="balanced"&&L!=="maintain-framerate"&&L!=="maintain-resolution")return;let M=-1;c1(y,b);const j=window.setInterval(()=>{const it=$R.get(y);if(!N("ENABLE_AG_ADAPTATION")||!it)return ty(y,I),void U(b);const dt=x();if(dt.sendPackets>0&&dt.OutgoingAvailableBandwidth>0){if(M===-1)return void(M=Date.now());if(Date.now()-M<1e3)return;const Ft=dt.sendFrameRate,Vt=dt.OutgoingAvailableBandwidth,[It,Ue]=jG(y,Ft,Vt,it.adaptationConfig,b,L);Ue&&(I.qualityLimitationReason=Ue),It&&it.adaptationConfig.scale!==It.scale&&(S.debug("[".concat(y,"] applyAdaptation: ").concat(I.qualityLimitationReason,`
           sendFps `).concat(Ft,", bwe ").concat(Vt,", switch from ").concat(it.adaptationConfig.scale," to ").concat(It.scale," ")),it.adaptationConfig=YI(YI({},it.adaptationConfig),It),U(It))}},N("CHECK_LOCAL_STATS_INTERVAL")),K=YI({},b);$R.set(y,{timer:j,adaptationConfig:K,originConfig:b,adaptationFunc:U}),S.debug("[".concat(y,"] start adaptation, originConfig: ").concat(JSON.stringify(b),", degradationPreference: ").concat(L))})(this.id+l.mid,d,this,R,y=>{n&&this.updateAdaptation(n,y)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var p;const{bitrateMax:R,frameRate:y,scaleResolutionDownBy:b}=e._encoderConfig;R&&(c.maxBitrate=1e3*R),(rt(p=e._hints).call(p,Ce.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(y&&(c.maxFramerate=jr(y)),b&&b>=1&&(c.scaleResolutionDownBy=b))}const{maxFramerate:_}=N("ENCODER_CONFIG_LIMIT");if(_&&typeof _=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,_):_),N("DSCP_TYPE")&&Gc()){var m;const R=N("DSCP_TYPE");rt(m=["very-low","low","medium","high"]).call(m,R)&&(c.networkPriority=R)}const g=n.getParameters(),C=(r=g.encodings)===null||r===void 0?void 0:r[0];en()&&!C&&(s.encodings=[c]),C&&Object.assign(C,c),Object.assign(g,s),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await n.setParameters(g),await async function(R,y,b){try{var I;if(!se().supportSetRtpSenderParameters||!function(j){return j==="vp9"||j==="av1"}(R)||!N("ENABLE_SVC"))return;const L={},U={},x=y.getParameters(),M=(I=x.encodings)===null||I===void 0?void 0:I[0];U.scalabilityMode=HR(b),M&&Object.assign(M,U),Object.assign(x,L),await y.setParameters(x),S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(x.encodings)))}catch(L){S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",L)}}(this.store.codec,n,N("SVC_MODE"))}async updateAdaptation(e,n){var i,r;if(!e)return S.debug("[updateAdaptation] no rtpSender found");if(!se().supportSetRtpSenderParameters)return S.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:c,frameRate:l,scaleResolutionDownBy:d}=n;c&&(s.maxBitrate=1e3*c),l&&(s.maxFramerate=jr(l)),d&&d>=1&&rt(i=["vp8","vp9"]).call(i,this.store.codec)&&(s.scaleResolutionDownBy=d);const h=e.getParameters(),p=(r=h.encodings)===null||r===void 0?void 0:r[0];p&&Object.assign(p,s),Object.assign(h,{});try{await e.setParameters(h),S.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(h.encodings)))}catch(_){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?S.debug("[updateAdaptation] peerConnection not connected}"):S.debug("[updateAdaptation] updateRtpSenderEncodings failed",_):S.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!se().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];s instanceof xe&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=vr(e);return n.forEach((s,c)=>{const l=i[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(Hf(d,s),NM(d,s,this.store.codec))}),pd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,s,c,l;const h=e[d],p=n[d];if(p instanceof xe&&!rt(i=p._hints).call(i,Ce.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},m={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];const g=h.sender.getParameters();await h.sender.setParameters(Object.assign(g,_))}}}async applySimulcastEncodings(e,n){if(!en()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof xe&&this.isVP8Simulcast(r)){const s=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,s,c;return!!(e instanceof xe&&N("SIMULCAST")&&this.store.codec==="vp8"&&!rt(n=e._hints).call(n,Ce.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(N("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(se().supportPCSetConfiguration){const n=yh.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Et(ee.prototype,"updateRemoteRTPCapabilities",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"updateRemoteRTPCapabilities"),ee.prototype),Et(ee.prototype,"connect",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"connect"),ee.prototype),Et(ee.prototype,"updateRemoteConnect",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"updateRemoteConnect"),ee.prototype),Et(ee.prototype,"createDataChannels",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"createDataChannels"),ee.prototype),Et(ee.prototype,"receive",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"receive"),ee.prototype),Et(ee.prototype,"batchReceive",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"batchReceive"),ee.prototype),Et(ee.prototype,"stopReceiving",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"stopReceiving"),ee.prototype),Et(ee.prototype,"muteRemote",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"muteRemote"),ee.prototype),Et(ee.prototype,"unmuteRemote",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"unmuteRemote"),ee.prototype),Et(ee.prototype,"muteLocal",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"muteLocal"),ee.prototype),Et(ee.prototype,"unmuteLocal",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"unmuteLocal"),ee.prototype),Et(ee.prototype,"close",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"close"),ee.prototype),Et(ee.prototype,"updateEncoderConfig",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"updateEncoderConfig"),ee.prototype),Et(ee.prototype,"updateSendParameters",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"updateSendParameters"),ee.prototype),Et(ee.prototype,"replaceTrack",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"replaceTrack"),ee.prototype),Et(ee.prototype,"updateAdaptation",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"updateAdaptation"),ee.prototype),Et(ee.prototype,"getRemoteSSRC",[cr],Object.getOwnPropertyDescriptor(ee.prototype,"getRemoteSSRC"),ee.prototype),ee);function cr(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}function QI(t,e){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=jr(e.width),i.height=jr(e.height);const r=jr(e.framerate||15);document.body.append(n),document.body.append(i);let s=t._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const c=i.getContext("2d");if(!c)throw new B(O.UNEXPECTED_ERROR,"can not get canvas context");const l=se(),d=i.captureStream(l.supportRequestFrame?0:r).getVideoTracks()[0];d.canvas||(d.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const p=n.videoWidth,_=n.videoHeight/p,m=i.width*_;Math.abs(m-i.height)>=2&&(S.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(m)),i.height=m)}c.drawImage(n,0,0,i.width,i.height),d.requestFrame&&d.requestFrame(),s!==t._mediaStreamTrack&&(s=t._mediaStreamTrack,n.srcObject=new MediaStream([s]))},i.stopCapture=oI(()=>i.startCapture&&i.startCapture(),r);const h=d.stop;return d.stop=()=>{h.call(d),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),S.debug("clean low stream renderer")},d}var fs=function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t[t.Video_Send_Type=2225]="Video_Send_Type",t}(fs||{}),Pt=function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t}(Pt||{}),ai=function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t}(ai||{}),lr=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(lr||{}),ny=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(ny||{});const dh=1e3,iy=6,hg=3,KG=Math.max(iy,hg);function Ct(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function p1(t){const e={[lr.CONN_TYPE]:0,[lr.RTT]:t.rtt,[lr.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[lr.CONN_TYPE]=1),n==="tcp"&&(e[lr.CONN_TYPE]=3),n==="tls"&&(e[lr.CONN_TYPE]=4);break}case"srflx":e[lr.CONN_TYPE]=2;break;case"unknown":e[lr.CONN_TYPE]=5;break;default:e[lr.CONN_TYPE]=0}return e}function f1(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class _1 extends Xe{constructor(e){super(),A(this,"store",void 0),A(this,"uploadWRTCStatsTimer",void 0),A(this,"uploadOutboundDenoiserStatsTimer",void 0),A(this,"uploadExtStatsTimer",void 0),A(this,"uploadExtUsageStatsTimer",void 0),A(this,"uploadInboundExtStatsTimer",void 0),A(this,"requestStats",void 0),A(this,"requestTransportStats",void 0),A(this,"requestLocalMedia",void 0),A(this,"requestRemoteMedia",void 0),A(this,"requestAllTracks",void 0),A(this,"requestVideoIsReady",void 0),A(this,"requestUploadStats",void 0),A(this,"requestUpload",void 0),A(this,"uploadOutboundStarted",!1),A(this,"uploadInboundStarted",!1),A(this,"uploadTransportStarted",!1),A(this,"uploadBaseStatsStarted",!1),A(this,"uploadExtensionUsageStarted",!1),A(this,"lastRecvStats",void 0),A(this,"lastSendStats",void 0),A(this,"lastRefRecvStats",void 0),A(this,"lastRefSendStats",void 0),A(this,"lastNormalRecvStats",void 0),A(this,"lastNormalSendStats",void 0),A(this,"needUploadRenderFreezeTime",!0),A(this,"lastUploadCompensateTime",-1),A(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;const n=e%hg==0,i=e%iy==0;let r,s;if(this.uploadTransportStarted&&(r=this.requestStats(),this.store.useP2P&&(s=this.requestStats(!0))),!r&&this.uploadOutboundStarted&&(r=this.requestStats()),!s&&this.uploadInboundStarted&&(s=this.requestStats(!0)),r||s){var c;const l={};if(this.uploadTransportStarted&&r){const h=this.getTransportStats(r,s,n);h&&(l.misc=[h])}if(this.uploadOutboundStarted&&r){const h=this.getOutboundStats(r,i?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats);h&&(l.outbound=[h])}if(this.uploadInboundStarted&&s){this.uploadCompensateStats(e);const h=this.getInboundStats(s,i?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);h&&(l.inbound=h)}const d=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;d&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[ny.RTC_PEER_CONNECTION_STATE]=zb[d]):l.misc=[{addition:{[ny.RTC_PEER_CONNECTION_STATE]:zb[d]}}]),this.requestUploadStats(l)}this.lastRecvStats=s,this.lastSendStats=r,i&&(this.lastNormalRecvStats=s,this.lastNormalSendStats=r),n&&(this.lastRefRecvStats=s,this.lastRefSendStats=r)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const r=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(r&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[ny.RTC_PEER_CONNECTION_STATE]:zb[r.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===KG+1&&(e=1)},dh)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=e%hg==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const r=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*r;const s=this.requestStats(!0);new Array(r).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const c={};if(this.uploadInboundStarted&&s){const l=this.requestRemoteMedia()||[],d=[];l.forEach(h=>{let[p,_]=h;const m={peer:p.uid};if(p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)&&_.has(ut.VIDEO)&&p.videoTrack){const g=function(C,R,y){if(!R.videoRecv.find(I=>I.ssrc===C))return;const b={};if(y&&y._player){const I=y._player,{renderFreezeAccTime2:L,videoElementStatus:U}=I;if(Ho.visibility==="visible"&&U===Li.PLAYING&&se().supportRequestVideoFrameCallback){const x=Math.min(6e3,L);I.renderFreezeAccTime2=Math.max(0,L-x),Ct(b,fs.Video_Render_Freeze_Time_Render2,x),N("USE_NEW_RENDER_FREEZE_TIME")&&Ct(b,fs.Video_Render_Freeze_Time_Render,x)}}return b}(p._videoSSRC,s,p.videoTrack);g&&(m.video=g)}m.video&&d.push(m)}),d.length>0&&(c.inbound=d,this.requestUploadStats(c))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,n,i){if(!this.requestStats)return;if(!i)return e.rtt==null?void 0:{addition:{[lr.RTT]:e.rtt,[lr.CONN_TYPE]:void 0,[lr.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};const r=p1(e);if(this.store.useP2P){if(n){const s=p1(n);r[lr.CONN_TYPE]+=s[lr.CONN_TYPE]<<3}r[lr.CONN_TYPE]+=110}else r[lr.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,n,i,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const s=this.requestLocalMedia();if(!s||s.length===0)return;let c,l,d;return s.forEach(h=>{let[p,{track:_,ssrcs:m}]=h;switch(p){case X.LocalVideoLowTrack:case X.LocalVideoTrack:if(p===X.LocalVideoTrack){const g=function(y,b,I,L,U,x){const M=b.videoSend.find(Ft=>Ft.ssrc===y);if(!M)return;const j={},{sentFrame:K,inputFrame:it}=M;if(L&&(Ct(j,fs.Video_Send_Qp_Sum,M.qpSumPerFrame),it&&K)){var dt;const Ft=it.frameRate,Vt=K.frameRate;j[fs.Video_Send_Freeze]=function(It,Ue){let Ae=!0;return Ae=!(It<=5)&&(It<=10?Ue<3:It<=20?Ue<4:Ue<5),Ae}(Ft,Vt)?1:0,j[fs.Video_Send_Type]=I.__className__==="CameraVideoTrack"?0:rt(dt=I._hints).call(dt,Ce.SCREEN_TRACK)?1:2}if(U){switch(K&&(Ct(j,Pt.Video_Send_Height,K.height),Ct(j,Pt.Video_Send_Width,K.width),Ct(j,Pt.Video_Send_Frame_Rate,K.frameRate)),j[Pt.Video_Send_Disabled]=I._originMediaStreamTrack&&!I._originMediaStreamTrack.enabled||I._mediaStreamTrack&&!I._mediaStreamTrack.enabled?1:0,M.adaptionChangeReason){case"none":j[Pt.Video_Send_Adaptation]=0;break;case"cpu":j[Pt.Video_Send_Adaptation]=1;break;case"bandwidth":j[Pt.Video_Send_Adaptation]=2;break;case"other":j[Pt.Video_Send_Adaptation]=3}let Ft=0;M.adaptionChangeReason&&(Ft+=f1(M.adaptionChangeReason)),b.qualityLimitationReason&&(Ft+=f1(b.qualityLimitationReason)<<3),j[Pt.Video_Send_Adaptation]=Ft,j[Pt.Video_Send_Player_Status]=aI[I._player?I._player.videoElementStatus:"uninit"],Ct(j,Pt.Video_Send_Nacks,M.nacksCount),Ct(j,Pt.Video_Send_Plis,M.plisCount),Ct(j,Pt.Video_Send_Firs,M.firsCount),Ct(j,Pt.Video_Send_Avg_Encode,M.avgEncodeMs),Ct(j,Pt.Video_Send_Huge_Frame_Sent,M.hugeFramesSent),Ct(j,Pt.Video_Send_Bytes_Retransmit,M.retransmittedBytesSent),Ct(j,Pt.Video_Send_Packages_Retransmit,M.retransmittedPacketsSent),Ct(j,Pt.Video_Send_Key_Frames_Encoded,M.keyFramesEncoded);const Vt=U.videoSend.find(It=>It.ssrc===y);if(Vt){let It=dh*hg;Vt.timestamp&&M.timestamp&&(It=M.timestamp-Vt.timestamp),Vt.packets!=null&&M.packets!=null&&Ct(j,Pt.Video_Send_Package_Rate,1e3*(M.packets-Vt.packets)/It),M.packetsLost!=null&&Vt.packetsLost!=null&&Ct(j,Pt.Video_Send_Package_Lost,M.packetsLost-Vt.packetsLost),Vt.bytes!=null&&M.bytes!=null&&Ct(j,Pt.Video_Send_Bitrate,8*(M.bytes-Vt.bytes)/It)}}return j}(m[0].ssrcId,e,_,n,i),C=_&&function(y,b,I,L){const U=b.videoSend.find(M=>M.ssrc===y);if(!U)return null;const x={};if(L){const M=U.inputFrame,j=M&&M.height||I.videoHeight||0,K=M&&M.width||I.videoWidth||0,it=M&&M.frameRate||0;Ct(x,Pt.Video_Capture_Height,j),Ct(x,Pt.Video_Capture_Width,K),Ct(x,Pt.Video_Capture_Frame_Rate,it)}return x}(m[0].ssrcId,e,_,!!i),R=function(y,b){const I={};return b&&(Ct(I,Pt.Video_Send_Retransmit,y.bitrate.retransmit),Ct(I,Pt.Video_Send_Target_Encoded,y.bitrate.targetEncoded),Ct(I,Pt.Video_Send_Actual_Encoded,y.bitrate.actualEncoded),Ct(I,Pt.Video_Send_Transmit,y.bitrate.transmit),Ct(I,Pt.Video_Send_Bandwidth,y.sendBandwidth)),I}(e,!!i);l=Object.assign({},g,C,R)}else d=function(g,C,R,y,b){const I=C.videoSend.find(U=>U.ssrc===g);if(!I)return;const L={};if(y){const U=I.sentFrame;U&&(Ct(L,Pt.Video_Send_Low_Height,U.height),Ct(L,Pt.Video_Send_Low_Width,U.width),Ct(L,Pt.Video_Send_Low_Frame_Rate,U.frameRate));const x=y.videoSend.find(M=>M.ssrc===g);if(x){let M=dh*iy;x.timestamp&&I.timestamp&&(M=I.timestamp-x.timestamp),x.packets!=null&&I.packets!=null&&Ct(L,Pt.Video_Send_Low_Package_Rate,1e3*(I.packets-x.packets)/M),I.packetsLost!=null&&x.packetsLost!=null&&Ct(L,Pt.Video_Send_Low_Package_Lost,I.packetsLost-x.packetsLost),x.bytes!=null&&I.bytes!=null&&Ct(L,Pt.Video_Send_Low_Bitrate,8*(I.bytes-x.bytes)/M)}}return L}(m[0].ssrcId,e,0,i);break;case X.LocalAudioTrack:c=_&&function(g,C,R,y,b,I){const L=C.audioSend.find(x=>x.ssrc===g);if(!L)return;const U={};if(b){U[Pt.Audio_Send_Disabled]=R._originMediaStreamTrack&&!R._originMediaStreamTrack.enabled||R._mediaStreamTrack&&!R._mediaStreamTrack.enabled?1:0;const x=100*R._source.getAccurateVolumeLevel(),M=L.inputLevel;if(M!=null){const K=Math.ceil(50*Math.log10(100*M+1));Ct(U,Pt.Audio_Send_Level,K)}Ct(U,Pt.Audio_Capture_PCM_Level,x),Ct(U,Pt.Audio_Send_AEC_Return_Loss,L.aecReturnLoss),Ct(U,Pt.Audio_Send_AEC_Return_Loss_Enhancement,L.aecReturnLossEnhancement),Ct(U,Pt.Audio_Send_Bytes_Retransmit,L.retransmittedBytesSent),Ct(U,Pt.Audio_Send_Packages_Retransmit,L.retransmittedPacketsSent),U[Pt.Audio_Send_Freeze]=0;const j=b.audioSend.find(K=>K.ssrc===g);if(j){let K=dh*iy;j.timestamp&&L.timestamp&&(K=L.timestamp-j.timestamp),j.bytes!=null&&L.bytes!=null&&Ct(U,Pt.Audio_Send_Bitrate,8*(L.bytes-j.bytes)/K),j.packets!=null&&L.packets!=null&&Ct(U,Pt.Audio_Send_Package_Rate,1e3*(L.packets-j.packets)/K)}}return U}(m[0].ssrcId,e,_,0,i)}}),{high:l,low:d,audio:c}}getInboundStats(e,n,i,r){if(!this.requestRemoteMedia)return;const s=this.requestRemoteMedia()||[],c=[];return s.forEach(l=>{let[d,h]=l;const p={peer:d.uid};if(h.has(ut.VIDEO)&&d.videoTrack){const _=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,m=d.videoTrack?function(g,C,R,y,b,I,L,U){const x=C.videoRecv.find(It=>It.ssrc===g);if(!x)return;const M={},{receivedFrame:j,outputFrame:K,decodeFrameRate:it}=x;Ct(M,ai.Video_Render_Frame_Rate_Decode,it),x.framesRateFirefox&&Ct(M,ai.Video_Recv_Frame_Rate,x.framesRateFirefox),j&&Ct(M,ai.Video_Recv_Frame_Rate,j.frameRate),Ct(M,ai.Video_Recv_Frame_Dropped,x.framesDroppedCount),Ct(M,ai.Video_Recv_Bytes_Retransmit,x.retransmittedBytesReceived),Ct(M,ai.Video_Recv_Packages_Retransmit,x.retransmittedPacketsReceived),Ct(M,ai.Video_Recv_Packages_Discarded,x.packetsDiscarded),Ct(M,ai.Video_Recv_Avg_Decode,x.avgDecodeMs),Ct(M,ai.Video_Recv_Avg_Processing_Delay,x.avgProcessingDelayMs),Ct(M,ai.Video_Recv_Avg_Assembly_Time,x.avgFramesAssembledFromMultiplePacketsMs),Ct(M,ai.Video_Recv_Avg_Inter_Frame_Delay,x.avgInterFrameDelayMs),Ct(M,ai.Video_Recv_Key_Frames_Decoded,x.keyFramesDecoded);const dt=U&&U.videoRecv.find(It=>It.ssrc===g);if(dt){const It=C.timestamp-U.timestamp||dh;x.packetsLost!=null&&dt.packetsLost!=null&&Ct(M,ai.Video_Recv_Package_Lost,x.packetsLost-dt.packetsLost),dt.bytes!=null&&x.bytes!=null&&Ct(M,ai.Video_Recv_Bitrate,8*(x.bytes-dt.bytes)/It),dt.packets!=null&&x.packets!=null&&Ct(M,ai.Video_Recv_Package_Rate,1e3*(x.packets-dt.packets)/It)}const Ft=I&&I.videoRecv.find(It=>It.ssrc===g);if(Ft&&(Ct(M,fs.Video_Recv_Qp_Sum,x.qpSumPerFrame),M[fs.Video_Recv_Freeze]=y&&dg.isRemoteVideoFreeze(R,x,Ft)?1:0),L){var Vt;const It=L.videoRecv.find(Ae=>Ae.ssrc===g);j?(Ct(M,Pt.Video_Recv_Height,j.height),Ct(M,Pt.Video_Recv_Width,j.width)):R&&(Ct(M,Pt.Video_Recv_Height,R._videoHeight||0),Ct(M,Pt.Video_Recv_Width,R._videoWidth||0)),K&&Ct(M,Pt.Video_Recv_Frame_Rate_Output,K.frameRate);const Ue=(Vt=R._player)===null||Vt===void 0?void 0:Vt.rendFrameRate.toFixed(0);if(Ue&&Ct(M,Pt.Video_Render_Frame_Rate_Render,+Ue),Ct(M,Pt.Video_Recv_Jitter_Buffer,x.jitterBufferMs),Ct(M,Pt.Video_Recv_Current_Delay,x.currentDelayMs),Ct(M,Pt.Video_Recv_Firs,x.firsCount),Ct(M,Pt.Video_Recv_Nacks,x.nacksCount),Ct(M,Pt.Video_Recv_Plis,x.plisCount),R){M[Pt.Video_Recv_Disabled]=R._originMediaStreamTrack.enabled&&R._mediaStreamTrack.enabled?0:1;const Ae=R._player;if(Ae){const{freezeTimeCounterList:ur,renderFreezeAccTime:z,renderFreezeAccTime2:$,videoElementStatus:ft}=Ae;if(ur&&ur.length>0&&Ct(M,fs.Video_Render_Freeze_Time,ur.splice(0,1)[0]),b&&Ho.visibility==="visible"&&ft===Li.PLAYING&&se().supportRequestVideoFrameCallback){const Y=Math.min(6e3,$);Ae.renderFreezeAccTime2=Math.max(0,$-Y),Ct(M,fs.Video_Render_Freeze_Time_Render2,Y);const v=Math.min(6e3,z);Ae.renderFreezeAccTime=Math.max(0,z-v),Ct(M,fs.Video_Render_Freeze_Time_Render,N("USE_NEW_RENDER_FREEZE_TIME")?Y:v)}if(typeof x.totalFreezesDuration=="number"){const Y=It&&It.totalFreezesDuration?x.totalFreezesDuration-It.totalFreezesDuration:x.totalFreezesDuration;Ct(M,Pt.Video_Render_Freeze_Duration,1e3*Y)}}}if(M[Pt.Video_Recv_Player_Status]=aI[R._player?R._player.videoElementStatus:"uninit"],It&&x.totalInterFrameDelay!==void 0&&x.totalSquaredInterFrameDelay!==void 0&&It.totalInterFrameDelay!==void 0&&It.totalSquaredInterFrameDelay!==void 0){const Ae=x.totalInterFrameDelay-It.totalInterFrameDelay,ur=x.totalSquaredInterFrameDelay-It.totalSquaredInterFrameDelay,z=x.framesDecodeCount-It.framesDecodeCount,$=Ae/z*1e3,ft=Math.round(1e3*Math.sqrt((ur-Math.pow(Ae,2)/z)/z));!isNaN(ft)&&$+ft>Math.max(3*$,$+150)&&(M[Pt.Video_Recv_I_Frame_Delay]=ft)}}return M}(d._videoSSRC,e,d.videoTrack,_===!0,this.needUploadRenderFreezeTime,n,i,r):void 0;m&&(p.video=m)}if(h.has(ut.AUDIO)&&d.audioTrack){const _=d.audioTrack?function(m,g,C,R,y,b){const I=g.audioRecv.find(M=>M.ssrc===m);if(!I)return;const L={};Ct(L,ai.Audio_Recv_Jitter,I.jitterMs),Ct(L,ai.Audio_Recv_Bytes_Retransmit,I.retransmittedBytesReceived),Ct(L,ai.Audio_Recv_Packages_Retransmit,I.retransmittedPacketsReceived),Ct(L,ai.Audio_Recv_Packages_Discarded,I.packetsDiscarded),Ct(L,ai.Audio_Recv_Avg_Processing_Delay,I.avgProcessingDelayMs);const U=b&&b.audioRecv.find(M=>M.ssrc===m);if(U){const M=dh;I.packets!=null&&U.packets!=null&&Ct(L,ai.Audio_Recv_Package_Rate,1e3*(I.packets-U.packets)/M),I.packetsLost!=null&&U.packetsLost!=null&&Ct(L,ai.Audio_Recv_Package_Lost,I.packetsLost-U.packetsLost)}if(R){const{receivedFrames:M,droppedFrames:j}=I;M!=null&&j!=null&&(L[fs.Audio_Recv_Freeze]=(x=M)===0||100*j/x>20?1:0)}var x;if(y){const M=100*C._source.getAccurateVolumeLevel(),j=I.outputLevel;if(j!=null){const it=Math.ceil(50*Math.log10(100*j+1));Ct(L,Pt.Audio_Render_Level,it)}Ct(L,Pt.Audio_Recv_PCM_Level,M),C&&(L[Pt.Audio_Recv_Disabled]=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?0:1),Ct(L,Pt.Audio_Recv_Jitter_Buffer,I.jitterBufferMs),Ct(L,Pt.Audio_Recv_Current_Delay,I.jitterBufferMs),L[Pt.Audio_Recv_Player_Status]=aI[or.getPlayerState(C.getTrackId())];const K=y.audioRecv.find(it=>it.ssrc===m);if(K){K.bytes!=null&&I.bytes!=null&&Ct(L,Pt.Audio_Recv_Bitrate,8*(I.bytes-K.bytes)/(dh*hg));const it=I.concealedSamples-K.concealedSamples;it>0&&Ct(L,Pt.Audio_Recv_Concealed_Samples,it);const dt=I.totalSamplesReceived-K.totalSamplesReceived;dt>0&&Ct(L,Pt.Audio_Recv_Total_Samples_Received,dt);const Ft=I.freezeSamples80-K.freezeSamples80;Ft>0&&Ct(L,Pt.Audio_Render_Freeze_Samples_80ms,Ft);const Vt=I.freezeSamples200-K.freezeSamples200;Vt>0&&Ct(L,Pt.Audio_Render_Freeze_Samples_200ms,Vt);const It=I.freezeMs80-K.freezeMs80;Ct(L,Pt.Audio_Render_Freeze_Time_80ms,It<0?0:It);const Ue=I.freezeMs200-K.freezeMs200;Ct(L,Pt.Audio_Render_Freeze_Time_200ms,Ue<0?0:Ue)}}return L}(d._audioSSRC,e,d.audioTrack,n,i,r):void 0;_&&(p.audio=_)}(p.video||p.audio)&&c.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof ZE);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(tg.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,i]=e;i.has(ut.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)}),i.has(ut.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),i={connectionInterval:N("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let r=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const h of s)!h.muted&&h.enabled&&(r=r.concat(await h.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[h,p]of c)p.has(ut.VIDEO)&&h.videoTrack&&(r=r.concat(await h.videoTrack.getProcessorUsage())),p.has(ut.AUDIO)&&h.audioTrack&&(r=r.concat(await h.audioTrack.getProcessorUsage()));if(r.length===0)return;i.details=function(h,p){const _={};for(const{id:R,value:y,level:b,direction:I}of h){var m;const L=(m=p.get(R))!==null&&m!==void 0?m:0,U=y===2?L+N("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:L;var g,C;p.set(R,U),_[R]?(y===2&&(_[R].value=y),b>_[R].level&&(_[R].level=b),I==="remote"&&(_[R].remoteUidCount+=1),_[R].totalTs=(g=p.get(R))!==null&&g!==void 0?g:0):_[R]={value:y,level:b,remoteUidCount:I==="local"?0:1,totalTs:(C=p.get(R))!==null&&C!==void 0?C:0}}return Object.keys(_).map(R=>{const{level:y,value:b,totalTs:I}=_[R];return{id:R,level:y,value:b,totalTs:I}})}(r,e);const l=Date.now(),d=l>n?l:n+1;this.requestUpload&&this.requestUpload(tg.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:d})},N("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const zG=N("ICE_RESTART_INTERVAL");let ry=new Map,qf=new Map,vd=[Ri.UDP_TCP_RELAY,Ri.TCP_RELAY,Ri.RELAY],ZI=N("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&se().supportPCSetConfiguration;function m1(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=ry.get(t.id);n&&(window.clearTimeout(n),ry.delete(t.id));const i=qf.get(t.id);e&&i&&i.index===vd.length-1&&(S.debug("[".concat(t.id,"] reset ICE restart policy")),qf.delete(t.id))}function E1(t,e,n){if(ry.size===0&&qf.size===0&&(Array.isArray(N("RESTART_SEQUENCE"))&&N("RESTART_SEQUENCE").length>0&&!function(l,d){if(l.length!==d.length)return!1;for(let h=0;h<l.length;h+=1){const p=l[h];if(l.filter(_=>_===p).length!==d.filter(_=>_===p).length)return!1}return!0}(vd,N("RESTART_SEQUENCE"))&&(vd=N("RESTART_SEQUENCE").filter(l=>{var d;if(rt(d=Object.values(Ri)).call(d,l))return!0}),S.debug("use reconnection policy from config distribution, queues: ".concat(vd.join(" => ")))),ZI=N("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&se().supportPCSetConfiguration),vd.length===0)return void n();let i,{index:r=0,type:s}=qf.get(t.id)||{};if(ZI&&s===Ri.RELAY)return void n();let c=s&&r>=vd.length-1;if(ZI)s=Ri.RELAY;else{if(c)return void n();s?(r++,s=vd[r]):(s=vd[0],r=0)}S.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(r)),e(s),qf.set(t.id,{index:r,type:s}),i=window.setTimeout(()=>E1(t,e,n),zG),ry.set(t.id,i)}var Kt;function g1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function qo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?g1(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function S1(t){var e,n,i,r=2;for(typeof Symbol<"u"&&(n=Tb,i=Symbol.iterator);r--;){if(n&&(e=t[n])!=null)return e.call(t);if(i&&(e=t[i])!=null)return new ay(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function ay(t){function e(n){if(Object(n)!==n)return st.reject(new TypeError(n+" is not an object."));var i=n.done;return st.resolve(n.value).then(function(r){return{value:r,done:i}})}return ay=function(n){this.s=n,this.n=n.next},ay.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?st.resolve({value:n,done:!0}):e(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?st.reject(n):e(i.apply(this.s,arguments))}},new ay(t)}let pg=(Kt=class extends Xe{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(vt.StateChange,e,this._state)}constructor(t,e){super(),A(this,"isPlanB",void 0),A(this,"store",void 0),A(this,"statsUploader",void 0),A(this,"connection",void 0),A(this,"localTrackMap",new Map),A(this,"remoteUserMap",new Map),A(this,"localDataChannels",[]),A(this,"remoteDataChannelMap",new Map),A(this,"pendingLocalTracks",[]),A(this,"pendingRemoteTracks",[]),A(this,"pendingLocalDataChannels",[]),A(this,"pendingRemoteDataChannels",[]),A(this,"statsCollector",void 0),A(this,"shouldForwardP2PCreation",void 0),A(this,"iceFailedCount",0),A(this,"dtlsFailedCount",0),A(this,"mutex",void 0),A(this,"_state",me.Disconnected),A(this,"_pcStatsUploadType",N("NEW_ICE_RESTART")?qc.FIRST_CONNECTION:qc.OLD_FIRST_CONNECTION),A(this,"_isStartRestartIce",!1),A(this,"_restartTimer",void 0),A(this,"_isTryConnecting",!1),A(this,"_iceError",null),A(this,"_forceTurn",!1),A(this,"_isWaitPcToRePub",!1),A(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==me.Connected)return void r(new G(O.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const d=this.createMuteMessage(c);await Ie(this,vt.RequestMuteLocal,d),i()}catch(c){r(c)}finally{s()}}),A(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==me.Connected)return void r(new G(O.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const l=c.find(h=>h[0]==="videoLowTrack");if(l){const h=l[1];if(h.track._originMediaStreamTrack.stop(),!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&se().supportDualStreamEncoding){const p=n._mediaStreamTrack.clone();h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}else{const p=QI(n,zE(this,vt.RequestLowStreamParameter));h.track._mediaStreamTrack=p,h.track._originMediaStreamTrack=p}await new st((p,_)=>{this.handleReplaceTrack(h.track,p,_,!0)})}await this.connection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const d=this.createUnmuteMessage(c);await Ie(this,vt.RequestUnmuteLocal,d),i()}catch(c){r(c)}finally{s()}}),A(this,"handleUpdateVideoEncoder",async(n,i,r,s)=>{let c;s||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(X.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==me.Connected)return void i();const{id:h,track:p}=d;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(vt.UpdateVideoEncoder,p),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),A(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(X.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==me.Connected)return void i();const{id:l,track:d}=c;await this.connection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{s()}}),A(this,"handleReplaceMixingTrack",async(n,i,r,s)=>{if(!this.connection||this.state!==me.Connected)return void i();const c=XI([n]);let l;S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof s=="boolean"&&s||(l=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),i()}catch(h){r(h)}finally{var d;(d=l)===null||d===void 0||d()}}),A(this,"handleReplaceTrack",async(n,i,r,s)=>{let c;S.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return n===_});if(!this.connection||!h||this.state!==me.Connected)return void i();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),this.isPlanB){const p=h[1];p.id=n._mediaStreamTrack.id,this.localTrackMap.set(h[0],p)}if(h[0]===X.LocalVideoTrack&&!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&se().supportDualStreamEncoding){const p=this.localTrackMap.get(X.LocalVideoLowTrack);if(p){const _=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new st((m,g)=>{this.handleReplaceTrack(p.track,m,g,!0)})}}i()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),A(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),A(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),A(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),A(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),A(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new _1(this.store),this.bindStatsUploaderEvents(),this.mutex=new Ti("P2PChannel-mutex",this.store.clientId),this.isPlanB=!se().supportUnifiedPlan||N("CHROME_FORCE_PLAN_B")&&Gc(),this.shouldForwardP2PCreation=N("FORWARD_P2P_CREATION")&&se().supportPCSetConfiguration&&Lb(),this.shouldForwardP2PCreation&&(this.connection=ey(this.store),this.emit(vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=me.New,this._forceTurn=u1(t),S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=ey(this.store,t),this.emit(vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new G(O.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=N("NEW_ICE_RESTART")?qc.FIRST_CONNECTION:qc.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new G(O.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");N("ENABLE_PREALLOC_PC")&&this.state===me.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=me.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(r=>{var s;let[c]=r;return rt(s=[X.LocalVideoLowTrack,X.LocalVideoTrack]).call(s,c)}),n=e.map(r=>{let[,{id:s}]=r;return s}),i=e.map(r=>{let[s]=r;return s});if(this.connection instanceof Yo){if(gt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!rt(t).call(t,this.store.codec)){const r=["vp9","vp8","h264"].find(s=>rt(t).call(t,s));r&&(this.store.codec=r,S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(r,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof Yo&&this.connection.peerConnectionState!=="closed"&&rt(t=[me.New,me.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==me.Connected){if(this.state===me.Disconnected)throw new G(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var i;rt(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var i=this;return Oa(function*(){const r=yield re(i.mutex.lock("From P2PChannel.publish"));try{var s;const c=i.connection&&rt(s=["disconnected","failed"]).call(s,i.connection.peerConnectionState);if(!i.connection||i.state!==me.Connected||c){if(i.state===me.Disconnected)throw new G(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(t);const d=t.filter(h=>i.pendingLocalTracks.indexOf(h)===-1);return i.pendingLocalTracks=i.pendingLocalTracks.concat(d),void(c&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,yi.markPublishStart(i.store.clientId,i.store.pubId);const l=i.filterTobePublishedTracks(t,e,n);if(l.length===0)return void(yield re(i.tryToUnmuteAudio(t)));yield*eR(S1(i.doPublish(i.connection,l)))}finally{r()}})()}doPublish(t,e){var n=this;return Oa(function*(){e.forEach(m=>{let{track:g,type:C}=m;const R=Date.now();n.store.publish(g.getTrackId(),C===X.LocalAudioTrack?"audio":"video",R)}),n.bindLocalTrackEvents(e);const i=e.map(m=>{let{track:g}=m;return g}),r=yield re(t.send(i,n.store.codec,n.store.audioCodec)),s=(yield re(r.next())).value,c=n.createGatewayPublishMessage(e,s);let l;try{l=yield c}catch(m){throw r.throw(m),(m==null?void 0:m.code)===O.WS_ABORT&&e.forEach(g=>{let{track:C}=g;n.pendingLocalTracks.indexOf(C)===-1&&n.pendingLocalTracks.push(C)}),n.unbindLocalTrackEvents(e),m}const d=n.mapPubResToRemoteConfig(c,l,i),h=(yield re(r.next(d))).value;if(n.state===me.Disconnected)throw new G(O.UNEXPECTED_ERROR,"PeerConnection already disconnected.");N("ENABLE_VIDEO_SEI");const p=N("ENABLE_ENCODED_TRANSFORM"),_=N("ENABLE_AUDIO_METADATA");i.forEach(async m=>{const g=m.getRTCRtpTransceiver();if(!g||!p)return;const{interceptLocalVideoFrame:C,interceptLocalAudioFrame:R}=qR();m.trackMediaType===ut.VIDEO?await C(g.sender,m):m.trackMediaType===ut.AUDIO&&await R(g.sender,{metadata:_?()=>{const y=m.metadata.shift();return y&&y.value}:void 0})}),e.forEach(m=>{let{type:g}=m;n.statsCollector.addLocalStats(g)}),n.assignLocalTracks(e,h),n.statsUploader.startUploadOutboundStats(),e.forEach(m=>{let{track:g,type:C}=m;const R=Date.now();n.store.publish(g.getTrackId(),C===X.LocalAudioTrack?"audio":"video",void 0,R)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n||!this.connection)return;if(!(n.track instanceof xe))return S.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,r=function(s,c){const l={};return s.height&&s.width&&(l.scaleResolutionDownBy=PI(s,c)),l.maxFramerate=s.framerate?jr(s.framerate):void 0,l.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,l}(t,i);if(i._encoderConfig||(i._encoderConfig={}),e!==X.LocalVideoLowTrack||!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&se().supportDualStreamEncoding)r.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const s=i._originMediaStreamTrack;if(!s.canvas)return S.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(c,l){const d=c.canvas;l.width&&(d.width=jr(l.width)),l.height&&(d.height=jr(l.height)),l.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=oI(()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()},jr(l.framerate)))})(s,t)}r.maxBitrate!=null&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),r.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),S.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(t){var e=this;return Oa(function*(){if(!e.connection||e.state!==me.Connected)return;const n=yield re(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(X.LocalVideoTrack);if(!r)throw new G(O.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(X.LocalVideoLowTrack))throw new G(O.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:e.getLowVideoTrack(r.track,t),type:X.LocalVideoLowTrack}];if(yield*eR(S1(e.doPublish(e.connection,s))),r.track.muted||!r.track.enabled){var i;const c=(i=e.localTrackMap.get(X.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield re(e.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ui(this,vt.RequestRePublish,this.pendingLocalTracks),this.emit(vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(S.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ui(this,vt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:i}=this.pendingRemoteTracks[e];(i!==ut.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==ut.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await ui(this,vt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===ut.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(vt.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==me.Connected)return void t.forEach(i=>{const r=this.pendingLocalTracks.indexOf(i);r!==-1&&this.pendingLocalTracks.splice(r,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==me.Connected)return void t.forEach(n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==me.Connected)return;const t=this.localTrackMap.get(X.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[X.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(i=>{let[,{id:r}]=i;return r})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[r,{track:s}]=i;return{type:r,track:s}})),e.forEach(i=>{let[r]=i;this.statsCollector.removeLocalStats(r)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==me.Connected)throw new G(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(i=>{var r;return!((r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.get(i.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(i=>{var r;this.remoteDataChannelMap.has(t)?(r=this.remoteDataChannelMap.get(t))===null||r===void 0||r.set(i.id,i):this.remoteDataChannelMap.set(t,new Map([[i.id,i]]));const s=this.pendingRemoteDataChannels.findIndex(c=>{let{user:l,id:d}=c;return l.uid===t.uid&&d===i.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(i=>i.id)}async subscribe(t,e,n,i,r){var s;if(!this.connection||this.state!==me.Connected)throw new G(O.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(t))!==null&&s!==void 0&&s.has(e))return;let c,l,d;const h=this.connection.getPreMedia(n);if(h)S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),d=h.transceiver,c=h.track,l=h.id;else if(r){const m=r.find(C=>{let{stream_type:R}=C;return R===e});if(!m)throw new G(O.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const g=await this.connection.receive(e,m.ssrcs,String(t._uintid),m.attributes);this.connection instanceof Yo&&(d=g.transceiver),c=g.track,l=g.id}else{const m=await this.connection.receive(e,[{ssrcId:n,rtx:i}],String(t._uintid),void 0);this.connection instanceof Yo&&(d=m.transceiver),c=m.track,l=m.id}if(e===ut.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(c):(t._audioTrack=new Mf(c,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),d&&t._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(c):(t._videoTrack=new kf(c,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),d&&t._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(t,t._videoTrack)),d&&N("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:m,interceptRemoteAudioFrame:g}=qR();e==ut.VIDEO?await m(d.receiver,{onSei:N("ENABLE_VIDEO_SEI")&&(C=>{var R;return(R=t._videoTrack)===null||R===void 0?void 0:R._onSei(C)})}):e==ut.AUDIO&&await g(d.receiver,{enableTopn:!!N("ENABLE_AUDIO_TOPN"),enableMetadata:!!N("ENABLE_AUDIO_METADATA"),onMetadata:C=>{this.safeEmit(vt.AudioMetadata,C)}})}const p=this.remoteUserMap.get(t);p?p.set(e,l):this.remoteUserMap.set(t,new Map([[e,l]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const _=this.pendingRemoteTracks.findIndex(m=>{let{user:g,kind:C}=m;return g.uid===t.uid&&e===C});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(vt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==me.Connected)throw new G(O.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(r=>{var s;let{user:c,mediaType:l}=r;return!((s=this.remoteUserMap.get(c))!==null&&s!==void 0&&s.has(l))});const e=[],n=new Map;t.forEach(r=>{if(!this.connection)return;const s=this.connection.getPreMedia(r.ssrcId);s?n.set(r.ssrcId,s):e.push(r)});const i=await this.connection.batchReceive(e.map(r=>{let{user:s,mediaType:c,ssrcId:l,rtxSsrcId:d}=r;return{kind:c,ssrcMsg:[{ssrcId:l,rtx:d}],mslabel:String(s._uintid)}}));e.forEach((r,s)=>{n.set(r.ssrcId,i[s])});for(const{user:r,mediaType:s,ssrcId:c}of t){const l=n.get(c);if(!l)return void S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(r.uid," subscribe data,").concat(s,", ").concat(c));const{track:d,id:h,transceiver:p}=l;if(p&&N("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:g,interceptRemoteAudioFrame:C}=qR();s==ut.VIDEO?await g(p.receiver,{onSei:N("ENABLE_VIDEO_SEI")&&(R=>{var y;return(y=r._videoTrack)===null||y===void 0?void 0:y._onSei(R)})}):s==ut.AUDIO&&await C(p.receiver,{enableTopn:!!N("ENABLE_AUDIO_TOPN"),enableMetadata:!!N("ENABLE_AUDIO_METADATA"),onMetadata:R=>{this.safeEmit(vt.AudioMetadata,R)}})}if(s===ut.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(d):(r._audioTrack=new Mf(d,r.uid,r._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),p&&r._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(d):(r._videoTrack=new kf(d,r.uid,r._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),p&&r._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(r,r._videoTrack)),N("ENABLE_VIDEO_SEI")&&p){const{interceptRemoteVideoFrame:g,interceptRemoteAudioFrame:C}=qR();s==ut.VIDEO?await g(p.receiver,{onSei:R=>{var y;(y=r._videoTrack)===null||y===void 0||y._onSei(R)}}):s==ut.AUDIO&&await C(p.receiver)}const _=this.remoteUserMap.get(r);_?_.set(s,h):this.remoteUserMap.set(r,new Map([[s,h]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();const m=this.pendingRemoteTracks.findIndex(g=>{let{user:C,kind:R}=g;return C.uid===r.uid&&s===R});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(vt.MediaReconnectEnd,r.uid))}}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:d}=c;return e!==void 0?l.uid===t.uid&&e===d:l.uid===t.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===me.Connected||n||i.forEach(c=>{let{kind:l}=c;var d;if(l===ut.AUDIO)(d=t._audioTrack)===null||d===void 0||d._destroy(),t._audioTrack=void 0;else if(l===ut.VIDEO){var h;(h=t._videoTrack)===null||h===void 0||h._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==me.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(r.length===0)return;await this.connection.stopReceiving(r.map(c=>{let[,{id:l}]=c;return l}));const s=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(c=>{let[l,{kind:d}]=c;var h,p;if(d===ut.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===ut.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0);else if(d===ut.AUDIO){var _;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((_=l._audioTrack)===null||_===void 0||_._destroy(),l._audioTrack=void 0)}}),s}async unsubscribeDataChannel(t,e){if(e.forEach(r=>{const s=this.pendingRemoteDataChannels.findIndex(c=>c.id===r.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(r=>{r._close()});const i=this.remoteDataChannelMap.get(t);return n.forEach(r=>{i&&i.delete(r.id)}),i&&i.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(r=>r.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:r,mediaType:s}of t){const c=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:h}=l;return s!==void 0?d.uid===r.uid&&s===h:d.uid===r.uid});c.forEach(l=>{const d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),e=e.concat(c)}if(!this.connection||this.state!==me.Connected)return void e.forEach(r=>{let{user:s,kind:c}=r;var l;if(c===ut.AUDIO)(l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0;else if(c===ut.VIDEO){var d;(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0}});const n=_r(t).call(t,(r,s)=>{let{user:c,mediaType:l}=s;const d=this.filterTobeUnSubscribedTracks(c,l);return r.concat(d)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(r=>{let[,{id:s}]=r;return s}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(r=>{let[s,{kind:c}]=r;var l,d;if(c===ut.VIDEO&&s._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),c===ut.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0;else if(c===ut.AUDIO){var h;this.unbindRemoteTrackEvents(s._audioTrack),(h=s._audioTrack)===null||h===void 0||h._destroy(),s._audioTrack=void 0}}),i}isPreSubScribe(t){return!this.connection||this.state!==me.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===ut.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}addAudioMetadata(t){const e=this.localTrackMap.get(X.LocalAudioTrack),n=e&&e.track;n&&n.metadata.push(t)}getAllTracks(t){const e=this.localTrackMap.get(X.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Dn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==X.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===X.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===X.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(X.LocalAudioTrack),l=i?this.localTrackMap.get(X.LocalVideoLowTrack):this.localTrackMap.get(X.LocalVideoTrack);gt.publish(this.store.sessionId,{eventElapse:yi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Ce.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const c=n.find(d=>d instanceof sn),l=i?(s=this.localTrackMap.get(X.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(d=>d instanceof xe);gt.publish(this.store.sessionId,{eventElapse:yi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Ce.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===ut.VIDEO?n._videoSSRC:n._audioSSRC;r&&gt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===ut.VIDEO,audio:i===ut.AUDIO,peerid:n.uid,subscribeRequestid:r,p2pid:this.store.p2pId,eventElapse:yi.measureFromSubscribeStart(this.store.clientId,r),preSsrc:this.isPreSubScribe(r)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Ti("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=ey(this.store),this.emit(vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(X.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Dn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=me.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(X.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(X.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof xe||e&&e.track instanceof sn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(ia(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(X.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Mt(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.connection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=me.Reconnecting,N("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=ey(this.store),this.emit(vt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case X.LocalVideoTrack:rt(e=i._hints).call(e,Ce.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case X.LocalAudioTrack:i instanceof Dn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case X.LocalVideoLowTrack:}}),this.emit(vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ia(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(vt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ia(n).call(n)).forEach(i=>{this.setPendingRemoteDataChannel(e,i)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((t instanceof Td?t.uid:t)===i.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof Td?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return Oa(function*(){if(!e.connection||e.state!==me.Connected)return;const n=yield re(e.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield re(e.connection.restartICE(t));const s=yield re(i.next());if(s.done)return;const c=s.value,l=yield c;switch(JI(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),t){case Ri.UDP_TCP_RELAY:e._pcStatsUploadType=qc.UDP_TCP_RESTART;break;case Ri.TCP_RELAY:e._pcStatsUploadType=qc.TCP_RESTART;break;case Ri.RELAY:e._pcStatsUploadType=qc.RELAY_RESTART;break;default:e._pcStatsUploadType=qc.OLD_RESTART}e._isTryConnecting=!0,i.next(l)}catch(s){var r;(r=i)===null||r===void 0||r.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(X.LocalVideoTrack),n=this.localTrackMap.get(X.LocalAudioTrack),i=t.videoSend.find(g=>g.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),r=t.audioSend.find(g=>g.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!r)return 1;const s=ea(this,vt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,m=e==null?void 0:e.track;if(m&&m._encoderConfig&&m._hints.indexOf(Ce.SCREEN_TRACK)===-1){const g=m._encoderConfig.bitrateMax,C=t.bitrate.actualEncoded;if(g&&C){const R=(1e3*g-C)/(1e3*g);return iM[R<.15?0:R<.3?1:R<.45?2:R<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,c=t.audioRecv.find(C=>C.ssrc===r),l=t.videoRecv.find(C=>C.ssrc===s);if(!c&&!l)return void(e+=1);const d=ea(this,vt.NeedSignalRTT),h=t.rtt,p=(h&&d?(h+d)/2:h||d)||0,_=c?c.jitterMs:void 0,m=t.recvPacketLossRate;let g=.7*m*100/50+.3*p/1500;_&&(g=.6*m*100/50+.2*p/1500+.2*_/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new st((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(S.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==me.Connected)return;const i=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:c}]=s;return t===c});if(!i)return;const r=i[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:r}]),this.bindLocalTrackEvents([{track:e,type:r}]),i[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,i[1].id)),this.isPlanB){const s=i[1];s.id=e._mediaStreamTrack.id,this.localTrackMap.set(r,s)}if(r===X.LocalVideoTrack&&!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&se().supportDualStreamEncoding){const s=this.localTrackMap.get(X.LocalVideoLowTrack);if(s){const c=t._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=c,s.track._originMediaStreamTrack=c,await new st((l,d)=>{this.handleReplaceTrack(s.track,l,d,!0)})}}}filterTobePublishedTracks(t,e,n){const i=[],r=this.getAllTracks();t=vf(t=t.filter(d=>r.indexOf(d)===-1));let s,c=!1;const l=this.localTrackMap.get(X.LocalAudioTrack);for(const d of t){if(d instanceof xe&&(this.localTrackMap.has(X.LocalVideoTrack)||c?new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:X.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(d,n);i.push({track:h,type:X.LocalVideoLowTrack})}if(d instanceof sn)if(l){const h=l.track;if(h instanceof Dn)qI([d]),h.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{const p=XI([h,d]);S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(h,p)}}else s instanceof Dn?(qI([d]),s.addAudioTrack(d)):s||!d._useAudioElement&&se().webAudioMediaStreamDest&&!d._bypassWebAudio?s=XI(s?[d,s]:[d]):s=d}return s&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),i.push({track:s,type:X.LocalAudioTrack})),i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=vf(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof sn){const r=this.localTrackMap.get(X.LocalAudioTrack);if(!r)continue;r.track instanceof Dn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([X.LocalAudioTrack,r]),r.track.close())):e.push([X.LocalAudioTrack,r])}if(i instanceof xe){const r=this.localTrackMap.get(X.LocalVideoTrack);if(!r)continue;e.push([X.LocalVideoTrack,r]);const s=this.localTrackMap.get(X.LocalVideoLowTrack);s&&e.push([X.LocalVideoLowTrack,s])}}return e}filterTobePublishedDataChannels(t){return t=(t=vf(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=vf(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case X.LocalVideoTrack:n.addListener(_t.GET_STATS,this.handleGetLocalVideoStats),n.addListener(_t.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(_t.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(_t.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case X.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case X.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof Dn?t.trackList.forEach(n=>{n.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(_t.GET_STATS,this.handleGetLocalAudioStats),n.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(_t.GET_STATS,this.handleGetLocalAudioStats),t.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(_t.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case X.LocalVideoTrack:n.off(_t.GET_STATS,this.handleGetLocalVideoStats),n.off(_t.GET_RTC_STATS,this.handleGetRTCStats),n.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(_t.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(_t.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case X.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case X.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Dn?t.trackList.forEach(e=>{e.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(_t.GET_STATS,this.handleGetLocalAudioStats),e.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(_t.GET_STATS,this.handleGetLocalAudioStats),t.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(_t.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof kf&&e.addListener(_t.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Mf&&e.addListener(_t.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(_t.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(ut.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(ut.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let s,c,{track:l,type:d}=n;switch(d){case X.LocalAudioTrack:s=Ee.Audio,c={dtx:l instanceof ZE&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case X.LocalVideoTrack:s=rt(r=l._hints).call(r,Ce.SCREEN_TRACK)?Ee.Screen:Ee.High,c=qo(qo({},SM(l)),{},{codec:this.store.codec,svc_mode:HR()});break;case X.LocalVideoLowTrack:s=Ee.Low,c=qo(qo({},SM(l)),{},{codec:this.store.codec,svc_mode:HR()})}return{stream_type:s,attributes:c,ssrcs:e[i]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case X.LocalVideoTrack:i=rt(n=s._hints).call(n,Ce.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case X.LocalAudioTrack:i=Ee.Audio;break;case X.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(vt.PeerConnectionStateChange,e),e==="connecting"&&t instanceof Yo&&!en()&&N("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&t.extendCandidate()},N("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Yo&&m1(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=qc.DISCONNECTED_OR_FAILED,ea(this,vt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map(r=>r.getTrackId()),i=this.pendingLocalDataChannels.map(r=>"dc_".concat(r.id));gt.reportApiInvoke(this.store.sessionId,{name:vn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:rn.TRACER}).onSuccess(),this.republish()}if(N("NEW_ICE_RESTART")&&t instanceof Yo&&!en()&&!this._forceTurn){if(rt(pM).call(pM,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=r=>{JI(t)&&(S.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(r)),ea(this,vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(vt.RequestRestartICE,r))},i=()=>{JI(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),S.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{E1(t,n,i)},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&N("ICE_RESTART")&&ea(this,vt.QueryClientConnectionState)==="CONNECTED"&&this.emit(vt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(vt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(vt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),gt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:rn.TRACER}).onSuccess(),this.emit(vt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(ia(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(wf.FIRST_FRAME_DECODED),gt.firstRemoteFrame(this.store.sessionId,jn.FIRST_AUDIO_DECODE,We.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(ia(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&gt.firstRemoteFrame(this.store.sessionId,jn.FIRST_AUDIO_RECEIVED,We.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(ia(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&gt.firstRemoteFrame(this.store.sessionId,jn.FIRST_VIDEO_RECEIVED,We.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(vt.ConnectionTypeChange,i),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ed(n))," -> ").concat(JSON.stringify(Ed(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ed(n))," -> ").concat(JSON.stringify(Ed(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return qo(qo({},e),n)},t.onICECandidateError=e=>{this._iceError=e}}resetConnection(t){t instanceof Yo&&function(e){qf.delete(e.id),m1(e)}(t),t.close(),this.emit(vt.PeerConnectionStateChange,"closed"),function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(X.LocalAudioTrack);if(t instanceof sn&&(n==null?void 0:n.track)instanceof Dn)return n.track.isActive||e.push([X.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i&&(e.push(i),i[0]===X.LocalVideoTrack)){const r=this.localTrackMap.get(X.LocalVideoLowTrack);r&&e.push([X.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(X.LocalAudioTrack);if(t instanceof sn&&(n==null?void 0:n.track)instanceof Dn)return n.track.isActive&&e.push([X.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i)if(i[0]===X.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(X.LocalVideoLowTrack);r&&e.push([X.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case X.LocalAudioTrack:i=Ee.Audio;break;case X.LocalVideoTrack:i=rt(n=s._hints).call(n,Ce.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case X.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case X.LocalAudioTrack:i=Ee.Audio;break;case X.LocalVideoTrack:i=rt(n=s._hints).call(n,Ce.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case X.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,c]=r;n.push([t,{kind:s,id:c}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(i=>{var r;(r=this.remoteDataChannelMap.get(t))!==null&&r!==void 0&&r.has(i.id)&&n.push(i)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case ut.VIDEO:return void(i._videoSSRC&&e.push({stream_type:ut.VIDEO,ssrcId:i._videoSSRC}));case ut.AUDIO:return void(i._audioSSRC&&e.push({stream_type:ut.AUDIO,ssrcId:i._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[i,{kind:r}]=n;if(e.has(i)){let s=e.get(i);r===ut.VIDEO?s|=Gn.Video:s|=Gn.Audio,e.set(i,s)}else r===ut.VIDEO?e.set(i,Gn.Video):e.set(i,Gn.Audio)}),{users:Array.from(e.entries()).map(n=>{let[i,r]=n;return{stream_id:i.uid,stream_type:r}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(X.LocalVideoTrack),n=this.localTrackMap.get(X.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new st((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new st((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e,n){return t.map((i,r)=>{var s;let{stream_type:c}=i;const l=(s=e.find(d=>{let{stream_type:h}=d;return c===h}))===null||s===void 0?void 0:s.attributes;if(l&&N("DISABLE_SCREEN_SHARE_REMB")){const d=n[r]._hints;(rt(d).call(d,Ce.SCREEN_TRACK)||rt(d).call(d,Ce.SCREEN_LOW_TRACK))&&(l.remb=!1,S.debug("disable remb for screen share, hints:",d))}return l})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof sn){var e;const i=this.filterTobeUnmutedTracks(t[n]);if(i.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(i.map(s=>{let[,{id:c}]=s;return c})));const r=this.createUnmuteMessage(i);return void await Ie(this,vt.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(vt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(vt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ni(jb(this.dtlsFailedCount,In)),this.emit(vt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await ui(this,vt.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(vt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(X.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof xe)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof xe).length>1)throw new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof sn).length>1&&(t.some(e=>e instanceof sn&&e._bypassWebAudio)||!se().webAudioMediaStreamDest))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof xe&&this.pendingLocalTracks.some(n=>n instanceof xe))throw new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof sn&&this.pendingLocalTracks.some(n=>n instanceof sn)&&(!se().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof sn&&n._bypassWebAudio)))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const i=!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&se().supportDualStreamEncoding,r=qo(qo({},{width:160,height:120,framerate:15,bitrate:50}),e);let s;s=i?t._mediaStreamTrack.clone():QI(t,r);const c=Le(8,"track-low-"),l=new xe(s,qo(qo({},i&&{scaleResolutionDownBy:PI(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return l.on(eh.TRANSCEIVER_UPDATED,d=>{t._updateRtpTransceiver(d,If.LOW_STREAM)}),l._hints.push(Ce.LOW_STREAM),rt(n=t._hints).call(n,Ce.SCREEN_TRACK)&&l._hints.push(Ce.SCREEN_LOW_TRACK),t.on("sei-to-send",d=>{l.emit("sei-to-send",d)}),t.addListener(_t.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Yo){var r,s,c,l;const d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:h,dtlsTransportState:p,peerConnectionState:_}=this.connection,{local:m,remote:g}=await this.connection.getSelectedCandidatePair();gt.pcStats(this.store.sessionId,{startTime:d,eventElapse:t-d||0,iceconnectionsate:h,dtlsstate:p,connectionstate:_,intSucc:e?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(r=m==null?void 0:m.protocol)!==null&&r!==void 0?r:"",selectedLocalCandidateType:(s=m.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(m.address,":").concat(m.port),selectedRemoteCandidateProtocol:(c=g.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(l=g.candidateType)!==null&&l!==void 0?l:"",selectedRemoteCandidateAddress:"".concat(g.address,":").concat(g.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(ia(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");gt.firstRemoteVideoDecode(this.store.sessionId,jn.FIRST_VIDEO_DECODE,We.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:yi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0,firstFrame:(l==null?void 0:l.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.connection.getRemoteSSRC(r);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===X.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,If.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Et(Kt.prototype,"startP2PConnection",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"startP2PConnection"),Kt.prototype),Et(Kt.prototype,"connect",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"connect"),Kt.prototype),Et(Kt.prototype,"updateRemoteRTPCapabilities",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"updateRemoteRTPCapabilities"),Kt.prototype),Et(Kt.prototype,"publishDataChannel",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"publishDataChannel"),Kt.prototype),Et(Kt.prototype,"unpublish",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"unpublish"),Kt.prototype),Et(Kt.prototype,"unpublishDataChannel",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"unpublishDataChannel"),Kt.prototype),Et(Kt.prototype,"unpublishLowStream",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"unpublishLowStream"),Kt.prototype),Et(Kt.prototype,"subscribeDataChannel",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"subscribeDataChannel"),Kt.prototype),Et(Kt.prototype,"subscribe",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"subscribe"),Kt.prototype),Et(Kt.prototype,"massSubscribe",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"massSubscribe"),Kt.prototype),Et(Kt.prototype,"unsubscribe",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"unsubscribe"),Kt.prototype),Et(Kt.prototype,"unsubscribeDataChannel",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"unsubscribeDataChannel"),Kt.prototype),Et(Kt.prototype,"massUnsubscribe",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"massUnsubscribe"),Kt.prototype),Et(Kt.prototype,"muteRemote",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"muteRemote"),Kt.prototype),Et(Kt.prototype,"unmuteRemote",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"unmuteRemote"),Kt.prototype),Et(Kt.prototype,"hasRemoteMediaWithLock",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"hasRemoteMediaWithLock"),Kt.prototype),Et(Kt.prototype,"disconnectForReconnect",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"disconnectForReconnect"),Kt.prototype),Et(Kt.prototype,"updateBitrateLimit",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"updateBitrateLimit"),Kt.prototype),Et(Kt.prototype,"remoteMediaSsrcChanged",[ji],Object.getOwnPropertyDescriptor(Kt.prototype,"remoteMediaSsrcChanged"),Kt.prototype),Kt);function ji(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PChannel.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}function T1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function v1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?T1(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const YG=Date.now(),qG=20,$I=new Map,sy=new Map;async function R1(t){const e=$I.get(t),n=Array.isArray(e)&&e[e.length-1],i=sy.get(t);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const s=n.sendTs-i.firstSendTs,c=s-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-s);let l=n.mediaDelay+c;l<=0?(e.pop(),y1(n.context,r),l=0):l=Math.min(l,qG),setTimeout(()=>e.length&&R1(t),l)}function y1(t,e){t.safeEmit(qt.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function XG(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return y1(n,{uid:t.uid,payload:t.payload});const i="".concat(n.id,"-").concat(t.uid),r=$I.get(i)||[],s=r.findIndex(h=>t.sendTs>=h.sendTs),c=v1(v1({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});s===-1?r.push(c):r.splice(s,0,c),$I.set(i,r);let l=!1;var d;sy.has(i)?l=!((d=sy.get(i))===null||d===void 0||!d.isSyncing):sy.set(i,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||R1(i)}const JG=ae().name;function C1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function A1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?C1(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const Xf="websdk_ng_cache_parameter",QG=N("MAX_PRELOAD_ASYNC_LENGTH"),ZG=1e4,uh=new Map,hh=[];let tO=null,eO=0,nO=0;const oy=new Map,$G=function(t,e){const n=[];let i=0;const r=async()=>{const s=n.shift();s&&await s(),n.length>0&&i<e?r():i--};return async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return new st(async(d,h)=>{n.push(async()=>{try{const p=await t(...c);d(p)}catch(p){h(p)}}),i<e&&(i++,r())})}}(b1,QG),iO=sr.CancelToken.source();async function b1(t,e,n,i,r,s){try{if(!N("ENABLE_PRELOAD"))return;if(!se().supportWebCrypto)return void ud(()=>{S.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new G(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ei(n,"token",1,2047),ei(t,"appid",1,2047),VR(e),i&&BR(i);const c=$u();S.debug("preload channel ".concat(e,", uid is ").concat(i));const l={appId:t,cname:e,token:n||t,uid:typeof i!="string"?i:null,sid:c,proxyServer:r};let d,h;typeof i=="string"?(l.stringUid=i,[h,d]=await st.all([MG(i,{sid:c,appId:t},iO.token),JM(A1(A1({},l),{},{token:n||t,uid:0}),iO.token)]),l.uid=h.uid,d.gatewayInfo.uid=l.uid,d.gatewayInfo.res.uid=l.uid):(s&&(l.stringUid=s),d=await JM(l,iO.token));const p={sid:c,appId:t,cname:e,token:n||t,uid:l.stringUid||i,intUid:l.uid||d.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:h,ap:d};await async function(_){let m;try{_.uid&&O1({appId:_.appId,cname:_.cname,token:_.token,uid:_.uid,stringUid:_.stringUid});const g=L1(_),C=await async function(y,b){try{const I=await window.crypto.subtle.importKey("raw",SL(b),"AES-GCM",!1,["encrypt"]),L=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},I,Zu(window.btoa(JSON.stringify(y))));return hd(new Uint8Array(L))}catch{return}}(_,_.token||_.appId);if(!C)return;m=D1(Xf);const R=m?JSON.parse(m):[];R.push({[g]:C}),R.length>N("AP_CACHE_NUM")&&R.shift(),cy(Xf,JSON.stringify(R))}catch(g){S.warn("Error caching server parameters:",g.message),cy(Xf,"")}}(p),eO++}catch(c){throw nO++,function(l){tO||(tO=window.setTimeout(()=>{let h="";oy.forEach((p,_)=>{h+="".concat(_,": ").concat(p," ;")}),gt.reportApiInvoke(null,{name:vn.PRELOAD,options:{success:eO,failed:nO,err:h}}).onError(l),eO=0,nO=0,oy.clear(),tO=null},ZG));const d=oy.get(l.code)||0;oy.set(l.code,d+1)}(c),c}}async function I1(t){try{if(N("AP_REQUEST_DETAIL")||N("ENABLE_ROLE_SELECT_EDGE"))return;const e=O1(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(i,r){try{const s=await window.crypto.subtle.importKey("raw",SL(r),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,Zu(i));return JSON.parse(window.atob(hd(new Uint8Array(c))))}catch{return}}(e,t.token||t.appId);if(!n||!function(i,r){return i.cname===r.cname&&i.appId===r.appId&&i.token===r.token?r.stringUid?i.stringUid===r.stringUid:typeof r.uid=="number"?i.uid===r.uid:i.uid==r.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<N("AP_CACHE_LIFETIME"))return n}catch(e){S.warn("Error get preloadInfo",e.message)}}function O1(t){let e;try{if(e=D1(Xf),!e)return;const n=JSON.parse(e),i=L1(t),r=function(c,l){for(let d=c.length-1;d>=0;d--)if(l(c[d]))return d;return-1}(n,c=>i in c);if(r===-1)return;const s=n.splice(r,1)[0];return cy(Xf,JSON.stringify(n)),s[i]}catch(n){S.warn("Error delete preload info: ".concat(e),n.message),cy(Xf,"")}}function rO(t){if(t){let e=uh.get(t);e&&(window.clearTimeout(e),e=null,uh.delete(t)),rt(hh).call(hh,t)||t.cloudProxyServer!=="disabled"||hh.push(t)}if(uh.size<N("AP_CACHE_NUM")&&hh.length>0){const e=hh.shift();uh.set(e,window.setTimeout(async()=>{const{appId:n,cname:i,token:r,stringUid:s,uid:c,proxyServer:l}=e;try{await $G(n,i,r,c,l,s),uh.has(e)&&rO(e)}catch(d){S.warn("update preload failed",d.message),w1(e)}},N("AP_UPDATE_INTERVAL")))}}function w1(t){const e=hh.indexOf(t);e!==-1&&hh.splice(e,1);let n=uh.get(t);n&&(window.clearTimeout(n),n=null,uh.delete(t),rO())}function N1(t,e){const n=t.sua,i=t.ap;e&&n&&gt.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),gt.reportResourceTiming(t.ap.url,t.sid),gt.joinWebProxyAP(t.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map(r=>r.ip).join(","),eventType:"disabled",unilbsServerIds:[yn.CHOOSE_SERVER,yn.CLOUD_PROXY_FALLBACK].toString()}),gt.joinChooseServer(t.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map(r=>r.address),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[yn.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function D1(t){return window.atob(window.localStorage.getItem(t)||"")}function cy(t,e){window.localStorage.setItem(t,window.btoa(e))}function L1(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),bL(e)}function t5(t){let e=function(){const n=i5.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,i){let r=n.appId;r!==void 0&&(Cn(i,10),Rd(i,r));let s=n.cid;s!==void 0&&(Cn(i,16),Cn(i,s));let c=n.cname;c!==void 0&&(Cn(i,26),Rd(i,c));let l=n.deviceId;l!==void 0&&(Cn(i,34),Rd(i,l));let d=n.elapse;d!==void 0&&(Cn(i,40),yd(i,d));let h=n.fileSize;h!==void 0&&(Cn(i,48),yd(i,Jf(h)));let p=n.height;p!==void 0&&(Cn(i,56),yd(i,Jf(p)));let _=n.jpg;_!==void 0&&(Cn(i,66),Cn(i,_.length),k1(i,_));let m=n.networkType;m!==void 0&&(Cn(i,72),yd(i,Jf(m)));let g=n.osType;g!==void 0&&(Cn(i,80),yd(i,Jf(g)));let C=n.requestId;C!==void 0&&(Cn(i,90),Rd(i,C));let R=n.sdkVersion;R!==void 0&&(Cn(i,98),Rd(i,R));let y=n.sequence;y!==void 0&&(Cn(i,104),yd(i,Jf(y)));let b=n.sid;b!==void 0&&(Cn(i,114),Rd(i,b));let I=n.timestamp;I!==void 0&&(Cn(i,120),yd(i,I));let L=n.uid;L!==void 0&&(Cn(i,128),Cn(i,L));let U=n.vid;U!==void 0&&(Cn(i,136),Cn(i,U));let x=n.width;x!==void 0&&(Cn(i,144),yd(i,Jf(x)));let M=n.service;M!==void 0&&(Cn(i,152),Cn(i,M));let j=n.callbackData;j!==void 0&&(Cn(i,162),Cn(i,j.length),k1(i,j));let K=n.ticket;K!==void 0&&(Cn(i,170),Rd(i,K));let it=n.vendorConfigs;it!==void 0&&(Cn(i,178),Rd(i,it))}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function e5(t){return function(n){let i={};t:for(;!r5(n);){let r=fg(n);switch(r>>>3){case 0:break t;case 1:i.code=fg(n);break;case 2:i.msg=M1(n,fg(n));break;case 3:i.requestId=M1(n,fg(n));break;case 4:i.timestamp=a5(n,!1);break;default:n5(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function n5(t,e){switch(e){case 0:for(;128&_s(t););break;case 2:aO(t,fg(t));break;case 5:aO(t,4);break;case 1:aO(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function Jf(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let i5=[];function aO(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function r5(t){return t.offset>=t.limit}function ly(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let c=new Uint8Array(2*s);c.set(n),t.bytes=c}return t.offset=s,s>r&&(t.limit=s),i}function P1(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function k1(t,e){let n=ly(t,e.length);t.bytes.set(e,n)}function M1(t,e){let n=P1(t,e),i=String.fromCharCode,r=t.bytes,s="",c="";for(let l=0;l<e;l++){let d,h,p,_,m=r[l+n];(128&m)==0?c+=i(m):(224&m)==192?l+1>=e?c+=s:(d=r[l+n+1],(192&d)!=128?c+=s:(_=(31&m)<<6|63&d,_<128?c+=s:(c+=i(_),l++))):(240&m)==224?l+2>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],(49344&(d|h<<8))!=32896?c+=s:(_=(15&m)<<12|(63&d)<<6|63&h,_<2048||_>=55296&&_<=57343?c+=s:(c+=i(_),l+=2))):(248&m)==240?l+3>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=s:(_=(7&m)<<18|(63&d)<<12|(63&h)<<6|63&p,_<65536||_>1114111?c+=s:(_-=65536,c+=i(55296+(_>>10),56320+(1023&_)),l+=3))):c+=s}return c}function Rd(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}Cn(t,i);let r=ly(t,i),s=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function _s(t){return t.bytes[P1(t,1)]}function U1(t,e){let n=ly(t,1);t.bytes[n]=e}function fg(t){let e,n=0,i=0;do e=_s(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function Cn(t,e){for(e>>>=0;e>=128;)U1(t,127&e|128),e>>>=7;U1(t,e)}function a5(t,e){let n,i=0,r=0,s=0;return n=_s(t),i=127&n,128&n&&(n=_s(t),i|=(127&n)<<7,128&n&&(n=_s(t),i|=(127&n)<<14,128&n&&(n=_s(t),i|=(127&n)<<21,128&n&&(n=_s(t),r=127&n,128&n&&(n=_s(t),r|=(127&n)<<7,128&n&&(n=_s(t),r|=(127&n)<<14,128&n&&(n=_s(t),r|=(127&n)<<21,128&n&&(n=_s(t),s=127&n,128&n&&(n=_s(t),s|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|s<<24,unsigned:e}}function yd(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=ly(t,s),l=t.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=s!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=s!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=s!==5?128|i:127&i;case 4:l[c+3]=s!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=s!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=s!==2?n>>>7|128:n>>>7&127;case 1:l[c]=s!==1?128|n:127&n}}const x1={},V1={},dy=4294967296,s5=dy*dy,B1=s5/2;j1(0,!0);const F1=j1(0),o5=_g(0,-2147483648,!1),c5=_g(-1,2147483647,!1);function j1(t,e){let n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=V1[t],i)?i:(n=_g(t,0,!0),r&&(V1[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=x1[t],i)?i:(n=_g(t,t<0?-1:0,!1),r&&(x1[t]=n),n)}function _g(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function G1(t,e){if(isNaN(t))return F1;{if(t<=-B1)return o5;if(t+1>=B1)return c5}return t<0?F1:_g(t%dy|0,t/dy|0,e)}function H1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}class sO extends Xe{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Xs.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),A(this,"name","AgoraRTCImageModeration"),A(this,"_connectionState",La.CONNECTING),A(this,"_sequence",0),A(this,"_moderationStartTime",void 0),A(this,"_workerConnection",void 0),A(this,"_workerMessageLengthLimit",void 0),A(this,"_qualityRatio",void 0),A(this,"_connectInfo",void 0),A(this,"_cancelTokenSource",sr.CancelToken.source()),A(this,"_retryConfig",void 0),A(this,"_moderationInterval",void 0),A(this,"_moderationTimer",null),A(this,"_moderationMode",1),A(this,"_quality",1),A(this,"_qualityTimer",null),A(this,"_ticket",void 0),A(this,"_moderationIntervalMinimum",void 0),A(this,"_uploadFailedNum",0),A(this,"_uploadNum",0),A(this,"_uploadTimer",null),A(this,"_extraInfo",void 0),A(this,"_vendor",""),A(this,"_encoder",new TextEncoder),A(this,"_moderationId",void 0),A(this,"inspectImage",()=>{if(this.connectionState!==La.CONNECTED)throw new B(O.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===La.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Le(5,"image-moderation-"),this._workerMessageLengthLimit=N("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=N("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=N("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new ig("worker-"+this._moderationId,In),this.on(Xs.STATE_CHANGE,(i,r)=>{S.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Bf[i]," ").concat(r||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(Xs.STATE_CHANGE,Bf.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new st((r,s)=>{this.on(Xs.CONNECTION_STATE_CHANGE,(c,l)=>{c===La.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorker(c)}).catch(c=>{s(c)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),S.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===La.CONNECTED&&this.inspectImage()}async requestAP(e,n,i){const r=N("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),s=await function(d,h,p,_){let{appId:m,areaCode:g,cname:C,sid:R,token:y,uid:b}=h;Kf++;const I="moderation_plugin",L={service_name:I,json_body:JSON.stringify({appId:m,areaCode:g,cname:C,command:"allocateEdge",requestId:Kf,seq:Kf,sid:R,appToken:y,ts:Date.now(),uid:b+""})};let U,x,M=d[0];return Ks(async()=>{U=Date.now();const j=await Js(M,{data:L,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(x=Date.now()-U,j.code!==0){const dt=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+j.code,{retry:!0,responseTime:x});throw S.error(dt.toString()),dt}const K=JSON.parse(j.json_body);if(K.code!==200){const dt=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(K.code,", reason: ").concat(K.reason),{code:K.code,responseTime:x});throw S.error(dt.toString()),dt}if(!K.servers||!Array.isArray(K.servers)||K.servers.length===0){const dt=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:K.code,responseTime:x});throw S.error(dt.toString()),dt}if(!K.servers.some(dt=>!!dt.wss)){const dt=new B(O.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:K.code,responseTime:x});throw S.error(dt.toString()),dt}const it=N("IMAGE_MODERATION_WORKER_HOST");return{addressList:K.servers.map(dt=>{let{address:Ft,wss:Vt}=dt;if(Ft&&Vt)return"wss://".concat(Ft.replace(/\./g,"-"),".").concat(it,":").concat(Vt,"/moderation")}).filter(dt=>!!dt),workerToken:K.workerToken,vid:K.vid,ticket:K.appTicket,responseTime:x}},(j,K)=>(gt.apworkerEvent(R,{success:!0,sc:200,serviceName:I,responseDetail:JSON.stringify(j.addressList),firstSuccess:K===0,responseTime:x,serverIp:d[K%d.length]}),!1),(j,K)=>(gt.apworkerEvent(R,{success:!1,sc:j.data&&j.data.code||200,serviceName:I,responseTime:x,serverIp:d[K%d.length]}),!!(j.code!==O.OPERATION_ABORTED&&j.code!==O.UNEXPECTED_RESPONSE||j.data&&j.data.retry)&&(M=d[(K+1)%d.length],!0)),_)}(r,e,n,i);this.emit(Xs.STATE_CHANGE,Bf.AP_CONNECTED);const{addressList:c,ticket:l}=s;return this._ticket=l,c}async connectWorker(e){this.emit(Xs.STATE_CHANGE,Bf.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(xt.CONNECTED,async()=>{this.emit(Xs.STATE_CHANGE,Bf.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=La.CONNECTED}),this._workerConnection.on(xt.CLOSED,()=>{this.connectionState=La.CLOSED}),this._workerConnection.on(xt.FAILED,()=>{this.connectionState=La.CLOSED}),this._workerConnection.on(xt.RECONNECTING,()=>{this.connectionState=this.connectionState===La.CONNECTED?La.RECONNECTING:La.CONNECTING}),this._workerConnection.on(xt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=e5(new Uint8Array(e.data));N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,S.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{gt.reportApiInvoke(this._connectInfo.sid||null,{name:vn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:rn.TRACER}).onError(new B(O.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},N("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else S.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(xt.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this._workerConnection.on(xt.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=ea(this,Xs.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(e,n);this._workerConnection.sendMessage(i,!0,!0)}else N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),_=await _P(p,i,r),m=this._sequence+"-"+s+"-"+d+"-"+h+"-"+Le(12,""),g={appId:i,cid:s,cname:r,deviceId:"",elapse:sO.intToLong(Number(h-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:m,sdkVersion:"4.23.4",sequence:this._sequence,sid:l,timestamp:G1(h),uid:d,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete g.callbackData;const C=t5(g);if(C.byteLength<this._workerMessageLengthLimit){if(N("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const R=function(y){for(var b=1;b<arguments.length;b++){var I=arguments[b]!=null?arguments[b]:{};b%2?H1(Object(I),!0).forEach(function(L){A(y,L,I[L])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(I)):H1(Object(I)).forEach(function(L){Object.defineProperty(y,L,Object.getOwnPropertyDescriptor(I,L))})}return y}({},g);delete R.jpg,S.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(R))}return C}{const R=this.quality*this._qualityRatio;return this.quality=R,await this.generateRequestData(e,{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=sr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=La.CLOSED,this.emit(Xs.STATE_CHANGE,Bf.CLOSED)}}function W1(t){if(ye(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new B(O.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new B(O.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const l5={name:"ImageModeration",create:function(t){let{config:e}=t;return W1(e),new sO(e)}};var K1,z1,Y1,q1,X1,J1,Q1,Z1,$1,tU,eU,nU,iU,rU,aU,sU,oU,cU,lU,dU,uU,hU,pU,fU,_U,mU,EU,gU,SU,TU,vU,RU,yU,CU,AU,bU,IU,OU,wU,NU,DU,lt;function LU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ms(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?LU(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):LU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}Ti.setLogger(S);let d5=(K1=At(),z1=At({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof Df))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),Y1=At({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==Nf.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),q1=At({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),X1=At({argsMap:(t,e,n)=>[e,n]}),J1=At({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return[i==null?void 0:i.uid,r]})}),Q1=At({argsMap:(t,e,n,i)=>[typeof e=="object"?e.uid:e,n,i]}),Z1=At({argsMap:(t,e)=>e.map(n=>{let{user:i,mediaType:r}=n;return{uid:i==null?void 0:i.uid,mediaType:r}})}),$1=At(),tU=At(),eU=At(),nU=At(),iU=At(),rU=At(),aU=At(),sU=At(),oU=At(),cU=At(),lU=At(),dU=At(),uU=At(),hU=At(),pU=At(),fU=At({argsMap:(t,e)=>[e]}),_U=At(),mU=At(),EU=At(),gU=At(),SU=At(),TU=At(),vU=At(),RU=At(),yU=At({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),CU=At(),AU=At(),bU=At(),IU=At(),OU=At(),wU=At(),NU=At({reportResult:!0}),DU=At(),lt=class extends Xe{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,e){let n;if(super(),A(this,"store",void 0),A(this,"_uid",void 0),A(this,"_channelName",void 0),A(this,"_uintUid",void 0),A(this,"_users",[]),A(this,"_config",void 0),A(this,"_clientId",void 0),A(this,"_appId",void 0),A(this,"_sessionId",null),A(this,"_key",void 0),A(this,"_rtmConfig",{}),A(this,"_joinInfo",void 0),A(this,"_gateway",void 0),A(this,"_statsCollector",void 0),A(this,"_configDistribute",void 0),A(this,"_leaveMutex",void 0),A(this,"_publishMutex",void 0),A(this,"_renewTokenMutex",void 0),A(this,"_subscribeMutex",void 0),A(this,"_encryptionMode","none"),A(this,"_encryptionSecret",null),A(this,"_encryptionSalt",null),A(this,"_encryptDataStream",!1),A(this,"_encryptDataStreamKey",null),A(this,"_encryptDataStreamIv",null),A(this,"_proxyServer",void 0),A(this,"_turnServer",{servers:[],mode:"auto"}),A(this,"_cloudProxyServerMode","disabled"),A(this,"_isDualStreamEnabled",!1),A(this,"_defaultStreamFallbackType",void 0),A(this,"_lowStreamParameter",void 0),A(this,"_streamFallbackTypeCacheMap",new Map),A(this,"_remoteStreamTypeCacheMap",new Map),A(this,"_axiosCancelSource",sr.CancelToken.source()),A(this,"_audioVolumeIndicationInterval",void 0),A(this,"_networkQualityInterval",void 0),A(this,"_userOfflineTimeout",void 0),A(this,"_streamRemovedTimeout",void 0),A(this,"_liveTranscodeStreamingClient",void 0),A(this,"_liveRawStreamingClient",void 0),A(this,"_channelMediaRelayClient",void 0),A(this,"_networkQualitySensitivity","normal"),A(this,"_p2pChannel",void 0),A(this,"_useLocalAccessPoint",!1),A(this,"_setLocalAPVersion",void 0),A(this,"_joinAndNotLeaveYet",!1),A(this,"_numberOfJoinCount",0),A(this,"_remoteDefaultVideoStreamType",void 0),A(this,"_inspect",void 0),A(this,"_moderation",void 0),A(this,"_license",void 0),A(this,"_pendingPublishedUsers",[]),A(this,"ntpAlignErrorCount",0),A(this,"remoteInboundOffset",0),A(this,"_peerConnectionState",void 0),A(this,"_handleLocalTrackEnable",(r,s,c)=>{this.publish(r,!1).then(s).catch(c)}),A(this,"_handleLocalTrackDisable",(r,s,c)=>{this.unpublish(r).then(s).catch(c)}),A(this,"_handleUserOnline",r=>{if(N("BLOCK_LOCAL_CLIENT")&&oh(r.uid,this.channelName))return void S.debug("[".concat(r.uid,"] will be ignored in local"));this.isStringUID&&typeof r.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const s=this._users.find(c=>c.uid===r.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(qt.USER_JOINED,s));else{const c=new Td(r.uid,r.uint_id||r.uid);this._users.push(c),S.debug("[".concat(this._clientId,"] user online"),r.uid),this.safeEmit(qt.USER_JOINED,c)}}),A(this,"_handleUserOffline",r=>{if(N("BLOCK_LOCAL_CLIENT")&&oh(r.uid,this.channelName))return;const s=this._users.find(c=>c.uid===r.uid);s&&(this._handleRemoveStream(r),this._handleRemoveDataChannels(r),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:fR(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),S.debug("[".concat(this._clientId,"] user offline"),r.uid,"reason:",r.reason),this.safeEmit(qt.USER_LEAVED,s,r.reason))}),A(this,"_handleAddAudioOrVideoStream",(r,s,c,l,d,h,p)=>{if(N("BLOCK_LOCAL_CLIENT")&&oh(s,this.channelName))return;const _=this._users.find(g=>g.uid===s);if(!_)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(_.uid,r,void 0,void 0,void 0,Date.now());const m=r==="audio"?_.hasAudio:_.hasVideo;_._uintid||(_._uintid=d||s),r==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,r==="audio"?(_._audio_added_=!0,c!==void 0&&(_._audioSSRC=c),l!==void 0&&(_._cname=l),h&&(_._audioOrtc=h)):(_._video_added_=!0,c!==void 0&&(_._videoSSRC=c),l!==void 0&&(_._cname=l),p!==void 0&&(_._rtxSsrcId=p),h&&(_._videoOrtc=h)),(r==="audio"?_.hasAudio:_.hasVideo)&&!m&&(S.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(r)),this.safeEmit(qt.USER_PUBLISHED,_,r)),r==="video"?gt.onGatewayStream(this._sessionId,jn.ON_ADD_VIDEO_STREAM,We.ON_ADD_VIDEO_STREAM,{peer:d||s,ssrc:_._videoSSRC}):gt.onGatewayStream(this._sessionId,jn.ON_ADD_AUDIO_STREAM,We.ON_ADD_AUDIO_STREAM,{peer:d||s,ssrc:_._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_,r,c).then(g=>{if(g&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(_.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof pg))return this._p2pChannel.unsubscribe(_,r,!0).then(()=>this._subscribe(_,r,!0).catch(C=>{S.error("[".concat(this._clientId,"] resubscribe error"),C.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_,r)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,r,!0).catch(g=>{S.error("[".concat(this._clientId,"] resubscribe error"),g.toString())}))}),A(this,"_handleRemoveStream",r=>{if(N("BLOCK_LOCAL_CLIENT")&&oh(r.uid,this.channelName))return;const s=this._users.find(l=>l.uid===r.uid);if(!s)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug("[".concat(this._clientId,"] stream removed with uid ").concat(r.uid));let c=()=>{};s.hasAudio&&s.hasVideo?c=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(qt.USER_UNPUBLISHED,s,"audio"),S.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(qt.USER_UNPUBLISHED,s,"video")}:s.hasVideo?c=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(qt.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(c=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(qt.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof pg&&this._p2pChannel.unsubscribe(s).then(l=>{if(l)return this._gateway.unsubscribe(l,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),gt.onGatewayStream(this._sessionId,jn.ON_REMOVE_STREAM,We.ON_REMOVE_STREAM,{peer:r.uint_id||r.uid}),c()}),A(this,"_handleSetStreamLocalEnable",(r,s,c)=>{if(N("BLOCK_LOCAL_CLIENT")&&oh(s,this.channelName))return;const l=this._users.find(p=>p.uid===s);if(!l)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug("[".concat(this._clientId,"] local ").concat(r," ").concat(c?"enabled":"disabled"," with uid ").concat(s));const d=r==="audio"?l.hasAudio:l.hasVideo;if(r==="audio"){l._trust_audio_enabled_state_=!0;const p=l._audio_enabled_;if(l._audio_enabled_=c,l._audio_enabled_===p)return;{const _=l._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(qt.USER_INFO_UPDATED,s,_)}}else{l._trust_video_enabled_state_=!0;const p=l._video_enabled_;if(l._video_enabled_=c,l._video_enabled_===p)return;{const _=l._video_enabled_?"enable-local-video":"disable-local-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(_)),this.safeEmit(qt.USER_INFO_UPDATED,s,_)}}const h=r==="audio"?l.hasAudio:l.hasVideo;return d!==h?!d&&h?(S.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(r)),void this.safeEmit(qt.USER_PUBLISHED,l,r)):(r==="video"&&l._videoTrack&&l._videoTrack._destroy(),r==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,r),S.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(r)),void this.safeEmit(qt.USER_UNPUBLISHED,l,r)):void 0}),A(this,"_handleMuteStream",(r,s,c)=>{if(N("BLOCK_LOCAL_CLIENT")&&oh(r,this.channelName))return;S.debug("[".concat(this._clientId,"] receive mute message"),r,s,c);const l=this._users.find(p=>p.uid===r);if(!l)return void S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r));const d=s==="audio"?l.hasAudio:l.hasVideo;if(s==="audio"){l._trust_audio_mute_state_=!0;const p=l._audio_muted_;if(l._audio_muted_=c,l._audio_muted_===p)return;{const _=l._audio_muted_?"mute-audio":"unmute-audio";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(_)),this.safeEmit(qt.USER_INFO_UPDATED,r,_)}}else{l._trust_video_mute_state_=!0;const p=l._video_muted_;if(l._video_muted_=c,l._video_muted_===p)return;{const _=l._video_muted_?"mute-video":"unmute-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(_)),this.safeEmit(qt.USER_INFO_UPDATED,r,_)}}const h=s==="audio"?l.hasAudio:l.hasVideo;if(d!==h){if(!d&&h)return(s==="audio"?l._audioSSRC:l._videoSSRC)?(S.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(s)),void this.safeEmit(qt.USER_PUBLISHED,l,s)):void S.warning("[".concat(this._clientId,"] remote user ").concat(r," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),s==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,s),S.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(s)),this.safeEmit(qt.USER_UNPUBLISHED,l,s)}}),A(this,"_handleP2PLost",async r=>{S.debug("[".concat(this._clientId,"] receive p2p lost"),r),parseInt(r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():S.warning("[".concat(this._clientId,"] P2PLost stream not found"),r)}),A(this,"_handleTokenWillExpire",()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(qt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),A(this,"_handleBeforeUnload",r=>{r.type==="beforeunload"&&r.returnValue!==void 0&&r.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),A(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(qt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(qt.NETWORK_QUALITY,r)}),A(this,"_handleP2PAddAudioOrVideoStream",(r,s,c,l)=>{const d=this._users.find(p=>p.uid===s);if(!d)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(r)),this.store.subscribe(d.uid,r,void 0,void 0,void 0,Date.now());const h=r==="audio"?d.hasAudio:d.hasVideo;r==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,r==="audio"?(d._audio_added_=!0,c!==void 0&&(d._audioSSRC=c),l!==void 0&&(d._audioMid=l)):(d._video_added_=!0,c!==void 0&&(d._videoSSRC=c),l!==void 0&&(d._videoMid=l)),(r==="audio"?d.hasAudio:d.hasVideo)&&!h&&(S.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(r)),this.safeEmit(qt.USER_PUBLISHED,d,r)),this._p2pChannel.hasPendingRemoteMedia(d,r)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(r," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,r,!0).catch(p=>{S.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=t,this._clientId=e||Le(5,"client-"),this.store=new class{constructor(r,s,c,l){Lt(this,"state",void 0),this.state={codec:r,audioCodec:s,mode:c,clientId:l,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:th.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(r){this.state=function(s,c){switch(c.type){case $t.SET_SESSION_ID:return ht(ht({},s),{},{sessionId:c.sessionId});case $t.SET_P2P_ID:return ht(ht({},s),{},{p2pId:c.p2pId});case $t.SET_UID:return ht(ht({},s),{},{uid:c.uid});case $t.SET_INT_UID:return ht(ht({},s),{},{intUid:c.intUid});case $t.SET_PUB_ID:return ht(ht({},s),{},{pubId:c.pubId});case $t.KEY_METRIC_CLIENT_CREATED:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{clientCreated:c.metric})});case $t.KEY_METRIC_JOIN_START:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{joinStart:c.metric})});case $t.KEY_METRIC_JOIN_END:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{joinEnd:c.metric})});case $t.KEY_METRIC_REQUEST_AP_START:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{requestAPStart:c.metric})});case $t.KEY_METRIC_REQUEST_AP_END:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{requestAPEnd:c.metric})});case $t.KEY_METRIC_JOIN_GATEWAY_START:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{joinGatewayStart:c.metric})});case $t.KEY_METRIC_JOIN_GATEWAY_END:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{joinGatewayEnd:c.metric})});case $t.KEY_METRIC_PEER_CONNECTION_START:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{peerConnectionStart:c.metric})});case $t.KEY_METRIC_PEER_CONNECTION_END:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{peerConnectionEnd:c.metric})});case $t.KEY_METRIC_DESCRIPTION_START:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{descriptionStart:c.metric})});case $t.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{signalChannelOpen:c.metric})});case $t.KEY_METRIC_ICE_CONNECTION_END:return ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{iceConnectionEnd:c.metric})});case $t.KEY_METRIC_PUBLISH:{const l=s.keyMetrics.publish,d=l.findIndex(h=>h.trackId===c.metric.trackId);return d!==-1?(l[d]=ht(ht({},l[d]),c.metric),ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{publish:[...l]})})):ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,c.metric]})})}case $t.KEY_METRIC_SUBSCRIBE:{const l=s.keyMetrics.subscribe,d=l.findIndex(h=>h.userId===c.metric.userId&&h.type===c.metric.type);return d!==-1?(l[d]=ht(ht({},l[d]),c.metric),ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{subscribe:[...l]})})):ht(ht({},s),{},{keyMetrics:ht(ht({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,c.metric]})})}case $t.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=c.mode,s;case $t.RECORD_JOIN_CHANNEL_SERVICE:return typeof c.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,c.record]:(s.joinChannelServiceRecords[c.index]=ht(ht({},s.joinChannelServiceRecords[c.index]),c.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case $t.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case $t.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[]},s;case $t.SET_USE_P2P:return ht(ht({},s),{},{useP2P:c.val});case $t.SET_TRANSPORT_TYPE:return ht(ht({},s),{},{p2pTransport:c.val});default:return s}}(this.state,r)}set sessionId(r){this.dispatch({type:$t.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set cid(r){this.state.cid=r}get cid(){return this.state.cid}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:$t.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:$t.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:$t.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:$t.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:$t.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:$t.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:$t.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:$t.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(r){this.state.hasStartJoinChannel=r}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(r){this.state.isABTestSuccess=r}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:$t.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:$t.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:$t.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:$t.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:$t.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:$t.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:$t.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:$t.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:$t.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:$t.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:$t.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:$t.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,s,c,l){this.dispatch({type:$t.KEY_METRIC_PUBLISH,metric:ht(ht({trackId:r,type:s},c&&{publishStart:c}),l&&{publishEnd:l})})}subscribe(r,s,c,l,d,h,p){this.dispatch({type:$t.KEY_METRIC_SUBSCRIBE,metric:ht(ht(ht(ht(ht({userId:r,type:s},c&&{subscribeStart:c}),l&&{subscribeEnd:l}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(r,s,c,l){r.forEach(d=>{this.dispatch({type:$t.KEY_METRIC_SUBSCRIBE,metric:ht(ht(ht({userId:d.userId,type:d.type},s&&{subscribeStart:s}),c&&{subscribeEnd:c}),l&&{firstFrame:l})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,s){r.service==="gateway"&&Array.isArray(r.urls)&&(r.urls=r.urls.map(c=>c.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:$t.RECORD_JOIN_CHANNEL_SERVICE,record:ht(ht({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:$t.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:$t.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:$t.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Ti("client-leave",this._clientId),this._publishMutex=new Ti("client-publish",this._clientId),this._renewTokenMutex=new Ti("client-renewtoken",this._clientId),this._subscribeMutex=new Ti("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),S.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(wa," build: ").concat(Qb,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{xb(t.clientRoleOptions),n=Object.assign({},t.clientRoleOptions)}catch(r){S.warning("[".concat(this._clientId,"] ").concat(r.toString()))}var i;this._statsCollector=new dg(this.store),this._statsCollector.onStatsException=(r,s,c)=>{S.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(r,", msg: ").concat(s,", uid: ").concat(c)),this.safeEmit(qt.EXCEPTION,{code:r,msg:s,uid:c})},this._statsCollector.onUploadPublishDuration=(r,s,c,l)=>{const d=this._users.find(h=>h.uid===r);d&&gt.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:s,videoPublishDuration:c,peer:d._uintid})},this._statsCollector.onVideoCodecChanged=r=>{if(N("VIDEO_STANDARD_BITRATE_VERSION")&&(r==="av1"||r==="h265"||r==="h264")){const s=this.localTracks.find(c=>c instanceof xe);s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(r==="h264"?N("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new wG(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||In,httpRetryConfig:t.httpRetryConfig||In,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:n}),this._configDistribute=new BG(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},Xc("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new pg(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,i,r){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Se("JOIN_GATEWAY_USE_443PORT_ONLY",s),Se("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const l=this._gateway.signal.websocket;return l instanceof DI&&(l.use443PortOnly=s,l.tryDoubleDomain=c),async function(d,h,p){lR.get(d)||lR.set(d,[]),dR.get(d)||dR.set(d,h),Vo.get(d)||Vo.set(d,0);const _=lR.get(d),m=dR.get(d);if(!_||!m)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Vo.get(d)===m){const b=FE();_.push(b),await b.promise}Vo.set(d,Vo.get(d)+1);for(var g=arguments.length,C=new Array(g>3?g-3:0),R=3;R<g;R++)C[R-3]=arguments[R];const y=await p(...C);return Vo.set(d,Vo.get(d)-1),Vo.get(d)===m-1&&_.length>0&&(_[0].resolve(),_.shift()),Vo.get(d)===0&&(lR.set(d,[]),dR.set(d,0),Vo.set(d,0)),y}("client.join",N("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,i,r)}async join(t,e,n,i,r){const s=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=(ER||ER||(ER=(window.location.protocol.split(":")[0]||"").toUpperCase(),ER))==="HTTPS",l=wL()?window.isSecureContext:"Browser Not Support";(!wL()&&!c||!window.isSecureContext)&&S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),gt.setAppId(t);try{if(!n&&n!==null)throw new B(O.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ei(n,"token",1,2047),ei(t,"appid",1,2047),VR(e),i&&BR(i),r&&ei(r,"optionalInfo",1,2047)}catch(R){throw gt.reportApiInvoke($u(),{name:vn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:rn.TRACER}).onError(R),R}if(this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const R=new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw gt.reportApiInvoke($u(),{name:vn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:rn.TRACER}).onError(R),R}this._gateway.state="CONNECTING";const d=await I1({appId:t,cname:e,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const h=(d==null?void 0:d.sid)||$u();S.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(s)),this._sessionId||(this._sessionId=h,this.store.sessionId=this._sessionId);const p=gt.reportApiInvoke(h,{id:this._clientId,name:vn.JOIN,options:[t,e,n,i],states:{isHttps:c,isSecureContext:l},tag:rn.TRACER}),_=ms(ms(ms({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!d},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:N("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(_.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(_.stringUid=i,this._uintUid?(_.uid=this._uintUid,this._uintUid=void 0):_.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(_.aesmode=this._encryptionMode,_.aespassword=await(async R=>{const y=function(U){const x=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),M=new Uint8Array(new ArrayBuffer(x.length));for(let j=0;j<x.length;j+=1)M[j]=x.charCodeAt(j);return M}(),b=await window.crypto.subtle.importKey("spki",y,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),I=Mb(R),L=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},b,I);return function(U){let x="";for(let M=0;M<U.length;M+=1)x+=String.fromCharCode(U[M]);return window.btoa(x)}(new Uint8Array(L))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(_.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const R=new TextEncoder,y=N("USE_PURE_ENCRYPTION_MASTER_KEY")?R.encode(_.appId+this._encryptionSecret+this._encryptionSecret):R.encode(_.appId+_.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(b,I,L){const U=await window.crypto.subtle.importKey("raw",I,"PBKDF2",!1,["deriveBits","deriveKey"]),x=b==="aes-128-gcm2"?128:256,M=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:BL,hash:"SHA-256",salt:L},U,x+r4);return new Uint8Array(M).subarray(x/8)}(this._encryptionMode,y,Zu(this._encryptionSalt)),this._encryptDataStreamKey=await async function(b,I,L){const U=await window.crypto.subtle.importKey("raw",I,"PBKDF2",!1,["deriveBits","deriveKey"]),x=b==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:BL,hash:"SHA-256",salt:L},U,{name:"AES-GCM",length:x},!0,["encrypt","decrypt"])}(this._encryptionMode,y,Zu(this._encryptionSalt))}else l?S.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):S.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,S.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:_.stringUid});const m=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&m===this._sessionId&&gt.joinChannelTimeout(this._sessionId,5)},5e3);try{var g;let R;const y=_.cloudProxyServer;if(rt(g=["proxy3","proxy4","proxy5"]).call(g,y)){const x=N("PROXY_SERVER_TYPE3");Array.isArray(x)?_.proxyServer=x[0]:_.proxyServer=x}if(gt.setProxyServer(_.proxyServer),S.setProxyServer(_.proxyServer),this.store.requestAPStart(),d){if(S.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(_.stringUid?", ".concat(_.stringUid," => ").concat(d.intUid):""," ")),_.stringUid&&!_.uid&&(_.uid=d.intUid),R={gatewayInfo:d.ap.gatewayInfo},N("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&_.turnServer.mode==="auto")if(d.ap.proxyInfo.addresses.length===0)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const x=(await vM(d.ap.proxyInfo,d.ap.gatewayInfo.uid)).map(M=>({turnServerURL:M.address,tcpport:M.tcpport||hi.tcpport,udpport:M.udpport||hi.udpport,username:M.username||hi.username,password:M.password||hi.password,forceturn:!1,security:!0}));_.turnServer={mode:"manual",servers:x}}N1(d,_.stringUid)}else{if(_.stringUid&&!_.uid){let x;[x,R]=await st.all([XM(_.stringUid,_,this._axiosCancelSource.token,this._config.httpRetryConfig||In,this.store),qM(_,this._axiosCancelSource.token,this._config.httpRetryConfig||In,!0,this.store)]),S.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(_.stringUid," => ").concat(x)),_.uid=x,R.gatewayInfo.uid=x,R.gatewayInfo.res.uid=x}else R=await qM(_,this._axiosCancelSource.token,this._config.httpRetryConfig||In,!0,this.store);if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(_,this._axiosCancelSource.token),this._configDistribute.on(eg.UPDATE_BITRATE_LIMIT,x=>{this._p2pChannel.updateBitrateLimit(x)}),this._configDistribute.on(eg.UPDATE_CLIENT_ROLE_OPTIONS,x=>{this._setClientRoleOptions(x)})},0),this._key=n||t;const b=R.gatewayInfo,I=_.uid?_.uid:b.uid;this._joinInfo=ms(ms({},_),{},{cid:b.cid,uid:I,vid:b.vid,apResponse:b.res,apGatewayAddress:b.apGatewayAddress,uni_lbs_ip:b.uni_lbs_ip,gatewayAddrs:b.gatewayAddrs}),this.store.intUid=I,this.store.cid=b.cid;const L=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));p.onSuccess(L),this._appId=t,this._channelName=_.cname,this._uid=L,this.store.uid=L,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(li()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const U=_.stringUid?"string uid: ".concat(_.stringUid,",uid: ").concat(_.uid):"uid: ".concat(this._uid);return S.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(U)),setTimeout(()=>{S.startUpload()},5e3),this.store.joinEnd(),C=this,rt(sh).call(sh,C)||sh.push(C),this._cloudProxyServerMode==="disabled"&&se().supportWebCrypto&&N("ENABLE_PRELOAD")&&rO(this._joinInfo),L}catch(R){const y=Array.isArray(R)?R[0]:R;throw y&&y.code===O.OPERATION_ABORTED?S.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),y):S.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),y),y.code!==O.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),p.onError(y),y}var C}_joinGateway(){if(!this._joinInfo||!this._key)throw new B(O.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!N("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){S.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(li()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=sh.indexOf(e);n!==-1&&sh.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",_e.LEAVE),S.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Df))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new B(O.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new B(O.INVALID_OPERATION,"audience can not publish stream");for(const r of n){if(!(r instanceof Df))throw new B(O.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&e)throw new B(O.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}S.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(r=>{const s=this._configDistribute.getBitrateLimit();r instanceof xe&&s&&r.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),S.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw S.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{i()}}async _publishDataChannel(t){ye(t.id,"id",0,65535,!0),Hc(t.ordered,"ordered"),ei(t.metadata,"metadata",0,512),S.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(r=>r.id===t.id)!==-1)throw new B(O.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&N("FORCE_TURN")&&!N("TURN_ENABLE_TCP")&&!N("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(r){return BM(r,!1)}(t),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new B(O.CREATE_DATACHANNEL_ERROR);try{await st.all(i.map(r=>this._uid&&this._gateway.publishDataChannel(this._uid,r,!0))),await n._waitTillOpen()}catch(r){if(r.code!==O.DISCONNECT_P2P)throw r}}return S.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw S.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof Df))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);S.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(i=>"".concat(i.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.sendExtensionMessage(En.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(e);i&&await this._gateway.unpublish(i,this._uid),S.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}}catch(i){throw S.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),S.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),S.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(i=>"".concat(i.id))))}catch(n){throw S.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof Td)){const i=this.remoteUsers.find(r=>r.uid===t);if(!i)throw new B(O.INVALID_REMOTE_USER,"user is not in the channel");t=i}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(xn(e,"mediaType",["audio","video"]),this.store.useP2P)throw new B(O.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===ut.AUDIO,i=e===ut.VIDEO,r=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:c,rtxSsrcId:l,cname:d,uint_id:h}=await this._gateway.presubscribe(t,e,!0);if(s==null)throw new B(O.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(m=>m.uid===t);p||(p=new Td(t,h||t),p._is_pre_created=!0,this._users.push(p)),d&&(p._cname=d),p._uintid||(p._uintid=h||t),n&&(p._audioSSRC=s,p._audio_pre_subscribed=!0,c&&(p._audioOrtc=c)),i&&(p._videoSSRC=s,p._video_pre_subscribed=!0,c&&(p._videoOrtc=c),l!=null&&(p._rtxSsrcId=l)),S.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(p,e,s,l,c);const _=n?p._audioTrack:p._videoTrack;if(!_)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),i&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),_}catch(s){throw S.error("[".concat(this._clientId,"] presub user ").concat(t," error"),s),s}finally{r()}}async _subscribeDataChannel(t,e){var n;if(ye(e,"channelId",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===t))throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new B(O.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new B(O.INVALID_REMOTE_USER,"user is not published");const r=(n=t._dataChannels)===null||n===void 0?void 0:n.find(l=>l.id===e);if(!r)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new B(O.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const l=await this._p2pChannel.subscribeDataChannel(t,[r]);if(l&&rt(l).call(l,r.id))try{var c;if(typeof r._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new B(O.CREATE_DATACHANNEL_ERROR);const d={id:r.id,datachannelId:r._originDataChannelId,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:(c=r.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(t.uid,d,!0),await r._waitTillOpen()}catch(d){if((d==null?void 0:d.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[r]),d;await this._p2pChannel.unsubscribeDataChannel(t,[r]),this._p2pChannel.setPendingRemoteDataChannel(t,r.id)}return S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),r}finally{s()}}async _p2pSubscribe(t,e,n){if(xn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===t)){const s=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),s}if(!t.hasAudio&&!t.hasVideo){const s=new B(O.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),s}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const s=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),s}const r=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const c=e==="audio"?t._audioSSRC:t._videoSSRC,l=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,e,c,l)}catch(c){throw c}S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(c=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),c)});const s=e==="audio"?t._audioTrack:t._videoTrack;if(!s)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),s),s}finally{r()}}async _subscribe(t,e,n){if(this.store.useP2P)return this._p2pSubscribe(t,e);if(xn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===t)){const h=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),h}if(!t.hasAudio&&!t.hasVideo){const h=new B(O.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),h}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const h=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),h}let r=e==="audio"?t._audioSSRC:t._videoSSRC,s=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?ut.AUDIO:ut.VIDEO,ssrcId:r};const d=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const p=e==="audio"?t._audioSSRC:t._videoSSRC;p!==void 0&&p!==r&&(r=p,s=e==="audio"?t._audioOrtc:t._videoOrtc,c=e==="video"?t._rtxSsrcId:void 0,l={stream_type:e==="audio"?ut.AUDIO:ut.VIDEO,ssrcId:r}),yi.markSubscribeStart(this.store.clientId,r),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,r,c,s);try{this._p2pChannel.isPreSubScribe(r)||await this._gateway.subscribe(t.uid,l,!0)}catch(_){if((_==null?void 0:_.code)!==O.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),_;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p==null?void 0:p.code,t,e),p}S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(p=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const h=e==="audio"?t._audioTrack:t._videoTrack;if(!h)throw new B(O.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),h),h}finally{d()}}async massSubscribe(t){if(Wc(t,"subscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,i=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(l=>{let{user:d,mediaType:h}=l;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(h)}).join("; ")));const r=(t=[...t]).map(l=>{let{user:d,mediaType:h}=l;return{user:d,mediaType:h}}),s=await this._p2pChannel.globalLock();try{var c;for(let d=t.length-1;d>=0;d--){const h=t[d],{user:p,mediaType:_}=h;if(xn(_,"mediaType",["audio","video"]),!p){const R=new B(O.INVALID_PARAMS,"user property does not exist in subscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),R}if(!this._users.find(R=>R===p)){const R=new B(O.INVALID_REMOTE_USER,"user is not in the channel");S.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),r[d].error=R,t.splice(d,1);continue}if(_==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||_==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){const R=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);S.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(_,", remote user is not published")),r[d].error=R,t.splice(d,1);continue}const g=Gn.Video|Gn.LwoVideo,C=n.get(p);if(C){if(_==="video"?C&g:C&Gn.Audio){t.splice(d,1),S.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(_," twice"));continue}n.set(p,C|(_==="video"?g:Gn.Audio))}else n.set(p,_==="video"?g:Gn.Audio)}for(let d=t.length-1;d>=0;d--){const h=t[d],{user:p,mediaType:_}=h,m=Gn.Video|Gn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,_)){await this._p2pChannel.unmuteRemoteNoLock(p,_);const g=n.get(p);n.set(p,_==="video"?g^m:g^Gn.Audio),t.splice(d,1)}}this.store.massSubscribe(t.map(d=>({userId:d.user.uid,type:d.mediaType})),e);let l=_r(c=Array.from(n.entries())).call(c,(d,h)=>{let[p,_]=h;if(_===0)return d;const m={stream_id:p.uid,stream_type:_};return _&Gn.Audio&&(m.audio_ssrc=p._audioSSRC),_&Gn.Video&&(m.video_ssrc=p._videoSSRC),d.push(m),d},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(h=>{let{user:p,mediaType:_}=h;return{user:p,mediaType:_,ssrcId:_===ut.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:_===ut.VIDEO?p._rtxSsrcId:void 0}}));const d=new Map;if(l=l.filter(h=>h.video_ssrc&&!this._p2pChannel.isPreSubScribe(h.video_ssrc)||h.audio_ssrc&&!this._p2pChannel.isPreSubScribe(h.audio_ssrc)||!h.video_ssrc&&!h.audio_ssrc),l.length>0){const h=await this._gateway.subscribeAll(l,!0);((h==null?void 0:h.users)||[]).forEach(p=>{let{stream_id:_,video_error_code:m,audio_error_code:g,error_code:C}=p;(m||g||C)&&d.set(_,{video_error_code:m,audio_error_code:g,error_code:C})})}if(Array.from(d.entries()).length>0){const h=[];Array.from(d.entries()).forEach(p=>{let[_,m]=p;const g=this.remoteUsers.find(C=>C.uid===_);if(g){let C;m.error_code||m.video_error_code&&m.audio_error_code?C=void 0:m.video_error_code?C=ut.VIDEO:m.audio_error_code&&(C=ut.AUDIO),h.push({user:g,mediaType:C})}}),h.length>0&&await this._p2pChannel.massUnsubscribeNoLock(h)}for(const h of r){const p=d.get(h.user.uid);if(p){const _=p.error_code||h.mediaType==="audio"&&p.audio_error_code||h.mediaType==="video"&&p.video_error_code;if(_){const m=ng(_);S.error("user:".concat(h.user.uid," mediaType:").concat(h.mediaType," has massSubscribe error ").concat(m.desc)),h.error=new B(O.SUBSCRIBE_FAILED,"code ".concat(_,": ").concat(m.desc))}}h.error||(h.mediaType==="video"?h.track=h.user.videoTrack:h.track=h.user.audioTrack)}return this.store.massSubscribe(r.filter(h=>!h.error).map(h=>({userId:h.user.uid,type:h.mediaType})),void 0,Date.now()),r.forEach(h=>{var p;gt.subscribe(this.store.sessionId,{succ:!!h.error,ec:((p=h.error)===null||p===void 0?void 0:p.code)||null,video:h.mediaType===ut.VIDEO,audio:h.mediaType===ut.AUDIO,peerid:h.user.uid,subscribeRequestid:h.mediaType===ut.VIDEO?h.user._videoSSRC:h.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(h.user._videoSSRC)},!0)}),S.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(h=>{let{user:p,mediaType:_}=h;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(_)}).join("; "))),r}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(t),d}}finally{s(),i()}}async unsubscribe(t,e,n){if(!(t instanceof Td)){const s=this.remoteUsers.find(c=>c.uid===t);if(!s)throw new B(O.INVALID_REMOTE_USER,"user is not in the channel");t=s}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&xn(e,"mediaType",["audio","video"]),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===t)){const s=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),s}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const r=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,e);else{const s=await this._p2pChannel.unsubscribe(t,e);s&&await this._gateway.unsubscribe(s,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&fR(this._users,t),S.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(s){if(s.code===O.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),s.toString()),s}finally{r()}}async _unsubscribeDataChannel(t,e){if(e&&ye(e,"id",0,65535,!0),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(r=>r===t)){const r=new B(O.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),r}let i;if(typeof e=="number"){const r=t._dataChannels.find(s=>s.id===e);r&&(i=[r])}else i=t._dataChannels;if(i===void 0){const r=new B(O.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),r}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i.map(r=>r.id)));try{const r=await this._p2pChannel.unsubscribeDataChannel(t,i);r&&await this._gateway.unsubscribeDataChannel(r,t.uid),S.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r))}catch(r){if(r.code===O.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),r.toString()),r}}async massUnsubscribe(t){if(Wc(t,"unsubscribeList"),!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");S.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:i,mediaType:r}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(r,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:i,mediaType:r}=t[n];if(!i){const l=new B(O.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(xn(r,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===i)){S.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),t.splice(n,1);continue}const c=Gn.Video|Gn.LwoVideo;if(e.has(i)){const l=e.get(i);let d;switch(r){case"video":d=l&c;break;case"audio":d=l&Gn.Audio;break;default:d=l&(Gn.Audio|c)}if(d){S.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),t.splice(n,1);continue}r?r==="audio"?e.set(i,l|Gn.Audio):r==="video"&&e.set(i,l|c):e.set(i,l|Gn.Audio|c)}else r?r==="audio"?e.set(i,Gn.Audio):r==="video"&&e.set(i,c):e.set(i,Gn.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),S.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(i=>{let{user:r,mediaType:s}=i;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===O.DISCONNECT_P2P)return void S.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw S.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new G(O.INVALID_PARAMS);nn(n.width)||Pb(n.width,"streamParameter.width"),nn(n.height)||Pb(n.height,"streamParameter.height"),nn(n.framerate)||Pb(n.framerate,"streamParameter.framerate"),nn(n.bitrate)||ye(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,X.LocalVideoLowTrack)}async enableDualStream(){if(!se().supportDualStream)throw gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new B(O.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new B(O.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(X.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,gt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(i){xn(i,"role",["audience","host"])}(t),e&&xb(e),this.mode==="rtc"||this.mode==="p2p")throw S.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new B(O.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new B(O.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new B(O.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==n&&N("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,e),this._config.role=t,this._gateway.reconnect("recover",di.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,e),this._config.role=t),S.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{t&&xb(t),await this._gateway.setClientRole(this._config.role,t),e=!0}catch{}finally{S.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(ei(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,gt.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer),S.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy")}if(KE(t))return this._turnServer={servers:t,mode:"original-manual"},void S.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>EL(n)),this._turnServer={servers:t,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"you should set license before join channel");if(ei(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new B(O.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,S.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new B(O.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new B(O.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new B(O.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new B(O.INVALID_OPERATION,"Stop proxy server after leave channel");gt.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new B(O.INVALID_PARAMS,"accessPoints is required.");Wc(t.accessPoints.serverList,"accessPoints.serverList"),ei(t.accessPoints.domain,"accessPoints.domain");const e=(m,g)=>{ye(m,g,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");N("CLOSE_AFB_FOR_LOCAL_AP")&&(Se("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Se("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,s=t.accessPoints.serverList.map(m=>i.test(m)?"".concat(m.replace(/\./g,"-"),".").concat(r):m),c=s.map(m=>"".concat(m,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Se("WEBCS_DOMAIN",c),Se("WEBCS_DOMAIN_BACKUP_LIST",c),Se("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Wc(t.report.hostname,"report.hostname"),Se("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Se("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Se("EVENT_REPORT_DOMAIN",s[0]),Se("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let l=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),l=t.report.port),Se("STATS_COLLECTOR_PORT",l),t.report?Se("ENABLE_EVENT_REPORT",!0):Se("ENABLE_EVENT_REPORT",!1);let d="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Wc(t.log.hostname,"log.hostname"),d=t.log.hostname[0]):d=s[0];let h=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),h=t.log.port),Se("LOG_UPLOAD_SERVER","".concat(d,":").concat(h));let p=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Wc(t.cds.hostname,"cds.hostname"),p=t.cds.hostname):p=s;let _=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),_=t.cds.port),Se("CDS_AP",p.map(m=>"".concat(m,":").concat(_))),t.cds?Se("ENABLE_CONFIG_DISTRIBUTE",!0):Se("ENABLE_CONFIG_DISTRIBUTE",!1),S.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(Wc(t,"serverList"),ei(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new B(O.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(e):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Se("WEBCS_DOMAIN",t),Se("WEBCS_DOMAIN_BACKUP_LIST",t),Se("GATEWAY_DOMAINS",[e]),Se("EVENT_REPORT_DOMAIN",t[0]),Se("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Se("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),S.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(xn(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw S.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else S.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){xn(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(i=>i.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw S.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){xn(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw S.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,i){(function(s){xn(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),ei(e,"secret");const r=["aes-128-gcm2","aes-256-gcm2"];if(rt(r).call(r,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new B(O.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new B(O.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(Hc(i,"encryptDataStream"),!rt(r).call(r,t))throw new B(O.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=hd(n))}async renewToken(t){if(ei(t,"token",1,2047),!this._key||!this._joinInfo)throw new B(O.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(N("USE_NEW_TOKEN")){S.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await VG(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||In);S.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:i})}else S.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});S.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=e,this._joinInfo.token=e,S.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?S.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(qt.VOLUME_INDICATOR,t)},N("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new B(O.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new B(O.LIVE_STREAMING_TASK_CONFLICT);const n=e?zc.TRANSCODE:zc.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(zc.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new B(O.INVALID_PARAMS,"can not find live streaming url to stop");await st.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){n1(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){n1(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof pg&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const r=new TextEncoder;t.payload=r.encode(t.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&rt(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(i=!0,t.payload=await async function(r,s,c){var l;const d=_r(l=Array.from(c)).call(l,(R,y)=>R+y,0),h={serverTs:0,seq:a4++,length:c.length,checkSum:d},p=new Uint8Array(AL(d,2)),_=new ArrayBuffer(Cf),m=new DataView(_);m.setUint32(0,h.serverTs),m.setUint16(4,h.seq),m.setUint16(6,h.length),m.setUint16(8,h.checkSum);const g=16-c.length%16;c=TL(c,new Uint8Array(g));const C=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:VL,additionalData:p},s,c);return TL(new Uint8Array(_),new Uint8Array(C))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new B(O.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(bt.DATA_STREAM,{payload:hd(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-YG},!n)}sendMetadata(t){if(!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new B(O.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(bt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:hd(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(f4),!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not send custom report, not joined");await gt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){xn(e.spatialLayer,"spatialLayer",[0,1,2,3]),xn(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(Hc(e,"apRTM"),ye(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,S.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(S.debug("[".concat(this._clientId,"] reset client")),function(t){const e=xf.indexOf(t);e!==-1&&xf.splice(e,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=sr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&w1(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&gt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Ti("client-publish",this._clientId),this._subscribeMutex=new Ti("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const i=t||$u();t?S.debug("[".concat(this._clientId,"] new Session ").concat(i)):S.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const r=t?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,gt.addSid(i);const s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:r,clientRole:this.role==="audience"?2:1};gt.sessionInit(this._sessionId,ms({cname:e.channel,appid:e.appId},s)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&N("FORCE_TURN")&&!N("TURN_ENABLE_TCP")&&!N("TURN_ENABLE_UDP"))throw new B(O.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");S.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(En.PUBLISH,i,!0)}catch(r){throw n.throw(r),r}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==O.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const r of t)r instanceof xe&&r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig).catch(s=>{S.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!r.muted&&r.enabled||await this._p2pChannel.muteLocalTrack(r)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new B(O.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new B(O.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));S.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(s){if(s.code!==O.DISCONNECT_P2P)throw n.throw(s),s}n.next(((e=r)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===O.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new B(O.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Xc("LiveStreaming").create(i));var i;return n.onLiveStreamError=(r,s)=>{gt.reportApiInvoke(this._sessionId,{name:vn.ON_LIVE_STREAM_ERROR,options:[r,s],tag:rn.TRACER}).onSuccess(),this.safeEmit(qt.LIVE_STREAMING_ERROR,r,s)},n.onLiveStreamWarning=(r,s)=>{gt.reportApiInvoke(this._sessionId,{name:vn.ON_LIVE_STREAM_WARNING,options:[r,s],tag:rn.TRACER}).onSuccess(),this.safeEmit(qt.LIVE_STREAMING_WARNING,r,s)},n.on(OI.REQUEST_WORKER_MANAGER_LIST,(r,s,c)=>{if(!this._joinInfo)return c(new B(O.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(l,d,h,p){const _=N("UAP_AP").slice(0,N("AJAX_REQUEST_CONCURRENT")).map(m=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(m+"/api/v1?action=uap"):"https://".concat(m,"/api/v1?action=uap"));return await LG(_,l,d,h,p)})(r,this._joinInfo,this._axiosCancelSource.token,In).then(s).catch(c)}),n};return t===zc.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new B(O.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},Xc("ChannelMediaRelay").create(t));i.on("state",r=>{r===Rr.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit(qt.CHANNEL_MEDIA_RELAY_STATE,r)}),i.on("event",r=>{this.safeEmit(qt.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(r,s)=>{var c;r==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(s))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:i}=t,r=[];if(e){const s=[];this._users.forEach(c=>{c._dataChannels.forEach(l=>{n.every(d=>d.uid!==c._uintid||d.stream_id!==l.id)&&s.push({uid:c._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:c,stream_id:l,ordered:d,max_retrans_times:h,metadata:p}=s,_=this._users.find(m=>m._uintid===c);if(!_)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(S.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),rt(r).call(r,_)||r.push(_),_._uintid||(_._uintid=c),_._dataChannels.findIndex(m=>m.id===s.stream_id)===-1){const m={id:l,ordered:!!d,maxRetransmits:h,metadata:p},g=function(C){return BM(C,!0)}(m);_._dataChannels.push(g),S.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published datachannel")),e||this.safeEmit(qt.USER_PUBLISHED,_,"datachannel",m)}this._p2pChannel.hasPendingRemoteDataChannel(_,s.stream_id)&&(S.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(_.uid," after reconnect.")),this._subscribeDataChannel(_,s.stream_id).catch(m=>{S.error("[".concat(this._clientId,"] resubscribe datachannel error"),m.toString())}))}),e&&(this.safeEmit(qt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach(s=>{const{uid:c,stream_id:l}=s,d=this._users.find(p=>p._uintid===c);if(!d)return void S.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const h=d._dataChannels.find(p=>p.id===s.stream_id);h&&(S.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(d,[h]).then(p=>{if(d._dataChannels=d._dataChannels.filter(_=>_!==h),p)return this._gateway.unsubscribeDataChannel(p,d.uid)}),S.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(h.id)),this.safeEmit(qt.USER_UNPUBLISHED,d,"datachannel",h._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){S.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(i=>{this.safeEmit(qt.USER_UNPUBLISHED,e,"datachannel",i._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(i=>{if(i)return this._gateway.unsubscribeDataChannel(i,e.uid)}),n()}}else S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(qn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void S.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();Object.keys(e).forEach(i=>{const{value:r,type:s,expires:c}=e[i];c&&c<=n||s||vI()||!Object.prototype.hasOwnProperty.call(TR,i)||(zs[i]=r,je[i]=r,S.debug("Update gateway parameters from config distribute",i,r))})}catch(e){S.error("Error update config from local cache",e.message)}})()}),this._gateway.on(qn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(qn.CONNECTION_STATE_CHANGE,(t,e,n)=>{var i;if(n===_e.FALLBACK)return;const r=()=>{this.safeEmit(qt.CONNECTION_STATE_CHANGE,t,e,n)};if(gt.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:vn.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:rn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),S.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void r();if(t==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(d=>{S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(d=>{S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{S.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{S.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{S.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,ut.AUDIO,!1)),c._trust_video_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,ut.VIDEO,!1)),c._trust_audio_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(S.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3))}r()}),this._gateway.on(qn.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new B(O.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await I1(ms(ms({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,N1(i),this._joinInfo.preload=!0):(n=await KI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||In,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const r=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:c}=s;const[l,d]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?r.push({proxy:this._joinInfo.proxyServer,host:l,port:d}):r.push({host:l,port:d})}),t(r)}catch(n){e(n)}}),this._gateway.on(qn.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(qt.NETWORK_QUALITY,t)}),this._gateway.on(qn.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(qt.STREAM_TYPE_CHANGED,t,e),gt.reportApiInvoke(this._sessionId,{name:vn.STREAM_TYPE_CHANGE,options:[t,e],tag:rn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(qn.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(qn.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let i=await this._p2pChannel.getEstablishParams();N("ENABLE_PREALLOC_PC")&&i||(i=await this._p2pChannel.startP2PConnection(t)),e(i)}catch(i){n(i)}}),this._gateway.on(qn.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;let n;t.attributes?n=t.attributes.userAttributes.preSubSsrcs:S.debug("no attributes in joinResponse");const i=IM(t.ortc,e,n);this._p2pChannel.connect(i)}),this._gateway.on(qn.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var i;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:r,cid:s}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(s,"_").concat(r),icePwd:"".concat(s,"_").concat(r)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=N("FINGERPRINT"))!==null&&i!==void 0?i:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Jt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Jt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Jt.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(Jt.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Jt.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(Jt.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Jt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Jt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Jt.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,ut.AUDIO,!0)),this._gateway.signal.on(Jt.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,ut.AUDIO,!1)),this._gateway.signal.on(Jt.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,ut.VIDEO,!0)),this._gateway.signal.on(Jt.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,ut.VIDEO,!1)),this._gateway.signal.on(Jt.RECEIVE_METADATA,t=>{const e=Zu(t.metadata);this.safeEmit(qt.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(Jt.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=Zu(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&rt(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<Cf)throw new B(O.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Cf));n=await async function(s,c,l){const d=l.subarray(0,Cf),h=d.slice(8,Cf),p=(h[0]<<8)+h[1],_=(d[6]<<8)+d[7],m=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:VL,additionalData:new Uint8Array(AL(p,2))},c,l.subarray(Cf));return new Uint8Array(m).subarray(0,_)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(t.ordered||t.syncWithAudio){const r=this._p2pChannel.getStats(),s=this.remoteUsers.find(l=>l.uid===t.uid),c=r==null?void 0:r.audioRecv.find(l=>l.ssrc===(s==null?void 0:s._audioSSRC));i=c==null?void 0:c.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),XG(ms(ms({},t),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Jt.ON_CRYPT_ERROR,()=>{ud(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(qt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Jt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,_e.TOKEN_EXPIRE),this.safeEmit(qt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Jt.ON_STREAM_FALLBACK_UPDATE,t=>{S.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(qt.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Jt.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),S.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(Jt.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Jt.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Dt.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case bt.PUBLISH:{if(!e)return;const r=e.ortc;if(r){var n,i;const s=r.some(d=>{let{stream_type:h}=d;return h===Ee.Audio}),c=r.some(d=>{let{stream_type:h}=d;return h!==Ee.Audio}),l=r.some(d=>{let{stream_type:h}=d;return h===Ee.Screen||h===Ee.ScreenLow});e.state==="offer"&&gt.publish(this._joinInfo.sid,{eventElapse:yi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:O.TIMEOUT,audio:s,video:c,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:s?(n=r.find(d=>{let{stream_type:h}=d;return h===Ee.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(i=r.find(d=>{let{stream_type:h}=d;return h!==Ee.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case bt.SUBSCRIBE:e&&gt.subscribe(this._joinInfo.sid,{succ:!1,ec:O.TIMEOUT,audio:e.stream_type===ut.AUDIO,video:e.stream_type===ut.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:yi.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(Jt.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(Jt.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;N("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(i=>!oh(i.string_id||i.stream_id,this.channelName)));const e=[],n=[];for(const i of t.users){let r=this._users.find(p=>p._uintid===i.stream_id);r?r._trust_in_room_=!0:(r=new Td(i.string_id||i.stream_id,i.stream_id),this._users.push(r),this.getListeners(qt.PUBLISHED_USER_LIST).length===0&&(S.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(qt.USER_JOINED,r)));const s=Gn.Audio&i.stream_type,c=(Gn.Video|Gn.LwoVideo)&i.stream_type,l=(65280&i.stream_type)!=0,d=s&&r.hasAudio,h=c&&r.hasVideo;c&&(r._trust_video_stream_added_state_=!0,r._video_added_=!0,r._videoSSRC=i.video_ssrc,r._rtxSsrcId=i.video_rtx),s&&(r._trust_audio_stream_added_state_=!0,r._audio_added_=!0,r._audioSSRC=i.audio_ssrc),s&&!d&&this.getListeners(qt.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published audio")),this.safeEmit(qt.USER_PUBLISHED,r,"audio")),c&&!h&&this.getListeners(qt.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," published video")),this.safeEmit(qt.USER_PUBLISHED,r,"video")),(s&&!d||c&&!h||l)&&e.push(r),c&&this._p2pChannel.hasPendingRemoteMedia(r,"video")&&n.push({user:r,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(r,"audio")&&n.push({user:r,mediaType:"audio"})}n.length>0&&(S.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{S.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(qt.PUBLISHED_USER_LIST).length>0?N("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(S.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(i=>i.uid).join(", "))),this.safeEmit(qt.PUBLISHED_USER_LIST,e)):S.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(i=>i.uid).join(", ")))}),this._gateway.signal.on(Jt.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof pg&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var i;return rt(i=Object.keys(vR)).call(i,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Jt.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(En.PUBLISH,(t,e,n)=>{const{uid:i}=t;t.forEach(r=>{const{kind:s,ssrcs:c,mid:l,isMuted:d}=r;this._handleP2PAddAudioOrVideoStream(s,i,c[0].ssrcId,l);const h=this._users.find(p=>p.uid===i);return h&&this.store.useP2P?this._p2pChannel.mockSubscribe(h,s,c[0].ssrcId,l).then(()=>{e()}).catch(n):e(),this._handleMuteStream(i,s,!!d)})}),this._gateway.signal.on(En.CALL,async(t,e,n)=>{if(this.store.useP2P)try{var i;e(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},t))}catch(r){n(r)}}),this._gateway.signal.on(Dt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(En.UNPUBLISH,async(t,e,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:r}=t,s=this._users.find(c=>c.uid===r);if(!s)return S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();try{i.forEach(async c=>{let{stream_type:l}=c;const d=l===Ee.Audio?ut.AUDIO:ut.VIDEO;await this._p2pChannel.unsubscribe(s,d),this._handleMuteStream(r,d,!0)}),e()}catch(c){n(c)}}}),this._gateway.signal.on(En.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case _d.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,ut.VIDEO,!0);break;case _d.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,ut.AUDIO,!0);break;case _d.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,ut.VIDEO,!1);break;case _d.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,ut.AUDIO,!1)}}),this._gateway.signal.on(En.RESTART_ICE,async(t,e,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:r}=t;i!==Qi.SEND_ONLY||r?e(await this._p2pChannel.restartICE(i,r)):(this._p2pChannel.handleDisconnect(i),e())}catch(i){n(i)}}),this._gateway.signal.on(En.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(vt.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:i}=t;e(await this._gateway.sendExtensionMessage(En.RESTART_ICE,t,i===Qi.SEND_ONLY))}catch(i){n(i)}}),this._p2pChannel.on(vt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(En.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(vt.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(En.CONTROL,t,!0),e()}catch(i){n(i)}}),this._p2pChannel.on(vt.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===O.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(vt.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===O.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(vt.StateChange,(t,e)=>{e===me.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(vt.PeerConnectionStateChange,t=>{const e=this._peerConnectionState;t!==e&&(this.safeEmit(qt.PEERCONNECTION_STATE_CHANGE,t,e),this._peerConnectionState=t)}),this._p2pChannel.on(vt.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===O.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(vt.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(i){i.code===O.DISCONNECT_P2P?e():n(i)}else e()}),this._p2pChannel.on(vt.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(vt.RequestRePublishDataChannel,(t,e,n)=>{st.all(t.map(async i=>{const r=await this._p2pChannel.publishDataChannel([i]);try{r.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==O.DISCONNECT_P2P)throw s}})).then(e).catch(n)}),this._p2pChannel.on(vt.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:i,kind:r}of t)r===ut.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");e()}catch(i){n(i)}}),this._p2pChannel.on(vt.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(vt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(vt.MediaReconnectStart,t=>{this.safeEmit(qt.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(vt.MediaReconnectEnd,t=>{this.safeEmit(qt.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(vt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(vt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(c){return void e.throw(c)}const{iceParameters:s}=function(c){const l=c.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(r);await e.next({remoteIceParameters:s})}),this._p2pChannel.on(vt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(vt.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:i}),c=IM(r,s);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(vt.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(vt.P2PLost,()=>{this.safeEmit(qt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(vt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(vt.ConnectionTypeChange,t=>{this.safeEmit(qt.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(vt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(vt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(vt.AudioMetadata,t=>{this.safeEmit(qt.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},Xc("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:r,sid:s,token:c,uid:l,cid:d,vid:h}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:r,sid:s,token:c,uid:l,cid:d,vid:h?Number(h):0},In)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(Xn.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(qt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===us.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(qt.CONTENT_INSPECT_ERROR,new B(O.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Xn.INSPECT_RESULT,(e,n)=>{var i;if((n==null?void 0:n.code)===O.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return S.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit(qt.CONTENT_INSPECT_RESULT,e,n)}),t.on(Xn.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Hc(t,"enabled"),t){if(!e)throw new B(O.INVALID_PARAMS,"config is required");if(W1(e),!this._joinInfo)throw new B(O.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const i=(n={config:e},Xc("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:r,cname:s,sid:c,token:l,uid:d,cid:h,vid:p}=this._joinInfo;await i.init({appId:r,areaCode:"",cname:s,sid:c,token:l,uid:d,cid:h,vid:p?Number(p):0},In)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new B(O.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(t){t.on(Xs.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(qt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===La.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new B(O.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Xs.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){xn(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new B(O.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,S.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return S.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Hc(t,"enabled"),Se("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Et(lt.prototype,"leave",[K1],Object.getOwnPropertyDescriptor(lt.prototype,"leave"),lt.prototype),Et(lt.prototype,"publish",[z1],Object.getOwnPropertyDescriptor(lt.prototype,"publish"),lt.prototype),Et(lt.prototype,"unpublish",[Y1],Object.getOwnPropertyDescriptor(lt.prototype,"unpublish"),lt.prototype),Et(lt.prototype,"subscribe",[q1],Object.getOwnPropertyDescriptor(lt.prototype,"subscribe"),lt.prototype),Et(lt.prototype,"presubscribe",[X1],Object.getOwnPropertyDescriptor(lt.prototype,"presubscribe"),lt.prototype),Et(lt.prototype,"massSubscribe",[J1],Object.getOwnPropertyDescriptor(lt.prototype,"massSubscribe"),lt.prototype),Et(lt.prototype,"unsubscribe",[Q1],Object.getOwnPropertyDescriptor(lt.prototype,"unsubscribe"),lt.prototype),Et(lt.prototype,"massUnsubscribe",[Z1],Object.getOwnPropertyDescriptor(lt.prototype,"massUnsubscribe"),lt.prototype),Et(lt.prototype,"setLowStreamParameter",[$1],Object.getOwnPropertyDescriptor(lt.prototype,"setLowStreamParameter"),lt.prototype),Et(lt.prototype,"enableDualStream",[tU],Object.getOwnPropertyDescriptor(lt.prototype,"enableDualStream"),lt.prototype),Et(lt.prototype,"disableDualStream",[eU],Object.getOwnPropertyDescriptor(lt.prototype,"disableDualStream"),lt.prototype),Et(lt.prototype,"setClientRole",[nU],Object.getOwnPropertyDescriptor(lt.prototype,"setClientRole"),lt.prototype),Et(lt.prototype,"_setClientRoleOptions",[iU],Object.getOwnPropertyDescriptor(lt.prototype,"_setClientRoleOptions"),lt.prototype),Et(lt.prototype,"setProxyServer",[rU],Object.getOwnPropertyDescriptor(lt.prototype,"setProxyServer"),lt.prototype),Et(lt.prototype,"setTurnServer",[aU],Object.getOwnPropertyDescriptor(lt.prototype,"setTurnServer"),lt.prototype),Et(lt.prototype,"setLicense",[sU],Object.getOwnPropertyDescriptor(lt.prototype,"setLicense"),lt.prototype),Et(lt.prototype,"startProxyServer",[oU],Object.getOwnPropertyDescriptor(lt.prototype,"startProxyServer"),lt.prototype),Et(lt.prototype,"stopProxyServer",[cU],Object.getOwnPropertyDescriptor(lt.prototype,"stopProxyServer"),lt.prototype),Et(lt.prototype,"setLocalAccessPointsV2",[lU],Object.getOwnPropertyDescriptor(lt.prototype,"setLocalAccessPointsV2"),lt.prototype),Et(lt.prototype,"setLocalAccessPoints",[dU],Object.getOwnPropertyDescriptor(lt.prototype,"setLocalAccessPoints"),lt.prototype),Et(lt.prototype,"setRemoteDefaultVideoStreamType",[uU],Object.getOwnPropertyDescriptor(lt.prototype,"setRemoteDefaultVideoStreamType"),lt.prototype),Et(lt.prototype,"setRemoteVideoStreamType",[hU],Object.getOwnPropertyDescriptor(lt.prototype,"setRemoteVideoStreamType"),lt.prototype),Et(lt.prototype,"setStreamFallbackOption",[pU],Object.getOwnPropertyDescriptor(lt.prototype,"setStreamFallbackOption"),lt.prototype),Et(lt.prototype,"setEncryptionConfig",[fU],Object.getOwnPropertyDescriptor(lt.prototype,"setEncryptionConfig"),lt.prototype),Et(lt.prototype,"renewToken",[_U],Object.getOwnPropertyDescriptor(lt.prototype,"renewToken"),lt.prototype),Et(lt.prototype,"enableAudioVolumeIndicator",[mU],Object.getOwnPropertyDescriptor(lt.prototype,"enableAudioVolumeIndicator"),lt.prototype),Et(lt.prototype,"startLiveStreaming",[EU],Object.getOwnPropertyDescriptor(lt.prototype,"startLiveStreaming"),lt.prototype),Et(lt.prototype,"setLiveTranscoding",[gU],Object.getOwnPropertyDescriptor(lt.prototype,"setLiveTranscoding"),lt.prototype),Et(lt.prototype,"stopLiveStreaming",[SU],Object.getOwnPropertyDescriptor(lt.prototype,"stopLiveStreaming"),lt.prototype),Et(lt.prototype,"startChannelMediaRelay",[TU],Object.getOwnPropertyDescriptor(lt.prototype,"startChannelMediaRelay"),lt.prototype),Et(lt.prototype,"updateChannelMediaRelay",[vU],Object.getOwnPropertyDescriptor(lt.prototype,"updateChannelMediaRelay"),lt.prototype),Et(lt.prototype,"stopChannelMediaRelay",[RU],Object.getOwnPropertyDescriptor(lt.prototype,"stopChannelMediaRelay"),lt.prototype),Et(lt.prototype,"sendCustomReportMessage",[yU],Object.getOwnPropertyDescriptor(lt.prototype,"sendCustomReportMessage"),lt.prototype),Et(lt.prototype,"pickSVCLayer",[CU],Object.getOwnPropertyDescriptor(lt.prototype,"pickSVCLayer"),lt.prototype),Et(lt.prototype,"setRTMConfig",[AU],Object.getOwnPropertyDescriptor(lt.prototype,"setRTMConfig"),lt.prototype),Et(lt.prototype,"enableContentInspect",[bU],Object.getOwnPropertyDescriptor(lt.prototype,"enableContentInspect"),lt.prototype),Et(lt.prototype,"disableContentInspect",[IU],Object.getOwnPropertyDescriptor(lt.prototype,"disableContentInspect"),lt.prototype),Et(lt.prototype,"setImageModeration",[OU],Object.getOwnPropertyDescriptor(lt.prototype,"setImageModeration"),lt.prototype),Et(lt.prototype,"setP2PTransport",[wU],Object.getOwnPropertyDescriptor(lt.prototype,"setP2PTransport"),lt.prototype),Et(lt.prototype,"getJoinChannelServiceRecords",[NU],Object.getOwnPropertyDescriptor(lt.prototype,"getJoinChannelServiceRecords"),lt.prototype),Et(lt.prototype,"setPublishAudioFilterEnabled",[DU],Object.getOwnPropertyDescriptor(lt.prototype,"setPublishAudioFilterEnabled"),lt.prototype),lt);class mg{constructor(e,n){A(this,"id",0),A(this,"element",void 0),A(this,"peerPair",void 0),A(this,"context",void 0),A(this,"audioPlayerElement",void 0),A(this,"audioTrack",void 0),mg.count+=1,this.id=mg.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(i,r)=>{const s=r==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(s),i.iceGatheringState==="complete"?i.localDescription:new st(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,r)=>await i.setRemoteDescription(r);try{const i=await e(this.peerPair[0],"offer");await n(this.peerPair[1],i);const r=await e(this.peerPair[1],"answer");await n(this.peerPair[0],r)}catch(i){throw new B(O.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(r){throw new B(O.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new B(O.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){S.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var PU,uy;A(mg,"count",0);const u5=window.AudioContext||window.webkitAudioContext,h5=new(PU=At({report:gt}),Et((uy=class{constructor(){A(this,"units",[]),A(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return S.debug("the system does not need to process local aec"),-1;this.context||(this.context=new u5);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new mg(t,this.context),this.units.push(e)),e.startEchoCancellation(),S.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return ae().name!==de.SAFARI}}).prototype,"processExternalMediaAEC",[PU],Object.getOwnPropertyDescriptor(uy.prototype,"processExternalMediaAEC"),uy.prototype),uy);function kU(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function MU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?kU(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kU(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}const oO=window||document;function UU(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!oO)return;const n=On._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const i=r=>{if(!(r&&r.blockedURI&&(On.onSecurityPolicyViolation||On.getListeners(Wo.SECURITY_POLICY_VIOLATION).length>0)))return;const s=r.blockedURI;N("CSP_DETECTED_HOSTNAME_LIST").some(c=>rt(s).call(s,c))&&(On.onSecurityPolicyViolation&&typeof On.onSecurityPolicyViolation=="function"&&On.onSecurityPolicyViolation(r),On.getListeners(Wo.SECURITY_POLICY_VIOLATION).length>0&&On.safeEmit(Wo.SECURITY_POLICY_VIOLATION,r))};n&&oO.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||On.getListeners(Wo.SECURITY_POLICY_VIOLATION).length>0)&&oO.addEventListener("securitypolicyviolation",i),On._cspEventHandlerPointer=i}var p5=he,f5=SD,xU=RegExp.prototype,_5=function(t){return t===xU||p5(xU,t)?f5(t):t.flags},Gi=kt(_5);function Qf(t){let e=t.length;for(;--e>=0;)t[e]=0}const cO=256,VU=286,Eg=30,gg=15,lO=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),hy=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),m5=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),BU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qc=new Array(576);Qf(Qc);const Sg=new Array(60);Qf(Sg);const Tg=new Array(512);Qf(Tg);const vg=new Array(256);Qf(vg);const dO=new Array(29);Qf(dO);const py=new Array(Eg);function uO(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}let FU,jU,GU;function hO(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}Qf(py);const HU=t=>t<256?Tg[t]:Tg[256+(t>>>7)],Rg=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},ua=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,Rg(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},Xo=(t,e,n)=>{ua(t,n[2*e],n[2*e+1])},WU=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},KU=(t,e,n)=>{const i=new Array(16);let r,s,c=0;for(r=1;r<=gg;r++)c=c+n[r-1]<<1,i[r]=c;for(s=0;s<=e;s++){let l=t[2*s+1];l!==0&&(t[2*s]=WU(i[l]++,l))}},zU=t=>{let e;for(e=0;e<VU;e++)t.dyn_ltree[2*e]=0;for(e=0;e<Eg;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},YU=t=>{t.bi_valid>8?Rg(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},qU=(t,e,n,i)=>{const r=2*e,s=2*n;return t[r]<t[s]||t[r]===t[s]&&i[e]<=i[n]},pO=(t,e,n)=>{const i=t.heap[n];let r=n<<1;for(;r<=t.heap_len&&(r<t.heap_len&&qU(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!qU(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},XU=(t,e,n)=>{let i,r,s,c,l=0;if(t.sym_next!==0)do i=255&t.pending_buf[t.sym_buf+l++],i+=(255&t.pending_buf[t.sym_buf+l++])<<8,r=t.pending_buf[t.sym_buf+l++],i===0?Xo(t,r,e):(s=vg[r],Xo(t,s+cO+1,e),c=lO[s],c!==0&&(r-=dO[s],ua(t,r,c)),i--,s=HU(i),Xo(t,s,n),c=hy[s],c!==0&&(i-=py[s],ua(t,i,c)));while(l<t.sym_next);Xo(t,256,e)},fO=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,s=e.stat_desc.elems;let c,l,d,h=-1;for(t.heap_len=0,t.heap_max=573,c=0;c<s;c++)n[2*c]!==0?(t.heap[++t.heap_len]=h=c,t.depth[c]=0):n[2*c+1]=0;for(;t.heap_len<2;)d=t.heap[++t.heap_len]=h<2?++h:0,n[2*d]=1,t.depth[d]=0,t.opt_len--,r&&(t.static_len-=i[2*d+1]);for(e.max_code=h,c=t.heap_len>>1;c>=1;c--)pO(t,n,c);d=s;do c=t.heap[1],t.heap[1]=t.heap[t.heap_len--],pO(t,n,1),l=t.heap[1],t.heap[--t.heap_max]=c,t.heap[--t.heap_max]=l,n[2*d]=n[2*c]+n[2*l],t.depth[d]=(t.depth[c]>=t.depth[l]?t.depth[c]:t.depth[l])+1,n[2*c+1]=n[2*l+1]=d,t.heap[1]=d++,pO(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((p,_)=>{const m=_.dyn_tree,g=_.max_code,C=_.stat_desc.static_tree,R=_.stat_desc.has_stree,y=_.stat_desc.extra_bits,b=_.stat_desc.extra_base,I=_.stat_desc.max_length;let L,U,x,M,j,K,it=0;for(M=0;M<=gg;M++)p.bl_count[M]=0;for(m[2*p.heap[p.heap_max]+1]=0,L=p.heap_max+1;L<573;L++)U=p.heap[L],M=m[2*m[2*U+1]+1]+1,M>I&&(M=I,it++),m[2*U+1]=M,U>g||(p.bl_count[M]++,j=0,U>=b&&(j=y[U-b]),K=m[2*U],p.opt_len+=K*(M+j),R&&(p.static_len+=K*(C[2*U+1]+j)));if(it!==0){do{for(M=I-1;p.bl_count[M]===0;)M--;p.bl_count[M]--,p.bl_count[M+1]+=2,p.bl_count[I]--,it-=2}while(it>0);for(M=I;M!==0;M--)for(U=p.bl_count[M];U!==0;)x=p.heap[--L],x>g||(m[2*x+1]!==M&&(p.opt_len+=(M-m[2*x+1])*m[2*x],m[2*x+1]=M),U--)}})(t,e),KU(n,h,t.bl_count)},JU=(t,e,n)=>{let i,r,s=-1,c=e[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=c,c=e[2*(i+1)+1],++l<d&&r===c||(l<h?t.bl_tree[2*r]+=l:r!==0?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[32]++):l<=10?t.bl_tree[34]++:t.bl_tree[36]++,l=0,s=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4))},QU=(t,e,n)=>{let i,r,s=-1,c=e[1],l=0,d=7,h=4;for(c===0&&(d=138,h=3),i=0;i<=n;i++)if(r=c,c=e[2*(i+1)+1],!(++l<d&&r===c)){if(l<h)do Xo(t,r,t.bl_tree);while(--l!=0);else r!==0?(r!==s&&(Xo(t,r,t.bl_tree),l--),Xo(t,16,t.bl_tree),ua(t,l-3,2)):l<=10?(Xo(t,17,t.bl_tree),ua(t,l-3,3)):(Xo(t,18,t.bl_tree),ua(t,l-11,7));l=0,s=r,c===0?(d=138,h=3):r===c?(d=6,h=3):(d=7,h=4)}};let ZU=!1;const $U=(t,e,n,i)=>{ua(t,0+(i?1:0),3),YU(t),Rg(t,n),Rg(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var E5=t=>{ZU||((()=>{let e,n,i,r,s;const c=new Array(16);for(i=0,r=0;r<28;r++)for(dO[r]=i,e=0;e<1<<lO[r];e++)vg[i++]=r;for(vg[i-1]=r,s=0,r=0;r<16;r++)for(py[r]=s,e=0;e<1<<hy[r];e++)Tg[s++]=r;for(s>>=7;r<Eg;r++)for(py[r]=s<<7,e=0;e<1<<hy[r]-7;e++)Tg[256+s++]=r;for(n=0;n<=gg;n++)c[n]=0;for(e=0;e<=143;)Qc[2*e+1]=8,e++,c[8]++;for(;e<=255;)Qc[2*e+1]=9,e++,c[9]++;for(;e<=279;)Qc[2*e+1]=7,e++,c[7]++;for(;e<=287;)Qc[2*e+1]=8,e++,c[8]++;for(KU(Qc,287,c),e=0;e<Eg;e++)Sg[2*e+1]=5,Sg[2*e]=WU(e,5);FU=new uO(Qc,lO,257,VU,gg),jU=new uO(Sg,hy,0,Eg,gg),GU=new uO(new Array(0),m5,0,19,7)})(),ZU=!0),t.l_desc=new hO(t.dyn_ltree,FU),t.d_desc=new hO(t.dyn_dtree,jU),t.bl_desc=new hO(t.bl_tree,GU),t.bi_buf=0,t.bi_valid=0,zU(t)},g5=(t,e,n,i)=>{let r,s,c=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(l=>{let d,h=4093624447;for(d=0;d<=31;d++,h>>>=1)if(1&h&&l.dyn_ltree[2*d]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(d=32;d<cO;d++)if(l.dyn_ltree[2*d]!==0)return 1;return 0})(t)),fO(t,t.l_desc),fO(t,t.d_desc),c=(l=>{let d;for(JU(l,l.dyn_ltree,l.l_desc.max_code),JU(l,l.dyn_dtree,l.d_desc.max_code),fO(l,l.bl_desc),d=18;d>=3&&l.bl_tree[2*BU[d]+1]===0;d--);return l.opt_len+=3*(d+1)+5+5+4,d})(t),r=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=r&&(r=s)):r=s=n+5,n+4<=r&&e!==-1?$U(t,e,n,i):t.strategy===4||s===r?(ua(t,2+(i?1:0),3),XU(t,Qc,Sg)):(ua(t,4+(i?1:0),3),((l,d,h,p)=>{let _;for(ua(l,d-257,5),ua(l,h-1,5),ua(l,p-4,4),_=0;_<p;_++)ua(l,l.bl_tree[2*BU[_]+1],3);QU(l,l.dyn_ltree,d-1),QU(l,l.dyn_dtree,h-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),XU(t,t.dyn_ltree,t.dyn_dtree)),zU(t),i&&YU(t)},S5=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(vg[n]+cO+1)]++,t.dyn_dtree[2*HU(e)]++),t.sym_next===t.sym_end),T5=t=>{ua(t,2,3),Xo(t,256,Qc),(e=>{e.bi_valid===16?(Rg(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},v5={_tr_init:E5,_tr_stored_block:$U,_tr_flush_block:g5,_tr_tally:S5,_tr_align:T5},yg=(t,e,n,i)=>{let r=65535&t|0,s=t>>>16&65535|0,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do r=r+e[i++]|0,s=s+r|0;while(--c);r%=65521,s%=65521}return r|s<<16|0};const R5=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var $i=(t,e,n,i)=>{const r=R5,s=i+n;t^=-1;for(let c=i;c<s;c++)t=t>>>8^r[255&(t^e[c])];return-1^t},ph={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},fy={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:y5,_tr_stored_block:_O,_tr_flush_block:C5,_tr_tally:Cd,_tr_align:A5}=v5,{Z_NO_FLUSH:Ad,Z_PARTIAL_FLUSH:b5,Z_FULL_FLUSH:I5,Z_FINISH:Es,Z_BLOCK:t2,Z_OK:dr,Z_STREAM_END:e2,Z_STREAM_ERROR:Jo,Z_DATA_ERROR:O5,Z_BUF_ERROR:mO,Z_DEFAULT_COMPRESSION:w5,Z_FILTERED:N5,Z_HUFFMAN_ONLY:_y,Z_RLE:D5,Z_FIXED:L5,Z_DEFAULT_STRATEGY:P5,Z_UNKNOWN:k5,Z_DEFLATED:my}=fy,EO=286,M5=30,U5=19,x5=2*EO+1,V5=15,fh=258,Qo=262,Zf=42,_h=113,Cg=666,mh=(t,e)=>(t.msg=ph[e],e),n2=t=>2*t-(t>4?9:0),bd=t=>{let e=t.length;for(;--e>=0;)t[e]=0},B5=t=>{let e,n,i,r=t.w_size;e=t.hash_size,i=e;do n=t.head[--i],t.head[i]=n>=r?n-r:0;while(--e);e=r,i=e;do n=t.prev[--i],t.prev[i]=n>=r?n-r:0;while(--e)};let Id=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const Pa=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},ka=(t,e)=>{C5(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Pa(t.strm)},un=(t,e)=>{t.pending_buf[t.pending++]=e},Ag=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},gO=(t,e,n,i)=>{let r=t.avail_in;return r>i&&(r=i),r===0?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),t.state.wrap===1?t.adler=yg(t.adler,e,r,n):t.state.wrap===2&&(t.adler=$i(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},i2=(t,e)=>{let n,i,r=t.max_chain_length,s=t.strstart,c=t.prev_length,l=t.nice_match;const d=t.strstart>t.w_size-Qo?t.strstart-(t.w_size-Qo):0,h=t.window,p=t.w_mask,_=t.prev,m=t.strstart+fh;let g=h[s+c-1],C=h[s+c];t.prev_length>=t.good_match&&(r>>=2),l>t.lookahead&&(l=t.lookahead);do if(n=e,h[n+c]===C&&h[n+c-1]===g&&h[n]===h[s]&&h[++n]===h[s+1]){s+=2,n++;do;while(h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&h[++s]===h[++n]&&s<m);if(i=fh-(m-s),s=m-fh,i>c){if(t.match_start=e,c=i,i>=l)break;g=h[s+c-1],C=h[s+c]}}while((e=_[e&p])>d&&--r!=0);return c<=t.lookahead?c:t.lookahead},$f=t=>{const e=t.w_size;let n,i,r;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Qo)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),B5(t),i+=e),t.strm.avail_in===0)break;if(n=gO(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=Id(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=Id(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Qo&&t.strm.avail_in!==0)},r2=(t,e)=>{let n,i,r,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,c=0,l=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>r&&(n=r),n<s&&(n===0&&e!==Es||e===Ad||n!==i+t.strm.avail_in)))break;c=e===Es&&n===i+t.strm.avail_in?1:0,_O(t,0,0,c),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,Pa(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&(gO(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(c===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),c?4:e!==Ad&&e!==Es&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(gO(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,s=r>t.w_size?t.w_size:r,i=t.strstart-t.block_start,(i>=s||(i||e===Es)&&e!==Ad&&t.strm.avail_in===0&&i<=r)&&(n=i>r?r:i,c=e===Es&&t.strm.avail_in===0&&n===i?1:0,_O(t,t.block_start,n,c),t.block_start+=n,Pa(t.strm)),c?3:1)},SO=(t,e)=>{let n,i;for(;;){if(t.lookahead<Qo){if($f(t),t.lookahead<Qo&&e===Ad)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=Id(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-Qo&&(t.match_length=i2(t,n)),t.match_length>=3)if(i=Cd(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=Id(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Id(t,t.ins_h,t.window[t.strstart+1]);else i=Cd(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(ka(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Es?(ka(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ka(t,!1),t.strm.avail_out===0)?1:2},t_=(t,e)=>{let n,i,r;for(;;){if(t.lookahead<Qo){if($f(t),t.lookahead<Qo&&e===Ad)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=Id(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Qo&&(t.match_length=i2(t,n),t.match_length<=5&&(t.strategy===N5||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=Cd(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=r&&(t.ins_h=Id(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(ka(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(i=Cd(t,0,t.window[t.strstart-1]),i&&ka(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=Cd(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Es?(ka(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(ka(t,!1),t.strm.avail_out===0)?1:2};function Zo(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}const bg=[new Zo(0,0,0,0,r2),new Zo(4,4,8,4,SO),new Zo(4,5,16,8,SO),new Zo(4,6,32,32,SO),new Zo(4,4,16,16,t_),new Zo(8,16,32,32,t_),new Zo(8,16,128,128,t_),new Zo(8,32,128,256,t_),new Zo(32,128,258,1024,t_),new Zo(32,258,258,4096,t_)];function F5(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=my,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*x5),this.dyn_dtree=new Uint16Array(2*(2*M5+1)),this.bl_tree=new Uint16Array(2*(2*U5+1)),bd(this.dyn_ltree),bd(this.dyn_dtree),bd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(V5+1),this.heap=new Uint16Array(2*EO+1),bd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*EO+1),bd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ig=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Zf&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==_h&&e.status!==Cg?1:0},a2=t=>{if(Ig(t))return mh(t,Jo);t.total_in=t.total_out=0,t.data_type=k5;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?Zf:_h,t.adler=e.wrap===2?0:1,e.last_flush=-2,y5(e),dr},s2=t=>{const e=a2(t);return e===dr&&(n=>{n.window_size=2*n.w_size,bd(n.head),n.max_lazy_match=bg[n.level].max_lazy,n.good_match=bg[n.level].good_length,n.nice_match=bg[n.level].nice_length,n.max_chain_length=bg[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},o2=(t,e,n,i,r,s)=>{if(!t)return Jo;let c=1;if(e===w5&&(e=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),r<1||r>9||n!==my||i<8||i>15||e<0||e>9||s<0||s>L5||i===8&&c!==1)return mh(t,Jo);i===8&&(i=9);const l=new F5;return t.state=l,l.strm=t,l.status=Zf,l.wrap=c,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=e,l.strategy=s,l.method=n,s2(t)};var j5=(t,e)=>{if(Ig(t)||e>t2||e<0)return t?mh(t,Jo):Jo;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===Cg&&e!==Es)return mh(t,t.avail_out===0?mO:Jo);const i=n.last_flush;if(n.last_flush=e,n.pending!==0){if(Pa(t),t.avail_out===0)return n.last_flush=-1,dr}else if(t.avail_in===0&&n2(e)<=n2(i)&&e!==Es)return mh(t,mO);if(n.status===Cg&&t.avail_in!==0)return mh(t,mO);if(n.status===Zf&&n.wrap===0&&(n.status=_h),n.status===Zf){let r=my+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=_y||n.level<2?0:n.level<6?1:n.level===6?2:3,r|=s<<6,n.strstart!==0&&(r|=32),r+=31-r%31,Ag(n,r),n.strstart!==0&&(Ag(n,t.adler>>>16),Ag(n,65535&t.adler)),t.adler=1,n.status=_h,Pa(t),n.pending!==0)return n.last_flush=-1,dr}if(n.status===57){if(t.adler=0,un(n,31),un(n,139),un(n,8),n.gzhead)un(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),un(n,255&n.gzhead.time),un(n,n.gzhead.time>>8&255),un(n,n.gzhead.time>>16&255),un(n,n.gzhead.time>>24&255),un(n,n.level===9?2:n.strategy>=_y||n.level<2?4:0),un(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(un(n,255&n.gzhead.extra.length),un(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=$i(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(un(n,0),un(n,0),un(n,0),un(n,0),un(n,0),un(n,n.level===9?2:n.strategy>=_y||n.level<2?4:0),un(n,3),n.status=_h,Pa(t),n.pending!==0)return n.last_flush=-1,dr}if(n.status===69){if(n.gzhead.extra){let r=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>r&&(t.adler=$i(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex+=l,Pa(t),n.pending!==0)return n.last_flush=-1,dr;r=0,s-=l}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>r&&(t.adler=$i(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=$i(t.adler,n.pending_buf,n.pending-s,s)),Pa(t),n.pending!==0)return n.last_flush=-1,dr;s=0}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,un(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=$i(t.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let r,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=$i(t.adler,n.pending_buf,n.pending-s,s)),Pa(t),n.pending!==0)return n.last_flush=-1,dr;s=0}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,un(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=$i(t.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Pa(t),n.pending!==0))return n.last_flush=-1,dr;un(n,255&t.adler),un(n,t.adler>>8&255),t.adler=0}if(n.status=_h,Pa(t),n.pending!==0)return n.last_flush=-1,dr}if(t.avail_in!==0||n.lookahead!==0||e!==Ad&&n.status!==Cg){let r=n.level===0?r2(n,e):n.strategy===_y?((s,c)=>{let l;for(;;){if(s.lookahead===0&&($f(s),s.lookahead===0)){if(c===Ad)return 1;break}if(s.match_length=0,l=Cd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,l&&(ka(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===Es?(ka(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(ka(s,!1),s.strm.avail_out===0)?1:2})(n,e):n.strategy===D5?((s,c)=>{let l,d,h,p;const _=s.window;for(;;){if(s.lookahead<=fh){if($f(s),s.lookahead<=fh&&c===Ad)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(h=s.strstart-1,d=_[h],d===_[++h]&&d===_[++h]&&d===_[++h])){p=s.strstart+fh;do;while(d===_[++h]&&d===_[++h]&&d===_[++h]&&d===_[++h]&&d===_[++h]&&d===_[++h]&&d===_[++h]&&d===_[++h]&&h<p);s.match_length=fh-(p-h),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(l=Cd(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(l=Cd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),l&&(ka(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,c===Es?(ka(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(ka(s,!1),s.strm.avail_out===0)?1:2})(n,e):bg[n.level].func(n,e);if(r!==3&&r!==4||(n.status=Cg),r===1||r===3)return t.avail_out===0&&(n.last_flush=-1),dr;if(r===2&&(e===b5?A5(n):e!==t2&&(_O(n,0,0,!1),e===I5&&(bd(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Pa(t),t.avail_out===0))return n.last_flush=-1,dr}return e!==Es?dr:n.wrap<=0?e2:(n.wrap===2?(un(n,255&t.adler),un(n,t.adler>>8&255),un(n,t.adler>>16&255),un(n,t.adler>>24&255),un(n,255&t.total_in),un(n,t.total_in>>8&255),un(n,t.total_in>>16&255),un(n,t.total_in>>24&255)):(Ag(n,t.adler>>>16),Ag(n,65535&t.adler)),Pa(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?dr:e2)},G5=(t,e)=>{let n=e.length;if(Ig(t))return Jo;const i=t.state,r=i.wrap;if(r===2||r===1&&i.status!==Zf||i.lookahead)return Jo;if(r===1&&(t.adler=yg(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){r===0&&(bd(i.head),i.strstart=0,i.block_start=0,i.insert=0);let d=new Uint8Array(i.w_size);d.set(e.subarray(n-i.w_size,n),0),e=d,n=i.w_size}const s=t.avail_in,c=t.next_in,l=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,$f(i);i.lookahead>=3;){let d=i.strstart,h=i.lookahead-2;do i.ins_h=Id(i,i.ins_h,i.window[d+3-1]),i.prev[d&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=d,d++;while(--h);i.strstart=d,i.lookahead=2,$f(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=l,t.avail_in=s,i.wrap=r,dr},Og={deflateInit:(t,e)=>o2(t,e,my,15,8,P5),deflateInit2:o2,deflateReset:s2,deflateResetKeep:a2,deflateSetHeader:(t,e)=>Ig(t)||t.state.wrap!==2?Jo:(t.state.gzhead=e,dr),deflate:j5,deflateEnd:t=>{if(Ig(t))return Jo;const e=t.state.status;return t.state=null,e===_h?mh(t,O5):dr},deflateSetDictionary:G5,deflateInfo:"pako deflate (from Nodeca project)"};const H5=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Ey={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)H5(n,i)&&(t[i]=n[i])}}return t},flattenChunks:t=>{let e=0;for(let i=0,r=t.length;i<r;i++)e+=t[i].length;const n=new Uint8Array(e);for(let i=0,r=0,s=t.length;i<s;i++){let c=t[i];n.set(c,r),r+=c.length}return n}};let c2=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{c2=!1}const wg=new Uint8Array(256);for(let t=0;t<256;t++)wg[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;wg[254]=wg[254]=1;var Ng={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,i,r,s,c=t.length,l=0;for(r=0;r<c;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(l),s=0,r=0;s<l;r++)n=t.charCodeAt(r),(64512&n)==55296&&r+1<c&&(i=t.charCodeAt(r+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let i,r;const s=new Array(2*n);for(r=0,i=0;i<n;){let c=t[i++];if(c<128){s[r++]=c;continue}let l=wg[c];if(l>4)s[r++]=65533,i+=l-1;else{for(c&=l===2?31:l===3?15:7;l>1&&i<n;)c=c<<6|63&t[i++],l--;l>1?s[r++]=65533:c<65536?s[r++]=c:(c-=65536,s[r++]=55296|c>>10&1023,s[r++]=56320|1023&c)}}return((c,l)=>{if(l<65534&&c.subarray&&c2)return String.fromCharCode.apply(null,c.length===l?c:c.subarray(0,l));let d="";for(let h=0;h<l;h++)d+=String.fromCharCode(c[h]);return d})(s,r)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+wg[t[n]]>e?n:e}},l2=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const d2=Object.prototype.toString,{Z_NO_FLUSH:W5,Z_SYNC_FLUSH:K5,Z_FULL_FLUSH:z5,Z_FINISH:Y5,Z_OK:gy,Z_STREAM_END:q5,Z_DEFAULT_COMPRESSION:X5,Z_DEFAULT_STRATEGY:J5,Z_DEFLATED:Q5}=fy;function Sy(t){this.options=Ey.assign({level:X5,method:Q5,chunkSize:16384,windowBits:15,memLevel:8,strategy:J5},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l2,this.strm.avail_out=0;let n=Og.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==gy)throw new Error(ph[n]);if(e.header&&Og.deflateSetHeader(this.strm,e.header),e.dictionary){let i;if(i=typeof e.dictionary=="string"?Ng.string2buf(e.dictionary):d2.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=Og.deflateSetDictionary(this.strm,i),n!==gy)throw new Error(ph[n]);this._dict_set=!0}}function Z5(t,e){const n=new Sy(e);if(n.push(t,!0),n.err)throw n.msg||ph[n.err];return n.result}Sy.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let r,s;if(this.ended)return!1;for(s=e===~~e?e:e===!0?Y5:W5,typeof t=="string"?n.input=Ng.string2buf(t):d2.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(s===K5||s===z5)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=Og.deflate(n,s),r===q5)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=Og.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===gy;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Sy.prototype.onData=function(t){this.chunks.push(t)},Sy.prototype.onEnd=function(t){t===gy&&(this.result=Ey.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var $5={deflate:Z5};const Ty=16209;var t6=function(t,e){let n,i,r,s,c,l,d,h,p,_,m,g,C,R,y,b,I,L,U,x,M,j,K,it;const dt=t.state;n=t.next_in,K=t.input,i=n+(t.avail_in-5),r=t.next_out,it=t.output,s=r-(e-t.avail_out),c=r+(t.avail_out-257),l=dt.dmax,d=dt.wsize,h=dt.whave,p=dt.wnext,_=dt.window,m=dt.hold,g=dt.bits,C=dt.lencode,R=dt.distcode,y=(1<<dt.lenbits)-1,b=(1<<dt.distbits)-1;t:do{g<15&&(m+=K[n++]<<g,g+=8,m+=K[n++]<<g,g+=8),I=C[m&y];e:for(;;){if(L=I>>>24,m>>>=L,g-=L,L=I>>>16&255,L===0)it[r++]=65535&I;else{if(!(16&L)){if((64&L)==0){I=C[(65535&I)+(m&(1<<L)-1)];continue e}if(32&L){dt.mode=16191;break t}t.msg="invalid literal/length code",dt.mode=Ty;break t}U=65535&I,L&=15,L&&(g<L&&(m+=K[n++]<<g,g+=8),U+=m&(1<<L)-1,m>>>=L,g-=L),g<15&&(m+=K[n++]<<g,g+=8,m+=K[n++]<<g,g+=8),I=R[m&b];n:for(;;){if(L=I>>>24,m>>>=L,g-=L,L=I>>>16&255,!(16&L)){if((64&L)==0){I=R[(65535&I)+(m&(1<<L)-1)];continue n}t.msg="invalid distance code",dt.mode=Ty;break t}if(x=65535&I,L&=15,g<L&&(m+=K[n++]<<g,g+=8,g<L&&(m+=K[n++]<<g,g+=8)),x+=m&(1<<L)-1,x>l){t.msg="invalid distance too far back",dt.mode=Ty;break t}if(m>>>=L,g-=L,L=r-s,x>L){if(L=x-L,L>h&&dt.sane){t.msg="invalid distance too far back",dt.mode=Ty;break t}if(M=0,j=_,p===0){if(M+=d-L,L<U){U-=L;do it[r++]=_[M++];while(--L);M=r-x,j=it}}else if(p<L){if(M+=d+p-L,L-=p,L<U){U-=L;do it[r++]=_[M++];while(--L);if(M=0,p<U){L=p,U-=L;do it[r++]=_[M++];while(--L);M=r-x,j=it}}}else if(M+=p-L,L<U){U-=L;do it[r++]=_[M++];while(--L);M=r-x,j=it}for(;U>2;)it[r++]=j[M++],it[r++]=j[M++],it[r++]=j[M++],U-=3;U&&(it[r++]=j[M++],U>1&&(it[r++]=j[M++]))}else{M=r-x;do it[r++]=it[M++],it[r++]=it[M++],it[r++]=it[M++],U-=3;while(U>2);U&&(it[r++]=it[M++],U>1&&(it[r++]=it[M++]))}break}}break}}while(n<i&&r<c);U=g>>3,n-=U,g-=U<<3,m&=(1<<g)-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<c?c-r+257:257-(r-c),dt.hold=m,dt.bits=g};const vy=15,e6=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),n6=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),i6=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),r6=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Dg=(t,e,n,i,r,s,c,l)=>{const d=l.bits;let h,p,_,m,g,C,R=0,y=0,b=0,I=0,L=0,U=0,x=0,M=0,j=0,K=0,it=null;const dt=new Uint16Array(16),Ft=new Uint16Array(16);let Vt,It,Ue,Ae=null;for(R=0;R<=vy;R++)dt[R]=0;for(y=0;y<i;y++)dt[e[n+y]]++;for(L=d,I=vy;I>=1&&dt[I]===0;I--);if(L>I&&(L=I),I===0)return r[s++]=20971520,r[s++]=20971520,l.bits=1,0;for(b=1;b<I&&dt[b]===0;b++);for(L<b&&(L=b),M=1,R=1;R<=vy;R++)if(M<<=1,M-=dt[R],M<0)return-1;if(M>0&&(t===0||I!==1))return-1;for(Ft[1]=0,R=1;R<vy;R++)Ft[R+1]=Ft[R]+dt[R];for(y=0;y<i;y++)e[n+y]!==0&&(c[Ft[e[n+y]]++]=y);if(t===0?(it=Ae=c,C=20):t===1?(it=e6,Ae=n6,C=257):(it=i6,Ae=r6,C=0),K=0,y=0,R=b,g=s,U=L,x=0,_=-1,j=1<<L,m=j-1,t===1&&j>852||t===2&&j>592)return 1;for(;;){Vt=R-x,c[y]+1<C?(It=0,Ue=c[y]):c[y]>=C?(It=Ae[c[y]-C],Ue=it[c[y]-C]):(It=96,Ue=0),h=1<<R-x,p=1<<U,b=p;do p-=h,r[g+(K>>x)+p]=Vt<<24|It<<16|Ue|0;while(p!==0);for(h=1<<R-1;K&h;)h>>=1;if(h!==0?(K&=h-1,K+=h):K=0,y++,--dt[R]==0){if(R===I)break;R=e[n+c[y]]}if(R>L&&(K&m)!==_){for(x===0&&(x=L),g+=b,U=R-x,M=1<<U;U+x<I&&(M-=dt[U+x],!(M<=0));)U++,M<<=1;if(j+=1<<U,t===1&&j>852||t===2&&j>592)return 1;_=K&m,r[_]=L<<24|U<<16|g-s|0}}return K!==0&&(r[g+K]=R-x<<24|64<<16|0),l.bits=L,0};const{Z_FINISH:u2,Z_BLOCK:a6,Z_TREES:Ry,Z_OK:Eh,Z_STREAM_END:s6,Z_NEED_DICT:o6,Z_STREAM_ERROR:gs,Z_DATA_ERROR:h2,Z_MEM_ERROR:p2,Z_BUF_ERROR:c6,Z_DEFLATED:f2}=fy,yy=16180,Cy=16190,Zc=16191,TO=16192,vO=16194,Ay=16199,by=16200,RO=16206,Jn=16209,_2=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function l6(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const gh=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<yy||e.mode>16211?1:0},m2=t=>{if(gh(t))return gs;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=yy,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Eh},E2=t=>{if(gh(t))return gs;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,m2(t)},g2=(t,e)=>{let n;if(gh(t))return gs;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?gs:(i.window!==null&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,E2(t))},S2=(t,e)=>{if(!t)return gs;const n=new l6;t.state=n,n.strm=t,n.window=null,n.mode=yy;const i=g2(t,e);return i!==Eh&&(t.state=null),i};let yO,CO,T2=!0;const d6=t=>{if(T2){yO=new Int32Array(512),CO=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Dg(1,t.lens,0,288,yO,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Dg(2,t.lens,0,32,CO,0,t.work,{bits:5}),T2=!1}t.lencode=yO,t.lenbits=9,t.distcode=CO,t.distbits=5},v2=(t,e,n,i)=>{let r;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>i&&(r=i),s.window.set(e.subarray(n-i,n-i+r),s.wnext),(i-=r)?(s.window.set(e.subarray(n-i,n),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var u6=(t,e)=>{let n,i,r,s,c,l,d,h,p,_,m,g,C,R,y,b,I,L,U,x,M,j,K=0;const it=new Uint8Array(4);let dt,Ft;const Vt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(gh(t)||!t.output||!t.input&&t.avail_in!==0)return gs;n=t.state,n.mode===Zc&&(n.mode=TO),c=t.next_out,r=t.output,d=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,_=l,m=d,j=Eh;t:for(;;)switch(n.mode){case yy:if(n.wrap===0){n.mode=TO;break}for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(2&n.wrap&&h===35615){n.wbits===0&&(n.wbits=15),n.check=0,it[0]=255&h,it[1]=h>>>8&255,n.check=$i(n.check,it,2,0),h=0,p=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",n.mode=Jn;break}if((15&h)!==f2){t.msg="unknown compression method",n.mode=Jn;break}if(h>>>=4,p-=4,M=8+(15&h),n.wbits===0&&(n.wbits=M),M>15||M>n.wbits){t.msg="invalid window size",n.mode=Jn;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&h?16189:Zc,h=0,p=0;break;case 16181:for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(n.flags=h,(255&Gi(n))!==f2){t.msg="unknown compression method",n.mode=Jn;break}if(57344&Gi(n)){t.msg="unknown header flags set",n.mode=Jn;break}n.head&&(n.head.text=h>>8&1),512&Gi(n)&&4&n.wrap&&(it[0]=255&h,it[1]=h>>>8&255,n.check=$i(n.check,it,2,0)),h=0,p=0,n.mode=16182;case 16182:for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.head&&(n.head.time=h),512&Gi(n)&&4&n.wrap&&(it[0]=255&h,it[1]=h>>>8&255,it[2]=h>>>16&255,it[3]=h>>>24&255,n.check=$i(n.check,it,4,0)),h=0,p=0,n.mode=16183;case 16183:for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&Gi(n)&&4&n.wrap&&(it[0]=255&h,it[1]=h>>>8&255,n.check=$i(n.check,it,2,0)),h=0,p=0,n.mode=16184;case 16184:if(1024&Gi(n)){for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),512&Gi(n)&&4&n.wrap&&(it[0]=255&h,it[1]=h>>>8&255,n.check=$i(n.check,it,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&Gi(n)&&(g=n.length,g>l&&(g=l),g&&(n.head&&(M=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(s,s+g),M)),512&Gi(n)&&4&n.wrap&&(n.check=$i(n.check,i,g,s)),l-=g,s+=g,n.length-=g),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&Gi(n)){if(l===0)break t;g=0;do M=i[s+g++],n.head&&M&&n.length<65536&&(n.head.name+=String.fromCharCode(M));while(M&&g<l);if(512&Gi(n)&&4&n.wrap&&(n.check=$i(n.check,i,g,s)),l-=g,s+=g,M)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&Gi(n)){if(l===0)break t;g=0;do M=i[s+g++],n.head&&M&&n.length<65536&&(n.head.comment+=String.fromCharCode(M));while(M&&g<l);if(512&Gi(n)&&4&n.wrap&&(n.check=$i(n.check,i,g,s)),l-=g,s+=g,M)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&Gi(n)){for(;p<16;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(4&n.wrap&&h!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Jn;break}h=0,p=0}n.head&&(n.head.hcrc=Gi(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Zc;break;case 16189:for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}t.adler=n.check=_2(h),h=0,p=0,n.mode=Cy;case Cy:if(n.havedict===0)return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,o6;t.adler=n.check=1,n.mode=Zc;case Zc:if(e===a6||e===Ry)break t;case TO:if(n.last){h>>>=7&p,p-=7&p,n.mode=RO;break}for(;p<3;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}switch(n.last=1&h,h>>>=1,p-=1,3&h){case 0:n.mode=16193;break;case 1:if(d6(n),n.mode=Ay,e===Ry){h>>>=2,p-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=Jn}h>>>=2,p-=2;break;case 16193:for(h>>>=7&p,p-=7&p;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Jn;break}if(n.length=65535&h,h=0,p=0,n.mode=vO,e===Ry)break t;case vO:n.mode=16195;case 16195:if(g=n.length,g){if(g>l&&(g=l),g>d&&(g=d),g===0)break t;r.set(i.subarray(s,s+g),c),l-=g,s+=g,d-=g,c+=g,n.length-=g;break}n.mode=Zc;break;case 16196:for(;p<14;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(n.nlen=257+(31&h),h>>>=5,p-=5,n.ndist=1+(31&h),h>>>=5,p-=5,n.ncode=4+(15&h),h>>>=4,p-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Jn;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;p<3;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.lens[Vt[n.have++]]=7&h,h>>>=3,p-=3}for(;n.have<19;)n.lens[Vt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,dt={bits:n.lenbits},j=Dg(0,n.lens,0,19,n.lencode,0,n.work,dt),n.lenbits=dt.bits,j){t.msg="invalid code lengths set",n.mode=Jn;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;K=n.lencode[h&(1<<n.lenbits)-1],y=K>>>24,b=K>>>16&255,I=65535&K,!(y<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(I<16)h>>>=y,p-=y,n.lens[n.have++]=I;else{if(I===16){for(Ft=y+2;p<Ft;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(h>>>=y,p-=y,n.have===0){t.msg="invalid bit length repeat",n.mode=Jn;break}M=n.lens[n.have-1],g=3+(3&h),h>>>=2,p-=2}else if(I===17){for(Ft=y+3;p<Ft;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=y,p-=y,M=0,g=3+(7&h),h>>>=3,p-=3}else{for(Ft=y+7;p<Ft;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=y,p-=y,M=0,g=11+(127&h),h>>>=7,p-=7}if(n.have+g>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Jn;break}for(;g--;)n.lens[n.have++]=M}}if(n.mode===Jn)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=Jn;break}if(n.lenbits=9,dt={bits:n.lenbits},j=Dg(1,n.lens,0,n.nlen,n.lencode,0,n.work,dt),n.lenbits=dt.bits,j){t.msg="invalid literal/lengths set",n.mode=Jn;break}if(n.distbits=6,n.distcode=n.distdyn,dt={bits:n.distbits},j=Dg(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,dt),n.distbits=dt.bits,j){t.msg="invalid distances set",n.mode=Jn;break}if(n.mode=Ay,e===Ry)break t;case Ay:n.mode=by;case by:if(l>=6&&d>=258){t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,t6(t,m),c=t.next_out,r=t.output,d=t.avail_out,s=t.next_in,i=t.input,l=t.avail_in,h=n.hold,p=n.bits,n.mode===Zc&&(n.back=-1);break}for(n.back=0;K=n.lencode[h&(1<<n.lenbits)-1],y=K>>>24,b=K>>>16&255,I=65535&K,!(y<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(b&&(240&b)==0){for(L=y,U=b,x=I;K=n.lencode[x+((h&(1<<L+U)-1)>>L)],y=K>>>24,b=K>>>16&255,I=65535&K,!(L+y<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=L,p-=L,n.back+=L}if(h>>>=y,p-=y,n.back+=y,n.length=I,b===0){n.mode=16205;break}if(32&b){n.back=-1,n.mode=Zc;break}if(64&b){t.msg="invalid literal/length code",n.mode=Jn;break}n.extra=15&b,n.mode=16201;case 16201:if(n.extra){for(Ft=n.extra;p<Ft;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;K=n.distcode[h&(1<<n.distbits)-1],y=K>>>24,b=K>>>16&255,I=65535&K,!(y<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if((240&b)==0){for(L=y,U=b,x=I;K=n.distcode[x+((h&(1<<L+U)-1)>>L)],y=K>>>24,b=K>>>16&255,I=65535&K,!(L+y<=p);){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}h>>>=L,p-=L,n.back+=L}if(h>>>=y,p-=y,n.back+=y,64&b){t.msg="invalid distance code",n.mode=Jn;break}n.offset=I,n.extra=15&b,n.mode=16203;case 16203:if(n.extra){for(Ft=n.extra;p<Ft;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Jn;break}n.mode=16204;case 16204:if(d===0)break t;if(g=m-d,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Jn;break}g>n.wnext?(g-=n.wnext,C=n.wsize-g):C=n.wnext-g,g>n.length&&(g=n.length),R=n.window}else R=r,C=c-n.offset,g=n.length;g>d&&(g=d),d-=g,n.length-=g;do r[c++]=R[C++];while(--g);n.length===0&&(n.mode=by);break;case 16205:if(d===0)break t;r[c++]=n.length,d--,n.mode=by;break;case RO:if(n.wrap){for(;p<32;){if(l===0)break t;l--,h|=i[s++]<<p,p+=8}if(m-=d,t.total_out+=m,n.total+=m,4&n.wrap&&m&&(t.adler=n.check=Gi(n)?$i(n.check,r,m,c-m):yg(n.check,r,m,c-m)),m=d,4&n.wrap&&(Gi(n)?h:_2(h))!==n.check){t.msg="incorrect data check",n.mode=Jn;break}h=0,p=0}n.mode=16207;case 16207:if(n.wrap&&Gi(n)){for(;p<32;){if(l===0)break t;l--,h+=i[s++]<<p,p+=8}if(4&n.wrap&&h!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Jn;break}h=0,p=0}n.mode=16208;case 16208:j=s6;break t;case Jn:j=h2;break t;case 16210:return p2;default:return gs}return t.next_out=c,t.avail_out=d,t.next_in=s,t.avail_in=l,n.hold=h,n.bits=p,(n.wsize||m!==t.avail_out&&n.mode<Jn&&(n.mode<RO||e!==u2))&&v2(t,t.output,t.next_out,m-t.avail_out),_-=t.avail_in,m-=t.avail_out,t.total_in+=_,t.total_out+=m,n.total+=m,4&n.wrap&&m&&(t.adler=n.check=Gi(n)?$i(n.check,r,m,t.next_out-m):yg(n.check,r,m,t.next_out-m)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Zc?128:0)+(n.mode===Ay||n.mode===vO?256:0),(_===0&&m===0||e===u2)&&j===Eh&&(j=c6),j},$c={inflateReset:E2,inflateReset2:g2,inflateResetKeep:m2,inflateInit:t=>S2(t,15),inflateInit2:S2,inflate:u6,inflateEnd:t=>{if(gh(t))return gs;let e=t.state;return e.window&&(e.window=null),t.state=null,Eh},inflateGetHeader:(t,e)=>{if(gh(t))return gs;const n=t.state;return(2&n.wrap)==0?gs:(n.head=e,e.done=!1,Eh)},inflateSetDictionary:(t,e)=>{const n=e.length;let i,r,s;return gh(t)?gs:(i=t.state,i.wrap!==0&&i.mode!==Cy?gs:i.mode===Cy&&(r=1,r=yg(r,e,n,0),r!==i.check)?h2:(s=v2(t,e,n,n),s?(i.mode=16210,p2):(i.havedict=1,Eh)))},inflateInfo:"pako inflate (from Nodeca project)"},h6=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const R2=Object.prototype.toString,{Z_NO_FLUSH:p6,Z_FINISH:f6,Z_OK:Lg,Z_STREAM_END:AO,Z_NEED_DICT:bO,Z_STREAM_ERROR:_6,Z_DATA_ERROR:y2,Z_MEM_ERROR:m6}=fy;function Iy(t){this.options=Ey.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l2,this.strm.avail_out=0;let n=$c.inflateInit2(this.strm,e.windowBits);if(n!==Lg)throw new Error(ph[n]);if(this.header=new h6,$c.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Ng.string2buf(e.dictionary):R2.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=$c.inflateSetDictionary(this.strm,e.dictionary),n!==Lg)))throw new Error(ph[n])}function E6(t,e){const n=new Iy(e);if(n.push(t),n.err)throw n.msg||ph[n.err];return n.result}Iy.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let s,c,l;if(this.ended)return!1;for(c=e===~~e?e:e===!0?f6:p6,R2.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),s=$c.inflate(n,c),s===bO&&r&&(s=$c.inflateSetDictionary(n,r),s===Lg?s=$c.inflate(n,c):s===y2&&(s=bO));n.avail_in>0&&s===AO&&n.state.wrap>0&&t[n.next_in]!==0;)$c.inflateReset(n),s=$c.inflate(n,c);switch(s){case _6:case y2:case bO:case m6:return this.onEnd(s),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||s===AO))if(this.options.to==="string"){let d=Ng.utf8border(n.output,n.next_out),h=n.next_out-d,p=Ng.buf2string(n.output,d);n.next_out=h,n.avail_out=i-h,h&&n.output.set(n.output.subarray(d,d+h),0),this.onData(p)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==Lg||l!==0){if(s===AO)return s=$c.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Iy.prototype.onData=function(t){this.chunks.push(t)},Iy.prototype.onEnd=function(t){t===Lg&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ey.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var g6={inflate:E6};const{deflate:S6}=$5,{inflate:T6}=g6;var v6=S6,R6=T6,C2=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(C2||{});class y6{constructor(){A(this,"_sequence",0),A(this,"_startTime",Date.now()),A(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const l=new Uint8Array(4);l.set([1,0,0,0]);const d={id:0,length:4,data:l.buffer},h={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};n.commonPacketHeader.extension=1,n.extension=h,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;N("SHOW_DATASTREAM2_LOG")&&S.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),r=new Uint8Array(i),s=new DataView(i);let c=0;if(s.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,s.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,s.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const l=this.serializeExtension(n.extension);r.set(new Uint8Array(l),c),c+=l.byteLength}if(r.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let i=0;const r=n.getUint16(i,!0);i+=2;const s={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let c,l;if(i+=4,N("SHOW_DATASTREAM2_LOG")&&S.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(i,!0),i+=2,s.extension){l=this.deserializeExtension(e.slice(i)),i+=2+l.length,c=e.slice(i);let d=!1;if(l.datas.length>0){const h=l.datas.find(p=>p.id===0);h&&(d=(1&new DataView(h.data).getUint32(0,!0))==1)}c=d?this.decompress(c):c}else c=e.slice(8);return c}serializeExtension(e){const{profile:n,length:i,datas:r}=e,s=new ArrayBuffer(i+2),c=new Uint8Array(s),l=new DataView(s);let d=0;if(l.setUint8(d++,n),l.setUint8(d++,i),r.forEach(h=>{n?(l.setUint8(d++,h.id),l.setUint8(d++,h.length),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength):(l.setUint8(d++,h.id|h.length<<4),c.set(new Uint8Array(h.data),d),d+=h.data.byteLength)}),d!==i+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(i+2));return s}deserializeExtension(e){const n=new DataView(e);let i=0;const r=n.getUint8(i);i++;const s=n.getUint8(i);i++;const c=r===C2.TWO_BYTE,l=[],d=new DataView(e,2);let h=0;for(;h<s;){let p=0,_=0,m=new ArrayBuffer(0);c?(p=d.getUint8(h),h++,_=d.getUint8(h),h++):(p=15&d.getUint8(h),_=d.getUint8(h)>>4,h++),_>0&&(m=d.buffer.slice(h+2,h+2+_),h+=m.byteLength),l.push({id:p,length:_,data:m})}if(h!==s)throw Error("parse error");return{profile:r,length:s,datas:l}}decompress(e){return R6(new Uint8Array(e))}compress(e){return v6(new Uint8Array(e))}}const C6={name:"DataStream",create:(t,e)=>{const n=e?new D4(t):new L4(t);return n.useDataStream(new y6),n}};class A6 extends Xe{constructor(e,n,i){super(),A(this,"ws",void 0),A(this,"requestId",1),A(this,"heartBeatTimer",void 0),A(this,"joinInfo",void 0),A(this,"clientId",void 0),A(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),A(this,"onClose",r=>{this.emit("close"),this.dispose()}),A(this,"onMessage",r=>{const s=JSON.parse(r.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=e,this.clientId=n,this.ws=new ig("cross-channel-".concat(this.clientId),i),this.ws.on(xt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(xt.CONNECTED,this.onOpen),this.ws.on(xt.ON_MESSAGE,this.onMessage),this.ws.on(xt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new st((n,i)=>{const r=window.setTimeout(()=>{i(new B(O.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,s=>{window.clearTimeout(r),s.state&&s.state!==0?i(new B(O.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),i(new B(O.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new B(O.WS_DISCONNECT);const n=()=>new st((c,l)=>{this.ws.once(xt.CLOSED,()=>l(new B(O.WS_ABORT))),this.ws.once(xt.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(e),r=new st((c,l)=>{const d=()=>{l(new B(O.WS_ABORT))};this.ws.once(xt.RECONNECTING,d),this.ws.once(xt.CLOSED,d),this.once("req_".concat(i),c),ni(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(xt.RECONNECTING,d),this.ws.off(xt.CLOSED,d),l(new B(O.TIMEOUT,"cross channel ws request timeout"))})}),s=await r;if(!s||s.code!==200)throw new B(O.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(e){this.ws.removeAllListeners(xt.REQUEST_NEW_URLS),this.ws.on(xt.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class b6 extends Xe{set state(e){e!==this._state&&(e!==Rr.RELAY_STATE_FAILURE&&(this.errorCode=Vf.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,i,r,s){super(),A(this,"joinInfo",void 0),A(this,"sid",void 0),A(this,"clientId",void 0),A(this,"cancelToken",sr.CancelToken.source()),A(this,"workerToken",void 0),A(this,"requestId",0),A(this,"signal",void 0),A(this,"prevChannelMediaConfig",void 0),A(this,"httpRetryConfig",void 0),A(this,"_resolution",void 0),A(this,"_state",Rr.RELAY_STATE_IDLE),A(this,"errorCode",Vf.RELAY_OK),A(this,"onStatus",c=>{S.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",Yc.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",Yc.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Vf.SRC_TOKEN_EXPIRED,this.state=Rr.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Vf.DEST_TOKEN_EXPIRED,this.state=Rr.RELAY_STATE_FAILURE))}),A(this,"onReconnect",async()=>{S.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Yc.NETWORK_DISCONNECTED),this.state=Rr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(c=>{this.state!==Rr.RELAY_STATE_IDLE&&(S.error("auto restart channel media relay failed",c.toString()),this.errorCode=Vf.SERVER_CONNECTION_LOST,this.state=Rr.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=$u(),this.signal=new A6(this.joinInfo,this.clientId,i),this.httpRetryConfig=r,this._resolution=s}async startChannelMediaRelay(e){if(this.state!==Rr.RELAY_STATE_IDLE)throw new B(O.INVALID_OPERATION);this.state=Rr.RELAY_STATE_CONNECTING,await this.connect(),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new B(O.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new B(O.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new B(O.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Rr.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Rr.RELAY_STATE_RUNNING)throw new B(O.INVALID_OPERATION);const n=this.genMessage(Zi.SetVideoProfile);await this.signal.request(n),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),S.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Rr.RELAY_STATE_IDLE,this.dispose()}dispose(){S.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=sr.CancelToken.source(),this.state=Rr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await xG(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Yc.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(Zi.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(Zi.SetSdkProfile,e);await this.signal.request(i),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(Zi.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Yc.PACKET_JOINED_SRC_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(Zi.SetSourceUserId,e);await this.signal.request(s),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(Zi.SetDestChannel,e);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Yc.PACKET_JOINED_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(Zi.StartPacketTransfer,e);await this.signal.request(l),this.emit("event",Yc.PACKET_SENT_TO_DEST_CHANNEL),this.state=Rr.RELAY_STATE_RUNNING,S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(Zi.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",Yc.PACKET_UPDATE_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(Zi.StopPacketTransfer);await this.signal.request(e),S.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const i=[],r=[],s=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:wa,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.23.4"&&(c.sdkVersion="0.0.1");let l=null,d=null;switch(e){case Zi.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case Zi.SetSourceChannel:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},c;case Zi.SetSourceUserId:if(d=n&&n.getSrcChannelMediaInfo(),!d)throw new B(O.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:d.uid+""},c;case Zi.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:r,token:s},c;case Zi.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case Zi.Reconnect:return c.clientRequest={command:"Reconnect"},c;case Zi.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case Zi.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new B(O.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(h=>{i.push(h.channelName),r.push(h.uid+""),s.push(h.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:r,token:s},c;case Zi.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const I6={name:"ChannelMediaRelay",create:function(t){return new b6(t.joinInfo,t.clientId,t.websocketRetryConfig||In,t.httpRetryConfig||In,t.resolution)}};function A2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Pg(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?A2(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class O6 extends Xe{constructor(e,n,i,r){super(),A(this,"spec",void 0),A(this,"token",void 0),A(this,"websocket",void 0),A(this,"pingpongTimer",void 0),A(this,"reconnectMode","retry"),A(this,"serviceMode",void 0),A(this,"reqId",0),A(this,"commandReqId",0),A(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),A(this,"handleWebSocketMessage",s=>{if(!s.data)return;const c=JSON.parse(s.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(gt.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===zc.TRANSCODE?1:2}),this.emit(fd.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=e,this.serviceMode=r,this.websocket=new ig("live-streaming",i),this.websocket.on(xt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(xt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(xt.REQUEST_NEW_URLS,(s,c)=>{ui(this,fd.REQUEST_NEW_ADDRESS).then(s).catch(c)}),this.websocket.on(xt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,i,r){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const s=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new B(O.UNEXPECTED_ERROR);const l=Pg({command:e,sdkVersion:wa==="4.23.4"?"0.0.1":wa,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new B(O.WS_DISCONNECT);const d=()=>new st((m,g)=>{this.websocket.once(xt.CLOSED,()=>g(new B(O.WS_ABORT))),this.websocket.once(xt.CONNECTED,m)});this.websocket.state!=="connected"&&await d(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const h=new st((m,g)=>{const C=()=>{g(new B(O.WS_ABORT))};this.websocket.once(xt.RECONNECTING,C),this.websocket.once(xt.CLOSED,C),this.once("@".concat(c,"-").concat(this.spec.sid),R=>{m(R)})});r&&gt.workerEvent(this.spec.sid,Pg(Pg({},r),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const p=Date.now();this.websocket.sendMessage(l);let _=null;try{_=await h}catch(m){if(this.websocket.state==="closed")throw m;return await d(),await this.request(e,n,i)}return r&&gt.workerEvent(this.spec.sid,Pg(Pg({},r),{},{requestId:s,actionType:"response",payload:JSON.stringify(_.serverResponse),serverCode:_.code,success:_.code===200,responseTime:Date.now()-p})),_.code!==200&&this.handleResponseError(_),_}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=wa==="4.23.4"?"0.0.1":wa;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Ln.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void S.warning("live stream response already exists stream");case Ln.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ln.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ln.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new B(O.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Ln.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ln.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new B(O.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Ln.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(fd.WARNING,n,e.serverResponse.url)}case Ln.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new B(O.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(fd.WARNING,n,e.serverResponse.url)}case Ln.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ln.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new B(O.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Ln.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new B(O.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(fd.WARNING,n,e.serverResponse.url)}case Ln.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Ln.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ln.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ln.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ln.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ln.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(mR)},6e3)}}function b2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function yr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?b2(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class w6 extends Xe{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:In,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:In;super(),A(this,"onLiveStreamWarning",void 0),A(this,"onLiveStreamError",void 0),A(this,"spec",void 0),A(this,"retryTimeout",1e4),A(this,"connection",void 0),A(this,"httpRetryConfig",void 0),A(this,"wsRetryConfig",void 0),A(this,"streamingTasks",new Map),A(this,"isStartingStreamingTask",!1),A(this,"taskMutex",new Ti("live-streaming")),A(this,"cancelToken",sr.CancelToken.source()),A(this,"transcodingConfig",void 0),A(this,"uapResponse",void 0),A(this,"lastTaskId",1),A(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=yr(yr({},mG),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(S.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>yr(yr(yr({},_G),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){nn(c.width)||ye(c.width,"config.width",0,1e4),nn(c.height)||ye(c.height,"config.height",0,1e4),nn(c.videoBitrate)||ye(c.videoBitrate,"config.videoBitrate",1,1e6),nn(c.videoFrameRate)||ye(c.videoFrameRate,"config.videoFrameRate"),nn(c.lowLatency)||Hc(c.lowLatency,"config.lowLatency"),nn(c.audioSampleRate)||xn(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),nn(c.audioBitrate)||ye(c.audioBitrate,"config.audioBitrate",1,128),nn(c.audioChannels)||xn(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),nn(c.videoGop)||ye(c.videoGop,"config.videoGop"),nn(c.videoCodecProfile)||xn(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),nn(c.userCount)||ye(c.userCount,"config.userCount",0,17),nn(c.backgroundColor)||ye(c.backgroundColor,"config.backgroundColor",0,16777215),nn(c.userConfigExtraInfo)||ei(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!nn(c.transcodingUsers)&&(Wc(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,d)=>{BR(l.uid),nn(l.x)||ye(l.x,"transcodingUser[".concat(d,"].x"),0,1e4),nn(l.y)||ye(l.y,"transcodingUser[".concat(d,"].y"),0,1e4),nn(l.width)||ye(l.width,"transcodingUser[".concat(d,"].width"),0,1e4),nn(l.height)||ye(l.height,"transcodingUser[".concat(d,"].height"),0,1e4),nn(l.zOrder)||ye(l.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),nn(l.alpha)||ye(l.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)})),nn(c.watermark)||II(c.watermark,"watermark"),nn(c.backgroundImage)||II(c.backgroundImage,"backgroundImage"),c.images&&!nn(c.images)&&(Wc(c.images,"config.images"),c.images.forEach((l,d)=>{II(l,"images[".concat(d,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>yr(yr(yr({},bI),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(yr(yr(yr({},bI),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(yr(yr(yr({},bI),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>yr({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const r=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?st.resolve(c.uid):XM(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await st.all(r)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var s;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ar(s=this.streamingTasks).call(s)).map(l=>l.taskId).join("#")});S.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{S.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{S.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(d=>{S.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)})})}}async startLiveStreamingTask(e,n,i){if(!this.transcodingConfig&&n===zc.TRANSCODE)throw new B(O.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};S.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&i)return void s();if(this.streamingTasks.get(e)&&!i)return s(),new B(O.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(l){throw s(),l}switch(n){case zc.TRANSCODE:r.transcodingConfig=yr({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const l=new st((h,p)=>{ni(this.retryTimeout).then(()=>{if(i)return p(i);const _=this.statusError.get(e);return _?(this.statusError.delete(e),p(_)):void 0})}),d=await st.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:n===zc.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),l]);this.isStartingStreamingTask=!1,S.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(e,{clientRequest:r,mode:n,url:e,taskId:c}),s()}catch(l){if(s(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||i)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,l)):await this.startLiveStreamingTask(e,n,l)}}stopLiveStreamingTask(e){return new st((n,i)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new B(O.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=r.mode;r.abortTask=()=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:s===zc.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(i)})}resetAllTask(){var e;const n=Array.from(ar(e=this.streamingTasks).call(e));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(r=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,r)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=sr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new B(O.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await ui(this,OI.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new O6(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(fd.WARNING,(i,r)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(r,i)),this.connection.on(fd.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(fd.REQUEST_NEW_ADDRESS,(i,r)=>{if(!this.connection)return r(new B(O.UNEXPECTED_ERROR,"can not get new live streaming address list"));ui(this,OI.REQUEST_WORKER_MANAGER_LIST,e).then(s=>{this.uapResponse=s,i(s.addressList)}).catch(r)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),r=e.reason;switch(e.code){case Ln.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ln.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new B(O.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(i)return S.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case Ln.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new B(O.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case Ln.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ln.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(ar(s=this.streamingTasks).call(s));for(const l of c)l.abortTask?l.abortTask():(S.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new B(O.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{S.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(d=>{S.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,d)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const N6={name:"LiveStreaming",create:function(t){return new w6(t.joinInfo,t.websocketRetryConfig||In,t.httpRetryConfig||In)}};function D6(t){let e=w2();return function(n,i){let r=n.appId;r!==void 0&&(ge(i,10),$o(i,r));let s=n.cid;s!==void 0&&(ge(i,16),ge(i,s));let c=n.cname;c!==void 0&&(ge(i,26),$o(i,c));let l=n.deviceId;l!==void 0&&(ge(i,34),$o(i,l));let d=n.elapse;d!==void 0&&(ge(i,40),Od(i,d));let h=n.fileSize;h!==void 0&&(ge(i,48),Od(i,e_(h)));let p=n.height;p!==void 0&&(ge(i,56),Od(i,e_(p)));let _=n.jpg;_!==void 0&&(ge(i,66),ge(i,_.length),function(ur,z){let $=n_(ur,z.length);ur.bytes.set(z,$)}(i,_));let m=n.networkType;m!==void 0&&(ge(i,72),Od(i,e_(m)));let g=n.osType;g!==void 0&&(ge(i,80),Od(i,e_(g)));let C=n.requestId;C!==void 0&&(ge(i,90),$o(i,C));let R=n.sdkVersion;R!==void 0&&(ge(i,98),$o(i,R));let y=n.sequence;y!==void 0&&(ge(i,104),Od(i,e_(y)));let b=n.sid;b!==void 0&&(ge(i,114),$o(i,b));let I=n.timestamp;I!==void 0&&(ge(i,120),Od(i,I));let L=n.uid;L!==void 0&&(ge(i,128),ge(i,L));let U=n.vid;U!==void 0&&(ge(i,136),ge(i,U));let x=n.width;x!==void 0&&(ge(i,144),Od(i,e_(x)));let M=n.service;M!==void 0&&(ge(i,152),ge(i,M));let j=n.callbackData;j!==void 0&&(ge(i,162),$o(i,j));let K=n.jpgEncryption;K!==void 0&&(ge(i,168),ge(i,K));let it=n.requestType;it!==void 0&&(ge(i,176),ge(i,it));let dt=n.scorePorn;dt!==void 0&&(ge(i,185),DO(i,dt));let Ft=n.scoreSexy;Ft!==void 0&&(ge(i,193),DO(i,Ft));let Vt=n.scoreNeutral;Vt!==void 0&&(ge(i,201),DO(i,Vt));let It=n.scene;It!==void 0&&(ge(i,208),ge(i,It));let Ue=n.ossFilePrefix;Ue!==void 0&&(ge(i,218),$o(i,Ue));let Ae=n.serviceVendor;if(Ae!==void 0)for(let ur of Ae){ge(i,226);let z=w2();k6(ur,z),ge(i,z.limit),V6(i,z),x6(z)}}(t,e),function(n){let i=n.bytes,r=n.limit;return i.length===r?i:i.subarray(0,r)}(e)}function L6(t){return function(n){let i={};t:for(;!N2(n);){let r=tc(n);switch(r>>>3){case 0:break t;case 1:i.code=tc(n);break;case 2:i.msg=D2(n,tc(n));break;case 3:{let s=M6(n);i.data=P6(n),n.limit=s;break}default:I2(n,7&r)}}return i}({bytes:e=t,offset:0,limit:e.length});var e}function P6(t){let e={};t:for(;!N2(t);){let n=tc(t);switch(n>>>3){case 0:break t;case 1:e.requestId=D2(t,tc(t));break;case 2:e.requestType=tc(t)>>>0;break;case 3:e.scorePorn=NO(t);break;case 4:e.scoreSexy=NO(t);break;case 5:e.scoreNeutral=NO(t);break;case 6:e.requestScene=tc(t)>>>0;break;case 7:e.scene=tc(t)>>>0;break;default:I2(t,7&n)}}return e}function k6(t,e){let n=t.service;n!==void 0&&(ge(e,8),ge(e,n));let i=t.vendor;i!==void 0&&(ge(e,16),ge(e,i));let r=t.token;r!==void 0&&(ge(e,26),$o(e,r));let s=t.callbackUrl;s!==void 0&&(ge(e,34),$o(e,s))}function M6(t){let e=tc(t),n=t.limit;return t.limit=t.offset+e,n}function I2(t,e){switch(e){case 0:for(;128&L2(t););break;case 2:OO(t,tc(t));break;case 5:OO(t,4);break;case 1:OO(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let U6=new Float32Array(1);new Uint8Array(U6.buffer);let IO=new Float64Array(1),Cr=new Uint8Array(IO.buffer);function e_(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let O2=[];function w2(){const t=O2.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function x6(t){O2.push(t)}function OO(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function N2(t){return t.offset>=t.limit}function n_(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let c=new Uint8Array(2*s);c.set(n),t.bytes=c}return t.offset=s,s>r&&(t.limit=s),i}function wO(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function D2(t,e){let n=wO(t,e),i=String.fromCharCode,r=t.bytes,s="",c="";for(let l=0;l<e;l++){let d,h,p,_,m=r[l+n];(128&m)==0?c+=i(m):(224&m)==192?l+1>=e?c+=s:(d=r[l+n+1],(192&d)!=128?c+=s:(_=(31&m)<<6|63&d,_<128?c+=s:(c+=i(_),l++))):(240&m)==224?l+2>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],(49344&(d|h<<8))!=32896?c+=s:(_=(15&m)<<12|(63&d)<<6|63&h,_<2048||_>=55296&&_<=57343?c+=s:(c+=i(_),l+=2))):(248&m)==240?l+3>=e?c+=s:(d=r[l+n+1],h=r[l+n+2],p=r[l+n+3],(12632256&(d|h<<8|p<<16))!=8421504?c+=s:(_=(7&m)<<18|(63&d)<<12|(63&h)<<6|63&p,_<65536||_>1114111?c+=s:(_-=65536,c+=i(55296+(_>>10),56320+(1023&_)),l+=3))):c+=s}return c}function $o(t,e){let n=e.length,i=0;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}ge(t,i);let r=n_(t,i),s=t.bytes;for(let c=0;c<n;c++){let l=e.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+e.charCodeAt(++c)-56613888),l<128?s[r++]=l:(l<2048?s[r++]=l>>6&31|192:(l<65536?s[r++]=l>>12&15|224:(s[r++]=l>>18&7|240,s[r++]=l>>12&63|128),s[r++]=l>>6&63|128),s[r++]=63&l|128)}}function V6(t,e){let n=n_(t,e.limit),i=t.bytes,r=e.bytes;for(let s=0,c=e.limit;s<c;s++)i[s+n]=r[s]}function L2(t){return t.bytes[wO(t,1)]}function P2(t,e){let n=n_(t,1);t.bytes[n]=e}function NO(t){let e=wO(t,8),n=t.bytes;return Cr[0]=n[e++],Cr[1]=n[e++],Cr[2]=n[e++],Cr[3]=n[e++],Cr[4]=n[e++],Cr[5]=n[e++],Cr[6]=n[e++],Cr[7]=n[e++],IO[0]}function DO(t,e){let n=n_(t,8),i=t.bytes;IO[0]=e,i[n++]=Cr[0],i[n++]=Cr[1],i[n++]=Cr[2],i[n++]=Cr[3],i[n++]=Cr[4],i[n++]=Cr[5],i[n++]=Cr[6],i[n++]=Cr[7]}function tc(t){let e,n=0,i=0;do e=L2(t),n<32&&(i|=(127&e)<<n),n+=7;while(128&e);return i}function ge(t,e){for(e>>>=0;e>=128;)P2(t,127&e|128),e>>>=7;P2(t,e)}function Od(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=r===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,c=n_(t,s),l=t.bytes;switch(s){case 10:l[c+9]=r>>>7&1;case 9:l[c+8]=s!==9?128|r:127&r;case 8:l[c+7]=s!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=s!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=s!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=s!==5?128|i:127&i;case 4:l[c+3]=s!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=s!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=s!==2?n>>>7|128:n>>>7&127;case 1:l[c]=s!==1?128|n:127&n}}function k2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}const B6=new Map([["moderation",1],["supervise",2]]);class F6 extends Xe{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Xn.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=_r(n=e.map(i=>B6.get(i)||0)).call(n,(i,r)=>i+r),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),A(this,"name","AgoraRTCVideoContentInspect"),A(this,"_connectionState",us.CONNECTING),A(this,"_innerConnectionState",void 0),A(this,"sequence",0),A(this,"inspectStartTime",void 0),A(this,"workerManagerConnection",void 0),A(this,"workerConnection",void 0),A(this,"workerMessageLengthLimit",void 0),A(this,"inspectIntervalMinimum",void 0),A(this,"qualityRatio",void 0),A(this,"_connectInfo",void 0),A(this,"_cancelTokenSource",sr.CancelToken.source()),A(this,"_retryConfig",void 0),A(this,"wmSequence",0),A(this,"inspectInterval",void 0),A(this,"inspectTimer",null),A(this,"ossFilePrefix",void 0),A(this,"extraInfo",void 0),A(this,"_inspectType",void 0),A(this,"_inspectMode",void 0),A(this,"_quality",1),A(this,"qualityTimer",null),A(this,"_inspectId",void 0),A(this,"_needWorkUrlOnly",!1),A(this,"inspectImage",()=>{if(this.connectionState!==us.CONNECTED)throw new B(O.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===us.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Le(5,"inspect-"),this.workerMessageLengthLimit=N("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=N("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=N("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new ig("worker-manager-"+this._inspectId,In),this.on(Xn.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,S.debug("[".concat(this._inspectId,"] Inspect operation :").concat(hs[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new ig("worker-"+this._inspectId,In),this.handleWorkerEvents()}async init(e,n){this.emit(Xn.STATE_CHANGE,hs.CONNECT_AP),this._connectInfo=e;const i=this._cancelTokenSource.token;return this._retryConfig=n,new st((r,s)=>{this.on(Xn.CONNECTION_STATE_CHANGE,(c,l)=>{l===us.CONNECTED&&r()}),this.requestAP(e,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{s(c)})})}async requestAP(e,n,i){const r=N("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),s=await function(l,d,h,p){let{appId:_,areaCode:m,cname:g,sid:C,token:R,uid:y}=d;Kf++;const b="image_moderation_api",I={service_name:b,json_body:JSON.stringify({appId:_,areaCode:m,cname:g,command:"allocateEdge",requestId:Kf,seq:Kf,sid:C,token:R,ts:Date.now(),uid:y+""})};let L,U,x=l[0];return Ks(async()=>{L=Date.now();const M=await Js(x,{data:I,cancelToken:h,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(U=Date.now()-L,M.code!==0){const dt=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code"+M.code,{retry:!0,responseTime:U});throw S.error(dt.toString()),dt}const j=JSON.parse(M.json_body);if(j.code!==200){const dt=new B(O.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(j.code,", reason: ").concat(j.reason),{code:j.code,responseTime:U});throw S.error(dt.toString()),dt}if(!j.servers||!Array.isArray(j.servers)||j.servers.length===0){const dt=new B(O.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:j.code,responseTime:U});throw S.error(dt.toString()),dt}const K=N("VIDEO_INSPECT_WORKER_MANAGER_HOST"),it=N("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:j.servers.map(dt=>{let{address:Ft,wss:Vt}=dt;if(Ft&&Vt)return"wss://".concat(Ft.replace(/\./g,"-"),".").concat(K,":").concat(it||Vt)}).filter(dt=>!!dt),workerToken:j.workerToken,vid:j.vid,responseTime:U}},(M,j)=>(gt.apworkerEvent(C,{success:!0,sc:200,serviceName:b,responseDetail:JSON.stringify(M.addressList),firstSuccess:j===0,responseTime:U,serverIp:l[j%l.length]}),!1),(M,j)=>(gt.apworkerEvent(C,{success:!1,sc:M.data&&M.data.code||200,serviceName:b,responseTime:U,serverIp:l[j%l.length]}),!!(M.code!==O.OPERATION_ABORTED&&M.code!==O.UNEXPECTED_RESPONSE||M.data&&M.data.retry)&&(x=l[(j+1)%l.length],!0)),p)}(r,e,n,i);this.emit(Xn.STATE_CHANGE,hs.AP_CONNECTED);const{addressList:c}=s;return this.wmSequence++,c}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Xn.STATE_CHANGE,hs.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(xt.CONNECTED,async()=>{this.emit(Xn.STATE_CHANGE,hs.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.4",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(xt.CLOSED,()=>{this._innerConnectionState<hs.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(xt.FAILED,()=>{this._innerConnectionState<hs.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(xt.RECONNECTING,()=>{this._innerConnectionState<hs.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(xt.ON_MESSAGE,async e=>{this.emit(Xn.STATE_CHANGE,hs.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(e.data);if(i.code!==200)throw S.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new B(O.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw S.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new B(O.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const r=N("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(r));this.emit(Xn.STATE_CHANGE,hs.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(Xn.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(xt.WILL_RECONNECT,(e,n,i)=>{i(e)}),this.workerManagerConnection.on(xt.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(xt.CONNECTED,async()=>{this.emit(Xn.STATE_CHANGE,hs.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=us.CONNECTED}),this.workerConnection.on(xt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const i=L6(new Uint8Array(e.data));if(N("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&S.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Xn.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const r={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},s=_r(n=Object.keys(r)).call(n,(l,d)=>r[l]>r[d]?l:d,"porn"),c=Object.keys(r).find(l=>l===s);this.emit(Xn.INSPECT_RESULT,c)}else this.emit(Xn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(Xn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else S.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Xn.INSPECT_RESULT,void 0,new B(O.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(xt.CLOSED,()=>{this.connectionState=us.CLOSED}),this.workerConnection.on(xt.FAILED,()=>{this.connectionState=us.CLOSED}),this.workerConnection.on(xt.RECONNECTING,()=>{this.connectionState=this.connectionState===us.CONNECTED?us.RECONNECTING:us.CONNECTING}),this.workerConnection.on(xt.WILL_RECONNECT,(e,n,i)=>{e==="recover"&&i(e),i("tryNext")}),this.workerConnection.on(xt.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(Xn.REQUEST_NEW_WORKER_URL,i=>{e([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}async requestToInspectImage(){this.sequence++;const e=ea(this,Xn.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Xn.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(e,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(Xn.INSPECT_RESULT,void 0,new B(O.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d}=n;const h=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),_=await _P(p,i,r),m=this.sequence+"-"+s+"-"+d+"-"+h+"-"+Le(12,""),g={appId:i,cid:s,cname:r,deviceId:"",elapse:(C=Number(h-this.inspectStartTime),{low:C|=0,high:C>>31,unsigned:C>=0}),fileSize:_.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:_,networkType:6,osType:7,requestId:m,sdkVersion:"4.23.4",sequence:this.sequence,sid:l,timestamp:G1(h),uid:d,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var C;this.extraInfo===void 0&&delete g.callbackData,this.ossFilePrefix===void 0&&delete g.ossFilePrefix;const R=D6(g);if(R.byteLength<this.workerMessageLengthLimit){if(N("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const y=function(b){for(var I=1;I<arguments.length;I++){var L=arguments[I]!=null?arguments[I]:{};I%2?k2(Object(L),!0).forEach(function(U){A(b,U,L[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(L)):k2(Object(L)).forEach(function(U){Object.defineProperty(b,U,Object.getOwnPropertyDescriptor(L,U))})}return b}({},g);delete y.jpg,S.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(y))}return R}{const y=this.quality*this.qualityRatio;return this.quality=y,await this.generateRequestData(e,{appId:i,cname:r,cid:s,vid:c,sid:l,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=sr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=us.CLOSED,this.emit(Xn.STATE_CHANGE,hs.CLOSED)}}const j6={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new B(O.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new B(O.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach(r=>{var s;if(!rt(s=["supervise","moderation"]).call(s,r))throw new B(O.INVALID_PARAMS,"".concat(r," is not a valid inspect type."))}),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new B(O.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new F6(e)}};var M2=kt(hr.Object.getOwnPropertySymbols),G6=fe,H6=cc.indexOf,W6=lc,LO=Ba([].indexOf),U2=!!LO&&1/LO([1],1,-0)<0;G6({target:"Array",proto:!0,forced:U2||!W6("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return U2?LO(this,t,e)||0:H6(this,t,e)}});var K6=Nr("Array","indexOf"),z6=he,Y6=K6,PO=Array.prototype,q6=function(t){var e=t.indexOf;return t===PO||z6(PO,t)&&e===PO.indexOf?Y6:e},x2=kt(q6);function X6(t,e){if(t==null)return{};var n,i,r=function(c,l){if(c==null)return{};var d={};for(var h in c)if({}.hasOwnProperty.call(c,h)){if(x2(l).call(l,h)!==-1)continue;d[h]=c[h]}return d}(t,e);if(M2){var s=M2(t);for(i=0;i<s.length;i++)n=s[i],x2(e).call(e,n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}let V2=class{get localCapabilities(){return Je(this._localCapabilities)}get rtpCapabilities(){return Je(this._rtpCapabilities)}get candidates(){return Je(this._candidates)}get iceParameters(){return Je(this._iceParameters)}get dtlsParameters(){return Je(this._dtlsParameters)}constructor(t){A(this,"sessionDesc",void 0),A(this,"_localCapabilities",void 0),A(this,"_rtpCapabilities",void 0),A(this,"_candidates",void 0),A(this,"_iceParameters",void 0),A(this,"_dtlsParameters",void 0),A(this,"setup",void 0),A(this,"currentMidIndex",void 0),A(this,"cname","o/i14u9pJrxRKAsu"),A(this,"firefoxSsrcMidMap",new Map),t=Je(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,localCapabilities:s,direction:c,setup:l,videoCodec:d,audioCodec:h}=t;let p;this.setup=l,p=c===Qi.RECEIVE_ONLY?vr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):vr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=s;const _=c===Qi.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,m=c===Qi.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,g=c===Qi.RECEIVE_ONLY?r.send.videoCodecs:sg(ut.VIDEO,_,m,d),C=c===Qi.RECEIVE_ONLY?r.send.audioCodecs:sg(ut.AUDIO,_,m,h);for(const R of p.mediaDescriptions)R.attributes.iceUfrag=e.iceUfrag,R.attributes.icePwd=e.icePwd,R.attributes.fingerprints=n.fingerprints,R.attributes.candidates=i,R.attributes.setup=this.setup,R.media.mediaType==="application"&&(R.attributes.sctpPort="5000"),R.media.mediaType==="video"&&(R.media.fmts=g.map(y=>y.payloadType.toString(10)),R.attributes.payloads=g,R.attributes.extmaps=_.videoExtensions),R.media.mediaType==="audio"&&(R.media.fmts=C.map(y=>y.payloadType.toString(10)),R.attributes.payloads=C,R.attributes.extmaps=_.audioExtensions,Wf(R));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return pd(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,i,r){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:c}=ch(e,this.cname,N("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(s);if(l){if(en()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,l.attributes.mid),r&&(r.twcc||r.remb)){const d=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(l,r),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const d=this.findAvailableMediaIndex(t,s,i);let h;return d===-1?(h=this.createOrRecycleSendMedia(t,s,c,"sendonly",i,r),this.updateBundleMids()):(h=Je(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="sendonly",h.attributes.ssrcs=s,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(h,r)),en()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,h.attributes.mid),{needExchangeSDP:!0,mid:h.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const i=[];return t.forEach(r=>{const s=r._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(s);let l,d=!1;c===-1?(d=!0,l=this.createOrRecycleRecvMedia(r,[],"recvonly",e,n),this.updateBundleMids()):(l=Je(this.sessionDesc.mediaDescriptions[c]),l.attributes.direction="recvonly"),i.push({mid:l.attributes.mid,needCreateTransceiver:d})}),i}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:i,port:r,type:s,relatedAddress:c,relatedPort:l,priority:d}=new RTCIceCandidate(t),h={foundation:e??"",componentId:"1",transport:n??"",priority:d?d+"":"",connectionAddress:i??"",port:r?r+"":"",type:s?s+"":"",relAddr:c??"",relPort:l?l+"":"",extension:{}};this.candidates.some(p=>p.priority===h.priority&&p.connectionAddress===h.connectionAddress&&p.port===h.port)||(this._candidates.push(h),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,i,r){const s=t._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,l=sg(s,c,this.localCapabilities.send,s===ut.AUDIO?r:i),d=s===ut.VIDEO?c.videoExtensions:c.audioExtensions,h="".concat(++this.currentMidIndex);let p={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};p=this.mungRecvMediaDsec(p,t);const _=this.findFirstClosedMedia(s);if(_){const m=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[m]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>rt(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>rt(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const r=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(en()){if(r){const s=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(s||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!s||s!==i.attributes.mid)}return!1}return r&&i.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=Je(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,i,r,s){const c=this.rtpCapabilities.send,l=t===ut.VIDEO?c.videoCodecs:c.audioCodecs,d=t===ut.VIDEO?c.videoExtensions:c.audioExtensions;en()&&(r="".concat(++this.currentMidIndex));let h={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:r}};h=this.mungSendMediaDesc(h,s);const p=this.findFirstClosedMedia(t);if(p){const _=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[_]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}mungRecvMediaDsec(t,e,n){const i=Je(t);return kI(i),Hf(i,e),MI(i,e),wM(i),zR(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=Je(t);return zR(n,e,this.localCapabilities.recv),Wf(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>en()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const J6=["sdp"];var Ve;function B2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function wd(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?B2(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):B2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let F2=(Ve=class r_ extends uM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,i){super(e,n),A(this,"direction",void 0),A(this,"name",void 0),A(this,"store",void 0),A(this,"spec",void 0),A(this,"peerConnection",void 0),A(this,"initialOffer",void 0),A(this,"transport",void 0),A(this,"statsFilter",void 0),A(this,"localCandidateCount",0),A(this,"_isInRestartIce",!1),A(this,"mutex",void 0),A(this,"onLocalCandidate",void 0),A(this,"remoteSDP",void 0),A(this,"pendingCandidates",[]),A(this,"localCapabilities",void 0),A(this,"isReady",!1),A(this,"restartCnt",0),A(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.mutex=new Ti("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(r_.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Qi.SEND_ONLY,this.name=this.direction===Qi.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Yb(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,en()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await DM();if(this.localCapabilities=YR(n),e){const{sdp:i}=e,r=X6(e,J6),s=function(){const p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},_=ag(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ps(_,p,"videoExtensions",m,g,C),ps(_,p,"videoCodecs",m,g,C),ps(_,p,"audioExtensions",m,g,C),ps(_,p,"audioCodecs",m,g,C),N("RAISE_H264_BASELINE_PRIORITY")){const R=C.videoCodecs.findIndex(y=>y.rtpMap&&y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&y.fmtp&&y.fmtp.parameters["profile-level-id"]==="42001f");if(R!==-1){const y=C.videoCodecs.findIndex(b=>b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(y<R){S.debug("raising H264 baseline profile priority");const b=C.videoCodecs[R];C.videoCodecs.splice(R,1),C.videoCodecs.splice(y,0,b)}y!==-1&&N("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(b=>!(b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&b.fmtp&&b.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:m,recv:g,sendrecv:C}}({},{},i);this.remoteSDP=new V2({remoteIceParameters:r.iceParameters,remoteDtlsParameters:r.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const l=gd(c.sdp);await this.peerConnection.setLocalDescription(c);const d=await LM({},{},c.sdp);this.localCapabilities=YR(d);const h=this.peerConnection.getTransceivers()[0];return h!=null&&h.receiver&&h.receiver.transport&&this.tryBindTransportEvents(h.receiver.transport),wd(wd({},l),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=gd(i.sdp);return this.initialOffer=i,wd(wd({},r),{},{sdp:i.sdp})}}catch(n){throw new G(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:r}=e,s=await LM({},{},n);this.remoteSDP=new V2({remoteIceParameters:i,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new G(O.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,i){var r=this;return Oa(function*(){const s=yield re(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],l=r.remoteSDP.receive(e,n,i);e.forEach((y,b)=>{if(l[b].needCreateTransceiver){const I=r.peerConnection.addTransceiver(y._mediaStreamTrack,{direction:"sendonly"});c.push(I),y._updateRtpTransceiver(I)}else{const I=r.peerConnection.getTransceivers().find(L=>L.mid===l[b].mid);if(!I)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[b].mid));c.push(I),y._updateRtpTransceiver(I)}}),en()&&N("SIMULCAST")===!0&&(yield re(r.applySimulcastForFirefox(c,e)));const d=l.map(y=>y.mid),h=yield re(r.peerConnection.createOffer()),p=r.mungSendOfferSDP(h.sdp,e,d),_=vr(p),m=d.map(y=>{const b=_.mediaDescriptions.find(I=>I.attributes.mid===y);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return bM(b,N("USE_PUB_RTX"))}),g=c.map((y,b)=>{const I=d[b];return{localSSRC:m[b],id:I}});yield re(r.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield g}catch(y){const b=r.remoteSDP.toString();throw yield re(r.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield re(r.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield re(r.stopSending(d,!0)),y}yield re(r.applySimulcastEncodings(c,e)),yield re(r.applySendEncodings(c,e));const C=r.remoteSDP.toString(),R=r.logSDPExchange(p,"offer","local","send");return R==null||R(C),yield re(r.setRemoteDescription({type:"answer",sdp:C})),c.map((y,b)=>{const I=d[b];return{localSSRC:m[b],id:I}})}catch(c){throw c instanceof G?c:new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{s()}})()}async stopSending(e,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const r=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(r.length!==e.length)throw new Error("Transceivers' length (".concat(r.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));r.map(d=>{var h;d.direction="inactive",(h=d.stop)===null||h===void 0||h.call(d)});const s=await this.peerConnection.createOffer(),c=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const l=this.remoteSDP.toString();c==null||c(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(r){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}finally{i&&i()}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const d=this.remoteSDP.toString(),h=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const p=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(p.sdp,s,e);h==null||h(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(s){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:c}=this.remoteSDP.send(e,n,i,r);if(c){const l=this.remoteSDP.toString(),d=this.logSDPExchange(l,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:l});const h=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(h.sdp,s,e);d==null||d(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(s){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();i==null||i(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===th.Auto&&(this.store.p2pTransport=th.SdRtn,se().supportPCSetConfiguration&&this.peerConnection.setConfiguration(r_.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,se().supportPCSetConfiguration&&this.peerConnection.setConfiguration(r_.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=gd(n.sdp);return this.store.descriptionStart(),this.direction===Qi.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===Qi.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=gd(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),c=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),c==null||c(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new G(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getTransceivers().filter(r=>r.mid===e);i.length===1&&(this.isVP8Simulcast(n)?en()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getTransceivers().find(r=>r.mid===n);i&&await i.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:i,remote:r}=n.getSelectedCandidatePair();return{local:wd(wd({},Fo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:wd(wd({},Fo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;rt(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r={iceServers:[]};var s;return e.iceServers?r.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(KE(e.turnServer.servers)?r.iceServers=e.turnServer.servers:(r.iceServers&&r.iceServers.push(...r_.turnServerConfigToIceServers(e.turnServer.servers,n,i)),N("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&e.turnServer.serversFromGateway&&r.iceServers.push(...r_.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,i)),rt(s=[th.Relay,th.SdRtn]).call(s,n)&&(r.iceTransportPolicy="relay"),N("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(c=>{c.forceturn&&(r.iceTransportPolicy="relay")}))),N("ENABLE_ENCODED_TRANSFORM")&&se().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),S.debug("P2PConnection p2pTransport is ".concat(n)),r}static turnServerConfigToIceServers(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=[],s=e.filter(l=>l.tcpport);S.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(i));const c=s.length>i?s[i]:s[0];switch(n){case th.SdRtn:const l=e.filter(h=>{var p;return rt(p=h.username).call(p,"glb:")&&h.turnServerURL==h.turnServerURL}),d=l.length>i?l[i]:l[0];d&&(r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(md(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),r.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(md(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case th.Relay:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(md(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(md(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),r.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var i;e!=null&&e.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,e.state))},e.onerror=i=>{var r;(r=this.onDTLSTransportError)===null||r===void 0||r.call(this,"error"in i?i.error:i)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const i=e==null?void 0:e.iceTransport.state;var r;i&&((r=this.onICETransportStateChange)===null||r===void 0||r.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:r}=n.getSelectedCandidatePair();S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(p=>p.track===e._mediaStreamTrack)),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!se().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},s={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var c;const{bitrateMax:p,frameRate:_,scaleResolutionDownBy:m}=e._encoderConfig;p&&(s.maxBitrate=1e3*p),rt(c=e._hints).call(c,Ce.LOW_STREAM)&&(_&&(s.maxFramerate=jr(_)),m&&m>=1&&(s.scaleResolutionDownBy=m))}if(N("DSCP_TYPE")&&Gc()){var l;const p=N("DSCP_TYPE");rt(l=["very-low","low","medium","high"]).call(l,p)&&(s.networkPriority=p)}const d=n.getParameters(),h=(i=d.encodings)===null||i===void 0?void 0:i[0];en()&&!h&&(r.encodings=[s]),h&&Object.assign(h,s),Object.assign(d,r),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(e,n){try{if(!se().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];s instanceof xe&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,r.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,i){const r=vr(e);return n.forEach((s,c)=>{const l=i[c],d=r.mediaDescriptions.find(h=>h.attributes.mid===l);d&&(Hf(d,s),NM(d,s,this.store.codec))}),pd(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let d=0;d<e.length;d++){var i,r,s,c,l;const h=e[d],p=n[d];if(p instanceof xe&&!rt(i=p._hints).call(i,Ce.LOW_STREAM)&&(r=p._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(c=p._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((l=p._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){const _={},m={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};_.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];const g=h.sender.getParameters();await h.sender.setParameters(Object.assign(g,_))}}}async applySimulcastEncodings(e,n){if(!en()&&e.length===n.length)for(let i=0;i<e.length;i++){const r=n[i];if(r instanceof xe&&this.isVP8Simulcast(r)){const s=e[i],c={},l={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,c))}}}isVP8Simulcast(e){var n,i,r,s,c;return!!(e instanceof xe&&N("SIMULCAST")&&this.store.codec==="vp8"&&!rt(n=e._hints).call(n,Ce.LOW_STREAM)&&(i=e._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((r=e._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((c=e._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(e,n,i,r){if(N("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(r,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",i==="local"?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&e.indexOf(c.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async c=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(e);const s=this.remoteSDP.toString();r==null||r(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var i;if(n=n??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var r;const s=(r=vr(n).mediaDescriptions.find(c=>c.attributes.mid===e))===null||r===void 0?void 0:r.attributes.ssrcs;return s==null?void 0:s[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),rt(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,i){const r=vr(e),s=r.mediaDescriptions.find(c=>c.attributes.mid===n);return s&&i===ut.AUDIO&&s.media.mediaType==="audio"&&Wf(s),pd(r)}},Et(Ve.prototype,"establish",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"establish"),Ve.prototype),Et(Ve.prototype,"connect",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"connect"),Ve.prototype),Et(Ve.prototype,"receive",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"receive"),Ve.prototype),Et(Ve.prototype,"mockReceive",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"mockReceive"),Ve.prototype),Et(Ve.prototype,"stopReceiving",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"stopReceiving"),Ve.prototype),Et(Ve.prototype,"restartICE",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"restartICE"),Ve.prototype),Et(Ve.prototype,"close",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"close"),Ve.prototype),Et(Ve.prototype,"updateEncoderConfig",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"updateEncoderConfig"),Ve.prototype),Et(Ve.prototype,"updateSendParameters",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"updateSendParameters"),Ve.prototype),Et(Ve.prototype,"replaceTrack",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"replaceTrack"),Ve.prototype),Et(Ve.prototype,"muteLocal",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"muteLocal"),Ve.prototype),Et(Ve.prototype,"unmuteLocal",[Ss],Object.getOwnPropertyDescriptor(Ve.prototype,"unmuteLocal"),Ve.prototype),Ve);function Ss(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("From P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}let Zs=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var j2,G2,H2,W2,K2,z2,Y2,q2,X2,J2,Q2,ze;function Z2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function Oy(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Z2(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Z2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let Q6=(j2=$s(Zs.SEND_ONLY),G2=$s(Zs.SEND_ONLY),H2=$s(),W2=$s(Zs.RECEIVE_ONLY),K2=$s(Zs.RECEIVE_ONLY),z2=$s(Zs.RECEIVE_ONLY),Y2=$s(Zs.RECEIVE_ONLY),q2=$s(Zs.RECEIVE_ONLY),X2=$s(Zs.RECEIVE_ONLY),J2=$s(),Q2=$s(Zs.RECEIVE_ONLY),ze=class extends Xe{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(vt.StateChange,e,this._state)}constructor(t,e){super(),A(this,"isPlanB",!1),A(this,"store",void 0),A(this,"statsUploader",void 0),A(this,"sendConnection",void 0),A(this,"recvConnection",void 0),A(this,"localTrackMap",new Map),A(this,"remoteUserMap",new Map),A(this,"localDataChannels",[]),A(this,"pendingLocalTracks",[]),A(this,"pendingRemoteTracks",[]),A(this,"statsCollector",void 0),A(this,"dtlsFailedCount",0),A(this,"sendMutex",void 0),A(this,"recvMutex",void 0),A(this,"_state",me.Disconnected),A(this,"_restartStates",["disconnected","failed"]),A(this,"reconnectInterval",void 0),A(this,"uploadUnplinkStarted",!1),A(this,"uploadDownlinkStarted",!1),A(this,"uplinkStateUploadInterval",void 0),A(this,"downlinkStatsUploadInterval",void 0),A(this,"handleMuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==me.Connected)return void r(new G(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void i();const h=d.find(g=>g[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map(g=>{let[,{id:C}]=g;return C}));let p=!1;var c,l;n.trackMediaType==="video"?p=!((c=this.localTrackMap.get(X.LocalAudioTrack))===null||c===void 0||!c.track._muted):p=((l=this.localTrackMap.get(X.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;const _=this.createMuteMessage(d);await Ie(this,vt.RequestMuteLocal,_);const m=n.trackMediaType==="video"?_d.MUTE_LOCAL_VIDEO:_d.MUTE_LOCAL_AUDIO;await Ie(this,vt.RequestP2PMuteLocal,{action:m,message:_,isMuteAll:p}),i()}catch(d){r(d)}finally{s()}}),A(this,"handleUnmuteLocalTrack",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==me.Connected)return void r(new G(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();await this.sendConnection.unmuteLocal(c.map(h=>{let[,{id:p}]=h;return p}));const l=this.createUnmuteMessage(c),d=n.trackMediaType==="video"?_d.UNMUTE_LOCAL_VIDEO:_d.UNMUTE_LOCAL_AUDIO;await Ie(this,vt.RequestP2PMuteLocal,{action:d,message:l}),i()}catch(c){r(c)}finally{s()}}),A(this,"handleUpdateVideoEncoder",async(n,i,r,s)=>{let c;typeof s=="boolean"&&s||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const d=this.localTrackMap.get(X.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==me.Connected)return void i();const{id:h,track:p}=d;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(vt.UpdateVideoEncoder,p)),i()}catch(d){r(d)}finally{var l;(l=c)===null||l===void 0||l()}}),A(this,"handleUpdateVideoSendParameters",async(n,i,r)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(X.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==me.Connected)return void i();const{id:l,track:d}=c;l&&await this.sendConnection.updateSendParameters(l,d),i()}catch(c){r(c)}finally{s()}}),A(this,"handleReplaceTrack",async(n,i,r,s)=>{let c;S.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;const h=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return n===_});if(!this.sendConnection||!h||h[1].id===void 0||this.state!==me.Connected)return void i();if(await((l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(n,h[1].id)),h[0]===X.LocalVideoTrack&&se().supportDualStreamEncoding){const p=this.localTrackMap.get(X.LocalVideoLowTrack);if(p){const _=n._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=_,p.track._originMediaStreamTrack=_,await new st((m,g)=>{this.handleReplaceTrack(p.track,m,g,!0)})}}i()}catch(h){r(h)}finally{var d;(d=c)===null||d===void 0||d()}}),A(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),A(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),A(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),A(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new _1(t),this.bindStatsUploaderEvents(),this.sendMutex=new Ti("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Ti("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},N("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new G(O.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new G(O.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new F2(t,this.store,Qi.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(e);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=me.New,this.sendConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new F2(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new G(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=me.Connected}async addRemoteCandidate(t,e){if(e===Qi.RECEIVE_ONLY){if(!this.sendConnection)throw new G(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new G(O.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var i=this;return Oa(function*(){const r=yield re(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==me.Connected){i.throwIfTrackTypeNotMatch(t);const h=t.filter(p=>i.pendingLocalTracks.indexOf(p)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(h))}i.store.pubId=i.store.pubId+1,yi.markPublishStart(i.store.clientId,i.store.pubId);const s=i.filterTobePublishedTracks(t,e,n);if(s.length===0)return void(yield re(i.tryToUnmuteAudio(t)));s.forEach(h=>{let{track:p,type:_}=h;const m=Date.now();i.store.publish(p.getTrackId(),_===X.LocalAudioTrack?"audio":"video",m)}),i.bindLocalTrackEvents(s);const c=yield re(i.sendConnection.send(s.map(h=>{let{track:p}=h;return p}),i.store.codec,i.store.audioCodec)),l=(yield re(c.next())).value,d=i.createGatewayPublishMessage(s,l);try{yield d}catch(h){throw c.throw(h),(h==null?void 0:h.code)===O.WS_ABORT&&s.forEach(p=>{let{track:_}=p;i.pendingLocalTracks.indexOf(_)===-1&&i.pendingLocalTracks.push(_)}),i.unbindLocalTrackEvents(s),h}yield re(c.next()),s.forEach(h=>{let{type:p}=h;i.statsCollector.addLocalStats(p)}),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(s,l),s.forEach(h=>{let{track:p,type:_}=h;const m=Date.now();i.store.publish(p.getTrackId(),_===X.LocalAudioTrack?"audio":"video",void 0,m)}),i.startUploadUplinkState()}finally{r()}})()}async unpublish(t){if(!this.sendConnection||this.state!==me.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(r=>!rt(t).call(t,r)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(r=>{let[,{id:s}]=r;return s})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[s,{track:c}]=r;return{type:s,track:c}})),e.forEach(r=>{let[s]=r;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===me.Connected)return n&&n[1].track.close(),i;t.forEach(r=>{const s=this.pendingLocalTracks.indexOf(r);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(i=>{let[r,{track:s,ssrcs:c}]=i;const l={stream_type:HG(s,r),ssrcs:c};s._muted||!s._enabled?e.push(l):n.push(l)}),e.length>0&&e.forEach(i=>{Ie(this,vt.RequestMuteLocal,[i])}),n.length>0&&n.forEach(i=>{Ie(this,vt.RequestUnmuteLocal,[i])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Oa(function*(){throw new G(O.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ui(this,vt.RequestRePublish,this.pendingLocalTracks),this.emit(vt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new G(O.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,i){var r;if(!this.recvConnection)throw new G(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((r=this.remoteUserMap.get(t))!==null&&r!==void 0&&r.has(e))return;const{track:s,mid:c,transceiver:l}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),i);e===ut.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new Mf(s,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),l&&t._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new kf(s,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),l&&t._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(t,t._videoTrack));const d=this.remoteUserMap.get(t);d?d.set(e,c):this.remoteUserMap.set(t,new Map([[e,c]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const h=this.pendingRemoteTracks.findIndex(p=>{let{user:_,kind:m}=p;return _.uid===t.uid&&e===m});h!==-1&&(this.pendingRemoteTracks.splice(h,1),this.emit(vt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,i){if(!this.recvConnection)throw new G(O.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),i)}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter(s=>{let{user:c,kind:l}=s;return e!==void 0?c.uid===t.uid&&e===l:c.uid===t.uid});if(i.forEach(s=>{const c=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(c,1)}),this.recvConnection||n||i.forEach(s=>{let{kind:c}=s;var l;if(c===ut.AUDIO)(l=t._audioTrack)===null||l===void 0||l._destroy(),t._audioTrack=void 0;else if(c===ut.VIDEO){var d;(d=t._videoTrack)===null||d===void 0||d._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const r=this.filterTobeUnSubscribedTracks(t,e);r.length!==0&&(await this.recvConnection.stopReceiving(r.map(s=>{let[,{id:c}]=s;return c})),this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),r.forEach(s=>{let[c,{kind:l}]=s;var d,h;if(l===ut.VIDEO&&c._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),l===ut.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0);else if(l===ut.AUDIO){var p;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((p=c._audioTrack)===null||p===void 0||p._destroy(),c._audioTrack=void 0)}}),r.forEach(s=>{let[,{kind:c}]=s;Ie(this,vt.RequestP2PMuteRemote,c)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[ut.VIDEO,ut.AUDIO].forEach(i=>{n.has(i)?Ie(this,vt.RequestP2PUnmuteRemote,i):Ie(this,vt.RequestP2PMuteRemote,i)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new G(O.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new G(O.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new G(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new G(O.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===ut.VIDEO?t._videoSSRC:t._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(X.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Dn){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[r]=i;return r!==X.LocalAudioTrack}).filter(i=>{let[r]=i;return!(t&&r===X.LocalVideoLowTrack)}).map(i=>{let[,{track:r}]=i;return r}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(t&&i===X.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(t,e,n,i,r){if(t){const c=this.localTrackMap.get(X.LocalAudioTrack),l=i?this.localTrackMap.get(X.LocalVideoLowTrack):this.localTrackMap.get(X.LocalVideoTrack);gt.publish(this.store.sessionId,{eventElapse:yi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Ce.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const c=n.find(d=>d instanceof sn),l=i?(s=this.localTrackMap.get(X.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(d=>d instanceof xe);gt.publish(this.store.sessionId,{eventElapse:yi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Ce.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===ut.VIDEO?n._videoSSRC:n._audioSSRC;r&&gt.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===ut.VIDEO,audio:i===ut.AUDIO,peerid:n.uid,subscribeRequestid:i===ut.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:yi.measureFromSubscribeStart(this.store.clientId,r)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Ti("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Ti("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(X.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Dn){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=me.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(X.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(X.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof xe||e&&e.track instanceof sn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(ia(e=this.remoteUserMap).call(e)).find(i=>i.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(X.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Mt(t).call(t,(n,i)=>n.level-i.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=me.Reconnecting,N("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:i}]=t;switch(n){case X.LocalVideoTrack:rt(e=i._hints).call(e,Ce.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case X.LocalAudioTrack:i instanceof Dn?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case X.LocalVideoLowTrack:}}),this.emit(vt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(ia(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(e,i)}),this.emit(vt.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof Td?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,i;if(t===Qi.SEND_ONLY){if(!this.sendConnection)throw new G(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new G(O.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(e){const r=await i.restartICE(e);return i.isInRestartIce=!1,r}{const r=await i.restartICE();if(r){const s=await ui(this,vt.RequestP2PRestartICE,{direction:Qi.RECEIVE_ONLY,iceParameter:r});await i.restartICE(s),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(X.LocalVideoTrack),n=this.localTrackMap.get(X.LocalAudioTrack),i=t.videoSend.find(g=>{var C;return g.ssrc===(e==null||(C=e.ssrcs)===null||C===void 0?void 0:C[0].ssrcId)}),r=t.audioSend.find(g=>{var C;return g.ssrc===(n==null||(C=n.ssrcs)===null||C===void 0?void 0:C[0].ssrcId)});if(!i||!r)return 1;const s=ea(this,vt.NeedSignalRTT),c=i?i.rttMs:void 0,l=r?r.rttMs:void 0,d=c&&l?(c+l)/2:c||l,h=(d&&s?(d+s)/2:d||s)||0,p=100*t.sendPacketLossRate*.7/50+.3*h/1500,_=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,m=e==null?void 0:e.track;if(m&&m._encoderConfig&&m._hints.indexOf(Ce.SCREEN_TRACK)===-1){const g=m._encoderConfig.bitrateMax,C=t.bitrate.actualEncoded;if(g&&C){const R=(1e3*g-C)/(1e3*g);return iM[R<.15?0:R<.3?1:R<.45?2:R<.6?3:4][_]}}return _}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,c=t.audioRecv.find(C=>C.ssrc===r),l=t.videoRecv.find(C=>C.ssrc===s);if(!c&&!l)return void(e+=1);const d=ea(this,vt.NeedSignalRTT),h=t.rtt,p=(h&&d?(h+d)/2:h||d)||0,_=c?c.jitterMs:void 0,m=t.recvPacketLossRate;let g=.7*m*100/50+.3*p/1500;_&&(g=.6*m*100/50+.2*p/1500+.2*_/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new st((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const i=[],r=se(),s=this.getAllTracks();t=vf(t=t.filter(d=>s.indexOf(d)===-1));let c=!1,l=!1;for(const d of t){if(d instanceof xe&&(this.localTrackMap.has(X.LocalVideoTrack)||c?new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:d,type:X.LocalVideoTrack}),c=!0),e)){const h=this.getLowVideoTrack(d,n);i.push({track:h,type:X.LocalVideoLowTrack})}if(d instanceof sn){const h=this.localTrackMap.get(X.LocalAudioTrack);if(h){if(!(h.track instanceof Dn))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");h.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(l){const p=i.find(_=>{let{type:m}=_;return m===X.LocalAudioTrack});if(!(p.track instanceof Dn))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(d)}else{if(!r.webAudioMediaStreamDest||d instanceof Dn||d._bypassWebAudio)i.push({track:d,type:X.LocalAudioTrack});else{const p=new Dn;p.addAudioTrack(d),i.push({track:p,type:X.LocalAudioTrack})}l=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=vf(t=t.filter(i=>n.indexOf(i)!==-1));for(const i of t){if(i instanceof sn){const r=this.localTrackMap.get(X.LocalAudioTrack);if(!r)continue;r.track instanceof Dn?(r.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),r.track.trackList.length===0&&(e.push([X.LocalAudioTrack,r]),r.track.close())):e.push([X.LocalAudioTrack,r])}if(i instanceof xe){const r=this.localTrackMap.get(X.LocalVideoTrack);if(!r)continue;e.push([X.LocalVideoTrack,r]);const s=this.localTrackMap.get(X.LocalVideoLowTrack);s&&e.push([X.LocalVideoLowTrack,s])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:i}=e;switch(i){case X.LocalVideoTrack:n.addListener(_t.GET_STATS,this.handleGetLocalVideoStats),n.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(_t.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(_t.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case X.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case X.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof Dn?t.trackList.forEach(n=>{n.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(_t.GET_STATS,this.handleGetLocalAudioStats),n.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(_t.GET_STATS,this.handleGetLocalAudioStats),t.addListener(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:i}]=e;return{track:i,type:n}})),t.forEach(e=>{let{track:n,type:i}=e;switch(i){case X.LocalVideoTrack:n.off(_t.GET_STATS,this.handleGetLocalVideoStats),n.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(_t.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(_t.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case X.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case X.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Dn?t.trackList.forEach(e=>{e.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(_t.GET_STATS,this.handleGetLocalAudioStats),e.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(_t.GET_STATS,this.handleGetLocalAudioStats),t.off(_t.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(_t.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(_t.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(_t.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(_t.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof kf&&e.addListener(_t.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Mf&&e.addListener(_t.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(_t.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(ut.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(ut.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,i)=>{var r;let s,{track:c,type:l}=n;switch(l){case X.LocalAudioTrack:s=Ee.Audio;break;case X.LocalVideoTrack:s=rt(r=c._hints).call(r,Ce.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case X.LocalVideoLowTrack:s=Ee.Low}return{kind:l===X.LocalAudioTrack?ut.AUDIO:ut.VIDEO,stream_type:s,mid:e[i].id,ssrcs:e[i].localSSRC,isMuted:c.muted||!c.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case X.LocalVideoTrack:i=rt(n=s._hints).call(n,Ce.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case X.LocalAudioTrack:i=Ee.Audio;break;case X.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:c,mid:l}})}assignLocalTracks(t,e){t.forEach((n,i)=>{let{track:r,type:s}=n;this.localTrackMap.set(s,{track:r,id:e[i].id,ssrcs:e[i].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(vt.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),rt(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await ni(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),gt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:rn.TRACER}).onSuccess(),this.emit(vt.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const i=Array.from(ia(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var r;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(r=i.audioTrack)===null||r===void 0||r.emit(wf.FIRST_FRAME_DECODED),gt.firstRemoteFrame(this.store.sessionId,jn.FIRST_AUDIO_DECODE,We.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const i=Array.from(ia(n=this.remoteUserMap).call(n)).find(r=>r._audioSSRC===e);i&&gt.firstRemoteFrame(this.store.sessionId,jn.FIRST_AUDIO_RECEIVED,We.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,i)=>{this.reportVideoFirstFrameDecoded(e,n,i)},t.onFirstVideoReceived=e=>{var n;const i=Array.from(ia(n=this.remoteUserMap).call(n)).find(r=>r._videoSSRC===e);i&&gt.firstRemoteFrame(this.store.sessionId,jn.FIRST_VIDEO_RECEIVED,We.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:yi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const i=e.candidateType==="relay",r=n.candidateType==="relay";n.candidateType!=="unknown"&&i===r||this.emit(vt.ConnectionTypeChange,i),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ed(n))," -> ").concat(JSON.stringify(Ed(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ed(n))," -> ").concat(JSON.stringify(Ed(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(vt.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===Qi.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,S.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===Qi.SEND_ONLY?this.restartICE(t):ui(this,vt.RequestP2PRestartICE,{direction:Qi.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(X.LocalAudioTrack);if(t instanceof sn&&(n==null?void 0:n.track)instanceof Dn)return n.track.isActive||e.push([X.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i&&(e.push(i),i[0]===X.LocalVideoTrack)){const r=this.localTrackMap.get(X.LocalVideoLowTrack);r&&e.push([X.LocalVideoLowTrack,r])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(X.LocalAudioTrack);if(t instanceof sn&&(n==null?void 0:n.track)instanceof Dn)return n.track.isActive&&e.push([X.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find(r=>{let[,{track:s}]=r;return t===s});if(i)if(i[0]===X.LocalVideoTrack){e.push(i);const r=this.localTrackMap.get(X.LocalVideoLowTrack);r&&e.push([X.LocalVideoLowTrack,r])}else e.push(i);return e}createMuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case X.LocalAudioTrack:i=Ee.Audio;break;case X.LocalVideoTrack:i=rt(n=s._hints).call(n,Ce.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case X.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:c,mid:l}})}createUnmuteMessage(t){return t.map(e=>{var n;let i,[r,{track:s,ssrcs:c,id:l}]=e;switch(r){case X.LocalAudioTrack:i=Ee.Audio;break;case X.LocalVideoTrack:i=rt(n=s._hints).call(n,Ce.SCREEN_TRACK)?Ee.Screen:Ee.High;break;case X.LocalVideoLowTrack:i=Ee.Low}return{stream_type:i,ssrcs:c,mid:l}})}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach(r=>{let[s,c]=r;n.push([t,{kind:s,id:c}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[i,{kind:r,id:s}]=n;switch(r){case ut.VIDEO:return void(i._videoSSRC&&e.push({stream_type:ut.VIDEO,ssrcId:i._videoSSRC}));case ut.AUDIO:return void(i._audioSSRC&&e.push({stream_type:ut.AUDIO,ssrcId:i._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:i}]=e;const r=this.remoteUserMap.get(n);r&&(r.delete(i),Array.from(r.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(X.LocalVideoTrack),n=this.localTrackMap.get(X.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(t.uplink),await new st((i,r)=>{this.handleUpdateVideoEncoder(e.track,i,r,!0)})),n&&t.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new st((i,r)=>{this.handleUpdateVideoEncoder(n.track,i,r,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof sn){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await Ie(this,vt.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(vt.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(vt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ni(jb(this.dtlsFailedCount,In)),this.emit(vt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(X.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof xe)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof xe).length>1)throw new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof sn).length>1&&(t.some(e=>e instanceof sn&&e._bypassWebAudio)||!se().webAudioMediaStreamDest))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof xe&&this.pendingLocalTracks.some(n=>n instanceof xe))throw new G(O.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof sn&&this.pendingLocalTracks.some(n=>n instanceof sn)&&(!se().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof sn&&n._bypassWebAudio)))throw new G(O.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!N("DISABLE_DUAL_STREAM_USE_ENCODING")&&se().supportDualStreamEncoding,i=Oy(Oy({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=n?t._mediaStreamTrack.clone():QI(t,i);const s=Le(8,"track-low-"),c=new xe(r,Oy(Oy({},n&&{scaleResolutionDownBy:PI(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,s);return c.on(eh.TRANSCEIVER_UPDATED,l=>{t._updateRtpTransceiver(l,If.LOW_STREAM)}),c._hints.push(Ce.LOW_STREAM),t.addListener(_t.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(ia(r=this.remoteUserMap).call(r)).find(c=>c._videoSSRC===t);if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(d=>d.userId===s.uid&&d.type==="video");gt.firstRemoteVideoDecode(this.store.sessionId,jn.FIRST_VIDEO_DECODE,We.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:yi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.recvConnection.getRemoteSSRC(r);return s!==void 0&&s!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new G(O.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new G(O.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new G(O.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new G(O.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new G(O.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new G(O.NOT_SUPPORTED)}async preConnect(t){throw new G(O.NOT_SUPPORTED)}getEstablishParams(){throw new G(O.NOT_SUPPORTED)}async reSubscribe(t){throw new G(O.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new G(O.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===X.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,If.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Et(ze.prototype,"p2pConnect",[j2],Object.getOwnPropertyDescriptor(ze.prototype,"p2pConnect"),ze.prototype),Et(ze.prototype,"unpublish",[G2],Object.getOwnPropertyDescriptor(ze.prototype,"unpublish"),ze.prototype),Et(ze.prototype,"unpublishLowStream",[H2],Object.getOwnPropertyDescriptor(ze.prototype,"unpublishLowStream"),ze.prototype),Et(ze.prototype,"subscribe",[W2],Object.getOwnPropertyDescriptor(ze.prototype,"subscribe"),ze.prototype),Et(ze.prototype,"mockSubscribe",[K2],Object.getOwnPropertyDescriptor(ze.prototype,"mockSubscribe"),ze.prototype),Et(ze.prototype,"unsubscribe",[z2],Object.getOwnPropertyDescriptor(ze.prototype,"unsubscribe"),ze.prototype),Et(ze.prototype,"muteRemote",[Y2],Object.getOwnPropertyDescriptor(ze.prototype,"muteRemote"),ze.prototype),Et(ze.prototype,"unmuteRemote",[q2],Object.getOwnPropertyDescriptor(ze.prototype,"unmuteRemote"),ze.prototype),Et(ze.prototype,"hasRemoteMediaWithLock",[X2],Object.getOwnPropertyDescriptor(ze.prototype,"hasRemoteMediaWithLock"),ze.prototype),Et(ze.prototype,"disconnectForReconnect",[J2],Object.getOwnPropertyDescriptor(ze.prototype,"disconnectForReconnect"),ze.prototype),Et(ze.prototype,"remoteMediaSsrcChanged",[Q2],Object.getOwnPropertyDescriptor(ze.prototype,"remoteMediaSsrcChanged"),ze.prototype),ze);function $s(t){return function(e,n,i){const r=e[n];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];switch(t){case Zs.SEND_ONLY:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}case Zs.RECEIVE_ONLY:{const d=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d()}}default:{const d=await this.sendMutex.lock("From P2PChannel2.".concat(n)),h=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,c)}finally{d(),h()}}}},i}}class Sh extends Xe{constructor(e,n){super(),A(this,"signal",void 0),A(this,"token",void 0),A(this,"tokenTimeout",void 0),A(this,"tokenInterval",void 0),A(this,"_sequence",0),A(this,"userMap",new Map),A(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const i=()=>{this.signal.connectionState===Me.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*N("P2P_TOKEN_INTERVAL"))};i()}async send(e,n,i,r,s){var c;if(this.userMap.size===0)return;const l=Array.from(ar(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),r=r??Le(6,""),s=s??this._sequence++;const d={_id:r,_type:e,_seq:s,_message:n,token:"".concat(this.token,"_").concat(l)};N("SHOW_P2P_LOG")&&S.debug("send message",d,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(d)).forEach(p=>{this.signal.request(bt.DATA_STREAM,{payload:hd(this.encoder.encode(p))})});const h=new st((p,_)=>{const m=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),g),this.off("res-@".concat(r),R),this.off(Ff.ABORT,C),S.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),this.userMap.size===0?_(new G(O.INVALID_REMOTE_USER)):_(new G(O.TIMEOUT))},N("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),g=()=>{m&&window.clearTimeout(m),this.off(Ff.ABORT,C),i&&p()},C=()=>{m&&window.clearTimeout(m),this.off("res-@".concat(r,"_ack"),g),this.off("res-@".concat(r),R),_(new G(O.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(Ff.ABORT,C),this.once("res-@".concat(r,"_ack"),g);const R=(b,I)=>{y=!0,m&&window.clearTimeout(m),this.off("res-@".concat(r,"_ack"),g),this.off(Ff.ABORT,C),b==="success"?p(I):_(new G(O.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let y=!1;i||(this.once("res-@".concat(r),R),ni(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{y||S.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(d))}))});try{return await h}catch(p){if(p.code===O.TIMEOUT)return await this.send(e,n,i,r,s);throw p}}onMessage(e){var n;const{_uid:i}=e;let r,s=this.userMap.get(i);if(s)r=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==En.CHECK)return;const{token:h}=e;r=new Map,s={uid:i,isStart:!0,token:h,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,s),this.signal.emit(Jt.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in e&&"total"in e){var c;const{id:h,total:p}=e,_=(c=r.get(h))!==null&&c!==void 0?c:[];if(_.push(e),r.has(h)||r.set(h,_),_.length!==p)return;{const m=Mt(_).call(_,(g,C)=>g.index-C.index).map(g=>g.payload).join("");r.delete(h),(e=JSON.parse(m))._uid=i}}const{_type:l,token:d}=e;if(rt(n=[En.ACK,En.CHECK]).call(n,l))return l===En.CHECK&&this.handleCheckToken(s,d),void this.receiveMessage(e);d==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(e):S.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(s.token,"_").concat(this.token),e)}check(){const e={_id:Le(6,""),token:this.token,_type:En.CHECK};N("SHOW_P2P_LOG")&&S.debug("send message",e),this.signal.request(bt.DATA_STREAM,{payload:hd(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:En.ACK,token:this.token};N("SHOW_P2P_LOG")&&S.debug("send message",n),this.signal.request(bt.DATA_STREAM,{payload:hd(this.encoder.encode(JSON.stringify(n)))})}response(e,n,i){this.send(En.RESPONSE,JSON.stringify({success:!i,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(h=>{const{receivedMessagesMap:p,nextExpectedSequenceNumber:_}=h;for(;p.has(_);){const m=p.get(_);p.delete(_),this.receiveMessage(m),h.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:i,_seq:r}=e,s=this.userMap.get(i),{receivedMessagesMap:c,isStart:l,nextExpectedSequenceNumber:d}=s;if(r<d)return this.ack(e._id),void S.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));c.set(r,e),l&&r===d&&(this.receiveMessage(e),c.delete(d),s.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:i,_message:r,_uid:s}=e;if(N("SHOW_P2P_LOG")&&S.debug("receive message",e),n){let c;switch(e._type!==En.ACK&&(r&&(c=JSON.parse(r)),this.ack(e._id)),e._type){case En.CANDIDATE:case En.CONTROL:this.signal.emit(i,c,s);break;case En.PUBLISH:case En.UNPUBLISH:case En.RESTART_ICE:case En.CALL:c.uid=s,ui(this.signal,i,c).then(l=>{this.response(e._id,l)}).catch(()=>{this.response(e._id,void 0,!0)});break;case En.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case En.RESPONSE:{const{success:l,message:d}=c;this.emit("res-@".concat(n),l?"success":"failed",d);break}}}}splitMessage(e){if(e.length<Sh.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:i}=JSON.parse(e),r=Le(6,"");let s=0,c=800;const l=Math.ceil(e.length/c);for(;e.length>0;){s++;const d={id:r,index:s,total:l,payload:e.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(d).length>Sh.MAX_MESSAGE_SIZE?c-=50:(n.push(d),e=e.slice(c))}return n.map(d=>JSON.stringify(d))}handleCheckToken(e,n){return e.token!==n?(S.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{S.debug("token timeout, ".concat(n)),this.reset(e.uid)},N("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await ui(this.signal,En.CALL,void 0),n=await this.send(En.CALL,e);this.signal.emit(Dt.P2P_CONNECTION,n,!0)}async reset(e,n){const i=this.userMap.get(e);i&&(this.emit(Ff.ABORT),this.signal.emit(Jt.ON_USER_OFFLINE,{uid:i.uid,reason:EG.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(S.debug("change local token from ".concat(n," to ").concat(n)),this.token=Le(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Ff.ABORT)}}A(Sh,"MAX_SIZE",1),A(Sh,"MAX_MESSAGE_SIZE",1024);class Z6 extends Xe{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Me.CONNECTED?this.emit(Dt.WS_CONNECTED):e===Me.RECONNECTING?this.emit(Dt.WS_RECONNECTING,this._websocketReconnectReason):e===Me.CLOSED&&this.emit(Dt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),A(this,"_disconnectedReason",void 0),A(this,"_websocketReconnectReason",void 0),A(this,"_connectionState",Me.CLOSED),A(this,"reconnectToken",void 0),A(this,"p2pToken",void 0),A(this,"websocket",void 0),A(this,"openConnectionTime",void 0),A(this,"clientId",void 0),A(this,"lastMsgTime",Date.now()),A(this,"uploadCache",[]),A(this,"uploadCacheInterval",void 0),A(this,"rttRolling",new OL(5)),A(this,"pingpongTimer",void 0),A(this,"pingpongTimeoutCount",0),A(this,"joinResponse",void 0),A(this,"multiIpOption",void 0),A(this,"initError",void 0),A(this,"spec",void 0),A(this,"store",void 0),A(this,"_external_signal",void 0),A(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(Dt.ON_BINARY_DATA,i.data);const r=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(r,"_id")){const s="res-@".concat(r._id);this.emit(s,r._result,r._message)}else if(Object.prototype.hasOwnProperty.call(r,"_type")){switch(r._type){case Jt.ON_DATA_STREAM:return void this.handleDataStream(r._message);case Jt.MUTE_AUDIO:case Jt.MUTE_VIDEO:case Jt.ON_P2P_LOST:case Jt.ON_USER_ONLINE:return;case Jt.ON_USER_OFFLINE:const{uid:s}=r._message;return S.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(r._type,r._message),r._type===Jt.ON_NOTIFICATION&&this.handleNotification(r._message),r._type===Jt.ON_USER_BANNED)switch(r._message.error_code){case 14:this.close(_e.UID_BANNED);break;case 15:this.close(_e.IP_BANNED);break;case 16:this.close(_e.CHANNEL_BANNED)}if(r._type===Jt.ON_USER_LICENSE_BANNED)switch(r._message.error_code){case yt.ERR_LICENSE_MISSING:this.close(_e.LICENSE_MISSING);break;case yt.ERR_LICENSE_EXPIRED:this.close(_e.LICENSE_EXPIRED);break;case yt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(_e.LICENSE_MINUTES_EXCEEDED);break;case yt.ERR_LICENSE_PERIOD_INVALID:this.close(_e.LICENSE_PERIOD_INVALID);break;case yt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(_e.LICENSE_MULTIPLE_SDK_SERVICE);break;case yt.ERR_LICENSE_ILLEGAL:this.close(_e.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new DI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,N("JOIN_GATEWAY_USE_DUAL_DOMAIN"),N("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Me.CONNECTED&&this.reconnect("retry",di.OFFLINE)}),this.p2pToken=Le(6,""),this._external_signal=new Sh(this,this.p2pToken)}async request(e,n,i,r){const s=Le(6,""),c={_id:s,_type:e,_message:n},l=this.websocket.connectionID,d=()=>new st((C,R)=>{if(this.connectionState===Me.CONNECTED)return C();const y=()=>{this.off(Dt.WS_CLOSED,b),C()},b=()=>{this.off(Dt.WS_CONNECTED,y),R(new G(O.WS_ABORT))};this.once(Dt.WS_CONNECTED,y),this.once(Dt.WS_CLOSED,b)});if(this.connectionState!==Me.CONNECTING&&this.connectionState!==Me.RECONNECTING||e===bt.JOIN||e===bt.REJOIN||await d(),this.websocket.sendMessage(c,!0),r)return;const h=new st((C,R)=>{let y=!1;const b=(L,U)=>{y=!0,C({isSuccess:L==="success",message:U||{}}),this.off(Dt.WS_CLOSED,I),this.off(Dt.WS_RECONNECTING,I),this.emit(Dt.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),b);const I=()=>{R(new G(O.WS_ABORT,"type: ".concat(e))),this.off(Dt.WS_CLOSED,I),this.off(Dt.WS_RECONNECTING,I),this.off("res-@".concat(s),b)};this.once(Dt.WS_CLOSED,I),this.once(Dt.WS_RECONNECTING,I),ni(N("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||y||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Dt.REQUEST_TIMEOUT,e,n))})});let p=null;try{p=await h}catch(C){if(this.connectionState===Me.CLOSED||e===bt.LEAVE)throw new G(O.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?C.throw():e===bt.JOIN||e===bt.REJOIN?null:(await d(),await this.request(e,n))}if(p.isSuccess)return p.message;const _=Number(p.message.error_code||p.message.code),m=ng(_),g=new G(O.UNEXPECTED_RESPONSE,"".concat(m.desc,": ").concat(p.message.error_str),{code:_,data:p.message,desc:m.desc});return m.action==="success"?p.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(_,", message: ").concat(m.desc,", action: ").concat(m.action)),_===yt.ERR_TOO_MANY_BROADCASTERS?((e===bt.JOIN||e===bt.REJOIN)&&(this.initError=g,this.close()),g.throw()):m.action==="failed"?g.throw():m.action==="quit"?(this.initError=g,this.close(),g.throw()):(_===yt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",di.MULTI_IP)):this.reconnect(m.action,di.SERVER_ERROR),e===bt.JOIN||e===bt.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new st(i=>{const r=s=>{(!n||n(s))&&(this.off(e,r),i(s))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(tg.WRTC_STATS,n)}upload(e,n){const i={_type:e,_message:n};try{this.websocket.sendMessage(i)}catch{const s=N("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Me.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},N("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const i={_type:e,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(e,n,i){return await this._external_signal.send(e,n,i)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new st((n,i)=>{this.once(Dt.WS_CONNECTED,()=>n(this.joinResponse)),this.once(Dt.WS_CLOSED,()=>i(this.initError||new G(O.WS_ABORT))),this.connectionState=Me.CONNECTING,this.websocket.init(e).catch(i)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||_e.LEAVE,this.connectionState=Me.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Le(6,""),this._external_signal.clear(),this._external_signal=new Sh(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Dt.ABORT_P2P_EXECUTION);const e=await ui(this,Dt.REQUEST_JOIN_INFO),n=await this.request(bt.JOIN,e);if(!n)return this.emit(Dt.REPORT_JOIN_GATEWAY,O.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Dt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Me.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const i=Zu(e.payload),r=new TextDecoder().decode(i),s=JSON.parse(r);"total"in s&&"id"in s||rt(n=Object.values(En)).call(n,s._type)?(s._uid=e.uid,this._external_signal.onMessage(s)):this.emit(Jt.ON_DATA_STREAM,e)}catch{this.emit(Jt.ON_DATA_STREAM,e)}}handleNotification(e){S.debug("[".concat(this.clientId,"] receive notification: "),e);const n=ng(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(_e.UID_BANNED),void this.close()):void this.reconnect(n.action,di.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=N("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(S.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>N("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",di.TIMEOUT):this.request(bt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),N("REPORT_STATS")&&this.send(bt.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWebsocketEvents(){this.websocket.on(xt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Dt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(xt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(xt.CLOSED,()=>{this.connectionState=Me.CLOSED}),this.websocket.on(xt.FAILED,()=>{this._disconnectedReason=_e.NETWORK_ERROR,this.connectionState=Me.CLOSED}),this.websocket.on(xt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Me.CONNECTED?this.connectionState=Me.RECONNECTING:this.connectionState=Me.CONNECTING}),this.websocket.on(xt.WILL_RECONNECT,(e,n,i)=>{e!=="retry"?(S.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):S.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(e)}),this.websocket.on(xt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(Dt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof G&&e.code===O.UNEXPECTED_RESPONSE&&e.data.code===yt.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",di.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",di.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(xt.REQUEST_NEW_URLS,(e,n)=>{ui(this,Dt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(xt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Jt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const $6={name:"P2PChannel",create:function(t){let{store:e,statsCollector:n}=t;return new Q6(e,n)},createSubmodule:function(t){let{store:e,spec:n}=t;return new Z6(n,e)}};function $2(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function tx(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$2(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$2(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}class tH{constructor(e){A(this,"sessionDesc",void 0),A(this,"localCapabilities",void 0),A(this,"rtpCapabilities",void 0),A(this,"candidates",void 0),A(this,"_originCandidates",void 0),A(this,"iceParameters",void 0),A(this,"dtlsParameters",void 0),A(this,"setup",void 0),A(this,"currentMidIndex",void 0),A(this,"cname",void 0),e=Je(e);const{iceParameters:n,dtlsParameters:i,candidates:r,rtpCapabilities:s,setup:c,localCapabilities:l,sdkCodec:d,cname:h}=e,p=vr(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=r,this._originCandidates=Je(r),this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=l,this.cname=h;for(let _=0;_<p.mediaDescriptions.length;_++){const m=p.mediaDescriptions[_];if(m.attributes.iceUfrag=n.iceUfrag,m.attributes.icePwd=n.icePwd,m.attributes.fingerprints=i.fingerprints,m.attributes.candidates=r,m.attributes.setup=c,m.media.mediaType==="video"){m.media.fmts=s.videoCodecs.map(C=>C.payloadType.toString(10));let g=s.videoCodecs.filter(C=>{var R,y;return(R=C.rtpMap)===null||R===void 0?void 0:rt(y=R.encodingName.toLowerCase()).call(y,d)});g.length===0&&(g=s.videoCodecs),m.attributes.payloads=g,m.attributes.extmaps=s.videoExtensions}m.media.mediaType==="audio"&&(m.media.fmts=s.audioCodecs.map(g=>g.payloadType.toString(10)),m.attributes.payloads=s.audioCodecs,m.attributes.extmaps=s.audioExtensions),p.mediaDescriptions[_]=this.mungMediaDesc(m)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return pd(this.sessionDesc)}send(e,n,i){const{ssrcs:r,ssrcGroups:s}=ch(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(h=>e===ut.VIDEO?h.media.mediaType==="video":h.media.mediaType==="audio"),l=r[0].attributes.label,d=r[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(r),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(s),{id:l,mslabel:d}}batchSend(e){return e.map(n=>{let{kind:i,ssrcMsg:r}=n;return this.send(i,r,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],r=[],s=[];n.attributes.ssrcs.forEach(c=>{rt(e).call(e,c.attributes.label||"")?s.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{var l;rt(l=s.map(d=>d.ssrcId)).call(l,c.ssrcIds[0])||r.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=r})}mute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(e,n,i){e.forEach((r,s)=>{const c=r._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===c.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],r);this.sessionDesc.mediaDescriptions[l]=d})}stopReceiving(e){}updateCandidates(e){const n=this._originCandidates.filter(r=>r.transport==="udp"),i=[];if(n.forEach(r=>{i.push(tx(tx({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),n.length!==0){switch(e){case Ri.TCP_RELAY:this.candidates=i;break;case Ri.UDP_TCP_RELAY:case Ri.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=Je(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(e,n){const i=Je(e);return Hf(i,n),MI(i,n),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(i!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=r}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,n,i){const r=this.sessionDesc.mediaDescriptions.find(c=>e===ut.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(r){const c=r.attributes.ssrcs.find(l=>l.attributes.label===n);var s;c&&(c.attributes.label=i,(s=c.attributes.msid)===null||s===void 0||s.replace(n,i))}}mungMediaDesc(e){const n=Je(e);return kI(n),function(i){const r=i.attributes.extmaps.find(s=>KR(s.extensionName));r&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(r),1),i.attributes.payloads.forEach(s=>{const c=s.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&s.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(e){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===e)return[i]}}var Oe;function ex(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function wy(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ex(Object(n),!0).forEach(function(i){A(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ex(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}let eH=(Oe=class xg extends hM{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return rt(n=Object.keys(vR)).call(n,e)}))]}constructor(e,n){super(e,n),A(this,"store",void 0),A(this,"peerConnection",void 0),A(this,"remoteSDP",void 0),A(this,"initialOffer",void 0),A(this,"statsFilter",void 0),A(this,"useRTX",!1),A(this,"localCapabilities",void 0),A(this,"localCandidateCount",0),A(this,"allCandidatesReceived",!1),A(this,"establishPromise",void 0),A(this,"mutex",void 0),this.store=n,this.mutex=new Ti("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(xg.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=Yb(this.peerConnection,N("STATS_UPDATE_INTERVAL"),void 0,en()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=gd(e.sdp),i=ag(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:N("FILTER_VIDEO_FEC"),filterAudioFec:N("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=e,wy(wy({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:e.sdp})}catch(e){throw new G(O.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new tH(wy(wy({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new G(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var i=this;return Oa(function*(){const r=yield re(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=e.map(m=>i.peerConnection.addTrack(m._mediaStreamTrack)),c=yield re(i.peerConnection.createOffer()),l=vr(c.sdp),d=e.map(m=>{const g=m._mediaStreamTrack,C=l.mediaDescriptions.find(R=>R.attributes.mid===g.kind);if(!C)throw new Error("Cannot extract ssrc from mediaDescription.");return function(R,y,b){const I=R.attributes.ssrcs.filter(U=>U.attributes.label===y),L=R.attributes.ssrcGroups;if(I.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(L&&I.length>1){const U=L.find(x=>x.ssrcIds.indexOf(I[0].ssrcId)!==-1);return U?[{ssrcId:U.ssrcIds[0],rtx:b?U.ssrcIds[1]:void 0}]:[{ssrcId:I[0].ssrcId}]}return[{ssrcId:I[0].ssrcId}]}(C,g.id,i.useRTX)});let h;try{h=yield d}catch(m){throw s.forEach(g=>{li()&&g.replaceTrack(null),i.peerConnection.removeTrack(g)}),m}const p=i.mungSendOfferSDP(c.sdp,e);i.remoteSDP.receive(e,n,h);const _=i.remoteSDP.toString();return yield re(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield re(i.applySendEncodings(s,e)),yield re(i.peerConnection.setRemoteDescription({type:"answer",sdp:_})),e.map((m,g)=>{const C=m._mediaStreamTrack.id;return{localSSRC:d[g],id:C}})}catch(s){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var c;return e.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{li()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,i,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:s,mslabel:c}=this.remoteSDP.send(e,n,r),l=new st((p,_)=>{const m=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(s)))},1e4),g=C=>{const R=ae();if((R.name==="Safari"&&Number(R.version)===11||qi())&&C.track.id!==s&&C.streams[0].id===c){var y;const b=C.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(e,s,C.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(m),void p(b)}if(C.track.id===s)return this.peerConnection.removeEventListener("track",g),clearTimeout(m),void p(C.track)};this.peerConnection.addEventListener("track",g)}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),{track:await l,id:s}}catch(s){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var r;return e.indexOf(((r=i.track)===null||r===void 0?void 0:r.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(li()&&i.track)i.track.enabled=!1;else{const r=i.getParameters();r.encodings.forEach(s=>s.active=!1),i.setParameters(r)}})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var c;return e.indexOf(((c=s.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(li()&&s.track)s.track.enabled=!0;else{const c=s.getParameters();c.encodings.forEach(l=>l.active=!0),await s.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Oa(function*(){const i=yield re(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const r=se().supportPCSetConfiguration;if(e===Ri.RELAY&&!r)return;if(r){const h=n.peerConnection.getConfiguration(),p=e===Ri.RELAY?"relay":"all";h.iceTransportPolicy!==p&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(p,"]")),h.iceTransportPolicy=p,n.peerConnection.setConfiguration(h))}e!==Ri.RELAY&&n.remoteSDP.updateCandidates(e);const s=yield re(n.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=gd(s.sdp),{remoteIceParameters:l}=yield c.iceParameters;n.remoteSDP.restartICE(l);const d=n.remoteSDP.toString();yield re(n.peerConnection.setLocalDescription(s)),yield re(n.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(r){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),r)}finally{i()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new G(O.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(e,n){const i=this.peerConnection.getSenders().filter(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===e});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const i=this.peerConnection.getSenders().find(r=>{var s;return((s=r.track)===null||s===void 0?void 0:s.id)===n});i&&await i.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new G(O.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new G(O.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},N("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(KE(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...xg.turnServerConfigToIceServers(e.turnServer.servers)),N("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...xg.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var i;if(n||(n=this.peerConnection.getSenders().find(h=>{var p;return((p=h.track)===null||p===void 0?void 0:p.id)===e._mediaStreamTrack.id})),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!se().supportSetRtpSenderParameters)return S.warn("Browser not support set rtp-sender parameters");const r={},s={};if(e instanceof xe)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(N("DSCP_TYPE")&&Gc()){var c;const h=N("DSCP_TYPE");rt(c=["very-low","low","medium","high"]).call(c,h)&&(s.networkPriority=h)}const l=n.getParameters(),d=(i=l.encodings)===null||i===void 0?void 0:i[0];d&&Object.assign(d,s),Object.assign(l,r),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),await n.setParameters(l)}async applySendEncodings(e,n){try{if(!se().supportSetRtpSenderParameters||e.length!==n.length)return;for(let i=0;i<e.length;i++){const r=e[i],s=n[i];r&&s&&await this.updateRtpSenderEncodings(s,r)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const i=vr(e);return n.forEach((r,s)=>{const c=r._mediaStreamTrack,l=i.mediaDescriptions.find(d=>d.attributes.mid===c.kind);l&&Hf(l,r)}),pd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,i)=>{var r;(r=this.onFirstVideoDecoded)===null||r===void 0||r.call(this,e,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((s,c)=>{let{id:l,mslabel:d}=s;const{kind:h}=e[c];return new st((p,_)=>{const m=setTimeout(()=>{_(new Error("Cannot receive track, id: ".concat(l)))},1e4),g=C=>{const R=ae();if(R.name==="Safari"&&Number(R.version)===11&&C.track.id!==l&&C.streams[0].id===d){var y;const b=C.streams[0].getTracks()[0];return(y=this.remoteSDP)===null||y===void 0||y.updateTrackLabel(h,l,C.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(m),void p({track:b,id:l})}if(C.track.id===l)return this.peerConnection.removeEventListener("track",g),clearTimeout(m),void p({track:C.track,id:l})};this.peerConnection.addEventListener("track",g)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await st.all(n)}catch(n){throw new G(O.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(se().supportPCSetConfiguration){const n=xg.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Et(Oe.prototype,"connect",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"connect"),Oe.prototype),Et(Oe.prototype,"stopSending",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"stopSending"),Oe.prototype),Et(Oe.prototype,"receive",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"receive"),Oe.prototype),Et(Oe.prototype,"stopReceiving",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"stopReceiving"),Oe.prototype),Et(Oe.prototype,"muteRemote",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"muteRemote"),Oe.prototype),Et(Oe.prototype,"unmuteRemote",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"unmuteRemote"),Oe.prototype),Et(Oe.prototype,"muteLocal",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"muteLocal"),Oe.prototype),Et(Oe.prototype,"unmuteLocal",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"unmuteLocal"),Oe.prototype),Et(Oe.prototype,"close",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"close"),Oe.prototype),Et(Oe.prototype,"updateEncoderConfig",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"updateEncoderConfig"),Oe.prototype),Et(Oe.prototype,"updateSendParameters",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"updateSendParameters"),Oe.prototype),Et(Oe.prototype,"replaceTrack",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"replaceTrack"),Oe.prototype),Et(Oe.prototype,"getRemoteSSRC",[Ma],Object.getOwnPropertyDescriptor(Oe.prototype,"getRemoteSSRC"),Oe.prototype),Oe);function Ma(t,e,n){const i=t[e];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const r=this.mutex,s=await r.lock("Locking from P2PConnection.".concat(e));try{for(var c=arguments.length,l=new Array(c),d=0;d<c;d++)l[d]=arguments[d];return await i.apply(this,l)}finally{s()}},n}const nH={name:"PlanBConnection",create:function(t){let{store:e,spec:n}=t;return new eH(n,e)}},iH={interceptLocalAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!se().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(wR.has(t)||!t.track)return;const n={track:t.track};if(jc()){if(!t.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void S.error("create audio-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(S.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=e.metadata&&e.metadata();d?function(h,p){const{chunk:_,controller:m}=p,g=N("ENABLE_AUDIO_PTS_METADATA")?Kc.AUDIO_64_BIT_PTS:Kc.METADATA;_.data=function(C,R,y){const b=y.byteLength,I=b+EI+Qk,L=_I+mI+I,U=new ArrayBuffer(C.byteLength+L),x=new DataView(U);x.setUint8(0,Jk),x.setUint16(1,I),x.setUint8(3,R),x.setUint16(4,b);for(let j=0;j<b;j++)x.setUint8(6+j,y[j]);const M=new Uint8Array(x.buffer);return M.set(new Uint8Array(C),L),M.buffer}(_.data,g,h),m.enqueue(_)}(d,{chunk:c,controller:l}):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(li()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const r=OR(),s=new MessageChannel;await new st(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-tx",port:s.port2},[s.port2]);t.transform=c,await new st(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;if(l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id)S.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i);else if(l.data.getMetadata){const h=e.metadata&&e.metadata();h&&s.port1.postMessage({metadata:h})}},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=wR.get(t);if(r){wR.delete(t);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){S.warning(l&&l.message)}}}wR.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!se().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(MR.has(t))return;const n={track:t.track,onMetadata:e.onMetadata};if(jc()){if(!t.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");Ob(de.CHROME,87,116)||(e.enableTopn=!1);let r=null;try{r=t.createEncodedStreams()}catch(c){return void S.error("create audio-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(S.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)),e.enableTopn?function(d,h,p){var _;const m=Zk(new DataView(h.data));if(!m)return p.enqueue(h);const g=d.track.id;x4.set(g,d.track);const C=(_=m.tlv.find(U=>U.tag===Kc.AUDIO_LEVEL))===null||_===void 0?void 0:_.value;let R=0;typeof C=="number"&&(R=127-C);const y=Math.round(Math.pow(10,R/60)-1),{selected:b,speaker:I}=function(U,x){let M=Uf.get(U);if(M||(M=function(j){const K=new tM;return Uf.set(j,K),Ys||(Ys=new M4(N("TOPN_SILENCE_THRESHOLD")||500),Ys.on("ActiveSpeakerChanged",it=>{it!=null&&(LR=it)})),Ys.addSpeakers([K]),K}(U)),Uf.size<=eM)return{selected:!0,speaker:M};if(!Ys)throw new Error("no active speaker detector");return Ys.levelChanged(M.id,x),ah=Ys.loudest.map(j=>j.id),LR&&!rt(ah).call(ah,LR)&&ah.length>=eM&&ah.pop(),{selected:rt(ah).call(ah,M.id)||M.id===LR,speaker:M}}(d,y),L=function(U,x,M){const j=qs.get(U)||new U4(U,x);return j.score=M,qs.set(U,j),function(K){if(PR.set(K,!0),!kR)return void(kR=Date.now());const it=Date.now();it-kR>1e3&&(PR.get(K)?PR.set(K,!1):(nM(K),PR.delete(K)),kR=it)}(U),j}(g,d.track,I.energyScore);L.addSample(b),L.active&&(h.data=m.frame.buffer,p.enqueue(h))}(t,c,l):e.enableMetadata?function(d,h,p){const _=Zk(new DataView(d.data));if(!_)return h.enqueue(d);const m=_.tlv.find(g=>g.tag===Kc.METADATA||g.tag===Kc.AUDIO_64_BIT_PTS);m&&p&&m.value instanceof Uint8Array&&p(m.value),d.data=_.frame.buffer,h.enqueue(d)}(c,l,e.onMetadata):l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(li()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const r=OR(),s=new MessageChannel;await new st(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"audio-metadata-rx",port:s.port2},[s.port2]);t.transform=c,await new st(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id?(S.debug("audio track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.metadata&&n.onMetadata&&n.onMetadata(l.data.metadata)},n.worker=r}function i(){t.track.removeEventListener("ended",i),function(r){const s=MR.get(r);if(s){(function(d){const h=Uf.get(d);h&&(Uf.delete(d),Ys&&(Ys.removeSpeakers([h]),Uf.size===0&&(Ys.destroy(),Ys=null)))})(r),nM(r.track.id),MR.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){S.warning(d&&d.message)}}}(t)}MR.set(t,n),t.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(t,e){if(!se().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(UR.has(t)||!t.track)return;const n={track:t.track};if(jc()){if(!t.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(l){return void S.error("create video-encoded-streams error",l&&l.message)}const s=[];e.on("sei-to-send",l=>{s.push(l)});const c=new TransformStream({transform(l,d){n.controller||(n.controller=d),t.track&&t.track.id!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const h=s.shift();h&&(l.data=function(p,_){const m=function(I){const L=I.length;let U=[],x=0;for(;x<L;)x+2<L&&I[x]===0&&I[x+1]===0&&(I[x+2]===0||I[x+2]===1||I[x+2]===2||I[x+2]===3)?(U.push(I[x],I[x+1],3,I[x+2]),x+=3):(U.push(I[x]),x++);return new Uint8Array(U)}(_),g=m.length,C=Math.floor(g/255),R=g%255,y=new Uint8Array(6+C+1+g+p.byteLength);y[0]=0,y[1]=0,y[2]=0,y[3]=1,y[4]=6,y[5]=101;let b=0;for(;b<C;)y[6+b]=255,b++;return y[6+b]=R,b++,y.set(m,6+b),y.set(new Uint8Array(p),6+b+g),y.buffer}(l.data,h)),d.enqueue(l)}});r.readable.pipeThrough(c).pipeTo(r.writable)}else{if(!li())return;{if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const r=OR(),s=new MessageChannel;await new st(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-tx",port:s.port2},[s.port2]);t.transform=c,await new st(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),e.on("sei-to-send",l=>{s.port1.postMessage({sei:l})}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i))},n.worker=r}}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}const r=UR.get(t);if(r){UR.delete(t);try{var s,c;(s=r.controller)===null||s===void 0||s.terminate(),(c=r.worker)===null||c===void 0||c.terminate()}catch(l){S.warning(l&&l.message)}}}UR.set(t,n),t.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!se().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(!t.track)return;if($E.has(t)){const r=$E.get(t);return void(r&&(r.onSei=e.onSei))}const n={track:t.track,onSei:e.onSei};if(jc()){if(!t.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let r=null;try{r=t.createEncodedStreams()}catch(c){return void S.error("create video-encoded-streams error",c&&c.message)}const s=new TransformStream({transform(c,l){n.controller||(n.controller=l),t.track&&t.track.id!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i));const d=function(h){const p=new DataView(h.data);let _=0;for(;_+4<h.data.byteLength;){if(p.getUint8(_+0)===0&&p.getUint8(_+1)===0&&p.getUint8(_+2)===0&&p.getUint8(_+3)===1&&p.getUint8(_+4)===6){let m=_+6,g=0,C=0;for(;(C=p.getUint8(m++))===255;)g+=255;g+=C;const R=V4(h.data,m,g);return new Uint8Array(R)}_++}return null}(c);d&&n.onSei&&n.onSei(d),l.enqueue(c)}});r.readable.pipeThrough(s).pipeTo(r.writable)}else if(li()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const r=OR(),s=new MessageChannel;await new st(l=>r.onmessage=d=>{d.data==="registered"&&l(void 0)});const c=new RTCRtpScriptTransform(r,{name:"sei-rx",port:s.port2},[s.port2]);t.transform=c,await new st(l=>r.onmessage=d=>{d.data==="started"&&l(void 0)}),s.port1.onmessage=l=>{var d;l.data.transformed&&t.track&&((d=t.track)===null||d===void 0?void 0:d.id)!==n.track.id?(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",i),n.track=t.track,n.track.addEventListener("ended",i)):l.data.sei&&n.onSei&&n.onSei(l.data.sei)},n.worker=r}function i(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",i)}(function(r){const s=$E.get(r);if(s){$E.delete(r);try{var c,l;(c=s.controller)===null||c===void 0||c.terminate(),(l=s.worker)===null||l===void 0||l.terminate()}catch(d){S.warning(d&&d.message)}}})(t)}$E.set(t,n),t.track.addEventListener("ended",i)}},rH={name:"InterceptFrame",create:()=>iH};qb(),Se("PROCESS_ID","process-".concat(Le(8,""),"-").concat(Le(4,""),"-").concat(Le(4,""),"-").concat(Le(4,""),"-").concat(Le(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void S.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();S.debug("Loading global parameters from cache",e),Object.keys(e).forEach(i=>{if(Object.prototype.hasOwnProperty.call(je,i)){const{value:r,expires:s}=e[i];if(s&&s<=n)return;zs[i]=r,je[i]=r}})}catch(e){S.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(zs.AREAS)&&zs.AREAS.length>0&&FI(zs.AREAS,!0);const nx=(t,e,n)=>{S.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),Se(t,e,n)};Sd(I6,!1),Sd(N6,!1),Sd(l5,!1),Sd(j6,!1),Sd(C6,!1),Sd($6,!1),Sd(nH,!1),Sd(rH,!1);const On=function(t){const e=new Xe,n=t,i={getListeners:e.getListeners.bind(e),on:(r,s)=>(function(c,l){c===Wo.SECURITY_POLICY_VIOLATION&&UU(l,!0)}(r,s),e.on.bind(e)(r,s)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return MU(MU({},n),i)}({__TRACK_LIST__:bf,VERSION:wa,BUILD:Qb,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:nx,getParameter:N,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(i){let r;return se().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),r=(await i.createOffer()).sdp):r=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,r}(e);if(!n)return t;e.close(),e=null,t=function(i){const r={video:[],audio:[]};return i.match(/ VP8/i)&&r.video.push("VP8"),i.match(/ VP9/i)&&r.video.push("VP9"),i.match(/ AV1/i)&&r.video.push("AV1"),i.match(/ H264/i)&&r.video.push("H264"),i.match(/ H265/i)&&r.video.push("H265"),i.match(/ opus/i)&&r.audio.push("OPUS"),i.match(/ PCMU/i)&&r.audio.push("PCMU"),i.match(/ PCMA/i)&&r.audio.push("PCMA"),i.match(/ G722/i)&&r.audio.push("G722"),r}(n)}catch(e){throw new B(O.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=gt.reportApiInvoke(null,{name:vn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:rn.TRACER});let e=!1;try{const s=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;e=!!(s&&c&&l),e&&Lb()&&iL(75)&&new s().close()}catch(s){return S.error("check system requirement failed: ",s),!1}let n=!1;const i=ae();i.name===de.CHROME&&Number(i.version)>=58&&(Ws.engine.name!=="WebKit"||function(){const s=ae();if(hR()){if(s.os===Fn.MAC_OS)return!0;if(s.os===Fn.IOS){const c=Ws.os.version&&Ws.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1}())&&(n=!0),(i.name===de.FIREFOX&&Number(i.version)>=56||i.name===de.OPERA&&Number(i.version)>=45||i.name===de.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(qi()||ss())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||lL()||ae().name===de.QQ)&&(n=!0),S.debug("checkSystemRequirements, api:",e,"browser",n);const r=e&&n;return t.onSuccess(r),r},getDevices:function(t){return ca.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return ca.getRecordingDevices(t)},getCameras:function(t){return ca.getCamerasDevices(t)},getElectronScreenSources:iP,getPlaybackDevices:function(t){return ca.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Le(5,"client-"),i=gt.reportApiInvoke(null,{id:n,name:vn.CREATE_CLIENT,options:[e],tag:rn.TRACER});try{(function(r){xn(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),xn(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&xn(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&ei(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&EL(r.turnServer),r.httpRetryConfig!==void 0&&mL(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&mL(r.websocketRetryConfig)})(e)}catch(r){throw i.onError(r),r}return(aL(16,0)||sL(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",S.debug("browser not support vp9, force use vp8")),Se("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),i.onSuccess(),new d5(ms(ms({forceWaitGatewayResponse:!0},e),{},{role:rt(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}),n)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=N("CAMERA_CAPTURE_CONFIG"),n=Le(8,"track-cam-"),i=gt.reportApiInvoke(null,{id:n,tag:rn.TRACER,name:vn.CREATE_CAM_VIDEO_TRACK,options:[Ke({},t),e]});e&&(t.encoderConfig=e);const r=IR(t);let s=null;S.info("start create camera video track with config",JSON.stringify(t),"trackId",n);try{s=(await oa({video:r},n)).getVideoTracks()[0]||null}catch(l){throw i.onError(l),l}if(!s){const l=new G(O.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(l),l.throw(S)}if(t.optimizationMode&&fI(n,s,t,ls(t.encoderConfig)),N("USE_STANDARD_BITRATE_DEFAULT")){const l=ls(t.encoderConfig);t.encoderConfig=l,delete l.bitrateMax,delete l.bitrateMin}const c=new pI(s,t,r,t.scalabiltyMode?yR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,n);return i.onSuccess(c.getTrackId()),S.info("create camera video success, trackId:",n),c},createCustomVideoTrack:function(t){const e=Le(8,"track-cus-"),n=gt.reportApiInvoke(null,{id:e,tag:rn.TRACER,name:vn.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});N("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const i=new xe(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?yR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,e,[Ce.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),S.info("create custom video track success with config",t,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof e=="object"?function(m){return pP(m)}(e):void 0;n&&(e="auto");const i=Le(8,"track-scr-v-"),r=gt.reportApiInvoke(null,{id:i,tag:rn.TRACER,name:vn.CREATE_SCREEN_VIDEO_TRACK,options:[Ke({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const s=function(m){const g={};m.screenSourceType&&(g.mediaSource=m.screenSourceType),m.extensionId&&jc()&&(g.extensionId=m.extensionId);const{displaySurface:C,selfBrowserSurface:R,surfaceSwitching:y,systemAudio:b,preferCurrentTab:I}=m;(jE(107)||wb(107)||Nb(93))&&(C&&(xn(C,"displaySurface",["browser","window","monitor"]),g.displaySurface=C),R?(xn(R,"selfBrowserSurface",["exclude","include"]),g.selfBrowserSurface=R):g.selfBrowserSurface="include",y&&(xn(y,"surfaceSwitching",["exclude","include"]),g.surfaceSwitching=y)),(jE(105)||wb(105)||Nb(91))&&b&&(xn(b,"systemAudio",["exclude","include"]),g.systemAudio=b),(jE(94)||wb(94)||Nb(80))&&I&&(g.preferCurrentTab=!0),m.electronScreenSourceId&&(g.sourceId=m.electronScreenSourceId);const L=m.encoderConfig?nI(m.encoderConfig):null;return g.mandatory={chromeMediaSource:"desktop",maxWidth:L?L.width:void 0,maxHeight:L?L.height:void 0},L&&(L.frameRate&&(typeof L.frameRate=="number"?(g.mandatory.maxFrameRate=L.frameRate,g.mandatory.minFrameRate=L.frameRate):(g.mandatory.maxFrameRate=L.frameRate.max||L.frameRate.ideal||L.frameRate.exact||void 0,g.mandatory.minFrameRate=L.frameRate.min||L.frameRate.ideal||L.frameRate.exact||void 0),g.frameRate=L.frameRate),L.width&&(g.width=L.width),L.height&&(g.height=L.height)),g}(t);let c=null,l=null;const d=se();if(!d.supportShareAudio&&e==="enable"){const m=new G(O.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return r.onError(m),m.throw(S)}S.info("start create screen video track with config",t,"withAudio",e,"trackId",i);const h=d.supportShareAudio&&e!=="disable";try{const m=await oa({screen:s,screenAudio:h?n||!0:void 0},i);c=m.getVideoTracks()[0]||null,l=m.getAudioTracks()[0]||null}catch(m){throw r.onError(m),m}if(!c){const m=new G(O.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(m),m.throw(S)}if(!l&&e==="enable"){c&&c.stop();const m=new G(O.SHARE_AUDIO_NOT_ALLOWED);return r.onError(m),m.throw(S)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(fI(i,c,t,t.encoderConfig&&nI(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const p=new xe(c,t.encoderConfig?nI(t.encoderConfig):{},t.scalabiltyMode?yR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[Ce.SCREEN_TRACK]);if(!l)return r.onSuccess(p.getTrackId()),S.info("create screen video track success","video:",p.getTrackId()),p;const _=new sn(l,void 0,Le(8,"track-scr-a-"),!1);return r.onSuccess([p.getTrackId(),_.getTrackId()]),S.info("create screen video track success","video:",p.getTrackId(),"audio:",_.getTrackId()),[p,_]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=N("CAMERA_CAPTURE_CONFIG"),i=Le(8,"track-mic-"),r=Le(8,"track-cam-"),s=gt.reportApiInvoke(null,{id:"".concat(i,"-").concat(r),tag:rn.TRACER,name:vn.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const c=IR(e),l=fP(t);let d=null,h=null;S.info("start create camera video track(".concat(r,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const m=await oa({audio:l,video:c},"".concat(i,"-").concat(r));d=m.getAudioTracks()[0],h=m.getVideoTracks()[0]}catch(m){throw s.onError(m),m}if(!d||!h){const m=new G(O.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(m),m.throw(S)}if(e.optimizationMode&&fI(r,h,e,ls(e.encoderConfig)),N("USE_STANDARD_BITRATE_DEFAULT")){const m=ls(e.encoderConfig);e.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}const p=new ZE(d,t,l,i),_=new pI(h,e,c,e.scalabiltyMode?yR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return s.onSuccess([p.getTrackId(),_.getTrackId()]),S.info("create camera video track(".concat(r,") and microphone audio track(").concat(i,") success")),[p,_]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Le(8,"track-mic-"),n=gt.reportApiInvoke(null,{id:e,tag:rn.TRACER,name:vn.CREATE_MIC_AUDIO_TRACK,options:[t]}),i=fP(t);let r=null;S.info("start create microphone audio track with config",JSON.stringify(t),"trackId",e);try{r=(await oa({audio:i},e)).getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}if(!r){const c=new G(O.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(S)}const s=new ZE(r,t,i,e);return n.onSuccess(s.getTrackId()),S.info("create microphone audio track success, trackId:",e),s},createCustomAudioTrack:function(t){const e=Le(8,"track-cus-"),n=gt.reportApiInvoke(null,{id:e,tag:rn.TRACER,name:vn.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),i=new sn(t.mediaStreamTrack,t.encoderConfig?CR(t.encoderConfig):{},e,!1);return S.info("create custom audio track success with config",t,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:i}=t;let{source:r}=t;const s={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":r,cacheOnlineFile:n,encoderConfig:i},c=Le(8,"track-buf-"),l=gt.reportApiInvoke(null,{id:c,tag:rn.TRACER,name:vn.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(N("DISABLE_WEBAUDIO"))throw new G(O.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");S.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",c);const d=r;if(!(r instanceof AudioBuffer))try{r=await async function(_,m){let g=null;if(typeof _=="string"){const R=tk.get(_);if(R)return S.debug("use cached audio resource: ",_),R;try{g=(await Ks(()=>sr.get(_,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(y){throw new G(O.FETCH_AUDIO_FILE_FAILED,y.toString())}}else g=await new st((y,b)=>{const I=new FileReader;I.onload=L=>{L.target?y(L.target.result):b(new G(O.READ_LOCAL_AUDIO_FILE_ERROR))},I.onerror=()=>{b(new G(O.READ_LOCAL_AUDIO_FILE_ERROR))},I.readAsArrayBuffer(_)});const C=await function(R){const y=Lf();return new st((b,I)=>{y.decodeAudioData(R,L=>{b(L)},L=>{I(new G(O.DECODE_AUDIO_FILE_FAILED,L.toString()))})})}(g);return typeof _=="string"&&m&&tk.set(_,C),C}(r,n)}catch(_){return l.onError(_),_.throw(S)}const h=new N4(r),p=new w4(d,h,i?CR(i):{},c);return S.info("create buffer source audio track success, trackId:",c),l.onSuccess(p.getTrackId()),p},setAppType:function(t){if(S.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw S.debug("Invalid appType"),new B(O.INVALID_PARAMS,"invalid app type",t);Se("APP_TYPE",Math.floor(t))},setLogLevel:function(t){S.setLogLevel(t)},enableLogUpload:function(){N("USE_NEW_LOG")?Se("UPLOAD_LOG",!0):S.enableLogUpload()},disableLogUpload:function(){N("USE_NEW_LOG")?Se("UPLOAD_LOG",!1):S.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new e1},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=gt.reportApiInvoke(null,{tag:rn.TRACER,name:vn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof sn||t instanceof Mf)){const d=new B(O.INVALID_TRACK,"the parameter is not a audio track");return n.onError(d),d.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof sn?t.getTrackLabel():"remote_track",r=t.getVolumeLevel();let s=r,c=r;const l=Date.now();return new st(d=>{const h=setInterval(()=>{const p=t.getVolumeLevel();s=p>s?p:s,c=p<c?p:c;const _=s-c>1e-4,m=Date.now()-l;if(_||m>e){clearInterval(h);const g=_,C={duration:m,deviceLabel:i,maxVolumeLevel:s,result:g};S.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(C))),n.onSuccess(C),d(g)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=gt.reportApiInvoke(null,{tag:rn.TRACER,name:vn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof xe||t instanceof kf)){const _=new B(O.INVALID_TRACK,"the parameter is not a video track");return n.onError(_),_.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof xe?t.getTrackLabel():"remote_track",r=t.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(li()||hR())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([r]),s.play();const c=document.createElement("canvas");c.width=160,c.height=120;let l=0,d=0;try{const _=Date.now();l=await function(m,g,C,R){let y,b=0,I=null;return new st((L,U)=>{function x(){b>R&&y&&(y(),L(b));const M=C.getContext("2d");if(!M){const it=new B(O.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(it.toString()),void U(it)}M.drawImage(m,0,0,160,120);const j=M.getImageData(0,0,C.width,C.height),K=Math.floor(j.data.length/3);if(I){for(let it=0;it<K;it+=3)if(j.data[it]!==I[it])return b+=1,void(I=j.data);I=j.data}else I=j.data}setTimeout(()=>{y&&(y(),L(b))},g),y=oI(()=>{x()},30)})}(s,e,c,4),d=Date.now()-_}catch(_){throw n.onError(_),_}JG===de.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const h=l>4,p={duration:d,changedPicNum:l,deviceLabel:i,result:h};return S.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),n.onSuccess(p),h},setArea:FI,audioElementPlayCenter:or,resumeAudioContext:function(){or.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){h5.processExternalMediaAEC(t)},registerExtensions:function(t){const e=N("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!rt(e).call(e,n.name)&&e.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=S.extLog,i.reporter.hookApiInvoke=gt.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(r=>{i.parameters[r]=N(r)})}),nx("PLUGIN_INFO",e)},ChannelMediaRelayError:Vf,ChannelMediaRelayEvent:Yc,ChannelMediaRelayState:Rr,RemoteStreamFallbackType:R4,RemoteStreamType:v4,ConnectionDisconnectedReason:_e,AudienceLatencyLevelType:Zj,AREAS:ue,preload:async function(t,e,n,i){return b1(t,e,n,i)}});return Object.defineProperties(On,{onAudioAutoplayFailed:{get:()=>la.onAudioAutoplayFailed,set:t=>{la.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>la.onAutoplayFailed,set:t=>{la.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>On._onSecurityPolicyViolation,set(t){On._onSecurityPolicyViolation=t,UU(t)}},__CLIENT_LIST__:{get:()=>N("SHOW_GLOBAL_CLIENT_LIST")?sh:[]}}),ca.on(nh.CAMERA_DEVICE_CHANGED,t=>{S.info("camera device changed",JSON.stringify(t)),On.onCameraChanged&&On.onCameraChanged(t),On.safeEmit(Wo.CAMERA_CHANGED,t)}),ca.on(nh.RECORDING_DEVICE_CHANGED,t=>{S.info("microphone device changed",JSON.stringify(t)),On.onMicrophoneChanged&&On.onMicrophoneChanged(t),On.safeEmit(Wo.MICROPHONE_CHANGED,t)}),ca.on(nh.PLAYOUT_DEVICE_CHANGED,t=>{S.debug("playout device changed",JSON.stringify(t)),On.onPlaybackDeviceChanged&&On.onPlaybackDeviceChanged(t),On.safeEmit(Wo.PLAYBACK_DEVICE_CHANGED,t)}),or.onAutoplayFailed=()=>{S.info("detect audio element autoplay failed"),la.onAudioAutoplayFailed&&la.onAudioAutoplayFailed()},Te.on("autoplay-failed",()=>{S.info("detect webaudio autoplay failed"),la.onAudioAutoplayFailed&&la.onAudioAutoplayFailed(),On.safeEmit(Wo.AUTOPLAY_FAILED)}),Te.on(ri.STATE_CHANGE,(t,e)=>{S.info("audio context state changed: ".concat(e," => ").concat(t)),On.onAudioContextStateChanged&&On.onAudioContextStateChanged(t,e),On.safeEmit(Wo.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),Rn.on(Tf.NETWORK_STATE_CHANGE,(t,e)=>{S.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=On),On})}(Py)),Py.exports}var gH=EH();const Ex=fx(gH),SH=({user:wt})=>{const on=nl.useRef();return nl.useEffect(()=>{wt.videoTrack&&wt.videoTrack.play(on.current)},[wt.videoTrack]),ha.jsx("div",{ref:on,style:{width:"200px",height:"150px",backgroundColor:"#000"}})},TH="86d24524d7e74010a5db49032a886241",vH="007eJxTYJgjaXfs/t5nqq73fhcdcs4+uCz86MJ6nlDX4rBf/889uPZPgcHCLMXIxNTIJMU81dzEwNAg0TQlycTSwNgo0cLCzMjE8HNmcUZDICODj4MrMyMDBIL4zAzlKVkMDAD1liD0",RH="wdj",Rh=Ex.createClient({mode:"rtc",codec:"vp8"}),yH=()=>{const[wt,on]=nl.useState([]),[Fe,nt]=nl.useState([]),[kt,jt]=nl.useState(!0),[hn,Ci]=nl.useState(!0),[Ht,St]=nl.useState(!0),zt=async(Mn,Sn)=>{var Ai;await Rh.subscribe(Mn,Sn),Sn==="video"&&on(Pi=>[...Pi,Mn]),Sn==="audio"&&((Ai=Mn.audioTrack)==null||Ai.play())},Yt=Mn=>{on(Sn=>Sn.filter(Ai=>Ai.uid!==Mn.uid))};nl.useEffect(()=>((async()=>{Rh.on("user-published",zt),Rh.on("user-left",Yt);const Sn=await Rh.join(TH,RH,vH,null),[Ai,Pi]=await Ex.createMicrophoneAndCameraTracks();nt([Ai,Pi]),on(Hn=>[...Hn,{uid:Sn,videoTrack:Pi,audioTrack:Ai}]),Pi.play(`local-player-${Sn}`),Ai.play(),await Rh.publish([Ai,Pi])})(),()=>{Rh.removeAllListeners(),Fe.forEach(Sn=>{Sn.stop(),Sn.close()}),Rh.leave()}),[]);const he=()=>{Fe[1]&&(Fe[1].setEnabled(!kt),jt(!kt))},Qn=()=>{Fe[0]&&(Fe[0].setEnabled(!hn),Ci(!hn))},le=()=>{wt.forEach(Mn=>{Mn.audioTrack&&Mn.audioTrack.setEnabled(!Ht)}),St(!Ht)};return ha.jsxs("div",{style:{textAlign:"center"},children:[ha.jsxs("div",{style:{marginBottom:"10px"},children:[ha.jsx("button",{onClick:he,style:{marginRight:"10px",backgroundColor:"lightyellow"},children:kt?"Turn Off Camera":"Turn On Camera"}),ha.jsx("button",{onClick:Qn,style:{marginRight:"10px",backgroundColor:"lightyellow"},children:hn?"Mute Microphone":"Unmute Microphone"}),ha.jsx("button",{onClick:le,children:Ht?"Mute Speaker":"Unmute Speaker"})]}),ha.jsx("div",{style:{display:"flex",justifyContent:"center"},children:ha.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 200px)",gap:"10px"},children:wt.map(Mn=>ha.jsx(SH,{user:Mn},Mn.uid))})})]})};function CH(){const[wt,on]=nl.useState(!1);return ha.jsxs("div",{className:"App",children:[ha.jsx("h1",{children:"HAL KORWA WEB VIRTUAL APP"}),!wt&&ha.jsx("button",{onClick:()=>on(!0),children:"Join Room"}),wt&&ha.jsx(yH,{})]})}_H.createRoot(document.getElementById("root")).render(ha.jsx(CH,{}));
